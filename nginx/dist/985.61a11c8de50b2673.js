"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[985],{4165:(et,U,I)=>{I.d(U,{W:()=>K});var m=I(2411),d=I(9232),W=I(7500);const F=Number.isInteger||function(o){return o<<0===o};function x(h){return"[object String]"===Object.prototype.toString.call(h)}const V=(0,W.Z)(function(o,r){var g=o<0?r.length+o:o;return x(r)?r.charAt(g):r[g]}),j=(0,W.Z)(function(o,r){return o.map(function(g){for(var S,u=r,_=0;_<g.length;){if(null==u)return;u=F(S=g[_])?V(S,u):u[S],_+=1}return u})}),nt=(0,W.Z)(function(o,r){return j([o],r)[0]}),it=(0,W.Z)(function(o,r){return o.map(function(g){return nt([g],r)})});var k=I(4182);const st=(0,W.Z)(function(o,r){return Number(o)+Number(r)});var b=I(2);function lt(h){return function o(r,g,u){switch(arguments.length){case 0:return o;case 1:return(0,b.Z)(r)?o:(0,W.Z)(function(_,S){return h(r,_,S)});case 2:return(0,b.Z)(r)&&(0,b.Z)(g)?o:(0,b.Z)(r)?(0,W.Z)(function(_,S){return h(_,g,S)}):(0,b.Z)(g)?(0,W.Z)(function(_,S){return h(r,_,S)}):(0,k.Z)(function(_){return h(r,g,_)});default:return(0,b.Z)(r)&&(0,b.Z)(g)&&(0,b.Z)(u)?o:(0,b.Z)(r)&&(0,b.Z)(g)?(0,W.Z)(function(_,S){return h(_,S,u)}):(0,b.Z)(r)&&(0,b.Z)(u)?(0,W.Z)(function(_,S){return h(_,g,S)}):(0,b.Z)(g)&&(0,b.Z)(u)?(0,W.Z)(function(_,S){return h(r,_,S)}):(0,b.Z)(r)?(0,k.Z)(function(_){return h(_,g,u)}):(0,b.Z)(g)?(0,k.Z)(function(_){return h(r,_,u)}):(0,b.Z)(u)?(0,k.Z)(function(_){return h(r,g,_)}):h(r,g,u)}}}const ht=Array.isArray||function(o){return null!=o&&o.length>=0&&"[object Array]"===Object.prototype.toString.call(o)},ct=(0,k.Z)(function(o){return!!ht(o)||!(!o||"object"!=typeof o||x(o))&&(1===o.nodeType?!!o.length:0===o.length||o.length>0&&o.hasOwnProperty(0)&&o.hasOwnProperty(o.length-1))});var mt=function(){function h(o){this.f=o}return h.prototype["@@transducer/init"]=function(){throw new Error("init not implemented on XWrap")},h.prototype["@@transducer/result"]=function(o){return o},h.prototype["@@transducer/step"]=function(o,r){return this.f(o,r)},h}();const ft=(0,W.Z)(function(o,r){return function(h,o){switch(h){case 0:return function(){return o.apply(this,arguments)};case 1:return function(r){return o.apply(this,arguments)};case 2:return function(r,g){return o.apply(this,arguments)};case 3:return function(r,g,u){return o.apply(this,arguments)};case 4:return function(r,g,u,_){return o.apply(this,arguments)};case 5:return function(r,g,u,_,S){return o.apply(this,arguments)};case 6:return function(r,g,u,_,S,E){return o.apply(this,arguments)};case 7:return function(r,g,u,_,S,E,N){return o.apply(this,arguments)};case 8:return function(r,g,u,_,S,E,N,P){return o.apply(this,arguments)};case 9:return function(r,g,u,_,S,E,N,P,Y){return o.apply(this,arguments)};case 10:return function(r,g,u,_,S,E,N,P,Y,z){return o.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}}(o.length,function(){return o.apply(r,arguments)})});function J(h,o,r){for(var g=r.next();!g.done;){if((o=h["@@transducer/step"](o,g.value))&&o["@@transducer/reduced"]){o=o["@@transducer/value"];break}g=r.next()}return h["@@transducer/result"](o)}function q(h,o,r,g){return h["@@transducer/result"](r[g](ft(h["@@transducer/step"],h),o))}var tt="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator";function yt(h,o,r){if("function"==typeof h&&(h=function(h){return new mt(h)}(h)),ct(r))return function(h,o,r){for(var g=0,u=r.length;g<u;){if((o=h["@@transducer/step"](o,r[g]))&&o["@@transducer/reduced"]){o=o["@@transducer/value"];break}g+=1}return h["@@transducer/result"](o)}(h,o,r);if("function"==typeof r["fantasy-land/reduce"])return q(h,o,r,"fantasy-land/reduce");if(null!=r[tt])return J(h,o,r[tt]());if("function"==typeof r.next)return J(h,o,r);if("function"==typeof r.reduce)return q(h,o,r,"reduce");throw new TypeError("reduce: list must be array or iterable")}const t=lt(yt)(st,0),n=(0,k.Z)(function(o){return t(o)/o.length}),p=function(h,o,r){const g=function(h,o){let r=new Map;return o.forEach(g=>{r.set(g.name,(0,d.yF)(g.samples,h))}),r}(o,r);let u=[];return u.length=h.length,h.forEach((_,S)=>{const E=function(h,o){let r=[];for(let[g,u]of o){const _=it(u,h);r.push(n(_))}return r}(_,g);u[S]=E}),u};var l=I(3692),y=I(3668);const i=function(h,o){return document.getElementById(h)?Promise.resolve():new Promise((g,u)=>{let _=document.createElement("script");document.body.appendChild(_),_.onload=()=>g(),_.onerror=S=>u(S.error),_.id=h,_.async=!0,_.src=o})},H=function(h){const r=h[0].length;let g=[];return g.length=h.length*r,h.forEach((u,_)=>{u.forEach((S,E)=>{g[_*r+E]=S})}),g};class c{constructor(o,r,g,u=null){this.node_id=o,this.xPos=r,this.yPos=g,this.children=u}}class f{constructor(o,r,g,u){this.nodesID2nodes=new Map,this.merge=o,this.height=r,this.order=g,this.rowNum=u}_computMaxHeight(){this.maxHeight=Math.max(...this.height)}_generateNodeIDFromMergeValue(o){return o<0?-o-1:o+this.rowNum-1}_generateLeavesNodes(){const o=1/this.rowNum;this.order.forEach((r,g)=>{const u=r-1,S=new c(u,1,o*(g+.5));this.nodesID2nodes.set(u,S)})}_generateNonLeavesNodes(){const o=this.rowNum-1;for(let r=0;r<o;r++){const g=r+this.rowNum,u=this._generateNodeIDFromMergeValue(this.merge[r]),_=this._generateNodeIDFromMergeValue(this.merge[r+o]),S=this.nodesID2nodes.get(u),E=this.nodesID2nodes.get(_),z=new c(g,1-this.height[r]/this.maxHeight,(S.yPos+E.yPos)/2,[E,S]);this.nodesID2nodes.set(g,z),this.nodesID2nodes.delete(u),this.nodesID2nodes.delete(_)}}resultTree(){return this._computMaxHeight(),this._generateLeavesNodes(),this._generateNonLeavesNodes(),new c(1e5,void 0,void 0,[this.nodesID2nodes.get(2*(this.rowNum-1))])}}var D=I(8260);const T=h=>h;let B=(()=>{class h{constructor(){this.resolveModule()}resolveModule(){i("hclustfastModule",D.N.wasmUrl+"hclustfast.js").then(()=>{const r={locateFile:u=>D.N.wasmUrl+"hclustfast.wasm"};return(this.moduleDecorator||T)(r),window.hclustfastModule(r)}).then(r=>{this.module=r,this.hclustWasmFunction=r.cwrap("hclustFastWasm",null,["number","number","number","number","number","number","number"])})}clusterUsingHclust(r,g){const u=r.length,_=r[0].length,S=H(r),E=this.module.HEAPF64.BYTES_PER_ELEMENT,N=new Float64Array(S),P=this.module._malloc(N.length*E);this.module.HEAPF64.set(N,P/E);const Y=this.module._malloc(2*(u-1)*this.module.HEAP32.BYTES_PER_ELEMENT),z=this.module._malloc((u-1)*this.module.HEAPF64.BYTES_PER_ELEMENT),X=this.module._malloc(u*this.module.HEAP32.BYTES_PER_ELEMENT);this.hclustWasmFunction(P,u,_,g,Y,z,X);let Lt=[],Ht=[],St=[];Lt.length=u;for(let O=0;O<u;O++)Lt[O]=this.module.HEAP32[X/Uint32Array.BYTES_PER_ELEMENT+O];Ht.length=u-1;for(let O=0;O<u-1;O++)Ht[O]=this.module.HEAPF64[z/Float64Array.BYTES_PER_ELEMENT+O];St.length=2*(u-1);for(let O=0;O<2*(u-1);O++)St[O]=this.module.HEAP32[Y/Uint32Array.BYTES_PER_ELEMENT+O];return this.module._free(P),this.module._free(Y),this.module._free(X),this.module._free(z),new f(St,Ht,Lt,u).resultTree()}}return h.\u0275fac=function(r){return new(r||h)},h.\u0275prov=y.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"}),h})();const w=h=>h;let M=(()=>{class h{constructor(){this.resolveModule()}resolveModule(){i("kmeansModule",D.N.wasmUrl+"kmeansLloyd.js").then(()=>{const r={locateFile:u=>D.N.wasmUrl+"kmeansLloyd.wasm"};return(this.moduleDecorator||w)(r),window.kmeansModule(r)}).then(r=>{this.module=r,this.kmeansWasmFunction=r.cwrap("kmeansLloydForWasm",null,["number","number","number","number","number"])})}clusterUsingKmeans(r,g){const u=r.length,_=r[0].length,S=H(r),E=this.module.HEAPF32.BYTES_PER_ELEMENT,N=new Float32Array(S),P=this.module._malloc(N.length*E);this.module.HEAPF32.set(N,P/E);const Y=this.module._malloc(u*this.module.HEAPU32.BYTES_PER_ELEMENT);this.kmeansWasmFunction(P,u,_,g,Y);let z=[];z.length=u;for(let X=0;X<u;X++)z[X]=this.module.HEAPU32[Y/Uint32Array.BYTES_PER_ELEMENT+X];return this.module._free(P),this.module._free(Y),z}}return h.\u0275fac=function(r){return new(r||h)},h.\u0275prov=y.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"}),h})();const C={single:0,complete:1,average:2};let K=(()=>{class h{constructor(r,g){this.wasmHclustFastService=r,this.wasmKmeansService=g}requestNormalizedValuesSpecificClusterResult(r){const g=l.Pn[r.experimentType](r.dataArray);let u,_;if("Across Samples"===r.acrossGroupsOrSamples?(u=[...g],_=r.samples):(u=p(g,r.samples,r.groups),_=r.groups.map(S=>S.name)),"Hierarchical"===r.clusterMethod){const S=C[r.clusterMethodSetting],E=this.wasmHclustFastService.clusterUsingHclust(u,S),N=this.wasmHclustFastService.clusterUsingHclust((0,d.Wy)(u),S);return(0,m.of)({leftDendgrogramInfor:E,topDendgrogramInfor:N,dataArray:u,leftUniqueTerms:r.genes,leftDisplayTerms:r.genes,topUniqueTerms:_,topDisplayTerms:_})}if("Kmeans"===r.clusterMethod){const S=this.wasmKmeansService.clusterUsingKmeans(u,r.clusterMethodSetting);return(0,m.of)({dataArray:u,clusterIndex:S,leftDisplayTerms:r.genes,leftUniqueTerms:r.genes,topDisplayTerms:_,topUniqueTerms:_})}}}return h.\u0275fac=function(r){return new(r||h)(y.LFG(B),y.LFG(M))},h.\u0275prov=y.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"}),h})()},9868:(et,U,I)=>{I.d(U,{h:()=>F});var m=I(4099),d=I(3668),W=I(1144);let F=(()=>{class x{constructor(V){this.router=V,this.keggPathwayFromOtherAppSubject=new m.X(null),this.geneListIDFromOtherAppSubject=new m.X(null),this.keggPathwayFromOtherApp$=this.keggPathwayFromOtherAppSubject.asObservable(),this.geneListIDFromOtherApp$=this.geneListIDFromOtherAppSubject.asObservable()}sendPathway2KeggExp(V){this.keggPathwayFromOtherAppSubject.next(V),this.router.navigate(["/KeggExp"])}sendGeneList2PPIExp(V){this.geneListIDFromOtherAppSubject.next(V),this.router.navigate(["/PPIExp"])}}return x.\u0275fac=function(V){return new(V||x)(d.LFG(W.F0))},x.\u0275prov=d.Yz7({token:x,factory:x.\u0275fac,providedIn:"root"}),x})()},2307:(et,U,I)=>{I.d(U,{H9:()=>m,pP:()=>d,Po:()=>W});const m=function(F){return F*parseFloat(getComputedStyle(document.documentElement).fontSize)*.8},d=function(F){return F*parseFloat(getComputedStyle(document.documentElement).fontSize)},W=function(F){return F*parseFloat(getComputedStyle(document.documentElement).fontSize)}},5150:(et,U,I)=>{I.d(U,{J:()=>_t});var m=I(3668),d=I(3203),W=I(4099),F=I(3405),x=I(8805),Z=I(8735),V=I(5686),Q=I(8105),j=I(2307),at=I(5043),nt=I(6019),rt=I(3856),it=I(8638);const k=["svgElement"],ot=["heatmap"],st=["heatmapCoverRects"],b=["verticalScaleIndicators"],lt=["leftDendgrogram"],ht=["leftDendgroCoverRects"],dt=["horizontalScaleIndicators"],ct=["topDendgrogram"],mt=["topDendgroCoverRects"],gt=["samplesAnnotations"],pt=["xLabels"],ut=["xLabelsCoverRects"],ft=["yLabels"],vt=["yLabelsCoverRects"],J=["colorScaleBar"],q=["upCoverForSelectNodes"],tt=["downCoverForSelectNodes"],yt=function(G,$,t){return{position:"fixed",left:G,top:$,visibility:t}};let _t=(()=>{class G{constructor(t){this.cdr=t,this.nodesSelected$=new m.vpe,this.nodeSelected$=new m.vpe,this.mapSettings$=new m.vpe,this.faToggleOff=at.Bl_,this.ifShowUnSelectElement=!1,this.unselectIfDisplay="hidden",this.width=300,this.height=500,this.marginTop=10,this.marginRight=30,this.marginBottom=50,this.marginLeft=5,this.padRight=10,this.padLeft=10,this.leftDendgroWidth=50,this.topDendgroHeight=50,this.heatmapWidth=200,this.verticalScaleIndicatorWidth=20,this.horizontalScaleIndicatorHeight=15,this.annotationBarHeight=10,this.dendgroIndicatorGap=3,this.xLabelRotationDegree=-30,this.xLabelsFontSize=1.5,this.yLablesFontSize=1,this.yLabelsWidth=100,this.indicatorAnnotationBarGap=2,this.annotationBarHeatmapGap=2,this.annotationWithinGap=1,this.basicSetting={width:300,height:500,marginTop:10,marginRight:30,marginBottom:50,marginLeft:5,leftDendgroWidth:50,topDendgroHeight:50,heatmapWidth:200,heatmapHeight:300,verticalScaleIndicatorWidth:20,horizontalScaleIndicatorHeight:15,xLabelRotationDegree:-30,xLabelsFontSize:1.5,yLabelsFontSize:.5,annotationBarHeight:10,indicatorAnnotationBarGap:2,annotationBarHeatmapGap:2,annotationWithinGap:1,yLabelsWidth:100,annotationLabelWidth:10},this.VERTICAL_MOVE_BAR_HEIGHT=10,this.HORIZONAL_MOVE_BAR_WIDTH=10,this.transformOneDirectionInfo={realTranslateX:0,realTranslateY:0,zoomTranslateX:0,zoomTranslateY:0,realScaleX:1,realScaleY:1,zoomScale:1},this.initialyLableYTranslate=[],this.initialxLableXTranslate=[],this.zoomFromScaleBar$=new W.X(null),this.zoomFromMapElements$=new W.X(null),this.mapSettingsDebouncer$=new W.X(null),this.destroyNotifier$=new F.xQ,this.mapSettingsDebouncer$.pipe((0,x.R)(this.destroyNotifier$),(0,Z.h)(e=>null!=e),(0,V.b)(1e3)).subscribe(e=>{this.mapSettings$.next(e)}),this.zoomFromMapElements$.pipe((0,x.R)(this.destroyNotifier$),(0,Z.h)(e=>null!=e),(0,Q.e)(this.auditTime)).subscribe(e=>{const{x:n,y:s,k:a,pointerX:p,pointerY:L}=e,l=this._computeRealZoomValues(n,s,a,p,L);this._transformMapUsingRealZoomValues(l.realTranslateX,l.realTranslateY,l.realScaleX,l.realScaleY),this._modifyVerticalScaleIndicatorsFromScroll(l.realTranslateY,l.realScaleY),this._modifyHorizontalScaleIndicatorsFromScroll(l.realTranslateX,l.realScaleX),this._toggleYlabelsVisibility(l.realScaleY),this._toggleXlabelsVisibility(l.realScaleX),this._updateTransformInfo(l),this._updateD3svg__zoom(l.zoomTranslateX,l.zoomTranslateY,l.zoomScale),this.selectedPathNode&&this._highlightRowsAndPathsWhenSelectingNodes(this.selectedPathNode,(0,d.Ys)(this.selectedPathNodeIdentifier)),this.mapSettings$.next({transform:Object.assign({},l),basicSetting:Object.assign({},this.basicSetting)})}),this.zoomFromScaleBar$.pipe((0,x.R)(this.destroyNotifier$),(0,Z.h)(e=>null!=e),(0,Q.e)(this.auditTime)).subscribe(e=>{const n=e.scaleBarSetting;if("vertical"===e.sourceOrientation){const s=this._convertScrollBarParameters2zoomParameters(e.sourceOrientation,n,Object.assign({},this.transformOneDirectionInfo));this._transformMapUsingRealZoomValues(s.realTranslateX,s.realTranslateY,s.realScaleX,s.realScaleY),this._updateTransformInfo(s),this._modifyVerticalScaleIndicators(n.smallEndRectLong,n.middleRectLong,n.bigEndRectLong,n.indicatorLong,this.VERTICAL_MOVE_BAR_HEIGHT),this.selectedPathNode&&this._highlightRowsAndPathsWhenSelectingNodes(this.selectedPathNode,(0,d.Ys)(this.selectedPathNodeIdentifier)),this._toggleYlabelsVisibility(s.realScaleY),this.mapSettings$.next({transform:Object.assign({},s),basicSetting:Object.assign({},this.basicSetting)})}else if("horizontal"===e.sourceOrientation){const s=this._convertScrollBarParameters2zoomParameters(e.sourceOrientation,n,Object.assign({},this.transformOneDirectionInfo));this._transformMapUsingRealZoomValues(s.realTranslateX,s.realTranslateY,s.realScaleX,s.realScaleY),this._updateTransformInfo(s),this._modifyHorizontalScaleIndicators(n.smallEndRectLong,n.middleRectLong,n.bigEndRectLong,n.indicatorLong,this.HORIZONAL_MOVE_BAR_WIDTH),this._toggleXlabelsVisibility(s.realScaleX),this.mapSettings$.next({transform:Object.assign({},s),basicSetting:Object.assign({},this.basicSetting)})}})}ngOnInit(){}ngAfterViewInit(){this._actionWhenHiearchicalResultChanges()}ngOnChanges(t){t.hierarchicalResultForDisplay&&!t.hierarchicalResultForDisplay.isFirstChange()&&this._actionWhenHiearchicalResultChanges(),t.disSelectedNodes&&!t.disSelectedNodes.isFirstChange()&&this.disSelectedNodes&&(this.unselectIfDisplay="hidden",this._disHighlightRowsAndPathsWhenSelectingNodes(this.selectedPathNode),this._resetSelecteNodeIfClickedAttr(),this._resetSelectedPathNode())}ngOnDestroy(){this.destroyNotifier$.next(),this.destroyNotifier$.complete()}unSelectGenes(t){this._disHighlightRowsAndPathsWhenSelectingNodes(this.selectedPathNode),this._resetSelecteNodeIfClickedAttr(),this._resetSelectedPathNode(),this.unselectIfDisplay="hidden",this.nodesSelected$.next({clickedNode:"",selectedNodes:[]})}_actionWhenHiearchicalResultChanges(){this.hierarchicalResultForDisplay&&(this._removeGraphicAndResetSettings(),this._initMap())}_removeGraphicAndResetSettings(){if(this.d3Svg){let t=function(e){(0,d.Ys)(e).selectAll("*").remove()};t(this.heatmap.nativeElement),t(this.heatmapCoverRects.nativeElement),t(this.verticalScaleIndicators.nativeElement),t(this.leftDendgrogram.nativeElement),t(this.leftDendgroCoverRects.nativeElement),t(this.horizontalScaleIndicators.nativeElement),t(this.topDendgrogram.nativeElement),t(this.topDendgroCoverRects.nativeElement),t(this.samplesAnnotations.nativeElement),t(this.xLabels.nativeElement),t(this.xLabelsCoverRects.nativeElement),t(this.yLabels.nativeElement),t(this.yLabelsCoverRects.nativeElement),t(this.colorScaleBar.nativeElement),t(this.upCoverForSelectNodes.nativeElement),t(this.downCoverForSelectNodes.nativeElement)}this.transformOneDirectionInfo={realTranslateX:0,realTranslateY:0,zoomTranslateX:0,zoomTranslateY:0,realScaleX:1,realScaleY:1,zoomScale:1},this.initialyLableYTranslate=[],this.initialxLableXTranslate=[],this.unselectIfDisplay="hidden"}_initMap(){this.d3Svg=(0,d.Ys)(this.svgElement.nativeElement),this._prepareVisData(),this._obtainBasicSettings(),this._obtainTransform(),this._drawLeftDendgro(),this._drawHeatmap(),this._addYLabels(),this._addXlabels(),this._addCoverBoxes(),this._drawTopDendgro(),this._drawSamplesAnnotations(),this._addVerticalScaleIndicators(),this._addHorizontalScaleIndicators(),this._addColorScaleBar(),this._zoomMap(),this._transformInitalMap(),this._modifyVerticalScaleIndicatorsFromScroll(this.transformOneDirectionInfo.realTranslateY,this.transformOneDirectionInfo.realScaleY),this._modifyHorizontalScaleIndicatorsFromScroll(this.transformOneDirectionInfo.realTranslateX,this.transformOneDirectionInfo.realScaleX),this._toggleYlabelsVisibility(this.transformOneDirectionInfo.realScaleY),this._toggleXlabelsVisibility(this.transformOneDirectionInfo.realScaleX)}_prepareVisData(){const t=this.hierarchicalResultForDisplay.clusterResult;this.leftDendgrogramInfor=t.leftDendgrogramInfor,this.topDendgrogramInfor=t.topDendgrogramInfor,this.heatmapArray=t.dataArray,this.leftDisplayTerms=t.leftDisplayTerms,this.topDisplayTerms=t.topUniqueTerms,this.leftUniqueTerms=t.leftUniqueTerms,this.topUniqueTerms=t.topUniqueTerms;let e=(0,d.ki8)().size([500,300]),n=(0,d.bT9)(this.leftDendgrogramInfor);e(n),this.leftDendgroRoot=n,this.leftDendgrogramLeavels=n.leaves(),this.leftDendgrogramLeavelsIDs=this.leftDendgrogramLeavels.map(i=>i.data.node_id),this.leftDendgrogramLeavelsLength=this.leftDendgrogramLeavels.length;let s=(0,d.ki8)(),a=(0,d.bT9)(this.topDendgrogramInfor);s(a),this.topDendgroRoot=a,this.topDendgrogramLeavels=a.leaves(),this.topDendgrogramLeavelIDs=this.topDendgrogramLeavels.map(i=>i.data.node_id);let p=n.descendants().slice(1).map(i=>"#LVNode"+i.data.node_id+",#LHNode"+i.data.node_id),L=n.leaves().map(i=>"#row"+i.data.node_id);this.allLeftLinksSelector=p.toString(),this.allLeftRowsSelector=L.toString();let l=[];this.heatmapArray.forEach(i=>{i.forEach(H=>{l.push(H)})}),this.allHeatmapValues=l,this.scaleForColor=(0,d.BYU)().domain([(0,d.VV$)(l),(0,d.Fp7)(l)]).range([0,1]);const y=this.hierarchicalResultForDisplay.colorScaleSetting;this.colorScale=(0,d.BYU)().domain([0,.5,1]).range([y.lowValueColor,y.middleValueColor,y.highValueColor])}_obtainBasicSettings(){const e=this.hierarchicalResultForDisplay.basicSetting,n=this.hierarchicalResultForDisplay.samplesAnnotations?this.hierarchicalResultForDisplay.samplesAnnotations:[];this.width=e.width,this.height=e.height,this.marginTop=e&&e.marginTop?e.marginTop:2,this.marginRight=e&&e.marginRight?e.marginRight:this._obtainMarginRight(),this.marginBottom=e&&e.marginBottom?e.marginBottom:this._obtainMarginBottom(),this.marginLeft=e&&e.marginLeft?e.marginLeft:2,this.leftDendgroWidth=e&&e.leftDendgroWidth?e.leftDendgroWidth:30,this.topDendgroHeight=e&&e.topDendgroHeight?e.topDendgroHeight:50,this.verticalScaleIndicatorWidth=e&&e.verticalScaleIndicatorWidth?e.verticalScaleIndicatorWidth:10,this.horizontalScaleIndicatorHeight=e&&e.horizontalScaleIndicatorHeight?e.horizontalScaleIndicatorHeight:10,this.heatmapWidth=e&&e.heatmapWidth?e.heatmapWidth:this._obtainHeatmapWidth(),this.heatmapHeight=e&&e.heatmapHeight?e.heatmapHeight:this._obtainHeatmapHeight(),this.annotationBarHeight=e&&e.annotationBarHeight?e.annotationBarHeight:10,this.xLabelRotationDegree=e&&e.xLabelRotationDegree?e.xLabelRotationDegree:-30,this.xLabelsFontSize=e&&e.xLabelsFontSize?e.xLabelsFontSize:1,this.yLabelsWidth=e&&e.yLabelsWidth?e.yLabelsWidth:100,this.yLablesFontSize=e&&e.yLabelsFontSize?e.yLabelsFontSize:1,this.indicatorAnnotationBarGap=e&&e.indicatorAnnotationBarGap?e.indicatorAnnotationBarGap:2,this.annotationBarHeatmapGap=e&&e.annotationBarHeatmapGap?e.annotationBarHeatmapGap:2,this.annotationWithinGap=e&&e.annotationWithinGap?e.annotationWithinGap:1,this.svgTop2SamplesAnnoHeight=this.marginTop+this.horizontalScaleIndicatorHeight+this.dendgroIndicatorGap+this.topDendgroHeight+this.indicatorAnnotationBarGap,this.svgTop2HeatmapHeight=this.svgTop2SamplesAnnoHeight+this.annotationBarHeight*n.length+this.annotationWithinGap*(n.length-1)+this.annotationBarHeatmapGap,this.svgLeft2HeatmapWidth=this.marginLeft+this.verticalScaleIndicatorWidth+this.dendgroIndicatorGap+this.leftDendgroWidth,this.heatmapInitRowHeight=this.heatmapHeight/this.heatmapArray.length,this.heatmapInitRectWidth=this.heatmapWidth/this.heatmapArray[0].length,this.Y_LABLE_CHARACTER_HEIGHT=(0,j.Po)(this.yLablesFontSize),this.X_LABLE_CHARACTER_WIDTH=(0,j.H9)(this.xLabelsFontSize),this.d3Svg.attr("width",this.width),this.d3Svg.attr("height",this.height),this.basicSetting=Object.assign(Object.assign({},this.basicSetting),{width:this.width,height:this.height,marginTop:this.marginTop,marginRight:this.marginRight,marginBottom:this.marginBottom,marginLeft:this.marginLeft,leftDendgroWidth:this.leftDendgroWidth,topDendgroHeight:this.topDendgroHeight,verticalScaleIndicatorWidth:this.verticalScaleIndicatorWidth,horizontalScaleIndicatorHeight:this.horizontalScaleIndicatorHeight,heatmapWidth:this.heatmapWidth,heatmapHeight:this.heatmapHeight,xLabelRotationDegree:this.xLabelRotationDegree,xLabelsFontSize:this.xLabelsFontSize}),this.ifDisplayLeftTermsWithRawOrder=this.hierarchicalResultForDisplay.ifDisplayLeftTermsWithRawOrder,this.ifDisplayTopTermsWithRawOrder=this.hierarchicalResultForDisplay.ifDisplayTopTermsWithRawOrder}_obtainTransform(){const t=Object.assign({},this.hierarchicalResultForDisplay.transform);this.transformOneDirectionInfo={realTranslateX:t.realTranslateX?t.realTranslateX:0,realTranslateY:t.realTranslateY?t.realTranslateY:0,zoomTranslateX:t.zoomTranslateX?t.zoomTranslateX:0,zoomTranslateY:t.zoomTranslateY?t.realTranslateY:0,realScaleX:t.realScaleX?t.realScaleX:1,realScaleY:t.realScaleY?t.realScaleY:1,zoomScale:t.zoomScale?t.zoomScale:1}}_obtainHeatmapWidth(){const t=this.width-this.marginLeft-this.marginRight-this.leftDendgroWidth-this.dendgroIndicatorGap-this.verticalScaleIndicatorWidth;return t>=.5*this.width?t:.5*this.width}_obtainHeatmapHeight(){return this.height-this.marginBottom-this.marginTop-this.topDendgroHeight-this.dendgroIndicatorGap-this.horizontalScaleIndicatorHeight}_drawLeftDendgro(){if(!this.ifDisplayLeftTermsWithRawOrder){let t=this;const e=this.heatmapHeight;let s=(0,d.Ys)(t.leftDendgrogram.nativeElement).attr("transform","translate("+(t.marginLeft+t.verticalScaleIndicatorWidth+t.dendgroIndicatorGap+20)+" "+t.svgTop2HeatmapHeight+")").append("g").attr("id","verticalDendgroLinks");const a=(l,y,i)=>{l.stopPropagation();let H=(0,d.Ys)(i);const v=H.attr("ifClick");if("false"===v){t._disHighlightRowsAndPathsWhenSelectingNodes(t.selectedPathNode),t._highlightRowsAndPathsWhenSelectingNodes(y,i),t._outputSelectedNodes(y,v),H.attr("ifClick",!0),t.selectedPathNodeIdentifier="#"+H.attr("id"),t.selectedPathNode=y;const c=document.getElementById(H.attr("id")).getBoundingClientRect(),f=c.top;t.unselectLeft=String(c.left)+"px",t.unselectTop=String(f+30)+"px",t.unselectIfDisplay="visible"}else t._disHighlightRowsAndPathsWhenSelectingNodes(t.selectedPathNode),t._outputSelectedNodes(y,v),H.attr("ifClick",!1),t.unselectIfDisplay="hidden",t._resetSelectedPathNode()};s.selectAll(".link").data(t.leftDendgroRoot.descendants().slice(1)).enter().append("path").attr("class","leftHorizontalLink linkGrey").style("cursor","pointer").attr("id",function(l){return"LHNode"+l.data.node_id}).attr("d",function(l){if(null!=l.parent.data.xPos)return"M"+t.leftDendgroWidth*l.parent.data.xPos+" "+e*l.data.yPos+"H"+t.leftDendgroWidth*l.data.xPos}).attr("ifClick",!1).on("click",function(l,y){a(l,y,this),t.cdr.detectChanges()}).style("stroke","grey"),s.selectAll(".link").data(t.leftDendgroRoot.descendants().slice(1)).enter().append("path").attr("class","leftVerticalLink linkGrey").style("cursor","pointer").attr("id",function(l){return"LVNode"+l.data.node_id}).attr("d",function(l){return null==l.parent.data.xPos||l.children?"M"+t.leftDendgroWidth*l.data.xPos+" "+e*l.children[0].data.yPos+"L"+t.leftDendgroWidth*l.data.xPos+" "+e*l.children[1].data.yPos:void 0}).attr("ifClick",!1).on("click",function(l,y){a(l,y,this),t.cdr.detectChanges()}).style("stroke","grey")}}_drawTopDendgro(){if(!this.ifDisplayTopTermsWithRawOrder){let t=this,e=(0,d.Ys)(t.topDendgrogram.nativeElement).attr("transform","translate("+t.svgLeft2HeatmapWidth+" "+(t.marginTop+t.horizontalScaleIndicatorHeight+t.dendgroIndicatorGap)+")");e.selectAll(".link").data(t.topDendgroRoot.descendants().slice(1)).enter().append("path").attr("class","topVerticalLink").attr("id",function(a){return"topNode"+a.data.node_id}).attr("d",function(a){if(null!=a.parent.data.yPos)return"M"+t.heatmapWidth*a.data.yPos+" "+t.topDendgroHeight*a.parent.data.xPos+"V"+t.topDendgroHeight*a.data.xPos}).style("stroke","grey"),e.selectAll(".link").data(t.topDendgroRoot.descendants().slice(1)).enter().append("path").attr("class","topHorizontalLink").attr("id",function(a){return"topNode"+a.data.node_id}).attr("d",function(a){return null==a.parent.data.yPos||a.children?"M"+t.heatmapWidth*a.children[0].data.yPos+" "+t.topDendgroHeight*a.data.xPos+"L"+t.heatmapWidth*a.children[1].data.yPos+" "+t.topDendgroHeight*a.data.xPos:void 0}).style("stroke","grey")}}_drawSamplesAnnotations(){let t=this;const e=this.hierarchicalResultForDisplay.samplesAnnotations?this.hierarchicalResultForDisplay.samplesAnnotations:[],s=this.heatmapWidth/this.heatmapArray[0].length,a=t.svgLeft2HeatmapWidth;let p=(0,d.Ys)(t.samplesAnnotations.nativeElement).attr("transform","translate("+a+" "+t.svgTop2SamplesAnnoHeight+")"),L=p.append("g").selectAll(".bar").data(e).enter().append("g").attr("transform",function(y,i){return"translate(0,"+(t.annotationBarHeight+t.annotationWithinGap)*i+")"});this.ifDisplayTopTermsWithRawOrder?L.selectAll(".rect").data(function(y){const H=t.topUniqueTerms.map(f=>y.annotationValues.get(f)),v=y.values2color;return H.map(f=>({annotationValue:f,color:v.get(f)}))}).enter().append("rect").attr("width",s).attr("height",t.annotationBarHeight).attr("x",function(y,i){return i*s}).style("fill",function(y){return y.color}):L.selectAll(".rect").data(function(y){const H=t.topDendgrogramLeavelIDs.reverse().map(f=>t.topUniqueTerms[f]).map(f=>y.annotationValues.get(f)),v=y.values2color;return H.map(f=>({annotationValue:f,color:v.get(f)}))}).enter().append("rect").attr("width",s).attr("height",t.annotationBarHeight).attr("x",function(y,i){return i*s}).style("fill",function(y){return y.color}),p.append("g").attr("transform","translate("+t.heatmapWidth+", 0)").selectAll(".barText").data(e).enter().append("text").attr("transform",function(y,i){return"translate(2,"+(i+.5)*(t.annotationBarHeight+t.annotationWithinGap)+")"}).text(function(y){return y.annotationName}).attr("dy","0.32em").style("font-size","1em").style("text-anchor","start")}_drawHeatmap(){this.ifDisplayLeftTermsWithRawOrder&&this.ifDisplayTopTermsWithRawOrder?this._drawHeatmapWithNoTopOrLeftDendgram():this.ifDisplayLeftTermsWithRawOrder&&!this.ifDisplayTopTermsWithRawOrder?this._drawHeatmapOnlyWithTopDendgram():!this.ifDisplayLeftTermsWithRawOrder&&this.ifDisplayTopTermsWithRawOrder?this._drawHeatmapOnlyWithLeftDendgram():this._drawHeatmapWithTopLeftDendgrogram()}_drawHeatmapWithTopLeftDendgrogram(){let t=this;const n=this.heatmapWidth/this.heatmapArray[0].length,s=this.leftDendgroRoot.leaves(),a=s.length,l=(s[0].data.yPos*t.heatmapHeight-s[a-1].data.yPos*t.heatmapHeight)/(a-1),y=t.svgLeft2HeatmapWidth+1;(0,d.Ys)(t.heatmap.nativeElement).attr("transform","translate("+y+" "+t.svgTop2HeatmapHeight+")").selectAll(".row").data(s).enter().append("g").style("cursor","pointer").attr("id",function(v){return"row"+v.data.node_id}).attr("transform",function(v,c){return"translate(0,"+(v.data.yPos*t.heatmapHeight-l/2)+")"}).attr("class","rowNormal").attr("ifClick",!1).on("dblclick",function(v,c){t.nodeSelected$.next(t.leftUniqueTerms[c.data.node_id])}).selectAll(".rect").data(function(v){const c=[...t.heatmapArray[v.data.node_id]];return t.topDendgrogramLeavelIDs.map(D=>c[D]).reverse()}).enter().append("rect").attr("width",n).attr("height",l).attr("x",function(v,c){return n*c}).style("stroke-width",0).style("fill",function(v,c){if(isNaN(v))return"white";{const f=t.scaleForColor(v);return t.colorScale(f)}})}_drawHeatmapWithNoTopOrLeftDendgram(){let t=this;const n=this.heatmapWidth/this.heatmapArray[0].length,s=this.leftDendgroRoot.leaves(),a=s.length,l=(s[0].data.yPos*t.heatmapHeight-s[a-1].data.yPos*t.heatmapHeight)/(a-1),y=t.svgLeft2HeatmapWidth+1;(0,d.Ys)(t.heatmap.nativeElement).attr("transform","translate("+y+" "+t.svgTop2HeatmapHeight+")").selectAll(".row").data(t.heatmapArray).enter().append("g").style("cursor","pointer").attr("transform",function(v,c){return"translate(0,"+c*l+")"}).attr("class","rowNormal").attr("ifClick",!1).on("dblclick",function(v,c){t.nodeSelected$.next(t.leftUniqueTerms[c.data.node_id])}).selectAll(".rect").data(function(v){return v}).enter().append("rect").attr("width",n).attr("height",l).attr("x",function(v,c){return n*c}).style("stroke-width",0).style("fill",function(v,c){if(isNaN(v))return"white";{const f=t.scaleForColor(v);return t.colorScale(f)}})}_drawHeatmapOnlyWithTopDendgram(){let t=this;const n=this.heatmapWidth/this.heatmapArray[0].length,s=this.leftDendgroRoot.leaves(),a=s.length,l=(s[0].data.yPos*t.heatmapHeight-s[a-1].data.yPos*t.heatmapHeight)/(a-1),y=t.svgLeft2HeatmapWidth+1;(0,d.Ys)(t.heatmap.nativeElement).attr("transform","translate("+y+" "+t.svgTop2HeatmapHeight+")").selectAll(".row").data(t.heatmapArray).enter().append("g").style("cursor","pointer").attr("transform",function(v,c){return"translate(0,"+c*l+")"}).attr("class","rowNormal").attr("ifClick",!1).on("dblclick",function(v,c){t.nodeSelected$.next(t.leftUniqueTerms[c.data.node_id])}).selectAll(".rect").data(function(v){return t.topDendgrogramLeavelIDs.map(f=>v[f]).reverse()}).enter().append("rect").attr("width",n).attr("height",l).attr("x",function(v,c){return n*c}).style("stroke-width",0).style("fill",function(v,c){if(isNaN(v))return"white";{const f=t.scaleForColor(v);return t.colorScale(f)}})}_drawHeatmapOnlyWithLeftDendgram(){let t=this;const e=this.heatmapArray[0].length,n=this.heatmapWidth/e;(0,d.BYU)().domain([0,e]).range([0,this.heatmapWidth]);const a=this.leftDendgroRoot.leaves(),p=a.length,y=(a[0].data.yPos*t.heatmapHeight-a[p-1].data.yPos*t.heatmapHeight)/(p-1),i=t.svgLeft2HeatmapWidth+1;(0,d.Ys)(t.heatmap.nativeElement).attr("transform","translate("+i+" "+t.svgTop2HeatmapHeight+")").selectAll(".row").data(a).enter().append("g").style("cursor","pointer").attr("id",function(c){return"row"+c.data.node_id}).attr("transform",function(c,f){return"translate(0,"+(c.data.yPos*t.heatmapHeight-y/2)+")"}).attr("class","rowNormal").attr("ifClick",!1).on("dblclick",function(c,f){t.nodeSelected$.next(t.leftUniqueTerms[f.data.node_id])}).selectAll(".rect").data(function(c){return[...t.heatmapArray[c.data.node_id]]}).enter().append("rect").attr("width",n).attr("height",y).attr("x",function(c,f){return n*f}).style("stroke-width",0).style("fill",function(c,f){if(isNaN(c))return"white";{const D=t.scaleForColor(c);return t.colorScale(D)}})}_addYLabels(){if(this.ifDisplayLeftTermsWithRawOrder){let t=this;const e=t.marginLeft+t.verticalScaleIndicatorWidth+t.leftDendgroWidth+t.heatmapWidth,n=t.marginTop+t.horizontalScaleIndicatorHeight+t.topDendgroHeight;let s=(0,d.Ys)(t.yLabels.nativeElement).attr("transform","translate("+e+" "+n+")").attr("visibility","hidden");const p=this.leftDendgroRoot.leaves().length,L=t.heatmapHeight/p;s.selectAll(".yLabels").data(t.leftDisplayTerms).enter().append("text").attr("transform",function(y,i){let H=i*L;return t.initialyLableYTranslate.push(H),"translate(0, "+H+")"}).text(function(y){return y}).style("text-anchor","start").attr("font-size",t.basicSetting.yLabelsFontSize+"em").attr("dy","0.32em")}else{let t=this;const e=t.marginLeft+t.verticalScaleIndicatorWidth+t.leftDendgroWidth+t.heatmapWidth,n=t.marginTop+t.horizontalScaleIndicatorHeight+t.topDendgroHeight;(0,d.Ys)(t.yLabels.nativeElement).attr("transform","translate("+e+" "+n+")").attr("visibility","hidden").selectAll(".yLabels").data(t.leftDendgrogramLeavels).enter().append("text").attr("transform",function(p,L){let l=p.data.yPos*t.heatmapHeight;return t.initialyLableYTranslate.push(l),"translate(0 "+l+")"}).text(function(p){return t.leftDisplayTerms[p.data.node_id]}).style("text-anchor","start").attr("font-size",t.basicSetting.yLabelsFontSize+"em").attr("dy","0.32em")}}_toggleYlabelsVisibility(t){(0,d.Ys)(this.yLabels.nativeElement).attr("visibility",t*this.heatmapInitRowHeight>=this.Y_LABLE_CHARACTER_HEIGHT?"visible":"hidden")}_toggleXlabelsVisibility(t){(0,d.Ys)(this.xLabels.nativeElement).attr("visibility",t*this.heatmapInitRectWidth>=this.X_LABLE_CHARACTER_WIDTH?"visible":"hidden")}_addXlabels(){let t=this;const e=t.heatmapWidth;let n=(0,d.Ys)(t.xLabels.nativeElement).attr("transform","translate("+t.svgLeft2HeatmapWidth+" "+(t.svgTop2HeatmapHeight+t.heatmapHeight+15)+")");if(this.ifDisplayTopTermsWithRawOrder){const s=t.heatmapWidth/t.topDisplayTerms.length;n.selectAll(".xLabels").data(t.topDisplayTerms).enter().append("text").attr("transform",function(p,L){let l=s*L;return t.initialxLableXTranslate.push(l),"translate("+l+",0) rotate("+t.xLabelRotationDegree+")"}).text(function(p){return p}).style("text-anchor","end").attr("font-size",t.xLabelsFontSize+"em").attr("dy","0.32em")}else n.selectAll(".xLabels").data(t.topDendgrogramLeavels).enter().append("text").attr("transform",function(a,p){let L=a.data.yPos*e;return t.initialxLableXTranslate.push(L),"translate("+L+",0) rotate("+t.xLabelRotationDegree+")"}).text(function(a){return t.topDisplayTerms[a.data.node_id]}).style("text-anchor","end").attr("font-size",t.xLabelsFontSize+"em").attr("dy","0.32em")}_addCoverBoxes(){this._addleftDendgroCoverRects(),this._addHeatmapCoverRects(),this._addTopDendgroCoverRects(),this._addXlabelsCoverRects(),this._addYlabelsCoverRects(),this._addCoversForSelectingNodes()}_addleftDendgroCoverRects(){var t=this;let e=(0,d.Ys)(t.leftDendgroCoverRects.nativeElement).attr("transform","translate(0 0)");e.append("rect").attr("height",t.svgTop2HeatmapHeight).attr("width",t.svgLeft2HeatmapWidth).attr("fill","white"),e.append("rect").attr("width",t.svgLeft2HeatmapWidth).attr("height",t.height-t.svgTop2HeatmapHeight-t.heatmapHeight+10).attr("y",t.svgTop2HeatmapHeight+t.heatmapHeight).attr("fill","white")}_addHeatmapCoverRects(){var t=this;let e=(0,d.Ys)(t.heatmapCoverRects.nativeElement).attr("transform","translate(0 0)");e.append("rect").attr("height",t.svgTop2HeatmapHeight).attr("width",t.width).attr("fill","white"),e.append("rect").attr("x",0).attr("y",t.svgTop2HeatmapHeight+t.heatmapHeight).attr("width",t.width).attr("height",t.height-t.svgTop2HeatmapHeight-t.heatmapHeight+10).attr("fill","white"),e.append("rect").attr("y",t.svgTop2HeatmapHeight).attr("x",-2).attr("width",t.svgLeft2HeatmapWidth).attr("height",t.heatmapHeight).attr("fill","white"),e.append("rect").attr("x",t.svgLeft2HeatmapWidth+t.heatmapWidth).attr("y",t.svgTop2HeatmapHeight).attr("width",t.marginRight+t.yLabelsWidth+2).attr("height",t.heatmapHeight).attr("fill","white")}_addTopDendgroCoverRects(){var t=this;let e=(0,d.Ys)(t.topDendgroCoverRects.nativeElement).attr("transform","translate(0 0)");e.append("rect").attr("height",t.svgTop2HeatmapHeight).attr("width",t.marginRight+t.yLabelsWidth).attr("x",t.svgLeft2HeatmapWidth+t.heatmapWidth).attr("fill","white"),e.append("rect").attr("height",t.svgTop2HeatmapHeight).attr("width",t.svgLeft2HeatmapWidth).attr("fill","white")}_addXlabelsCoverRects(){var t=this;(0,d.Ys)(t.xLabelsCoverRects.nativeElement).append("rect").attr("x",0).attr("y",t.svgTop2HeatmapHeight+t.heatmapHeight).attr("width",t.marginLeft+t.verticalScaleIndicatorWidth).attr("height",t.marginBottom).attr("fill","white")}_addYlabelsCoverRects(){var t=this;let e=(0,d.Ys)(t.yLabelsCoverRects.nativeElement);const n=t.svgLeft2HeatmapWidth+t.heatmapWidth;e.append("rect").attr("id","yLableTopCover").attr("transform","translate("+n+" 0)").attr("width",t.yLabelsWidth).attr("height",t.svgTop2HeatmapHeight).attr("fill","white");const s=t.svgLeft2HeatmapWidth+t.heatmapWidth,a=t.svgTop2HeatmapHeight+t.heatmapHeight;e.append("rect").attr("id","yLableDownCover").attr("transform","translate("+s+" "+a+")").attr("width",t.yLabelsWidth).attr("height",t.marginBottom).attr("fill","white")}_addColorScaleBar(){let t=this,p=[3];const L=this.hierarchicalResultForDisplay.samplesAnnotations?this.hierarchicalResultForDisplay.samplesAnnotations:[];L.forEach(w=>{p.push([...w.values2color.keys()].length)});const l=[t.marginTop+15];p.slice(0,p.length-1).forEach((w,M)=>{l.push(l[M]+(15+10*w+15))});const i=t.marginLeft+t.leftDendgroWidth+t.verticalScaleIndicatorWidth+t.heatmapWidth+t.yLabelsWidth,H=l[0];let f=(0,d.Ys)(t.colorScaleBar.nativeElement).attr("transform","translate("+i+","+H+")");f.append("g").append("text").text("Value").attr("transform","translate(0,-5)").style("text-anchor","start");let T=f.append("g");T.selectAll(".rect").data([0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1]).enter().append("rect").attr("class","grid").attr("width",15).attr("height",3).attr("transform",function(w,M){return"translate(0,"+3*M+")"}).style("fill",function(w,M){return t.colorScale(w)}),T.append("g").attr("transform","translate(15 0)").selectAll(".colorLabels").data(["Low","Medium","High"]).enter().append("text").attr("transform",function(w,M){return"translate(2 "+30*(M+.5)/3+")"}).text(function(w){return w}).attr("dy","0.32em").style("font-size","0.7em").style("text-anchor","start"),L.forEach((w,M)=>{const C=f.append("g");C.attr("transform","translate(0,"+l[M+1]+")"),C.append("g").append("text").text(w.annotationName).attr("transform","translate(0,10)").style("text-anchor","start");const h=w.values2color,o=[...h.keys()];C.append("g").attr("transform","translate(0,15)").selectAll(".rect").data(o).enter().append("rect").attr("class","grid").attr("width",15).attr("height",10).attr("transform",function(r,g){return"translate(0,"+10*g+")"}).style("fill",function(r,g){return h.get(r)}),C.append("g").attr("transform","translate(15,15)").selectAll(".annotationLabels").data(o).enter().append("text").attr("transform",function(r,g){return"translate(2,"+10*(g+.5)+")"}).text(function(r){return r}).attr("dy","0.32em").style("font-size","0.7em").style("text-anchor","start")})}_highlightRowsAndPathsWhenSelectingNodesChangeingClass(t){(0,d.td_)(this.allLeftRowsSelector).attr("class","rowDim");let s=t.descendants().map(l=>"#LHNode"+l.data.node_id+",#LVNode"+l.data.node_id).toString();(0,d.td_)(s).classed("linkGrey",!1).classed("linkRed",!0);let L=t.leaves().map(l=>l.data.node_id).map(l=>"#row"+l).toString();""!=L&&(0,d.td_)(L).attr("class","rowNormal")}_disHighlightRowsAndPathsWhenSelectingNodesUsingCover(t){if((0,d.Ys)("#upCoverForSelectNodes").attr("visibility","hidden"),(0,d.Ys)("#downCoverForSelectNodes").attr("visibility","hidden"),t){const e=t.leaves(),s=t.data.node_id;(0,d.td_)("#LHNode"+s+",#LVNode"+s+",#LHNode"+e[0].data.node_id+",#LHNode"+e[e.length-1].data.node_id).classed("linkRed",!1).classed("linkGrey",!0)}}_disHighlightRowsAndPathsWhenSelectingNodesChangingClass(){this.allLeftRowsSelector&&(0,d.td_)(this.allLeftRowsSelector).classed("rowNormal",!0).classed("rowDim",!1),this.allLeftLinksSelector&&(0,d.td_)(this.allLeftLinksSelector).classed("linkRed",!1).classed("linkGrey",!0)}_resetSelectedPathNode(){this.selectedPathNode=null,this.selectedPathNodeIdentifier=null}_resetSelecteNodeIfClickedAttr(){this.selectedPathNodeIdentifier&&(0,d.Ys)(this.selectedPathNodeIdentifier).attr("ifClick",!1)}_disHighlightRowsAndPathsWhenSelectingNodes(t){"useCover"===this.highlightUseCoverOrClass?this._disHighlightRowsAndPathsWhenSelectingNodesUsingCover(t):this._disHighlightRowsAndPathsWhenSelectingNodesChangingClass()}_highlightRowsAndPathsWhenSelectingNodesUsingCover(t){const e=t.leaves(),s=t.data.node_id,a=e[e.length-1].data.node_id,p=e[0].data.node_id;(0,d.td_)("#LHNode"+s+",#LVNode"+s+",#LHNode"+p+",#LHNode"+a).classed("linkRed",!0).classed("linkGrey",!1);const l=this.leftDendgrogramLeavelsIDs.indexOf(a)+1,y=this.leftDendgrogramLeavelsIDs.indexOf(p)+1,i=this.transformOneDirectionInfo.realTranslateY,H=this.transformOneDirectionInfo.realScaleY;let c,f,v=i+H*this.heatmapHeight*(this.leftDendgrogramLeavelsLength-l)/this.leftDendgrogramLeavelsLength;i+H*this.heatmapHeight>=this.heatmapHeight?(c=this.heatmapHeight-(i+H*this.heatmapHeight*(this.leftDendgrogramLeavelsLength-y+1)/this.leftDendgrogramLeavelsLength),f=this.heatmapHeight-c):(f=i+H*this.heatmapHeight*(this.leftDendgrogramLeavelsLength-y+1)/this.leftDendgrogramLeavelsLength,c=i+H*this.heatmapHeight-f),v=v>=0?v:0,c=c>=0?c:0,(0,d.Ys)("#upCoverForSelectNodes").attr("height",v).attr("visibility","visible"),(0,d.Ys)("#downCoverForSelectNodes").attr("y",f).attr("height",c).attr("visibility","visible")}_highlightRowsAndPathsWhenSelectingNodes(t,e){"useCover"===this.highlightUseCoverOrClass?this._highlightRowsAndPathsWhenSelectingNodesUsingCover(t):this._highlightRowsAndPathsWhenSelectingNodesChangeingClass(t)}_outputSelectedNodes(t,e){if("false"===e){const s=t.leaves().map(a=>a.data.node_id).map(a=>this.leftUniqueTerms[a]);this.nodesSelected$.next({clickedNode:t.data.node_id.toString(),selectedNodes:s}),this.ifShowUnSelectElement=!0}else this.nodesSelected$.next({clickedNode:"",selectedNodes:[]})}_addCoversForSelectingNodes(){let t=this;(0,d.Ys)(t.upCoverForSelectNodes.nativeElement).attr("transform","translate("+(t.marginLeft+t.verticalScaleIndicatorWidth)+" "+t.svgTop2HeatmapHeight+")").append("rect").attr("id","upCoverForSelectNodes").attr("width",t.leftDendgroWidth+t.heatmapWidth+t.marginRight).attr("height",0).attr("fill","white").attr("visibility","hidden").style("opacity",.9),(0,d.Ys)(t.downCoverForSelectNodes.nativeElement).attr("transform","translate("+(t.marginLeft+t.verticalScaleIndicatorWidth)+" "+t.svgTop2HeatmapHeight+")").append("rect").attr("id","downCoverForSelectNodes").attr("x",0).attr("y",0).attr("width",t.leftDendgroWidth+t.heatmapWidth+t.marginRight).attr("fill","white").attr("visibility","hidden").style("opacity",.9)}_addVerticalScaleIndicators(){if(!this.ifDisplayLeftTermsWithRawOrder){var t=this;const a=this.heatmapHeight;let p=(0,d.Ys)(this.verticalScaleIndicators.nativeElement).attr("transform","translate("+t.marginLeft+" "+t.svgTop2HeatmapHeight+")"),L=p.append("g").attr("id","verticalScaleLinks");L.selectAll(".link").data(t.leftDendgroRoot.descendants().slice(1)).enter().append("path").attr("d",function(i){if(null!=i.parent.data.xPos)return"M"+t.verticalScaleIndicatorWidth*i.parent.data.xPos+" "+a*i.data.yPos+"H"+t.verticalScaleIndicatorWidth*i.data.xPos}).style("stroke","grey"),L.selectAll(".link").data(t.leftDendgroRoot.descendants().slice(1)).enter().append("path").attr("d",function(i){return null==i.parent.data.xPos||i.children?"M"+t.verticalScaleIndicatorWidth*i.data.xPos+" "+a*i.children[0].data.yPos+"L"+t.verticalScaleIndicatorWidth*i.data.xPos+" "+a*i.children[1].data.yPos:void 0}).style("stroke","grey"),p.append("rect").attr("id","indicatorUp").attr("height",0).attr("width",t.verticalScaleIndicatorWidth).attr("fill","grey").attr("fill-opacity",.5);var e=(0,d.ohM)().on("start",function(i,H){const c=(0,d.Ys)(this).attr("y")-i.y;H.deltaY=c}).on("drag",function(i,H){let v=(0,d.Ys)(this);const c=i.y+H.deltaY,f=parseFloat(v.attr("height"));let D;D=c<=0?0:c>=t.heatmapHeight-f?t.heatmapHeight-f:c;const B=t.heatmapHeight-D-f;t.zoomFromScaleBar$.next({sourceOrientation:"vertical",scaleBarSetting:{smallEndRectLong:D,middleRectLong:f,bigEndRectLong:B,indicatorLong:f+D+B}})});p.append("g").selectAll("rect").data([{deltaX:0,deltaY:0}]).enter().append("rect").attr("id","indicatorMiddle").attr("height",a).attr("width",t.verticalScaleIndicatorWidth).attr("x",0).attr("y",0).attr("fill","grey").attr("fill-opacity",.1).style("cursor","row-resize").call(e),p.append("rect").attr("id","indicatorDown").attr("height",0).attr("width",t.verticalScaleIndicatorWidth).attr("fill","grey").attr("fill-opacity",.5);var n=(0,d.ohM)().on("start",function(i,H){const c=(0,d.Ys)(this).attr("y")-i.y;H.deltaY=c}).on("drag",function(i,H){const v=parseFloat((0,d.Ys)("#moveBarDown").attr("y")),c=i.y+H.deltaY;if(c<v&&c>=-15&&i.y<=a){let f;f=i.y<=-t.VERTICAL_MOVE_BAR_HEIGHT?-t.VERTICAL_MOVE_BAR_HEIGHT:i.y>=a?a:i.y,(0,d.Ys)(this).attr("y",f);const D=v-f-t.VERTICAL_MOVE_BAR_HEIGHT,T=f+t.VERTICAL_MOVE_BAR_HEIGHT,A=a-v;t.zoomFromScaleBar$.next({sourceOrientation:"vertical",scaleBarSetting:{smallEndRectLong:T,middleRectLong:D,bigEndRectLong:A,indicatorLong:D+T+A}})}});p.append("g").selectAll("rect").data([{deltaY:0}]).enter().append("rect").attr("id","moveBarUp").attr("height",t.VERTICAL_MOVE_BAR_HEIGHT).attr("width",t.verticalScaleIndicatorWidth).attr("fill","black").style("cursor","row-resize").attr("y",-t.VERTICAL_MOVE_BAR_HEIGHT).call(n);var s=(0,d.ohM)().on("drag",function(i){const H=parseFloat((0,d.Ys)("#moveBarUp").attr("y")),v=i.y;if(v>=H+t.VERTICAL_MOVE_BAR_HEIGHT&&v>=-15&&v<=a+5){let c;c=i.y<=-t.VERTICAL_MOVE_BAR_HEIGHT?-t.VERTICAL_MOVE_BAR_HEIGHT:i.y>=a?a:v,(0,d.Ys)(this).attr("y",c);const f=c-H-t.VERTICAL_MOVE_BAR_HEIGHT,D=H+t.VERTICAL_MOVE_BAR_HEIGHT,T=a-c;t.zoomFromScaleBar$.next({sourceOrientation:"vertical",scaleBarSetting:{smallEndRectLong:D,middleRectLong:f,bigEndRectLong:T,indicatorLong:f+D+T}})}});p.append("rect").attr("id","moveBarDown").attr("height",t.VERTICAL_MOVE_BAR_HEIGHT).attr("width",t.verticalScaleIndicatorWidth).attr("y",a).attr("fill","black").style("cursor","row-resize").call(s)}}_modifyVerticalScaleIndicatorsFromScroll(t,e){const n=this._converRoomEventParameters2VerticalIndicatorSettings(t,e);this._modifyVerticalScaleIndicators(n.smallEndRectLong,n.middleRectLong,n.bigEndRectLong,n.indicatorLong,this.VERTICAL_MOVE_BAR_HEIGHT)}_modifyVerticalScaleIndicators(t,e,n,s,a){(0,d.Ys)("#verticalScaleLinks").attr("transform","translate(0 0) scale(1 "+s/this.heatmapHeight+")"),(0,d.Ys)("#indicatorUp").attr("height",t),(0,d.Ys)("#indicatorMiddle").attr("height",e).attr("y",t),(0,d.Ys)("#indicatorDown").attr("height",n).attr("y",t+e),(0,d.Ys)("#moveBarUp").attr("y",t-a),(0,d.Ys)("#moveBarDown").attr("y",t+e)}_addHorizontalScaleIndicators(){if(!this.ifDisplayTopTermsWithRawOrder){var t=this;let a=(0,d.Ys)(this.horizontalScaleIndicators.nativeElement).attr("transform","translate("+t.svgLeft2HeatmapWidth+" "+t.marginTop+")"),p=a.append("g").attr("id","horizonalScaleLinks");p.selectAll(".link").data(t.topDendgroRoot.descendants().slice(1)).enter().append("path").attr("class","topVerticalLink").attr("id",function(i){return"topNode"+i.data.node_id}).attr("d",function(i){if(null!=i.parent.data.yPos)return"M"+t.heatmapWidth*i.data.yPos+" "+t.horizontalScaleIndicatorHeight*i.parent.data.xPos+"V"+t.horizontalScaleIndicatorHeight*i.data.xPos}).style("stroke","grey"),p.selectAll(".link").data(t.topDendgroRoot.descendants().slice(1)).enter().append("path").attr("class","topHorizontalLink").attr("id",function(i){return"topNode"+i.data.node_id}).attr("d",function(i){return null==i.parent.data.yPos||i.children?"M"+t.heatmapWidth*i.children[0].data.yPos+" "+t.horizontalScaleIndicatorHeight*i.data.xPos+"L"+t.heatmapWidth*i.children[1].data.yPos+" "+t.horizontalScaleIndicatorHeight*i.data.xPos:void 0}).style("stroke","grey"),a.append("rect").attr("id","topIndicatorLeft").attr("height",t.horizontalScaleIndicatorHeight).attr("width",0).attr("fill","grey").attr("fill-opacity",.5);var e=(0,d.ohM)().on("start",function(i,H){const c=(0,d.Ys)(this).attr("x")-i.x;H.deltaX=c}).on("drag",function(i,H){let v=(0,d.Ys)(this);const c=i.x+H.deltaX,f=parseFloat(v.attr("width"));let D;D=c<=0?0:c>=t.heatmapWidth-f?t.heatmapWidth-f:c;const B=t.heatmapWidth-D-f;t.zoomFromScaleBar$.next({sourceOrientation:"horizontal",scaleBarSetting:{smallEndRectLong:D,middleRectLong:f,bigEndRectLong:B,indicatorLong:D+f+B}})});a.append("g").selectAll("rect").data([{deltaX:0,deltaY:0}]).enter().append("rect").attr("id","topIndicatorMiddle").attr("height",t.horizontalScaleIndicatorHeight).attr("width",t.heatmapWidth).attr("fill","grey").attr("fill-opacity",.1).style("cursor","col-resize").call(e),a.append("rect").attr("id","topIndicatorRight").attr("height",t.horizontalScaleIndicatorHeight).attr("width",0).attr("fill","grey").attr("fill-opacity",.5);const y=10;var n=(0,d.ohM)().on("start",function(i,H){const c=(0,d.Ys)(this).attr("x")-i.x;H.deltaX=c}).on("drag",function(i){const H=parseFloat((0,d.Ys)("#moveBarRight").attr("x")),v=i.x;if(v<H&&v>=-15&&v<=t.heatmapWidth){let c;c=v<=-t.HORIZONAL_MOVE_BAR_WIDTH?-t.HORIZONAL_MOVE_BAR_WIDTH:v>=t.heatmapWidth?t.heatmapWidth:v,(0,d.Ys)(this).attr("x",c);const f=H-c-t.HORIZONAL_MOVE_BAR_WIDTH,D=c+t.HORIZONAL_MOVE_BAR_WIDTH,T=t.heatmapWidth-H;t.zoomFromScaleBar$.next({sourceOrientation:"horizontal",scaleBarSetting:{smallEndRectLong:D,middleRectLong:f,bigEndRectLong:T,indicatorLong:D+f+T}})}});a.append("g").selectAll("rect").data([{deltaX:0}]).enter().append("rect").attr("id","moveBarLeft").attr("height",t.horizontalScaleIndicatorHeight).attr("width",t.HORIZONAL_MOVE_BAR_WIDTH).attr("fill","black").style("cursor","col-resize").attr("x",-t.HORIZONAL_MOVE_BAR_WIDTH).call(n);var s=(0,d.ohM)().on("drag",function(i){const H=parseFloat((0,d.Ys)("#moveBarLeft").attr("x")),v=i.x;if(v>H+t.HORIZONAL_MOVE_BAR_WIDTH&&v<=t.heatmapWidth+t.HORIZONAL_MOVE_BAR_WIDTH){let c;c=v<=-t.HORIZONAL_MOVE_BAR_WIDTH?-t.HORIZONAL_MOVE_BAR_WIDTH:v>=t.heatmapWidth?t.heatmapWidth:v,(0,d.Ys)(this).attr("x",c);const f=c-H-t.HORIZONAL_MOVE_BAR_WIDTH,D=H+t.HORIZONAL_MOVE_BAR_WIDTH,T=t.heatmapWidth-c;t.zoomFromScaleBar$.next({sourceOrientation:"horizontal",scaleBarSetting:{smallEndRectLong:D,middleRectLong:f,bigEndRectLong:T,indicatorLong:D+f+T}})}});a.append("rect").attr("id","moveBarRight").attr("height",t.horizontalScaleIndicatorHeight).attr("width",y).attr("x",t.heatmapWidth).attr("fill","black").style("cursor","col-resize").call(s)}}_computeHorizontalIndicatorSettings(t,e,n){const s=this;let a=s.heatmapWidth;t+e*s.heatmapWidth<=s.heatmapWidth&&(a=e*s.heatmapWidth+t);const p=a/(e*s.heatmapWidth),L=-t*p,l=a*p;let y=a-L-l;return y<0&&(y=0),{smallEndRectLong:L,middleRectLong:l,bigEndRectLong:y,indicatorLong:a}}_modifyHorizontalScaleIndicatorsFromScroll(t,e){const n=this._computeHorizontalIndicatorSettings(t,e,this.HORIZONAL_MOVE_BAR_WIDTH);this._modifyHorizontalScaleIndicators(n.smallEndRectLong,n.middleRectLong,n.bigEndRectLong,n.indicatorLong,this.HORIZONAL_MOVE_BAR_WIDTH)}_modifyHorizontalScaleIndicators(t,e,n,s,a){(0,d.Ys)("#horizonalScaleLinks").attr("transform","scale("+s/this.heatmapWidth+",1)"),(0,d.Ys)("#topIndicatorLeft").attr("width",t),(0,d.Ys)("#topIndicatorMiddle").attr("width",e).attr("x",t),(0,d.Ys)("#topIndicatorRight").attr("width",n).attr("x",t+e),(0,d.Ys)("#moveBarLeft").attr("x",t-a),(0,d.Ys)("#moveBarRight").attr("x",t+e)}_convertScrollBarParameters2zoomParameters(t,e,n){const{smallEndRectLong:s,middleRectLong:a,indicatorLong:L}=Object.assign({},e),l=L/a,y=-s*l;return"vertical"===t?Object.assign(Object.assign({},n),{realScaleY:l,realTranslateY:y}):"horizontal"===t?Object.assign(Object.assign({},n),{realScaleX:l,realTranslateX:y}):void 0}_converRoomEventParameters2VerticalIndicatorSettings(t,e){const n=this;let s=n.heatmapHeight;t+e*n.heatmapHeight<=n.heatmapHeight&&(s=e*n.heatmapHeight+t);const a=s/(e*n.heatmapHeight),p=-t*a,L=s*a;let l=s-p-L;return l<0&&(l=0),{smallEndRectLong:p,middleRectLong:L,bigEndRectLong:l,indicatorLong:s}}_zoomMap(){this.d3Svg.node().__zoom=d.CRH}_computeRealZoomValues(t,e,n,s,a){const p=this;let L,l,y,i,H=t,v=e,c=n;if(p._determineIfPointerInElement(p.leftDendgrogram.nativeElement,s,a)||p._determineIfPointerInElement(p.yLabels.nativeElement,s,a))l=e-this.transformOneDirectionInfo.zoomTranslateY+p.transformOneDirectionInfo.realTranslateY,i=n-this.transformOneDirectionInfo.zoomScale+this.transformOneDirectionInfo.realScaleY,L=this.transformOneDirectionInfo.realTranslateX,y=this.transformOneDirectionInfo.realScaleX,l+i*p.heatmapHeight<=p.heatmapHeight&&(l=(1-i)*p.heatmapHeight),l>=0&&(l=0);else if(p._determineIfPointerInElement(p.topDendgrogram.nativeElement,s,a)||p._determineIfPointerInElement(p.xLabels.nativeElement,s,a)){if(L=t-this.transformOneDirectionInfo.zoomTranslateX+this.transformOneDirectionInfo.realTranslateX,y=n-this.transformOneDirectionInfo.zoomScale+this.transformOneDirectionInfo.realScaleX,l=this.transformOneDirectionInfo.realTranslateY,i=this.transformOneDirectionInfo.realScaleY,L+y*p.heatmapWidth<=.5*p.heatmapWidth&&(L=(.5-y)*p.heatmapWidth),L>=0&&(L=0),y<=.1)return Object.assign({},this.transformOneDirectionInfo)}else{if(!p._determineIfPointerInElement(p.heatmap.nativeElement,s,a))return Object.assign({},this.transformOneDirectionInfo);if(L=t-this.transformOneDirectionInfo.zoomTranslateX+this.transformOneDirectionInfo.realTranslateX,y=n-this.transformOneDirectionInfo.zoomScale+this.transformOneDirectionInfo.realScaleX,l=e-this.transformOneDirectionInfo.zoomTranslateY+p.transformOneDirectionInfo.realTranslateY,i=n-this.transformOneDirectionInfo.zoomScale+this.transformOneDirectionInfo.realScaleY,l+i*p.heatmapHeight<=.5*p.heatmapHeight&&(l=(.5-i)*p.heatmapHeight),l>=0&&(l=0),i<=.1)return Object.assign({},this.transformOneDirectionInfo);if(L+y*p.heatmapWidth<=.5*p.heatmapWidth&&(L=(.5-y)*p.heatmapWidth),L>=0&&(L=0),y<=.1)return Object.assign({},this.transformOneDirectionInfo)}return{realTranslateX:L,realTranslateY:l,realScaleX:y,realScaleY:i,zoomTranslateX:H,zoomTranslateY:v,zoomScale:c}}_updateTransformInfo(t){this.transformOneDirectionInfo=Object.assign({},t)}_updateD3svg__zoom(t,e,n){let s=this.d3Svg.node(),a=d.CRH;a=a.translate(t,e),a=a.scale(n),s.__zoom=a}_transformMapUsingRealZoomValues(t,e,n,s){const a=this,p=(0,d.Ys)(a.leftDendgrogram.nativeElement),L=(0,d.Ys)(a.heatmap.nativeElement),l=(0,d.Ys)(a.topDendgrogram.nativeElement),y=(0,d.Ys)(a.yLabels.nativeElement),i=(0,d.Ys)(a.xLabels.nativeElement),D=((0,d.Ys)("#yLableTopCover"),(0,d.Ys)("#yLableDownCover"),a.svgLeft2HeatmapWidth+t),T=a.svgTop2HeatmapHeight+e,A=a.svgLeft2HeatmapWidth+t,B=a.marginTop+a.horizontalScaleIndicatorHeight+a.dendgroIndicatorGap;let w=a.svgLeft2HeatmapWidth+n*a.heatmapWidth+t;const M=a.svgTop2HeatmapHeight+e,C=a.svgLeft2HeatmapWidth+t;let K=a.svgTop2HeatmapHeight+e+s*a.heatmapHeight;e+s*a.heatmapHeight>=a.heatmapHeight&&(K=a.svgTop2HeatmapHeight+a.heatmapHeight+15),t+n*a.heatmapWidth>=a.heatmapWidth&&(w=a.svgLeft2HeatmapWidth+a.heatmapWidth+5),p.attr("transform","translate("+(a.marginLeft+a.verticalScaleIndicatorWidth+a.dendgroIndicatorGap)+" "+(a.svgTop2HeatmapHeight+e)+") scale(1 "+s+")"),L.attr("transform","translate("+D+" "+T+") scale("+n+" "+s+")"),l.attr("transform","translate("+A+" "+B+") scale("+n+" 1)"),y.attr("transform","translate("+w+" "+M+") scale(1 1)"),i.attr("transform","translate("+C+" "+K+")");const h=a.initialxLableXTranslate.length;if(this.ifDisplayTopTermsWithRawOrder?i.selectAll("text").attr("transform",function(o,r){return"translate("+n*(a.initialxLableXTranslate[1]-a.initialxLableXTranslate[0])*(r+.5)+" 0)rotate("+a.xLabelRotationDegree+")"}):i.selectAll("text").attr("transform",function(o,r){return"translate("+n*(a.initialxLableXTranslate[0]-a.initialxLableXTranslate[1])*(h-1-r+.5)+" 0)rotate("+a.xLabelRotationDegree+")"}),this.ifDisplayLeftTermsWithRawOrder)y.selectAll("text").attr("transform",function(r,g){return"translate(0,"+s*(a.initialyLableYTranslate[1]-a.initialyLableYTranslate[0])*(g+.5)+")"});else{const o=a.initialyLableYTranslate.length;y.selectAll("text").attr("transform",function(r,g){return"translate(0,"+s*(a.initialyLableYTranslate[0]-a.initialyLableYTranslate[1])*(o-1-g+.5)+")"})}a.d3Svg.selectAll(".topVerticalLink").attr("stroke-width",1/n+"px"),a.d3Svg.selectAll(".leftHorizontalLink").attr("stroke-width",1/s+"px")}_transformInitalMap(){const e=this.hierarchicalResultForDisplay.transform;this._transformMapUsingRealZoomValues(e.realTranslateX?e.realTranslateX:0,e.realTranslateY?e.realTranslateY:0,e.realScaleX?e.realScaleX:1,e.realScaleY?e.realScaleY:1)}_determineIfPointerInElement(t,e,n){const s=t.getBoundingClientRect();return e>=s.x&&e<=s.x+s.width&&n>=s.y&&n<=s.y+s.height}_obtainMarginRight(){let t=0;const e=(0,j.H9)(1);return this.leftDisplayTerms.forEach(n=>{const s=(null==n?void 0:n.length)*e;s>t&&(t=s)}),t+5}_obtainMarginBottom(){let t=0;const e=(0,j.H9)(this.xLabelsFontSize);return this.topDisplayTerms.forEach(n=>{const s=-this.xLabelRotationDegree*Math.PI/180,a=n.length*e*Math.sin(s)+1.32*e*Math.cos(s);a>t&&(t=a)}),t+5}}return G.\u0275fac=function(t){return new(t||G)(m.Y36(m.sBO))},G.\u0275cmp=m.Xpm({type:G,selectors:[["app-dendgrogram-vis"]],viewQuery:function(t,e){if(1&t&&(m.Gf(k,5),m.Gf(ot,5),m.Gf(st,5),m.Gf(b,5),m.Gf(lt,5),m.Gf(ht,5),m.Gf(dt,5),m.Gf(ct,5),m.Gf(mt,5),m.Gf(gt,5),m.Gf(pt,5),m.Gf(ut,5),m.Gf(ft,5),m.Gf(vt,5),m.Gf(J,5),m.Gf(q,5),m.Gf(tt,5)),2&t){let n;m.iGM(n=m.CRH())&&(e.svgElement=n.first),m.iGM(n=m.CRH())&&(e.heatmap=n.first),m.iGM(n=m.CRH())&&(e.heatmapCoverRects=n.first),m.iGM(n=m.CRH())&&(e.verticalScaleIndicators=n.first),m.iGM(n=m.CRH())&&(e.leftDendgrogram=n.first),m.iGM(n=m.CRH())&&(e.leftDendgroCoverRects=n.first),m.iGM(n=m.CRH())&&(e.horizontalScaleIndicators=n.first),m.iGM(n=m.CRH())&&(e.topDendgrogram=n.first),m.iGM(n=m.CRH())&&(e.topDendgroCoverRects=n.first),m.iGM(n=m.CRH())&&(e.samplesAnnotations=n.first),m.iGM(n=m.CRH())&&(e.xLabels=n.first),m.iGM(n=m.CRH())&&(e.xLabelsCoverRects=n.first),m.iGM(n=m.CRH())&&(e.yLabels=n.first),m.iGM(n=m.CRH())&&(e.yLabelsCoverRects=n.first),m.iGM(n=m.CRH())&&(e.colorScaleBar=n.first),m.iGM(n=m.CRH())&&(e.upCoverForSelectNodes=n.first),m.iGM(n=m.CRH())&&(e.downCoverForSelectNodes=n.first)}},inputs:{hierarchicalResultForDisplay:"hierarchicalResultForDisplay",auditTime:"auditTime",disSelectedNodes:"disSelectedNodes",highlightUseCoverOrClass:"highlightUseCoverOrClass"},outputs:{nodesSelected$:"nodesSelected$",nodeSelected$:"nodeSelected$",mapSettings$:"mapSettings$"},features:[m.TTD],decls:36,vars:8,consts:[["svgElement",""],["data-testid","heatmap"],["heatmap",""],["data-testid","heatmapCoverRects"],["heatmapCoverRects",""],["data-testid","leftDendgrogram"],["leftDendgrogram",""],["data-testid","leftDendgroCoverRects"],["leftDendgroCoverRects",""],["data-testid","topDendgrogram"],["topDendgrogram",""],["data-testid","topDendgroCoverRects"],["topDendgroCoverRects",""],["data-testid","xLabels"],["xLabels",""],["data-testid","xLabelsCoverRects"],["xLabelsCoverRects",""],["data-testid","yLabels"],["yLabels",""],["data-testid","yLabelsCoverRects"],["yLabelsCoverRects",""],["data-testid","colorScaleBar"],["colorScaleBar",""],["data-testid","upCoverForSelectNodes"],["upCoverForSelectNodes",""],["data-testid","downCoverForSelectNodes"],["downCoverForSelectNodes",""],["data-testid","samplesAnnotations"],["samplesAnnotations",""],["data-testid","verticalScaleIndicators"],["verticalScaleIndicators",""],["data-testid","horizontalScaleIndicators"],["horizontalScaleIndicators",""],[3,"ngStyle"],[1,"hoverBigger",3,"icon","size","ngbTooltip","click"]],template:function(t,e){1&t&&(m.O4$(),m.TgZ(0,"svg",null,0),m._UZ(2,"g",1,2),m._UZ(4,"g",3,4),m._UZ(6,"g",5,6),m._UZ(8,"g",7,8),m._UZ(10,"g",9,10),m._UZ(12,"g",11,12),m._UZ(14,"g",13,14),m._UZ(16,"g",15,16),m._UZ(18,"g",17,18),m._UZ(20,"g",19,20),m._UZ(22,"g",21,22),m._UZ(24,"g",23,24),m._UZ(26,"g",25,26),m._UZ(28,"g",27,28),m._UZ(30,"g",29,30),m._UZ(32,"g",31,32),m.qZA(),m.kcU(),m.TgZ(34,"div",33),m.TgZ(35,"fa-icon",34),m.NdJ("click",function(s){return e.unSelectGenes(s)}),m.qZA(),m.qZA()),2&t&&(m.xp6(34),m.Q6J("ngStyle",m.kEZ(4,yt,e.unselectLeft,e.unselectTop,e.unselectIfDisplay)),m.xp6(1),m.Q6J("icon",e.faToggleOff)("size","1x")("ngbTooltip","Click to unselect genes"))},directives:[nt.PC,rt.BN,it._L],styles:[".rowNormal{opacity:1}.rowDim{opacity:.5}.linkRed{stroke:red}.linkGrey{stroke:gray}\n"],encapsulation:2,changeDetection:0}),G})()}}]);