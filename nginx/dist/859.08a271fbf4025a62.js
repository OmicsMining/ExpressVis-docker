"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[859],{2307:(J,L,h)=>{h.d(L,{H9:()=>a,pP:()=>_,Po:()=>I});const a=function(P){return P*parseFloat(getComputedStyle(document.documentElement).fontSize)*.8},_=function(P){return P*parseFloat(getComputedStyle(document.documentElement).fontSize)},I=function(P){return P*parseFloat(getComputedStyle(document.documentElement).fontSize)}},4859:(J,L,h)=>{h.r(L),h.d(L,{IntegrationExpModule:()=>os});var a=h(6019),_=h(1144),I=h(9133),P=h(7695),M=h(9256),F=h(3553),C=h(8638),H=h(3856),x=h(8702),b=h(3928),Y=h(3667),e=h(3668),v=h(8472),D=h(4099),T=h(6813),w=h(2411),u=h(8053),G=h(8735),N=h(9204),A=h(6636),bt=h(1366),ht=h(2047),W=h(7548),q=h(7473),k=h(1890),Bt=h(8970),Nt=h(9744),Ot=h(1118),pt=h(254);const ct=o=>o.integrationExpState.integrationAnalysisCorResultState,mt=(0,v.P1)(ct,(o,g)=>o.ids),Zt=(0,v.P1)(ct,(o,g)=>o.entities[g.ID]),Ft=(0,v.P1)(mt,(o,g)=>!!o.includes(g.ID));var Ht=h(7194),K=h(3692),O=h(9232);const dt=function(o,g,t,s){const n=[...new Set(t)].concat([...new Set(s)]),i=(0,O.kX)(n),r=(0,O.Wv)(i,t),p=(0,O.Wv)(i,s);return{array1:r.map(d=>o[d]),array2:p.map(d=>g[d]),rows:i}},ut=function(o,g){let t=[];for(const[s,n]of(0,O.$R)(o,g))t.push(s>0?-Math.log10(n):0===s?0:Math.log10(n));return t},ft=function(o){return`${o.dataset1ID} vs ${o.dataset2ID}-top${o.topVariablePercentage}`};var Rt=h(9990),Lt=h(8779),Mt=h(4205),Et=h(5535),$t=h(4473);let ot=(()=>{class o extends Ht.g{constructor(t,s,n,i,r,p){super(t,i,r,p),this.store=t,this.trySamppleService=s,this.enrichmentService=n,this.integrationAnalysisRequestSubject=new D.X(null),this.integrationAnalysisResultIDsubject=new D.X(null),this.corAnalysisGSEAresultStatusSubject=new D.X(null),this.commonGenesRequestSubject=new D.X(null),this.oneGeneBetweenDatasetsRequestSubject=new D.X(null),this.oneGeneBetweenDatasetsResultStatusSubject=new D.X(null),this.corAnalysisGSEAresultStatus$=this.corAnalysisGSEAresultStatusSubject.asObservable(),this.oneGeneBetweenDatasetsResultStatus$=this.oneGeneBetweenDatasetsResultStatusSubject.asObservable(),this.allDatasetInfoForDisplay$=this.store.pipe((0,v.Ys)(q.yz)),this.allIntegrationCorAnalysisIDs$=this.store.pipe((0,v.Ys)(mt),(0,u.U)(l=>l.reverse())),this.integrationAnalysisRequestSubject.pipe((0,G.h)(l=>null!=l),(0,N.w)(l=>{const f=ft(l);return this.store.pipe((0,v.Ys)(Ft,{ID:f}),(0,A.q)(1),(0,G.h)(d=>!d),(0,u.U)(d=>l))}),(0,bt.b)(l=>{this.corAnalysisGSEAresultStatusSubject.next({status:"loading",statusValue:"Wait for a moment. The app is requesting integration analysis result from the server"})}),(0,N.w)(l=>{const f=ft(l),d=this.store.pipe((0,v.Ys)(q.iR,{datasetID:l.dataset1ID}),(0,A.q)(1)),c=this.store.pipe((0,v.Ys)(W.Qn,{datasetID:l.dataset1ID,samples:l.overlappingSamples}),(0,A.q)(1)),y=this.store.pipe((0,v.Ys)(q.iR,{datasetID:l.dataset2ID}),(0,A.q)(1)),S=this.store.pipe((0,v.Ys)(W.Qn,{datasetID:l.dataset2ID,samples:l.overlappingSamples}),(0,A.q)(1));return(0,T.D)([d,c,y,S]).pipe((0,N.w)(([B,R,Z,V])=>{const tt=K.wb[B.experimentType](R.expressionValues,R.genes,l.topVariablePercentage),et=K.wb[Z.experimentType](V.expressionValues,V.genes,l.topVariablePercentage),rt=this.store.pipe((0,v.Ys)(k.Rk,{ID:B.speciesID+"-"+B.IDtype,geneIDs:tt}),(0,A.q)(1)),lt=this.store.pipe((0,v.Ys)(k.Rk,{ID:Z.speciesID+"-"+Z.IDtype,geneIDs:et}),(0,A.q)(1));return(0,T.D)([rt,lt]).pipe((0,N.w)(([gt,as])=>{const rs=gt.concat(as),Pt=[...new Set(rs)],ls=this.store.pipe((0,v.Ys)(k.by,{ID:B.speciesID+"-"+B.IDtype,symbols:Pt}),(0,A.q)(1)).pipe((0,N.w)(Q=>this.store.pipe((0,v.Ys)(W.C_,{datasetID:B.datasetID,genes:Q,samples:l.overlappingSamples}),(0,A.q)(1)).pipe((0,N.w)(j=>{const E=j.geneIDs.map($=>$.split(/,|;/)[0]);return this.store.pipe((0,v.Ys)(k.MR,{ID:B.speciesID+"-"+B.IDtype,geneIDs:E}),(0,A.q)(1)).pipe((0,u.U)($=>{const st=E.map(nt=>$.get(nt));return Object.assign(Object.assign({},j),{geneIDs:st})}))})))),gs=this.store.pipe((0,v.Ys)(k.by,{ID:Z.speciesID+"-"+Z.IDtype,symbols:Pt}),(0,A.q)(1)).pipe((0,N.w)(Q=>this.store.pipe((0,v.Ys)(W.C_,{datasetID:Z.datasetID,genes:Q,samples:l.overlappingSamples}),(0,A.q)(1)).pipe((0,N.w)(j=>{const E=j.geneIDs.map($=>$.split(/,|;/)[0]);return this.store.pipe((0,v.Ys)(k.MR,{ID:Z.speciesID+"-"+Z.IDtype,geneIDs:E}),(0,A.q)(1)).pipe((0,u.U)($=>{const st=E.map(nt=>$.get(nt));return Object.assign(Object.assign({},j),{geneIDs:st})}))}))));return(0,T.D)([ls,gs]).pipe((0,N.w)(([Q,j])=>{const E=dt(Q.expressionValues,j.expressionValues,Q.geneIDs,j.geneIDs),$=K.Ju.Spearman(E.array1,E.array2),st=ut($.cors,$.pvalues);return this.enrichmentService.requestGSEAenrichedAnnotations({speciesID:Z.speciesID,geneIDtype:"SYMBOL",valuesForRank:st,genes:E.rows}).pipe((0,u.U)(hs=>({ID:f,dataset1ID:B.datasetID,dataset2ID:Z.datasetID,samples:l.overlappingSamples,genes:E.rows,expressionInfo:{array1:E.array1,array2:E.array2},corsInfo:{cors:$.cors,pvalues:$.pvalues},gseaEnrichedAnnotations:hs})))}))}))}))}),(0,u.U)(l=>({status:"finished",statusValue:"finished",result:l})),(0,ht.K)(l=>(0,w.of)({status:"error",statusValue:`Error when requesting integration analysis result. error:${l.status}, errorText:${l.statusText}`}))).subscribe(l=>{"finished"===l.status&&this.store.dispatch(pt.p({integrationResult:l.result}))}),this.integrationAnalysisResultIDsubject.pipe((0,G.h)(l=>null!=l),(0,N.w)(l=>this.store.pipe((0,v.Ys)(Zt,{ID:l}),(0,A.q)(1)))).subscribe(l=>{this.corAnalysisGSEAresultStatusSubject.next({status:"finished",statusValue:"finished",result:l})}),this.commonGenes$=this.commonGenesRequestSubject.pipe((0,G.h)(l=>null!=l),(0,N.w)(l=>{const f=this.store.pipe((0,v.Ys)(q.iR,{datasetID:l.dataset1ID}),(0,A.q)(1)),d=this.store.pipe((0,v.Ys)(W.JZ,{datasetID:l.dataset1ID}),(0,A.q)(1)),c=this.store.pipe((0,v.Ys)(q.iR,{datasetID:l.dataset2ID}),(0,A.q)(1)),y=this.store.pipe((0,v.Ys)(W.JZ,{datasetID:l.dataset2ID}),(0,A.q)(1));return(0,T.D)([f,c,d,y]).pipe((0,N.w)(([S,B,R,Z])=>{const V=this.store.pipe((0,v.Ys)(k.Rk,{ID:S.speciesID+"-"+S.IDtype,geneIDs:R}),(0,A.q)(1)),tt=this.store.pipe((0,v.Ys)(k.Rk,{ID:B.speciesID+"-"+B.IDtype,geneIDs:Z}),(0,A.q)(1));return(0,T.D)([V,tt]).pipe((0,u.U)(([et,rt])=>{const lt=[...new Set(et)],gt=[...new Set(rt)];return(0,O.kX)(lt.concat(gt))}))}))})),this.oneGeneBetweenDatasetsRequestSubject.pipe((0,G.h)(l=>null!=l),(0,N.w)(l=>{const f=this.store.pipe((0,v.Ys)(q.iR,{datasetID:l.dataset1ID}),(0,A.q)(1)).pipe((0,N.w)(S=>this._obtainSubGenesExpressionValuesBySymbols(S,l.overlappingGenes,l.overlappingSamples))),d=this.store.pipe((0,v.Ys)(q.iR,{datasetID:l.dataset2ID}),(0,A.q)(1)).pipe((0,N.w)(S=>this._obtainSubGenesExpressionValuesBySymbols(S,l.overlappingGenes,l.overlappingSamples))),c=this.store.pipe((0,v.Ys)(q.iR,{datasetID:l.dataset1ID}),(0,A.q)(1)).pipe((0,N.w)(S=>this._obtainSubGenesExpressionValuesBySymbols(S,[l.geneID],l.overlappingSamples))),y=this.store.pipe((0,v.Ys)(q.iR,{datasetID:l.dataset2ID}),(0,A.q)(1)).pipe((0,N.w)(S=>this._obtainSubGenesExpressionValuesBySymbols(S,[l.geneID],l.overlappingSamples)));return(0,T.D)([f,d,c,y]).pipe((0,u.U)(([S,B,R,Z])=>{const V=dt(S.expressionValues,B.expressionValues,S.geneIDs,B.geneIDs),tt=K.v1.Spearman(R.expressionValues[0],V.array1),et=K.v1.Spearman(Z.expressionValues[0],V.array2);return{status:"finished",statusValue:"finished",result:{dataset1ID:l.dataset1ID,dataset2ID:l.dataset2ID,samples:l.overlappingSamples,geneName:l.geneID,otherGenes:V.rows,valuesInDataset1:R.expressionValues[0],valuesInDataset2:Z.expressionValues[0],otherGenesExpressionInDataset1:V.array1,otherGenesExpressionInDataset2:V.array2,geneCorsInDataset1:tt,geneCorsInDataset2:et}}}))}),(0,ht.K)(l=>(0,w.of)({status:"error",statusValue:l.message}))).subscribe(l=>{this.oneGeneBetweenDatasetsResultStatusSubject.next(l)}),this.trySamppleService.trySampleData$.pipe((0,G.h)(Boolean)).subscribe(l=>{this.store.dispatch(Nt.CF({newState:l.datasetListState})),this.store.dispatch(Ot.gw({newState:l.localExpressDataState})),this.store.dispatch(Bt.A({newState:l.geneAnnotationsState})),this.store.dispatch(pt.o({newState:l.integrationExpState}))}),this.trySamplePercentage$=this.trySamppleService.trySamplePercentage$}prepareTrySampleData(t){this.trySamppleService.requestTrySampleData(t)}processIntegrationAnalysisRequest(t){this.integrationAnalysisRequestSubject.next(t)}requestIntegrationAnalysisResult(t){this.integrationAnalysisResultIDsubject.next(t)}requestCommonGenesInTwoDatasets(t){this.commonGenesRequestSubject.next(t)}processOneGeneBetweenDatasetsCorRequest(t){this.oneGeneBetweenDatasetsResultStatusSubject.next({status:"loading",statusValue:"loading"}),this.oneGeneBetweenDatasetsRequestSubject.next(t)}_obtainSubGenesExpressionValuesBySymbols(t,s,n){return this.store.pipe((0,v.Ys)(k.by,{ID:t.speciesID+"-"+t.IDtype,symbols:s}),(0,A.q)(1)).pipe((0,N.w)(i=>this.store.pipe((0,v.Ys)(W.C_,{datasetID:t.datasetID,genes:i,samples:n}),(0,A.q)(1)).pipe((0,N.w)(r=>{const p=r.geneIDs.map(l=>l.split(/,|;/)[0]);return this.store.pipe((0,v.Ys)(k.MR,{ID:t.speciesID+"-"+t.IDtype,geneIDs:p}),(0,A.q)(1)).pipe((0,u.U)(l=>{const f=p.map(d=>l.get(d));return Object.assign(Object.assign({},r),{geneIDs:f})}))}))))}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(v.yh),e.LFG(Rt.v),e.LFG(Lt.g),e.LFG(Mt.b),e.LFG(Et.f),e.LFG($t.h))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac}),o})();var at=h(94),U=h(2668),_t=h(6087),z=h(8805),it=h(1125),yt=h(5571),It=h(438),kt=h(4816),St=h(4813);const Vt=["submitButton"];function Yt(o,g){if(1&o){const t=e.EpF();e.TgZ(0,"div"),e.TgZ(1,"app-select-item-object",5),e.NdJ("selectedItemObject$",function(n){return e.CHM(t),e.oxw().processSelectedDataset1(n)}),e.qZA(),e.qZA()}if(2&o){const t=e.oxw();e.xp6(1),e.Q6J("inputObjects",t.datasetInfos)("idAttribute","datasetID")("displayAttribute","datasetID")("itemLabel","Select Dataset1")}}function qt(o,g){1&o&&(e.TgZ(0,"p",6),e._uU(1,"Please import two Expression Profile data first. "),e.TgZ(2,"a",7),e._uU(3,"Import Data"),e.qZA(),e.qZA())}function jt(o,g){1&o&&(e.TgZ(0,"p",8),e._uU(1," Dataset1 and dataset2 have no overlapping samples. Select another one dataset or change sample names in the dataset\n"),e.qZA())}function Wt(o,g){if(1&o&&(e.TgZ(0,"div"),e.TgZ(1,"p",12),e._uU(2),e.qZA(),e._UZ(3,"app-display-limited-items",13),e.qZA()),2&o){const t=e.oxw().ngIf;e.xp6(2),e.hij(" Dataset1 and dataset2 have ",t.length," overlapping samples. These samples will be used for later use "),e.xp6(1),e.Q6J("items",t)("displayNum",10)}}function Ut(o,g){if(1&o){const t=e.EpF();e.TgZ(0,"div"),e.YNc(1,Wt,4,3,"div",4),e.TgZ(2,"div"),e.TgZ(3,"app-input-number-with-range",9),e.NdJ("outputNumber$",function(n){return e.CHM(t),e.oxw().processCVpercentage(n)}),e.qZA(),e.TgZ(4,"button",10,11),e.ALo(6,"async"),e._uU(7," Submit\n"),e.qZA(),e.qZA(),e.qZA()}if(2&o){const t=g.ngIf,s=e.oxw();e.xp6(1),e.Q6J("ngIf",(null==t?null:t.length)>0),e.xp6(2),e.Q6J("minValue",0)("maxValue",1)("defaultValue",.1)("formInlineOrNot",!1)("step",.01)("itemLabel","Percentage of Top Variable Genes"),e.xp6(1),e.Q6J("disabled",!e.lcZ(6,8,s.ifSubmitAvailable$))}}let zt=(()=>{class o extends at.e{constructor(t){super(),this.cdr=t,this.datasetInfos=[],this.integrationAnalysisRequest$=new e.vpe,this.datasetInfosForDataset2=[],this.dataset1$=new D.X(null),this.dataset2$=new D.X(null),this.percentage$=new D.X(null)}ngOnInit(){this.ifShowNoOverlappingSamplesNote$=(0,U.aj)([this.dataset1$,this.dataset2$]).pipe((0,u.U)(([t,s])=>!(!t||!s||(0,O.BY)([t.samples,s.samples]))),(0,z.R)(this.destroyNotifier$),(0,it.O)(!1)),this.overlappingSamples$=(0,U.aj)([this.dataset1$,this.dataset2$]).pipe((0,u.U)(([t,s])=>{let n=[];return t&&s&&(0,O.BY)([t.samples,s.samples])&&(n=(0,O.kX)(t.samples.concat(s.samples))),n}),(0,z.R)(this.destroyNotifier$)),this.ifSubmitAvailable$=(0,U.aj)([this.dataset1$,this.dataset2$,this.overlappingSamples$,this.percentage$]).pipe((0,u.U)(([t,s,n,i])=>!!(t&&s&&(null==n?void 0:n.length)>1&&i)),(0,z.R)(this.destroyNotifier$),(0,it.O)(!1))}ngAfterViewInit(){this.submitStream$=(0,_t.R)(this.submitButton.nativeElement,"click"),this.submitStream$.pipe((0,G.h)(t=>null!=t),(0,yt.M)(this.dataset1$.pipe((0,G.h)(t=>null!=t)),this.dataset2$.pipe((0,G.h)(t=>null!=t)),this.overlappingSamples$.pipe((0,G.h)(t=>(null==t?void 0:t.length)>1)),this.percentage$.pipe((0,G.h)(t=>null!=t))),(0,u.U)(([t,s,n,i,r])=>({dataset1ID:s.datasetID,dataset2ID:n.datasetID,overlappingSamples:i,topVariablePercentage:r})),(0,z.R)(this.destroyNotifier$)).subscribe(t=>{this.integrationAnalysisRequest$.next(t)})}processSelectedDataset1(t){this.dataset1$.next(t),this._obtainDatasetInfosForDataset2(t)}processSelectedDataset2(t){this.dataset2$.next(t)}processCVpercentage(t){this.percentage$.next(t)}_obtainDatasetInfosForDataset2(t){const s=this.datasetInfos.filter(n=>n.datasetID!=t.datasetID&&n.speciesID==t.speciesID);this.datasetInfosForDataset2=[...s],this.cdr.detectChanges()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(e.sBO))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-generate-new-merge-analysis-based-on-correlation"]],viewQuery:function(t,s){if(1&t&&e.Gf(Vt,5),2&t){let n;e.iGM(n=e.CRH())&&(s.submitButton=n.first)}},inputs:{datasetInfos:"datasetInfos"},outputs:{integrationAnalysisRequest$:"integrationAnalysisRequest$"},features:[e.qOj],decls:8,vars:12,consts:[[4,"ngIf","ngIfElse"],["importDataNote",""],["data-testid","dataset2",3,"inputObjects","idAttribute","displayAttribute","itemLabel","selectedItemObject$"],["data-testid","noOverlapSamplesAlert","class","text-danger",4,"ngIf"],[4,"ngIf"],["data-testid","dataset1",3,"inputObjects","idAttribute","displayAttribute","itemLabel","selectedItemObject$"],["data-testid","noDatasetNote"],["routerLink","/importData"],["data-testid","noOverlapSamplesAlert",1,"text-danger"],[3,"minValue","maxValue","defaultValue","formInlineOrNot","step","itemLabel","outputNumber$"],["data-testid","submitMergeAnalysis",1,"btn","btn-sm","btn-expressvis","mt-2",3,"disabled"],["submitButton",""],[1,"text-info"],[3,"items","displayNum"]],template:function(t,s){if(1&t&&(e.YNc(0,Yt,2,4,"div",0),e.YNc(1,qt,4,0,"ng-template",null,1,e.W1O),e.TgZ(3,"app-select-item-object",2),e.NdJ("selectedItemObject$",function(i){return s.processSelectedDataset2(i)}),e.qZA(),e.YNc(4,jt,2,0,"p",3),e.ALo(5,"async"),e.YNc(6,Ut,8,10,"div",4),e.ALo(7,"async")),2&t){const n=e.MAs(2);e.Q6J("ngIf",(null==s.datasetInfos?null:s.datasetInfos.length)>=2)("ngIfElse",n),e.xp6(3),e.Q6J("inputObjects",s.datasetInfosForDataset2)("idAttribute","datasetID")("displayAttribute","datasetID")("itemLabel","Select Dataset2"),e.xp6(1),e.Q6J("ngIf",e.lcZ(5,8,s.ifShowNoOverlappingSamplesNote$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(7,10,s.overlappingSamples$))}},directives:[a.O5,It.w,_.yS,kt.C,St.w],pipes:[a.Ov],styles:[""],changeDetection:0}),o})();var Jt=h(3013),Xt=h(9918),vt=h(5043),Tt=h(1113),Dt=h(2307),Gt=h(383),m=h(3203);const Qt=["svgElement"];let Kt=(()=>{class o{constructor(){this.selectedGene$=new e.vpe,this.height=250,this.width=500,this.marginRight=100,this.marginTop=20,this.marginLeft=60,this.marginBottom=50,this.histogramWidth=400,this.histogramHeight=200,this.histogramTitleHeight=50,this.highlightGenesGap=10,this.highlightGenesHeight=20,this.highlightGenesFontSize=1,this.descriptionTextFontSize=1,this.gapBetweenPosNegGeneLists=10,this.posColor="#ff4d4d",this.negColor="#21a721",this.axisBottomTitleFontSize=20,this.axisLeftTitleFontSize=20,this.top2XaxisHeight=350,this.binsNum=100,this.cors=[],this.corsMedian=0}ngAfterViewInit(){this.corsPlotInfo&&(this._initSettings(),this._removeGraphic(),this._initMap())}ngOnChanges(t){t.corsPlotInfo&&!t.corsPlotInfo.isFirstChange()&&(this._initSettings(),this._removeGraphic(),this._initMap())}ngOnDestroy(){this.geneToolTipDiv&&this.geneToolTipDiv.remove()}_initSettings(){var t,s;const n=this;n.cors=this.corsPlotInfo.cors;const i=this.corsPlotInfo.basicSettings;this.height=i&&i.height?i.height:n.height,this.width=i&&i.width?i.width:n.width,this.marginRight=i&&i.marginRight?i.marginRight:n.marginRight,this.marginTop=i&&i.marginTop?i.marginTop:n.marginTop,this.marginLeft=i&&i.marginLeft?i.marginLeft:n.marginLeft,this.marginBottom=i&&i.marginBottom?i.marginBottom:n.marginBottom,this.histogramWidth=i&&i.histogramWidth?i.histogramWidth:n.histogramWidth,this.histogramHeight=i&&i.histogramHeight?i.histogramHeight:n.histogramHeight,this.histogramTitleHeight=i&&i.histogramTitleHeight?i.histogramTitleHeight:n.histogramTitleHeight,this.highlightGenesGap=i&&i.highlightGenesGap?i.highlightGenesGap:n.highlightGenesGap,this.highlightGenesHeight=i&&i.highlightGenesHeight?i.highlightGenesHeight:n.highlightGenesHeight,this.highlightGenesFontSize=i&&i.highlightGenesFontSize?i.highlightGenesFontSize:n.highlightGenesFontSize,this.posHighlightGenesList=this.corsPlotInfo.posGenesList,this.negHighlightGenesList=this.corsPlotInfo.negGenesList,n.posHighlightGenesHeight=(null===(t=this.posHighlightGenesList)||void 0===t?void 0:t.length)*(this.highlightGenesGap+this.highlightGenesHeight)+this.highlightGenesGap,n.negHighlightGenesHeight=(null===(s=this.negHighlightGenesList)||void 0===s?void 0:s.length)*(this.highlightGenesGap+this.highlightGenesHeight)+this.highlightGenesGap,this.allHighlightGenesHeight=n.posHighlightGenesHeight+n.gapBetweenPosNegGeneLists+n.negHighlightGenesHeight,n.top2XaxisHeight=n.marginTop+n.histogramHeight,this.xAxisScale=(0,m.BYU)().domain([(0,m.VV$)(n.cors),(0,m.Fp7)(n.cors)]).range([0,n.histogramWidth]);const r=(0,m.KXr)().domain([(0,m.VV$)(n.cors),(0,m.Fp7)(n.cors)]).thresholds(n.xAxisScale.ticks(n.binsNum));n.bins=r(n.cors);const l=1.05*(0,m.Fp7)(n.bins,function(f){return f.length});this.yAxisScale=(0,m.BYU)().range([n.histogramHeight,0]).domain([0,l])}_removeGraphic(){(0,m.Ys)(this.svgElement.nativeElement).selectAll("*").remove()}_initMap(){let t=this;t.corsMedian=(0,m.C2o)(t.cors),t.d3Svg=(0,m.Ys)(this.svgElement.nativeElement).attr("height",t.height).attr("width",t.width),t.geneToolTipDiv=(0,m.Ys)("body").append("div").attr("class","d3Tooltip").style("opacity","0"),this._addAxises(),this._addHistogram(),this._addHistogramBorder(),t.top2PosHighlightGenesHeight=t.marginTop+t.histogramHeight+t.histogramTitleHeight,t.posHighlightGenesList&&t.posHighlightGenesList.length>0&&this._addHighlightGenesLines(t.posHighlightGenesList,t.top2PosHighlightGenesHeight,t.posHighlightGenesHeight),t.top2NegHighlightGenesHeight=t.marginTop+t.histogramHeight+t.histogramTitleHeight+t.posHighlightGenesHeight+t.gapBetweenPosNegGeneLists,t.negHighlightGenesList&&t.negHighlightGenesList.length>0&&this._addHighlightGenesLines(t.negHighlightGenesList,t.top2NegHighlightGenesHeight,t.negHighlightGenesHeight),this._addMedianLine(),this._addPosProbability()}_addAxises(){const t=this,s=t.d3Svg.append("g").attr("transform","translate("+t.marginLeft+","+t.top2XaxisHeight+")").call((0,m.LLu)(t.xAxisScale)),n=t.d3Svg.append("g").attr("transform","translate("+t.marginLeft+","+t.marginTop+")").call((0,m.y4O)(t.yAxisScale)),i=t.marginTop+t.histogramHeight+s.node().getBBox().height+t.axisBottomTitleFontSize,r=t.marginLeft+.5*t.histogramWidth,l=(t.d3Svg.append("text").attr("transform","translate("+r+","+i+")").style("text-anchor","middle").style("font-size",t.axisBottomTitleFontSize).text("Correlation"),t.marginLeft-n.node().getBBox().width-10),f=t.marginTop+.5*t.histogramHeight;t.d3Svg.append("text").attr("transform","translate("+l+","+f+")rotate(-90)").style("text-anchor","middle").style("font-size",t.axisLeftTitleFontSize).text("Count")}_addHistogram(){const t=this;t.d3Svg.selectAll("rect").data(t.bins).join("rect").attr("transform",function(s){return"translate("+(t.xAxisScale(s.x0)+t.marginLeft)+","+(t.yAxisScale(s.length)+t.marginTop)+")"}).attr("width",function(s){return t.xAxisScale(s.x1)-t.xAxisScale(s.x0)}).attr("height",function(s){return t.histogramHeight-t.yAxisScale(s.length)}).style("fill",function(s){return s.x1<0?t.negColor:t.posColor})}_addHistogramBorder(){const t=this;t.d3Svg.append("rect").attr("transform","translate("+t.marginLeft+","+t.marginTop+")").attr("x",0).attr("y",0).attr("height",t.histogramHeight).attr("width",t.histogramWidth).attr("fill","none").attr("stroke","black")}_addHighlightGenesLines(t,s,n){const i=this,r=i.d3Svg.append("g").attr("transform","translate("+i.marginLeft+","+s+")"),p=r.append("g").selectAll(".highlightLines").data(t).enter().append("g").attr("transform",function(c,y){return"translate(0,"+((i.highlightGenesHeight+i.highlightGenesGap)*y+i.highlightGenesGap)+")"}),l=this.corsPlotInfo.genes;p.selectAll("lines").data(function(c){return c.genes.map(S=>({gene:S,cor:i.cors[l.indexOf(S)]}))}).enter().append("path").attr("d",function(c){return"M"+i.xAxisScale(c.cor)+" 0V"+i.highlightGenesHeight}).style("stroke",function(c){return c.cor<0?i.negColor:i.posColor}).style("cursor","pointer").on("mouseover",function(c,y){i.geneToolTipDiv.transition().duration(200).style("opacity",.9),i.geneToolTipDiv.html("<p>Gene:"+y.gene+";Cor:"+y.cor.toFixed(3)+"</p>").style("left",c.pageX+"px").style("top",c.pageY-20+"px")}).on("mouseout",function(c,y){i.geneToolTipDiv.transition().duration(500).style("opacity",0)}).on("dblclick",function(c,y){i.selectedGene$.next(y.gene)});const f=t.map(c=>c.name);r.append("g").attr("transform","translate("+i.histogramWidth+",0)").selectAll(".highlightGeneNames").data(f).enter().append("text").attr("transform",function(c,y){return"translate(2,"+((i.highlightGenesHeight+i.highlightGenesGap)*y+.5*i.highlightGenesHeight+i.highlightGenesGap)+")"}).text(function(c){return c}).attr("dy","0.32em").style("font-size",i.highlightGenesFontSize+"em").style("font-family","times new roman").style("text-anchor","start"),i.d3Svg.append("rect").attr("transform","translate("+i.marginLeft+","+s+")").attr("x",0).attr("y",0).attr("height",n).attr("width",i.histogramWidth).attr("fill","none").attr("stroke","black")}_addMedianLine(){const t=this,s=(0,m.C2o)(this.cors),n=t.marginLeft+t.xAxisScale(s),i=t.marginTop,r=t.d3Svg.append("g").attr("transform","translate("+n+","+i+")");r.append("path").attr("d",function(p){return"M0 5V"+(t.histogramHeight-5)}).style("stroke","blue").style("stroke-dasharray","5"),r.append("text").attr("transform","translate(0,"+(t.histogramHeight-20)+")").style("text-anchor","middle").style("font-size",t.descriptionTextFontSize+"em").style("fill","white").text("Median = "+s.toFixed(2))}_addPosProbability(){const t=this,s=this.cors.length;let n=0;this.cors.forEach(p=>{p>0&&(n+=1)});const r=(n/s*100).toFixed(1)+"% positive correlation";this.d3Svg.append("text").attr("transform","translate("+(t.marginLeft+5)+","+(t.marginTop+20)+")").style("text-anchor","start").style("font-size",t.descriptionTextFontSize+"em").text(r)}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-d3-cor-frequency-plot"]],viewQuery:function(t,s){if(1&t&&e.Gf(Qt,5),2&t){let n;e.iGM(n=e.CRH())&&(s.svgElement=n.first)}},inputs:{corsPlotInfo:"corsPlotInfo"},outputs:{selectedGene$:"selectedGene$"},features:[e.TTD],decls:2,vars:0,consts:[["svgElement",""]],template:function(t,s){1&t&&(e.O4$(),e._UZ(0,"svg",null,0))},styles:[""],changeDetection:0}),o})();var X=h(2326);const te=["svgContainer"],ee=function(o){return{"min-height":o}};let se=(()=>{class o{constructor(t,s){this.computeStringWidthService=t,this.cdr=s,this.selectedGene$=new e.vpe(null),this.defaultBasicSetting={height:270,width:500,marginRight:100,marginTop:20,marginLeft:50,marginBottom:50,histogramWidth:400,histogramHeight:200,histogramTitleHeight:50,highlightGenesGap:10,highlightGenesHeight:20,highlightGenesFontSize:1,gapBetweenPosNegGeneLists:10,xLabelsFontSize:1.5,xLabelRotationDegree:0,yLabelsFontSize:1},this.containerMinHeight=500,this.downloadPngName="Correlation between datasets.png",this.downloadPDFname="Correlation between datasets.pdf",this.minHistorgramWidth=200,this.maxHistorgramWidth=500}ngAfterViewInit(){if(this.corsInfo){if(this.posNegHighlightGenes){const t=this.posNegHighlightGenes.pos.concat(this.posNegHighlightGenes.neg),s=this._initBasicSettings(t);this.corsPlotInfo=Object.assign(Object.assign({},this.corsInfo),{posGenesList:this.posNegHighlightGenes?this.posNegHighlightGenes.pos:[],negGenesList:this.posNegHighlightGenes?this.posNegHighlightGenes.neg:[],basicSettings:s})}else this.corsPlotInfo=Object.assign(Object.assign({},this.corsInfo),{posGenesList:this.posNegHighlightGenes?this.posNegHighlightGenes.pos:[],negGenesList:this.posNegHighlightGenes?this.posNegHighlightGenes.neg:[],basicSettings:this.defaultBasicSetting});this.cdr.detectChanges()}}ngOnChanges(t){if(t.corsInfo&&!t.corsInfo.isFirstChange())if(this.posNegHighlightGenes){const s=this.posNegHighlightGenes.pos.concat(this.posNegHighlightGenes.neg),n=this._initBasicSettings(s);this.corsPlotInfo=Object.assign(Object.assign({},this.corsInfo),{posGenesList:this.posNegHighlightGenes?this.posNegHighlightGenes.pos:[],negGenesList:this.posNegHighlightGenes?this.posNegHighlightGenes.neg:[],basicSettings:n})}else this.corsPlotInfo=Object.assign(Object.assign({},this.corsInfo),{posGenesList:this.posNegHighlightGenes?this.posNegHighlightGenes.pos:[],negGenesList:this.posNegHighlightGenes?this.posNegHighlightGenes.neg:[],basicSettings:this.defaultBasicSetting});if(t.posNegHighlightGenes&&!t.posNegHighlightGenes.isFirstChange())if(this.posNegHighlightGenes){const s=this.posNegHighlightGenes.pos.concat(this.posNegHighlightGenes.neg),n=this._initBasicSettings(s);this.corsPlotInfo=Object.assign(Object.assign({},this.corsInfo),{posGenesList:this.posNegHighlightGenes?this.posNegHighlightGenes.pos:[],negGenesList:this.posNegHighlightGenes?this.posNegHighlightGenes.neg:[],basicSettings:n})}else this.corsPlotInfo=Object.assign(Object.assign({},this.corsInfo),{posGenesList:this.posNegHighlightGenes?this.posNegHighlightGenes.pos:[],negGenesList:this.posNegHighlightGenes?this.posNegHighlightGenes.neg:[],basicSettings:this.defaultBasicSetting})}processSelectedGene(t){this.selectedGene$.next(t)}_initBasicSettings(t){const s=this.svgContainer.nativeElement.clientWidth,n=this._obtainGenelistLabelsWidth(t),i=s-n-this.defaultBasicSetting.marginLeft;let r,p;i<=this.minHistorgramWidth?(r=this.minHistorgramWidth,p=s):i>=this.maxHistorgramWidth?(r=this.maxHistorgramWidth,p=this.defaultBasicSetting.marginLeft+r+n):(r=i,p=this.defaultBasicSetting.marginLeft+r+n);const f=this.defaultBasicSetting.marginTop+this.defaultBasicSetting.histogramHeight+this.defaultBasicSetting.histogramTitleHeight+(t.length*(this.defaultBasicSetting.highlightGenesHeight+this.defaultBasicSetting.highlightGenesGap)+this.defaultBasicSetting.gapBetweenPosNegGeneLists)+this.defaultBasicSetting.marginBottom;return Object.assign(Object.assign({},this.defaultBasicSetting),{histogramWidth:r,height:f,width:p})}_obtainGenelistLabelsWidth(t){let s=0;const n=(0,Dt.pP)(this.defaultBasicSetting.yLabelsFontSize);return t.forEach(i=>{const r=this.computeStringWidthService.computeStringWidth(i.name,n,"times new roman");r>s&&(s=r)}),s+5}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(Gt.m),e.Y36(e.sBO))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-display-cor-info-with-histogram"]],viewQuery:function(t,s){if(1&t&&e.Gf(te,5),2&t){let n;e.iGM(n=e.CRH())&&(s.svgContainer=n.first)}},inputs:{corsInfo:"corsInfo",posNegHighlightGenes:"posNegHighlightGenes"},outputs:{selectedGene$:"selectedGene$"},features:[e.TTD],decls:3,vars:6,consts:[[1,"d-flex","flex-column","justify-content-center",3,"ngStyle"],["svgContainer",""],["appD3ExportMap","",3,"pngName","pdfName","corsPlotInfo","selectedGene$"]],template:function(t,s){1&t&&(e.TgZ(0,"div",0,1),e.TgZ(2,"app-d3-cor-frequency-plot",2),e.NdJ("selectedGene$",function(i){return s.processSelectedGene(i)}),e.qZA(),e.qZA()),2&t&&(e.Q6J("ngStyle",e.VKq(4,ee,s.containerMinHeight)),e.xp6(2),e.Q6J("pngName",s.downloadPngName)("pdfName",s.downloadPDFname)("corsPlotInfo",s.corsPlotInfo))},directives:[a.PC,Kt,X.I],styles:[""],changeDetection:0}),o})();const ne=["svgElement"];let ie=(()=>{class o{constructor(){this.selectedGene$=new e.vpe,this.height=250,this.width=500,this.marginRight=100,this.marginTop=20,this.marginLeft=80,this.marginBottom=50,this.barsWidth=400,this.barsHeight=120,this.barsTitleHeight=40,this.highlightGenesGap=10,this.highlightGenesHeight=15,this.highlightGenesFontSize=1,this.axisBottomTitleFontSize=20,this.axisLeftTitleFontSize=20,this.gapBetweenXaxisLines=2,this.gapBetweenPosNegGeneLists=10,this.yLabelsFontSize=1,this.xLabelsFontSize=1,this.xLabelRotationDegree=0,this.posColor="#ff4d4d",this.negColor="#21a721",this.yTitle="Correlation"}ngAfterViewInit(){this.corsPlotInfo&&(this._initSettings(),this._removeGraphic(),this._initMap())}ngOnChanges(t){t.corsPlotInfo&&!t.corsPlotInfo.isFirstChange()&&(this._initSettings(),this._removeGraphic(),this._initMap())}ngOnDestroy(){this.geneToolTipDiv&&this.geneToolTipDiv.remove()}_initSettings(){var t,s,n;const i=this,r=this.corsPlotInfo.basicSettings;i.height=r&&r.height?r.height:i.height,i.width=r&&r.width?r.width:i.width,i.marginRight=r&&r.marginRight?r.marginRight:i.marginRight,i.marginTop=r&&r.marginTop?r.marginTop:i.marginTop,i.marginLeft=r&&r.marginLeft?r.marginLeft:i.marginLeft,i.marginBottom=r&&r.marginBottom?r.marginBottom:i.marginBottom,i.barsWidth=r&&r.barsWidth?r.barsWidth:i.barsWidth,i.barsHeight=r&&r.barsHeight?r.barsHeight:i.barsHeight,i.barsTitleHeight=r&&r.barsTitleHeight?r.barsTitleHeight:i.barsTitleHeight,i.highlightGenesGap=r&&r.highlightGenesGap?r.highlightGenesGap:i.highlightGenesGap,i.highlightGenesHeight=r&&r.highlightGenesHeight?r.highlightGenesHeight:i.highlightGenesHeight,i.highlightGenesFontSize=r&&r.highlightGenesFontSize?r.highlightGenesFontSize:i.highlightGenesFontSize,i.axisBottomTitleFontSize=r&&r.axisBottomTitleFontSize?r.axisBottomTitleFontSize:i.axisBottomTitleFontSize,i.axisLeftTitleFontSize=r&&r.axisLeftTitleFontSize?r.axisLeftTitleFontSize:i.axisLeftTitleFontSize,i.gapBetweenPosNegGeneLists=r&&r.gapBetweenPosNegGeneLists?r.gapBetweenPosNegGeneLists:i.gapBetweenPosNegGeneLists,i.yLabelsFontSize=r&&r.yLabelsFontSize?r.yLabelsFontSize:i.yLabelsFontSize,i.xLabelsFontSize=r&&r.xLabelsFontSize?r.xLabelsFontSize:i.xLabelsFontSize,i.xLabelRotationDegree=r&&r.xLabelRotationDegree?r.xLabelRotationDegree:i.xLabelRotationDegree,i.cors=this.corsPlotInfo.cors,i.allGenes=this.corsPlotInfo.genes,this._sortGenesAccordingCors(),this.allHighlightGenesHeight=(null===(t=this.corsPlotInfo.posGenesList)||void 0===t?void 0:t.length)*(this.highlightGenesGap+this.highlightGenesHeight)+this.highlightGenesGap,this.posHighlightGenesList=this.corsPlotInfo.posGenesList,this.negHighlightGenesList=this.corsPlotInfo.negGenesList,i.posHighlightGenesHeight=(null===(s=this.posHighlightGenesList)||void 0===s?void 0:s.length)*(this.highlightGenesGap+this.highlightGenesHeight)+this.highlightGenesGap,i.negHighlightGenesHeight=(null===(n=this.negHighlightGenesList)||void 0===n?void 0:n.length)*(this.highlightGenesGap+this.highlightGenesHeight)+this.highlightGenesGap,this.allHighlightGenesHeight=i.posHighlightGenesHeight+i.gapBetweenPosNegGeneLists+i.negHighlightGenesHeight,this.height=this.marginTop+this.barsHeight+this.barsTitleHeight+this.allHighlightGenesHeight+this.marginBottom,i.right2linesWidth=this.marginLeft+this.gapBetweenXaxisLines,i.maxCor=(0,m.Fp7)(i.cors),i.minCor=(0,m.VV$)(i.cors),i.posCorHeight=i.barsHeight*Math.abs(i.maxCor)/(Math.abs(i.maxCor)+Math.abs(i.minCor)),i.negCorHeight=i.barsHeight*Math.abs(i.minCor)/(Math.abs(i.maxCor)+Math.abs(i.minCor)),i.top2XaxisHeight=i.marginTop+i.posCorHeight}_removeGraphic(){(0,m.Ys)(this.svgElement.nativeElement).selectAll("*").remove()}_initMap(){var t,s;const n=this;n.d3Svg=(0,m.Ys)(this.svgElement.nativeElement).attr("height",n.height).attr("width",n.width),this._addCorBars(),this._addAxises(),(null===(t=n.posHighlightGenesList)||void 0===t?void 0:t.length)>0&&(n.top2PosHighlightGenesHeight=n.marginTop+n.barsHeight+n.barsTitleHeight,this._addHighlightGenesLines(n.posHighlightGenesList,n.top2PosHighlightGenesHeight,n.posHighlightGenesHeight)),(null===(s=n.negHighlightGenesList)||void 0===s?void 0:s.length)>0&&(n.top2NegHighlightGenesHeight=n.marginTop+n.barsHeight+n.barsTitleHeight+n.posHighlightGenesHeight+n.gapBetweenPosNegGeneLists,this._addHighlightGenesLines(n.negHighlightGenesList,n.top2NegHighlightGenesHeight,n.negHighlightGenesHeight))}_addCorBars(){const t=this,s=(0,m.BYU)().range([0,t.posCorHeight]).domain([0,Math.abs(t.maxCor)]),n=(0,m.BYU)().range([0,t.negCorHeight]).domain([0,t.minCor]),i=t.barsWidth/t.cors.length;t.d3Svg.append("g").attr("transform","translate("+t.right2linesWidth+","+t.top2XaxisHeight+")").selectAll(".rect").data(t.corGenesArraySorted).enter().append("rect").attr("transform",function(p,l){const f=l*i;return p.cor<0?"translate("+f+",0)":"translate("+f+","+-s(p.cor)+")"}).attr("width",i).attr("height",function(p,l){return p.cor>0?s(p.cor):0===p.cor?0:n(p.cor)}).style("fill",function(p){return p.cor<0?t.negColor:t.posColor}),t.d3Svg.append("rect").attr("transform","translate("+t.marginLeft+","+t.marginTop+")").attr("x",0).attr("y",0).attr("height",t.barsHeight).attr("width",t.barsWidth+2*t.gapBetweenXaxisLines).attr("fill","none").attr("stroke","black")}_addAxises(){const t=this;t.yAxisScale=(0,m.BYU)().range([t.barsHeight,0]).domain([(0,m.VV$)(t.cors),(0,m.Fp7)(t.cors)]);const s=t.d3Svg.append("g").attr("transform","translate("+t.marginLeft+","+t.marginTop+")").call((0,m.y4O)(t.yAxisScale).tickFormat(d=>d.toString())),n=t.marginTop+t.barsHeight+t.axisBottomTitleFontSize,i=t.marginLeft+.5*(t.barsWidth+2*t.gapBetweenXaxisLines),p=(t.d3Svg.append("text").attr("transform","translate("+i+","+n+")").style("text-anchor","middle").style("font-size",t.axisBottomTitleFontSize).text("Genes"),t.marginLeft-s.node().getBBox().width-10),l=t.marginTop+.5*t.barsHeight;t.d3Svg.append("text").attr("transform","translate("+p+","+l+") rotate(-90)").style("text-anchor","middle").style("font-size",t.axisLeftTitleFontSize).text(t.yTitle)}_addHighlightGenesLines(t,s,n){const i=this,r=i.d3Svg.append("g").attr("transform","translate("+i.right2linesWidth+","+s+")"),p=r.append("g").selectAll(".highlightLines").data(t).enter().append("g").attr("transform",function(c,y){return"translate(0,"+((i.highlightGenesHeight+i.highlightGenesGap)*y+i.highlightGenesGap)+")"});i.geneToolTipDiv=(0,m.Ys)("body").append("div").attr("class","d3Tooltip").style("opacity","0");const l=i.barsWidth/i.cors.length;p.selectAll("lines").data(function(c){return c.genes.map(S=>{const B=i.allGenesSorted.indexOf(S);return i.corGenesArraySorted[B]})}).enter().append("path").attr("d",function(c){return"M"+l*i.allGenesSorted.indexOf(c.gene)+" 0V"+i.highlightGenesHeight}).style("stroke",function(c){return c.cor<0?i.negColor:i.posColor}).style("cursor","pointer").on("mouseover",function(c,y){i.geneToolTipDiv.transition().duration(200).style("opacity",.9),i.geneToolTipDiv.html("<p>Gene:"+y.gene+";Cor:"+y.cor.toFixed(3)+"</p>").style("left",c.pageX+"px").style("top",c.pageY-20+"px")}).on("mouseout",function(c,y){i.geneToolTipDiv.transition().duration(500).style("opacity",0)}).on("dblclick",function(c,y){i.selectedGene$.next(y.gene)});const f=t.map(c=>c.name);r.append("g").attr("transform","translate(-10,0)").selectAll(".highlightGeneNames").data(f).enter().append("text").attr("transform",function(c,y){return"translate(2,"+((i.highlightGenesHeight+i.highlightGenesGap)*y+.5*i.highlightGenesHeight+i.highlightGenesGap)+")"}).text(function(c){return c}).attr("dy","0.32em").style("font-size",i.highlightGenesFontSize+"em").style("font-family","times new roman").style("text-anchor","end"),i.d3Svg.append("rect").attr("transform","translate("+i.marginLeft+","+s+")").attr("x",0).attr("y",0).attr("height",n).attr("width",i.barsWidth+2*i.gapBetweenXaxisLines).attr("fill","none").attr("stroke","black")}_sortGenesAccordingCors(){let t=[];for(let[s,n]of(0,O.$R)(this.allGenes,this.cors))t.push({gene:s,cor:n});this.corGenesArraySorted=t.sort(function(s,n){return s.cor>=n.cor?-1:1}),this.allGenesSorted=this.corGenesArraySorted.map(s=>s.gene),this.corsSorted=this.corGenesArraySorted.map(s=>s.cor)}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-d3-cor-lines-plot"]],viewQuery:function(t,s){if(1&t&&e.Gf(ne,5),2&t){let n;e.iGM(n=e.CRH())&&(s.svgElement=n.first)}},inputs:{corsPlotInfo:"corsPlotInfo"},outputs:{selectedGene$:"selectedGene$"},features:[e.TTD],decls:2,vars:0,consts:[["svgElement",""]],template:function(t,s){1&t&&(e.O4$(),e._UZ(0,"svg",null,0))},styles:[""],changeDetection:0}),o})();const oe=["svgContainer"],ae=function(o){return{"min-height":o}};let re=(()=>{class o{constructor(t,s){this.computeStringWidthService=t,this.cdr=s,this.selectedGene$=new e.vpe(null),this.containerMinHeight=500,this.downloadPngName="Correlation between datasets lines plot.png",this.downloadPDFname="Correlation between datasets lines plot.pdf",this.defaultBasicSetting={height:250,width:580,marginRight:100,marginTop:20,marginLeft:80,marginBottom:50,barsWidth:400,barsHeight:120,barsTitleHeight:40,highlightGenesGap:10,highlightGenesHeight:15,highlightGenesFontSize:1,axisBottomTitleFontSize:20,axisLeftTitleFontSize:20,gapBetweenPosNegGeneLists:10,yLabelsFontSize:1,xLabelsFontSize:1.5,xLabelRotationDegree:0},this.minBarsWidth=200,this.maxBarsWidth=500}ngAfterViewInit(){if(this.corsInfo){if(this.posNegHighlightGenes){const t=this.posNegHighlightGenes.pos.concat(this.posNegHighlightGenes.neg),s=this._initBasicSettings(t);this.corsPlotInfo=Object.assign(Object.assign({},this.corsInfo),{posGenesList:this.posNegHighlightGenes?this.posNegHighlightGenes.pos:[],negGenesList:this.posNegHighlightGenes?this.posNegHighlightGenes.neg:[],basicSettings:s})}else this.corsPlotInfo=Object.assign(Object.assign({},this.corsInfo),{posGenesList:this.posNegHighlightGenes?this.posNegHighlightGenes.pos:[],negGenesList:this.posNegHighlightGenes?this.posNegHighlightGenes.neg:[],basicSettings:this.defaultBasicSetting});this.cdr.detectChanges()}}ngOnChanges(t){if(t.corsInfo&&!t.corsInfo.isFirstChange())if(this.posNegHighlightGenes){const s=this.posNegHighlightGenes.pos.concat(this.posNegHighlightGenes.neg),n=this._initBasicSettings(s);this.corsPlotInfo=Object.assign(Object.assign({},this.corsInfo),{posGenesList:this.posNegHighlightGenes?this.posNegHighlightGenes.pos:[],negGenesList:this.posNegHighlightGenes?this.posNegHighlightGenes.neg:[],basicSettings:n})}else this.corsPlotInfo=Object.assign(Object.assign({},this.corsInfo),{posGenesList:this.posNegHighlightGenes?this.posNegHighlightGenes.pos:[],negGenesList:this.posNegHighlightGenes?this.posNegHighlightGenes.neg:[],basicSettings:this.defaultBasicSetting});if(t.posNegHighlightGenes&&!t.posNegHighlightGenes.isFirstChange())if(this.posNegHighlightGenes){const s=this.posNegHighlightGenes.pos.concat(this.posNegHighlightGenes.neg),n=this._initBasicSettings(s);this.corsPlotInfo=Object.assign(Object.assign({},this.corsInfo),{posGenesList:this.posNegHighlightGenes?this.posNegHighlightGenes.pos:[],negGenesList:this.posNegHighlightGenes?this.posNegHighlightGenes.neg:[],basicSettings:n})}else this.corsPlotInfo=Object.assign(Object.assign({},this.corsInfo),{posGenesList:this.posNegHighlightGenes?this.posNegHighlightGenes.pos:[],negGenesList:this.posNegHighlightGenes?this.posNegHighlightGenes.neg:[],basicSettings:this.defaultBasicSetting})}processSelectedGene(t){this.selectedGene$.next(t)}_initBasicSettings(t){const s=this.svgContainer.nativeElement.clientWidth,n=this._obtainGenelistLabelsWidth(t),i=s-n-this.defaultBasicSetting.marginRight;let r,p;i<=this.minBarsWidth?(r=this.minBarsWidth,p=s):i>=this.maxBarsWidth?(r=this.maxBarsWidth,p=i+r+this.defaultBasicSetting.marginRight):(r=i,p=this.defaultBasicSetting.marginRight+r+n);const f=this.defaultBasicSetting.marginTop+this.defaultBasicSetting.barsHeight+this.defaultBasicSetting.barsTitleHeight+(t.length*(this.defaultBasicSetting.highlightGenesHeight+this.defaultBasicSetting.highlightGenesGap)+this.defaultBasicSetting.gapBetweenPosNegGeneLists)+this.defaultBasicSetting.marginBottom;return Object.assign(Object.assign({},this.defaultBasicSetting),{barsWidth:r,height:f,marginLeft:n,width:p})}_obtainGenelistLabelsWidth(t){let s=0;if((null==t?void 0:t.length)>0){const n=(0,Dt.pP)(this.defaultBasicSetting.yLabelsFontSize);t.forEach(i=>{const r=this.computeStringWidthService.computeStringWidth(i.name,n,"times new roman");r>s&&(s=r)})}else s=50;return s+20}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(Gt.m),e.Y36(e.sBO))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-display-cor-info-with-lines-plot"]],viewQuery:function(t,s){if(1&t&&e.Gf(oe,5),2&t){let n;e.iGM(n=e.CRH())&&(s.svgContainer=n.first)}},inputs:{corsInfo:"corsInfo",posNegHighlightGenes:"posNegHighlightGenes"},outputs:{selectedGene$:"selectedGene$"},features:[e.TTD],decls:3,vars:6,consts:[[1,"d-flex","flex-column","justify-content-center",3,"ngStyle"],["svgContainer",""],["appD3ExportMap","",3,"pngName","pdfName","corsPlotInfo","selectedGene$"]],template:function(t,s){1&t&&(e.TgZ(0,"div",0,1),e.TgZ(2,"app-d3-cor-lines-plot",2),e.NdJ("selectedGene$",function(i){return s.processSelectedGene(i)}),e.qZA(),e.qZA()),2&t&&(e.Q6J("ngStyle",e.VKq(4,ae,s.containerMinHeight)),e.xp6(2),e.Q6J("pngName",s.downloadPngName)("pdfName",s.downloadPDFname)("corsPlotInfo",s.corsPlotInfo))},directives:[a.PC,ie,X.I],styles:[""],changeDetection:0}),o})();const le=["svgElement"];let xt=(()=>{class o{constructor(t){this.cdr=t,this.svgWidth=300,this.svgHeight=360,this.marginTop=60,this.marginRight=10,this.marginLeft=80,this.marginBottom=80,this.axisStrokeWidth=2,this.axisBottomLableSize=1,this.axisBottomTitleSize=1.5,this.xAxisTitleHeight=20,this.pointSize=2}ngOnInit(){}ngAfterViewInit(){this._removeGraphic(),this._initSettings(),this._initMap(),this.cdr.detectChanges()}ngOnChanges(t){t.corPointsPlotInfo&&!t.corPointsPlotInfo.isFirstChange()&&(this._removeGraphic(),this._initSettings(),this._initMap(),this.cdr.detectChanges())}ngOnDestroy(){this.geneToolTipDiv&&this.geneToolTipDiv.remove()}_removeGraphic(){(0,m.Ys)(this.svgElement.nativeElement).selectAll("*").remove()}_initSettings(){const t=this;t.allXvalues=this.corPointsPlotInfo.values1,t.allYvalues=this.corPointsPlotInfo.values2,t.samples=this.corPointsPlotInfo.samples;let s=[];for(let d=0;d<this.corPointsPlotInfo.values1.length;d++)s.push({value1:t.allXvalues[d],value2:t.allYvalues[d],sample:t.samples[d]});t.pairsValues=s,t.pointsMapWidth=t.svgWidth-t.marginLeft-t.marginRight,t.pointsMapHeight=t.svgHeight-t.marginTop-t.marginBottom;const n=(0,m.VV$)(t.allXvalues),i=(0,m.Fp7)(t.allXvalues),r=(i-n)/10;t.xScale=(0,m.BYU)().domain([n-r,i+r]).range([0,t.pointsMapWidth]);const p=(0,m.VV$)(t.allYvalues),l=(0,m.Fp7)(t.allYvalues),f=(l-p)/10;t.yScale=(0,m.BYU)().domain([p-f,l+f]).range([t.pointsMapHeight,0])}_initMap(){const t=this;this.d3Svg=(0,m.Ys)(this.svgElement.nativeElement).attr("height",t.svgHeight).attr("width",t.svgWidth),t.geneToolTipDiv=(0,m.Ys)("body").append("div").attr("class","d3Tooltip").style("opacity","0"),this._addBorder(),this._addAxises(),this._addPoints(),this._addCorsInfo()}_addBorder(){const t=this;this.d3Svg.append("rect").attr("transform","translate("+t.marginLeft+","+t.marginTop+")").attr("x",0).attr("y",0).attr("height",t.pointsMapHeight).attr("width",t.pointsMapWidth).attr("fill","none").attr("stroke","black").attr("stroke-width",t.axisStrokeWidth)}_addAxises(){const t=this,s=t.marginTop+t.pointsMapHeight,n=this.d3Svg.append("g").attr("transform","translate("+t.marginLeft+","+s+")").call((0,m.LLu)(t.xScale).tickFormat(y=>y.toString()));n.selectAll("text").style("font-size",t.axisBottomLableSize+"em");const i=s+n.node().getBBox().height+5+t.xAxisTitleHeight,r=t.marginLeft+.5*t.pointsMapWidth;this.d3Svg.append("text").attr("transform","translate("+r+","+i+")").style("text-anchor","middle").style("font-size",t.axisBottomTitleSize+"em").text(t.corPointsPlotInfo.value1Name);let l=this.d3Svg.append("g").attr("transform","translate("+t.marginLeft+","+t.marginTop+")").call((0,m.y4O)(t.yScale).tickFormat(y=>y.toString()));const f=t.marginLeft-l.node().getBBox().width-5,d=t.marginTop+.5*t.pointsMapHeight;this.d3Svg.append("text").attr("transform","translate("+f+","+d+")rotate(-90)").style("text-anchor","middle").style("font-size",t.axisBottomTitleSize+"em").text(t.corPointsPlotInfo.value2Name)}_addPoints(){const t=this;this.d3Svg.append("g").selectAll("samplePoints").data(t.pairsValues).enter().append("circle").attr("transform","translate("+t.marginLeft+","+t.marginTop+")").attr("cx",function(n){return t.xScale(n.value1)}).attr("cy",function(n){return t.yScale(n.value2)}).attr("r",t.pointSize).style("fill","black").attr("stroke","black").on("mousemove",function(n,i){t.geneToolTipDiv.transition().duration(200).style("opacity",.9),t.geneToolTipDiv.html(i.sampleName).style("left",n.pageX+"px").style("top",n.pageY-28+"px")}).on("mouseout",function(n){t.geneToolTipDiv.transition().duration(500).style("opacity",0)})}_addCorsInfo(){let s=this.marginLeft;const n=this.corPointsPlotInfo.corInfo,i=this.marginTop-40,r=this.d3Svg.append("g");r.append("text").attr("transform","translate("+s+","+i+")").style("font-size",20).text("cor = "+n.cor.toFixed(3)).style("text-anchor","start"),r.append("text").attr("transform","translate("+s+","+(i+20)+")").style("font-size",20).text("p-value = "+n.pValue.toExponential(3)).style("text-anchor","start")}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(e.sBO))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-d3-cor-points-plot"]],viewQuery:function(t,s){if(1&t&&e.Gf(le,5),2&t){let n;e.iGM(n=e.CRH())&&(s.svgElement=n.first)}},inputs:{corPointsPlotInfo:"corPointsPlotInfo"},features:[e.TTD],decls:2,vars:0,consts:[["svgElement",""]],template:function(t,s){1&t&&(e.O4$(),e._UZ(0,"svg",null,0))},styles:[""],changeDetection:0}),o})(),ge=(()=>{class o{constructor(){this.closeSignal$=new e.vpe}ngOnInit(){this.corPointsPlotInfo&&this._formatMapName()}closeModal(t){this.closeSignal$.next(!0)}ngOnChanges(t){t.corPointsPlotInfo&&!t.corPointsPlotInfo.isFirstChange()&&this._formatMapName()}_formatMapName(){this.downloadPDFname=this.corPointsPlotInfo.termName+".pdf",this.downloadPngName=this.corPointsPlotInfo.termName+".png"}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-display-one-gene-cor"]],inputs:{corPointsPlotInfo:"corPointsPlotInfo"},outputs:{closeSignal$:"closeSignal$"},features:[e.TTD],decls:9,vars:4,consts:[[1,"p-3"],[2,"height","1rem"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],["appD3ExportMap","",3,"pngName","pdfName","corPointsPlotInfo"]],template:function(t,s){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"button",2),e.NdJ("click",function(i){return s.closeModal(i)}),e.TgZ(3,"span",3),e._uU(4,"\xd7"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(5,"div"),e.TgZ(6,"p"),e._uU(7),e.qZA(),e.qZA(),e._UZ(8,"app-d3-cor-points-plot",4),e.qZA()),2&t&&(e.xp6(7),e.hij("Symbol: ",s.corPointsPlotInfo.termName,""),e.xp6(1),e.Q6J("pngName",s.downloadPngName)("pdfName",s.downloadPDFname)("corPointsPlotInfo",s.corPointsPlotInfo))},directives:[xt,X.I],styles:[""],changeDetection:0}),o})();const Ct=[{name:"Width",defaultValue:400,minValue:300,maxValue:800,stepValue:1},{name:"Height",defaultValue:500,minValue:400,maxValue:800,stepValue:1},{name:"MarginLeft",defaultValue:60,minValue:40,maxValue:100,stepValue:1},{name:"MarginRight",defaultValue:20,minValue:10,maxValue:100,stepValue:1},{name:"MarginTop",defaultValue:40,minValue:30,maxValue:100,stepValue:1},{name:"MarginBottom",defaultValue:80,minValue:60,maxValue:100,stepValue:1},{name:"TitleFontSize",defaultValue:18,minValue:10,maxValue:30,stepValue:1},{name:"ESYTitleFontSize",defaultValue:12,minValue:10,maxValue:30,stepValue:1},{name:"RMXTitleFontSize",defaultValue:12,minValue:10,maxValue:30,stepValue:1},{name:"RMYTitleFontSize",defaultValue:12,minValue:10,maxValue:30,stepValue:1}],he=["svgElement"];let pe=(()=>{class o{constructor(){this._svgWidth=400,this._svgHeight=450,this._svgMarginLeft=60,this._svgMarginRight=20,this._svgMarginTop=40,this._svgMarginBottom=80,this._svgBackGroundColor="#ffffff",this._geneInThePathwayBarsColor="black",this._esPlotBrokenLineColor="#07f80c",this._rankedListMetricBarsColor="#000000",this._svgTitle="Enrichment plot",this._svgESPlotYTitle="Enrichment score (ES)",this._svgRankedMetricPlotXTitle="Rank in Ordered Dataset",this._svgRankedMetricPlotYTitle="Ranked list metric",this._svgTitleFontSize=18,this._svgESPlotYTitleFontSize=12,this._svgRankedMetricPlotXTitleFontSize=12,this._svgRankedMetricPlotYTitleFontSize=12}ngOnChanges(t){t.gseaPlotInfo&&!t.gseaPlotInfo.isFirstChange()&&this._checkGseaPlotInfo()&&(this._removeGraphic(),this._initSettings(),this._initIntersectionGenes(),this._initMap())}ngAfterViewInit(){this._checkGseaPlotInfo()&&(this._initSettings(),this._initIntersectionGenes(),this._initMap())}_initMap(){this._initSvg(),this._initTitle(),this._initESPlotScale(),this._initESPlotAxis(),this._initESPlotZeroLine(),this._initESPlotBrokenLine(),this._initESPlotYTitle(),this._initGeneBars(),this._initRankedRiskMetricPlotScale(),this._initRankedRiskMetricPlotAxis(),this._initRankedRiskMetricPlotYTitle(),this._initRankedRiskMetricPlotXTitle(),this._initRankedRiskMetricPlotBars(),this._initSvgDescriptionInfo()}_initRankedRiskMetricPlotBars(){const n=(this._svgWidth-this._svgMarginLeft-this._svgMarginRight)/this._getAxisMaXValue(".rrmXAxis .tick text"),i=(0,m.UID)(this.gseaPlotInfo.gseaDataInfo.rankSeries,p=>p.valueUsedForRank),r=this._svgMarginTop+this._esPlotHeight+this._geneBarHeight;i.forEach((p,l)=>{this._svgD3.append("line").attr("x1",this._rrmXScale(l+1)).attr("y1",r+this._rrmYSacle(0)).attr("x2",this._rrmXScale(l+1)).attr("y2",r+this._rrmYSacle(p)).style("stroke",this._rankedListMetricBarsColor).style("stroke-width",n)})}_initSvgDescriptionInfo(){const t=this._svgMarginTop+this._esPlotHeight+this._geneBarHeight+this._rankedRiskMetricPlotHeight+50,i=this._svgD3.append("g").attr("class","description"),r=i.append("text").text("Enrichment profile").style("font-size","12px").style("font-weight","bold").style("font-family","Arial"),p=i.append("text").text("Hit").style("font-size","12px").style("font-weight","bold").style("font-family","Arial"),l=i.append("text").text("Ranking metric scores").style("font-size","12px").style("font-weight","bold").style("font-family","Arial"),f=r.node().getBBox().width,d=p.node().getBBox().width,c=l.node().getBBox().width,S=this._svgMarginLeft+.5*(this._svgWidth-this._svgMarginLeft-this._svgMarginRight)-.5*(40+f+d+c);i.append("rect").attr("x",S).attr("y",t).attr("width",10).attr("height",10).attr("fill",this._esPlotBrokenLineColor),r.attr("x",S+10).attr("y",t+10-1),i.append("rect").attr("x",S+10+f+5).attr("y",t).attr("width",10).attr("height",10).attr("fill",this._geneInThePathwayBarsColor),p.attr("x",S+20+f+5).attr("y",t+10-1),i.append("rect").attr("x",S+20+f+10+d).attr("y",t).attr("width",10).attr("height",10).attr("fill",this._rankedListMetricBarsColor),l.attr("x",S+30+f+10+d).attr("y",t+10-1)}_initRankedRiskMetricPlotXTitle(){const t=this._svgMarginLeft+.5*(this._svgWidth-this._svgMarginLeft-this._svgMarginRight),s=this._svgMarginTop+this._esPlotHeight+this._geneBarHeight+this._rankedRiskMetricPlotHeight+30;this._svgD3.append("text").text(this._svgRankedMetricPlotXTitle).attr("x",t).attr("y",s).attr("text-anchor","middle").style("font-size",this._svgRankedMetricPlotXTitleFontSize+"px").style("font-family","Arial").style("font-weight","bold")}_initRankedRiskMetricPlotYTitle(){const t=this._svgD3.append("text").text(this._svgRankedMetricPlotYTitle),s=t.node().getBBox(),n=this._geneBarHeight+this._svgMarginTop+this._esPlotHeight+.5*(this._rankedRiskMetricPlotHeight-s.width)+s.width;t.attr("x",this._svgMarginLeft-30).attr("y",n).attr("transform",`rotate(-90, ${this._svgMarginLeft-30}, ${n})`).style("font-size",this._svgRankedMetricPlotYTitleFontSize+"px").style("font-family","Arial").style("font-weight","bold")}_initRankedRiskMetricPlotAxis(){this._rrmXAxis=(0,m.LLu)(this._rrmXScale).tickSize(1).tickPadding(5).tickFormat(t=>t+""),this._rrmYAxis=(0,m.y4O)(this._rrmYSacle).tickSize(1).tickPadding(5),this._svgD3.append("g").call(this._rrmXAxis).attr("class","rrmXAxis").attr("transform",`translate(0, ${this._svgMarginTop+this._esPlotHeight+this._geneBarHeight+this._rankedRiskMetricPlotHeight})`).attr("stroke-width",1),this._svgD3.append("g").call(this._rrmYAxis).attr("class","rrmYAxis").attr("transform",`translate(${this._svgMarginLeft}, ${this._svgMarginTop+this._esPlotHeight+this._geneBarHeight})`).attr("stroke-width",1),this._svgD3.selectAll(".rrmXAxis .tick text").style("font-family","Arial").style("font-size","8px"),this._svgD3.selectAll(".rrmYAxis .tick text").style("font-family","Arial").style("font-size","8px")}_initRankedRiskMetricPlotScale(){const t=this.gseaPlotInfo.gseaDataInfo.rankSeries;this._rankedRiskMetricPlotHeight=.3*(this._svgHeight-this._svgMarginTop-this._svgMarginBottom),this._rrmXScale=(0,m.BYU)(),this._rrmYSacle=(0,m.BYU)(),this._rrmXScale.domain([0,t.length]).range([this._svgMarginLeft,this._svgWidth-this._svgMarginRight]).nice(),this._rrmYSacle.domain([parseFloat((0,m.VV$)(t,s=>s.valueUsedForRank)+""),parseFloat((0,m.Fp7)(t,s=>s.valueUsedForRank)+"")].reverse()).range([0,this._rankedRiskMetricPlotHeight]).nice()}_initESPlotYTitle(){const t=this._svgD3.append("text").text(this._svgESPlotYTitle),s=t.node().getBBox(),n=this._svgMarginTop+.5*(this._esPlotHeight-s.width)+s.width;t.attr("x",this._svgMarginLeft-30).attr("y",n).attr("transform",`rotate(-90, ${this._svgMarginLeft-30},${n})`).style("font-size",this._svgESPlotYTitleFontSize+"px").style("font-family","Arial").style("font-weight","bold")}_initGeneBars(){const t=this.gseaPlotInfo.gseaDataInfo.rankSeries,s=this.gseaPlotInfo.gseaDataInfo.genesInThePathway,n=this._getAxisMaXValue(".xAxis .tick text"),r=(this._svgWidth-this._svgMarginLeft-this._svgMarginRight)/n;this._geneBarHeight=.1*(this._svgHeight-this._svgMarginTop-this._svgMarginBottom),this._geneBarYStart=this._esPlotHeight+this._svgMarginTop;const p=[],l=this._svgD3.append("g").attr("class","geneBarsGroup");t.forEach((d,c)=>{s.includes(d.geneName)&&l.append("rect").attr("class",s.includes(d.geneName)?"geneInThePathway":"geneNotInThePathway").attr("width",r).attr("height",this._geneBarHeight).attr("x",this._esPlotXScale(this._esPoints[c][0])+.5*r).attr("y",this._geneBarYStart).attr("fill",this._geneInThePathwayBarsColor).attr("stroke",this._geneInThePathwayBarsColor).style("cursor","pointer").on("mouseenter",()=>{const y=this._svgD3.append("g").attr("class","pointerToPointInESPlot");y.append("line").attr("x1",this._esPlotXScale(this._esPoints[c][0])+r).attr("y1",this._geneBarYStart).attr("x2",this._esPlotXScale(this._esPoints[c][0])+r).attr("y2",this._esPlotYScale(this._esPoints[c+1][1])).style("stroke","#ccc").style("stroke-width",1),y.append("line").attr("x1",this._esPlotXScale(this._esPoints[c][0])+r).attr("y1",this._esPlotYScale(this._esPoints[c+1][1])).attr("x2",this._esPlotXScale(0)).attr("y2",this._esPlotYScale(this._esPoints[c+1][1])).style("stroke","#ccc").style("stroke-width",1),y.append("foreignObject").attr("class","info").attr("width","150px").attr("height","60px").html(`\n                <div style="position: relative;background-color: ${(0,m.B8C)(0,0,0,.4)}; padding-left: 10px; border-radius: 10px;">\n                  <p>\n                    GeneName: ${d.geneName}<br>\n                    Rank: ${d.valueUsedForRank.toFixed(2)}<br>\n                    ES: ${this._esPoints[c+1][1].toPrecision(2)}\n                  </p>\n                </div>\n              `).attr("x",this._svgWidth-160).attr("y",10).attr("color","white").style("font-size","12px").style("font-weight","bold").style("font-family","Arial")}).on("mouseout",()=>{this._svgD3.select(".pointerToPointInESPlot").remove()}).on("click",()=>{p.includes(c)?(this._svgD3.select(".desInfo"+c).remove(),p.splice(p.indexOf(c),1)):(p.push(c),this._svgD3.append("g").attr("class","desInfo"+c).append("line").attr("x1",this._esPlotXScale(this._esPoints[c][0])+r).attr("y1",this._geneBarYStart).attr("x2",this._esPlotXScale(this._esPoints[c][0])+r).attr("y2",this._esPlotYScale(this._esPoints[c+1][1])).style("stroke","#ccc").style("stroke-width",1))})}),p.push(this._maxValueInfo[1]),this._svgD3.append("g").attr("class","desInfo"+this._maxValueInfo[1]).append("line").attr("x1",this._esPlotXScale(this._maxValueInfo[1])+r).attr("y1",this._geneBarYStart).attr("x2",this._esPlotXScale(this._maxValueInfo[1])+r).attr("y2",this._esPlotYScale(this._maxValueInfo[0])).style("stroke","#ccc").style("stroke-width",1)}_getAxisMaXValue(t){const s=[];return this._svgD3.selectAll(t).each(n=>s.push(Number(n))),parseFloat((0,m.Fp7)(s,n=>n)+"")}_initESPlotBrokenLine(){const t=this.gseaPlotInfo.gseaDataInfo.rankSeries,s=this.gseaPlotInfo.gseaDataInfo.genesInThePathway,n=[[0,0]];let i=0;t.forEach((p,l)=>{s.includes(p.geneName)?i+=Math.abs(p.valueUsedForRank)/this._foldChangeValue:i+=-1/(t.length-s.length),n.push([l+1,i])}),this._esPoints=n;const r=(0,m.jvg)().x(p=>this._esPlotXScale(p[0])).y(p=>this._esPlotYScale(p[1]));this._svgD3.append("path").datum(n).attr("class","line").attr("d",r).style("stroke",this._esPlotBrokenLineColor).style("stroke-width",2).style("fill","none")}_initESPlotZeroLine(){const t=this._getESPlotTicksAndZeroIndexBySelector(".yAxis .tick text"),s=this._svgMarginTop+this._esPlotHeight/(t.size-1)*t.oneIndex;this._svgD3.append("line").attr("x1",this._svgMarginLeft).attr("y1",s).attr("x2",this._svgWidth-this._svgMarginRight).attr("y2",s).style("stroke","#ccc").style("stroke-width",2).attr("stroke-dasharray","8,4")}_getESPlotTicksAndZeroIndexBySelector(t){const s=[];return this._svgD3.selectAll(t).each(n=>s.push(Number(n))),{oneIndex:s.indexOf(0),size:s.length}}_initESPlotAxis(){this._exPlotXAxis=(0,m.LLu)(this._esPlotXScale).tickFormat(t=>"").tickSize(0),this._exPlotYAxis=(0,m.y4O)(this._esPlotYScale).tickSize(1).tickPadding(5),this._svgD3.append("g").call(this._exPlotXAxis).attr("class","xAxis").attr("transform",`translate(0, ${this._svgMarginTop+this._esPlotHeight})`).attr("stroke-width",0),this._svgD3.append("g").call(this._exPlotYAxis).attr("class","yAxis").attr("transform",`translate(${this._svgMarginLeft}, 0)`).attr("stroke-width",1),this._svgD3.selectAll(".yAxis .tick text").style("font-family","Arial").style("font-size","8px")}_initESPlotScale(){this._esPlotHeight=.6*(this._svgHeight-this._svgMarginTop-this._svgMarginBottom),this._esPlotXScale=(0,m.BYU)(),this._esPlotYScale=(0,m.BYU)(),this._esPlotXScale.domain([0,this.gseaPlotInfo.gseaDataInfo.rankSeries.length]).range([this._svgMarginLeft,this._svgWidth-this._svgMarginRight]).nice(),this._esPlotYScale.domain(this._getESPlotYScaleDomain().reverse()).range([this._svgMarginTop,this._svgMarginTop+this._esPlotHeight]).nice()}_getESPlotYScaleDomain(){const t=this.gseaPlotInfo.gseaDataInfo.rankSeries,s=this.gseaPlotInfo.gseaDataInfo.genesInThePathway,n=[];let i=0;return this._getFoldChangeValue(),t.forEach(r=>{s.includes(r.geneName)?i+=Math.abs(r.valueUsedForRank)/this._foldChangeValue:i+=-1/(t.length-s.length),n.push(i)}),this._maxValueInfo=[parseFloat((0,m.Fp7)(n,r=>r)+""),n.indexOf(parseFloat((0,m.Fp7)(n,r=>r)+""))],[parseFloat((0,m.VV$)(n,r=>r)+""),parseFloat((0,m.Fp7)(n,r=>r)+"")]}_getFoldChangeValue(){const s=this.gseaPlotInfo.gseaDataInfo.genesInThePathway;let n=0;this.gseaPlotInfo.gseaDataInfo.rankSeries.forEach(i=>{s.includes(i.geneName)&&(n+=Math.abs(i.valueUsedForRank))}),this._foldChangeValue=n}_initTitle(){const t=this._svgMarginLeft+.5*(this._svgWidth-this._svgMarginLeft-this._svgMarginRight);this._svgD3.append("text").text(this._svgTitle).attr("class","title").attr("x",t).attr("y",this._svgMarginTop-10).attr("text-anchor","middle").style("font-family","Arial").style("font-size",this._svgTitleFontSize+"px").style("font-weight","bold")}_initSvg(){this._svgD3=(0,m.Ys)(this.svgElement.nativeElement),this._svgD3.attr("width",this._svgWidth).attr("height",this._svgHeight).style("border","2px solid #ccc").style("backGround",this._svgBackGroundColor)}_initIntersectionGenes(){const t=[],n=this.gseaPlotInfo.gseaDataInfo.genesInThePathway,i=[];this.gseaPlotInfo.gseaDataInfo.rankSeries.forEach(r=>{i.push(r.geneName)}),n.forEach(r=>{i.includes(r)&&t.push(r)}),this.gseaPlotInfo.gseaDataInfo.genesInThePathway=t}_initSettings(){const t=this.gseaPlotInfo.gseaSettings;t&&(this._svgWidth=t.svgWidth?t.svgWidth:this._svgWidth,this._svgHeight=t.svgHeight?t.svgHeight:this._svgHeight,this._svgMarginLeft=t.svgMarginLeft?t.svgMarginLeft:this._svgMarginLeft,this._svgMarginRight=t.svgMarginRight?t.svgMarginRight:this._svgMarginRight,this._svgMarginTop=t.svgMarginTop?t.svgMarginTop:this._svgMarginTop,this._svgMarginBottom=t.svgMarginBottom?t.svgMarginBottom:this._svgMarginBottom,this._svgBackGroundColor=t.svgBackGroundColor?t.svgBackGroundColor:this._svgBackGroundColor,this._geneInThePathwayBarsColor=t.geneInThePathwayBarsColor?t.geneInThePathwayBarsColor:this._geneInThePathwayBarsColor,this._esPlotBrokenLineColor=t.esPlotBrokenLineColor?t.esPlotBrokenLineColor:this._esPlotBrokenLineColor,this._rankedListMetricBarsColor=t.rankedListMetricBarsColor?t.rankedListMetricBarsColor:this._rankedListMetricBarsColor,this._svgESPlotYTitle=t.svgESPlotYTitle?t.svgESPlotYTitle:this._svgESPlotYTitle,this._svgRankedMetricPlotXTitle=t.svgRankedMetricPlotXTitle?t.svgRankedMetricPlotXTitle:this._svgRankedMetricPlotXTitle,this._svgRankedMetricPlotYTitle=t.svgRankedMetricPlotYTitle?t.svgRankedMetricPlotYTitle:this._svgRankedMetricPlotYTitle,this._svgTitleFontSize=t.svgTitleFontSize?t.svgTitleFontSize:this._svgTitleFontSize,this._svgESPlotYTitleFontSize=t.svgESPlotYTitleFontSize?t.svgESPlotYTitleFontSize:this._svgESPlotYTitleFontSize,this._svgRankedMetricPlotXTitleFontSize=t.svgRankedMetricPlotXTitleFontSize?t.svgRankedMetricPlotXTitleFontSize:this._svgRankedMetricPlotXTitleFontSize,this._svgRankedMetricPlotYTitleFontSize=t.svgRankedMetricPlotYTitleFontSize?t.svgRankedMetricPlotYTitleFontSize:this._svgRankedMetricPlotYTitleFontSize)}_checkGseaPlotInfo(){return!(!this.gseaPlotInfo||!this.gseaPlotInfo.gseaDataInfo.rankSeries.length||!this.gseaPlotInfo.gseaDataInfo.genesInThePathway.length)}_removeGraphic(){this._svgD3&&this._svgD3.selectAll("*").remove()}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-d3-enriched-gsea-plot"]],viewQuery:function(t,s){if(1&t&&e.Gf(he,7),2&t){let n;e.iGM(n=e.CRH())&&(s.svgElement=n.first)}},inputs:{gseaPlotInfo:"gseaPlotInfo"},features:[e.TTD],decls:2,vars:0,consts:[["svgElement",""]],template:function(t,s){1&t&&(e.O4$(),e._UZ(0,"svg",null,0))},styles:[""],changeDetection:0}),o})();var ce=h(6458),me=h(3945);function de(o,g){if(1&o){const t=e.EpF();e.TgZ(0,"div",11),e.TgZ(1,"app-change-figure-settings",12),e.NdJ("modifiedSettings$",function(n){return e.CHM(t),e.oxw().changePlotSettings(n)})("closeSignal$",function(n){return e.CHM(t),e.oxw().showSettings(n)}),e.qZA(),e.qZA()}if(2&o){const t=e.oxw();e.xp6(1),e.Q6J("plotSettingInfoList",t.plotSettingInfoList)}}let ue=(()=>{class o{constructor(t){this.cdr=t,this.faCog=vt.b7W,this.ifShowSettingsComponent=!1,this.downloadPNGname="GSEA.png",this.downloadPDFname="GSEA.pdf"}ngOnChanges(){this.gseaPlotInfo&&(this._processGseaPlotInfoByDecreaseSort(),this.cdr.detectChanges())}ngOnInit(){this.plotSettingInfoList=Ct}changePlotSettings(t){this.gseaPlotInfo={gseaDataInfo:{rankSeries:this.gseaPlotInfo.gseaDataInfo.rankSeries,genesInThePathway:this.gseaPlotInfo.gseaDataInfo.genesInThePathway},gseaSettings:{svgWidth:t.Width,svgHeight:t.height,svgMarginLeft:t.marginLeft,svgMarginRight:t.marginRight,svgMarginTop:t.marginTop,svgMarginBottom:t.marginBottom,svgTitleFontSize:t.xLabelsFontSize,svgESPlotYTitleFontSize:t.yLabelsFontSize,svgRankedMetricPlotXTitleFontSize:t.xLabelsFontSize,svgRankedMetricPlotYTitleFontSize:t.yLabelsFontSize}},this.cdr.detectChanges()}showSettings(t){this.plotSettingInfoList=Ct,this.ifShowSettingsComponent=!this.ifShowSettingsComponent}_processGseaPlotInfoByDecreaseSort(){const t=this.gseaPlotInfo.gseaDataInfo.rankSeries,s=this.gseaPlotInfo.gseaDataInfo.genesInThePathway,n=[],i=[];this.gseaPlotInfo.gseaDataInfo.rankSeries=t.sort((r,p)=>p.valueUsedForRank-r.valueUsedForRank),t.forEach(r=>{s.includes(r.geneName)&&(i.push(r),n.push(r.geneName))}),this.gseaPlotInfo.gseaDataInfo.genesInThePathway=n}_processGenesInfoForTableData(){const s=this.gseaPlotInfo.gseaDataInfo.genesInThePathway,n=["geneName","valueUsedForRank"],i=[];n.length>0&&(this.gseaPlotInfo.gseaDataInfo.rankSeries.forEach(r=>{s.includes(r.geneName)&&i.push(r)}),this.genesInfoForTableData={features:n,genesInfo:i})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(e.sBO))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-display-gsea-info-with-gsea-plot"]],inputs:{gseaPlotInfo:"gseaPlotInfo",genesInfoForTableData:"genesInfoForTableData"},features:[e.TTD],decls:16,vars:8,consts:[[1,"row"],[1,"col-6","border-right"],[1,"text-center"],[1,"d-flex","justify-content-end"],[1,"form-inline","ml-1"],["ngbTooltip","Click to change settings of the plot",1,"hoverBigger","close","pull-right",3,"icon","size","click"],[1,"d-flex","justify-content-center"],["appD3ExportMap","",3,"gseaPlotInfo","pngName","pdfName"],[1,"col-6"],[1,"m-1",3,"genesInfoForTable","ifViewOneGenePlot"],["cdkDrag","","class","border p-3","style","position: absolute; z-index: 1014;top: 7rem; right: 0rem; background-color: white",4,"ngIf"],["cdkDrag","",1,"border","p-3",2,"position","absolute","z-index","1014","top","7rem","right","0rem","background-color","white"],[3,"plotSettingInfoList","modifiedSettings$","closeSignal$"]],template:function(t,s){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e.TgZ(3,"h5"),e._uU(4,"GSEA Plot"),e.qZA(),e.qZA(),e.TgZ(5,"div",3),e.TgZ(6,"div",4),e.TgZ(7,"fa-icon",5),e.NdJ("click",function(i){return s.showSettings(i)}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(8,"div",6),e._UZ(9,"app-d3-enriched-gsea-plot",7),e.qZA(),e.qZA(),e.TgZ(10,"div",8),e.TgZ(11,"div",2),e.TgZ(12,"h5"),e._uU(13,"Info of the genes in the Pathway"),e.qZA(),e.qZA(),e._UZ(14,"app-display-genes-info-table-pagination",9),e.qZA(),e.qZA(),e.YNc(15,de,2,1,"div",10)),2&t&&(e.xp6(7),e.Q6J("icon",s.faCog)("size","sm"),e.xp6(2),e.Q6J("gseaPlotInfo",s.gseaPlotInfo)("pngName",s.downloadPNGname)("pdfName",s.downloadPDFname),e.xp6(5),e.Q6J("genesInfoForTable",s.genesInfoForTableData)("ifViewOneGenePlot",!1),e.xp6(1),e.Q6J("ngIf",s.ifShowSettingsComponent))},directives:[H.BN,C._L,pe,X.I,ce.T,a.O5,P.Zt,me.q],styles:[""]}),o})();const fe=["svgContainer"],_e=["GSEAplotContent"],ye=function(o){return{active:o}};function Ie(o,g){if(1&o){const t=e.EpF();e.TgZ(0,"li",12),e.TgZ(1,"a",13),e.NdJ("click",function(){const i=e.CHM(t).$implicit;return e.oxw().changeCorPlotType(i)}),e._uU(2),e.qZA(),e.qZA()}if(2&o){const t=g.$implicit,s=e.oxw();e.xp6(1),e.Q6J("ngClass",e.VKq(2,ye,s.selectedCorPlotType===t)),e.xp6(1),e.hij(" ",t," ")}}function Se(o,g){1&o&&(e.TgZ(0,"p",14),e._uU(1," Please Generate a new integration analysis in the left side bar "),e.qZA())}function ve(o,g){if(1&o&&(e.TgZ(0,"div",16),e._UZ(1,"fa-icon",17),e.qZA()),2&o){const t=e.oxw(2);e.xp6(1),e.Q6J("icon",t.faSpinner)("size","3x")("spin",!0)}}function Te(o,g){if(1&o&&(e.TgZ(0,"p"),e._uU(1),e.qZA(),e.YNc(2,ve,2,3,"div",15)),2&o){const t=e.oxw();e.xp6(1),e.Oqu(null==t.corAnalysisGSEAresultStatus?null:t.corAnalysisGSEAresultStatus.statusValue),e.xp6(1),e.Q6J("ngIf","loading"===(null==t.corAnalysisGSEAresultStatus?null:t.corAnalysisGSEAresultStatus.status))}}function De(o,g){if(1&o){const t=e.EpF();e.TgZ(0,"app-display-cor-info-with-histogram",18),e.NdJ("selectedGene$",function(n){return e.CHM(t),e.oxw().processSelectedGene(n)}),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("corsInfo",t.corsInfo)("posNegHighlightGenes",t.posNegHighlightGenes)}}function Ge(o,g){if(1&o){const t=e.EpF();e.TgZ(0,"app-display-cor-info-with-lines-plot",18),e.NdJ("selectedGene$",function(n){return e.CHM(t),e.oxw().processSelectedGene(n)}),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("corsInfo",t.corsInfo)("posNegHighlightGenes",t.posNegHighlightGenes)}}function xe(o,g){if(1&o){const t=e.EpF();e.TgZ(0,"app-display-one-gene-cor",19),e.NdJ("closeSignal$",function(n){return e.CHM(t),e.oxw().closeModalForOneGeneCor(n)}),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("corPointsPlotInfo",t.corPointsPlotInfo)}}function Ce(o,g){if(1&o){const t=e.EpF();e.TgZ(0,"div",20),e.TgZ(1,"h4",21),e._uU(2),e.qZA(),e.TgZ(3,"button",22),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return null==n.gseaModalRef?null:n.gseaModalRef.hide()}),e.TgZ(4,"span",23),e._uU(5,"\xd7"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(6,"div",24),e._UZ(7,"app-display-gsea-info-with-gsea-plot",25),e.qZA(),e.TgZ(8,"div",26),e.TgZ(9,"button",27),e.NdJ("click",function(){return e.CHM(t),e.oxw().gseaModalRef.hide()}),e._uU(10," close "),e.qZA(),e.qZA()}if(2&o){const t=e.oxw();e.xp6(2),e.hij("GSEA Analysis result of ",t.annotationID,""),e.xp6(5),e.Q6J("gseaPlotInfo",t.gseaPlotInfo)("genesInfoForTableData",t.annotationGenesInfoForTable)}}let we=(()=>{class o{constructor(t,s){this.cdr=t,this.modalService=s,this.faSpinner=vt.LM3,this.corPlotTypes=["Histogram Plot","Line Order Plot"],this.selectedCorPlotType="Histogram Plot",this.posNegHighlightGenes={pos:[],neg:[]},this.ifShowOneGeneCor=!1}ngOnInit(){this.corAnalysisGSEAresultStatus&&"finished"===this.corAnalysisGSEAresultStatus.status&&(this._prepareInitCorsPlotInfo(),this._prepareCorGenesEnrichedAnnotationsForTable(),this._prepareRankerSeries())}ngOnChanges(t){t.corAnalysisGSEAresultStatus&&!t.corAnalysisGSEAresultStatus.isFirstChange()&&this.corAnalysisGSEAresultStatus&&"finished"===this.corAnalysisGSEAresultStatus.status&&(this._prepareInitCorsPlotInfo(),this._prepareCorGenesEnrichedAnnotationsForTable(),this._prepareRankerSeries())}changeCorPlotType(t){this.selectedCorPlotType=t,this.corsInfo=Object.assign({},this.corsInfo),this.posNegHighlightGenes=Object.assign({},this.posNegHighlightGenes),this.cdr.detectChanges()}processSelectedAnnotations(t){const s=[],n=[],i=this.corAnalysisGSEAresultStatus.result.gseaEnrichedAnnotations,r=new Set(t),p=i.pathway,l=i.GenesInAnnotation,f=i.NES;for(let d=0;d<p.length;d++)r.has(p[d])&&(f[d]>0?s.push({name:p[d].split("#")[2],genes:l[d].split(",")}):n.push({name:p[d].split("#")[2],genes:l[d].split(",")}));this.posNegHighlightGenes={pos:s,neg:n},this.cdr.detectChanges()}processSelectedAnnotation(t){this.gseaModalRef=this.modalService.show(this.GSEAplotContent,Object.assign({},{class:"modal-xl"}));const s=this.corAnalysisGSEAresultStatus.result.gseaEnrichedAnnotations.pathway.indexOf(t),n=this.corAnalysisGSEAresultStatus.result.gseaEnrichedAnnotations.GenesInAnnotation[s].split(",");this.gseaPlotInfo={gseaDataInfo:{rankSeries:[...this._rankedSeries],genesInThePathway:n}},this.annotationID=t;const i=this.corAnalysisGSEAresultStatus.result.corsInfo.cors,r=this.corAnalysisGSEAresultStatus.result.corsInfo.pvalues,p=this.corAnalysisGSEAresultStatus.result.genes,l=new Set(n);let f=[];p.forEach((d,c)=>{l.has(d)&&f.push({geneName:p[c],cor:i[c],pValue:r[c]})}),this.annotationGenesInfoForTable={features:["geneName","cor","pValue"],genesInfo:f}}processSelectedGene(t){this.ifShowOneGeneCor=!0;const s=this.corAnalysisGSEAresultStatus.result.genes.indexOf(t),n={samples:[...this.corAnalysisGSEAresultStatus.result.samples],values1:[...this.corAnalysisGSEAresultStatus.result.expressionInfo.array1[s]],values2:[...this.corAnalysisGSEAresultStatus.result.expressionInfo.array2[s]],value1Name:this.corAnalysisGSEAresultStatus.result.dataset1ID,value2Name:this.corAnalysisGSEAresultStatus.result.dataset2ID,corInfo:{cor:this.corAnalysisGSEAresultStatus.result.corsInfo.cors[s],pValue:this.corAnalysisGSEAresultStatus.result.corsInfo.pvalues[s]},termName:t};this.corPointsPlotInfo=Object.assign({},n),this.cdr.detectChanges()}closeModalForOneGeneCor(t){this.ifShowOneGeneCor=!1}_prepareInitCorsPlotInfo(){this.corsInfo={cors:this.corAnalysisGSEAresultStatus.result.corsInfo.cors,genes:this.corAnalysisGSEAresultStatus.result.genes},this.cdr.detectChanges()}_prepareRankerSeries(){const t=ut(this.corAnalysisGSEAresultStatus.result.corsInfo.cors,this.corAnalysisGSEAresultStatus.result.corsInfo.pvalues);let s=[];for(const[i,r]of(0,O.$R)(t,this.corAnalysisGSEAresultStatus.result.genes))s.push({geneName:r,valueUsedForRank:i});const n=s.sort((i,r)=>i.valueUsedForRank>r.valueUsedForRank?-1:i.valueUsedForRank<r.valueUsedForRank?1:0);this._rankedSeries=n}_prepareCorGenesEnrichedAnnotationsForTable(){const t=this.corAnalysisGSEAresultStatus.result.gseaEnrichedAnnotations,s=Object.keys(t),r=(0,O.gG)(t).map(p=>Object.assign(Object.assign({},p),{leadingEdge:p.leadingEdge.toString()})).sort((p,l)=>p.NES<l.NES?1:l.NES<p.NES?-1:0);this.corGenesEnrichedAnnotationsForTable={features:s,termsInfo:r},this.cdr.detectChanges()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(e.sBO),e.Y36(M.tT))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-display-integration-analysis-result-based-on-cor"]],viewQuery:function(t,s){if(1&t&&(e.Gf(fe,5),e.Gf(_e,5,e.Rgc)),2&t){let n;e.iGM(n=e.CRH())&&(s.svgContainer=n.first),e.iGM(n=e.CRH())&&(s.GSEAplotContent=n.first)}},inputs:{corAnalysisGSEAresultStatus:"corAnalysisGSEAresultStatus"},features:[e.TTD],decls:18,vars:11,consts:[[1,"row"],[1,"col-12","col-lg-6"],[1,"text-center","mt-2",2,"margin-bottom","0"],["data-testid","switchPlotType",1,"nav","nav-tabs","mt-2"],["class","nav-item",4,"ngFor","ngForOf"],["class","mt-2 text-danger","data-testid","noIntegrationNote",4,"ngIf"],[3,"ngIf"],[3,"corsInfo","posNegHighlightGenes","selectedGene$",4,"ngIf"],[1,"mt-2"],[3,"termsInfoForTable","termName","uniqueFeature","ifShowViewPlotIcon","viewPlotName","selectedItems$","clickedTermForPlot$"],["cdkDrag","","class","moveFreeDiv border",3,"corPointsPlotInfo","closeSignal$",4,"ngIf"],["GSEAplotContent",""],[1,"nav-item"],["href","javascript:void(0)",1,"nav-link",3,"ngClass","click"],["data-testid","noIntegrationNote",1,"mt-2","text-danger"],["class","form-inline",4,"ngIf"],[1,"form-inline"],[1,"hoverBigger",3,"icon","size","spin"],[3,"corsInfo","posNegHighlightGenes","selectedGene$"],["cdkDrag","",1,"moveFreeDiv","border",3,"corPointsPlotInfo","closeSignal$"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close","close","pull-right",3,"click"],["aria-hidden","true",1,"visually-hidden"],[1,"modal-body"],[3,"gseaPlotInfo","genesInfoForTableData"],[1,"modal-footer"],["data-testid","closeGeneListInput","type","button",1,"btn","btn-default",3,"click"]],template:function(t,s){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"h5",2),e._uU(3," Plot of Correlation "),e.qZA(),e.TgZ(4,"ul",3),e.YNc(5,Ie,3,4,"li",4),e.qZA(),e.YNc(6,Se,2,0,"p",5),e.YNc(7,Te,3,2,"ng-template",6),e.YNc(8,De,1,2,"app-display-cor-info-with-histogram",7),e.YNc(9,Ge,1,2,"app-display-cor-info-with-lines-plot",7),e.qZA(),e.TgZ(10,"div",1),e.TgZ(11,"h5",2),e._uU(12," Enriched Annotations "),e.qZA(),e.TgZ(13,"div",8),e.TgZ(14,"app-display-terms-info-table-pagination",9),e.NdJ("selectedItems$",function(i){return s.processSelectedAnnotations(i)})("clickedTermForPlot$",function(i){return s.processSelectedAnnotation(i)}),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.YNc(15,xe,1,1,"app-display-one-gene-cor",10),e.YNc(16,Ce,11,3,"ng-template",null,11,e.W1O)),2&t&&(e.xp6(5),e.Q6J("ngForOf",s.corPlotTypes),e.xp6(1),e.Q6J("ngIf",!s.corAnalysisGSEAresultStatus),e.xp6(1),e.Q6J("ngIf","error"===(null==s.corAnalysisGSEAresultStatus?null:s.corAnalysisGSEAresultStatus.status)||"loading"===(null==s.corAnalysisGSEAresultStatus?null:s.corAnalysisGSEAresultStatus.status)),e.xp6(1),e.Q6J("ngIf","Histogram Plot"===s.selectedCorPlotType),e.xp6(1),e.Q6J("ngIf","Line Order Plot"===s.selectedCorPlotType),e.xp6(5),e.Q6J("termsInfoForTable",s.corGenesEnrichedAnnotationsForTable)("termName","Annotation Terms")("uniqueFeature","pathway")("ifShowViewPlotIcon",!0)("viewPlotName","View GSEA Plot"),e.xp6(1),e.Q6J("ngIf",s.ifShowOneGeneCor))},directives:[a.sg,a.O5,Tt.v,a.mk,H.BN,se,re,ge,P.Zt,ue],styles:[""],changeDetection:0}),o})();var Ae=h(4547),wt=h(5826);function Pe(o,g){if(1&o){const t=e.EpF();e.TgZ(0,"div",15),e.TgZ(1,"div",16),e.TgZ(2,"app-try-sample",17),e.NdJ("sampleForTryName$",function(n){return e.CHM(t),e.oxw().processTrySampleFileName(n)})("sampleForImportName$",function(n){return e.CHM(t),e.oxw().processDownloadSampleData(n)})("closeMe$",function(n){return e.CHM(t),e.oxw().closeTrySampleComponent(n)}),e.ALo(3,"async"),e.ALo(4,"async"),e.qZA(),e.qZA(),e.qZA()}if(2&o){const t=e.oxw();e.xp6(2),e.Q6J("fileInfos",t.trySamplesInfos)("trySamplePercentage",e.lcZ(3,3,t.trySamplePercentage$))("downloadSampleDataPercentage",e.lcZ(4,5,t.downloadSampleDataPercentage$))}}let be=(()=>{class o{constructor(t){this.facade=t,this.trySamplesInfos=[{fileForImport:"Integration_Demo.zip",fileForTry:"integrationExp.json.gz",description:"Transcriptomic, Proteomics integration analysis"}],this.tutorialGifInfos=[{name:"New integration analysis",src:"/static/images/interactiveOperations/IntegrationExp-1-start new analysis.gif"},{name:"Highligh genes in the annotation terms",src:"/static/images/interactiveOperations/IntegrationExp-2-Highlight genes in annotations.gif"},{name:"Switch between plots",src:"/static/images/interactiveOperations/IntegrationExp-3-switch between plots.gif"}],this.trySamplePercentage$=this.facade.trySamplePercentage$,this.ifShowTrySampleComponent=!0,this.downloadSampleDataPercentage$=this.facade.downloadSampleDataPercentage$,this.allDatasetInfoForDisplay$=this.facade.allDatasetInfoForDisplay$,this.allIntegrationCorAnalysisIDs$=this.facade.allIntegrationCorAnalysisIDs$,this.corAnalysisGSEAresultStatus$=this.facade.corAnalysisGSEAresultStatus$}ngOnInit(){}processIntegrationAnalysisRequest(t){this.facade.processIntegrationAnalysisRequest(t)}processTrySampleFileName(t){this.facade.prepareTrySampleData(t)}processDownloadProjectSignal(t){this.facade.downloadProjectSignal()}processDownloadSampleData(t){this.facade.downloadSampleData(t)}closeTrySampleComponent(t){this.ifShowTrySampleComponent=!1}processSelectedIntegrationResultID(t){this.facade.requestIntegrationAnalysisResult(t)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(ot))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-overview-cor-between-datasets"]],decls:19,vars:15,consts:[[1,"row","flex-xl-nowrap"],[1,"col-12","col-md-3","col-xl-2","border-right"],[1,"mb-3","mt-5"],[3,"datasetInfos","integrationAnalysisRequest$"],[1,"col-12","col-md-9","col-xl-10","mt-2"],["class","row border",4,"ngIf"],[1,"row","mt-2"],[1,"col-12","p-1","d-flex","justify-content-between"],["data-testid","requestIntegrationResult",3,"inputItems","itemLabel","emptyNote","formInlineOrNot","ifOutputFirstValue","selectedItem$"],[3,"tutorialGifInfos"],[1,"row","border","mt-4"],[1,"col-12"],[3,"corAnalysisGSEAresultStatus"],[1,"row","mt-4"],[3,"downloadProjectSignal$"],[1,"row","border"],[1,"col-12","p-1"],[3,"fileInfos","trySamplePercentage","downloadSampleDataPercentage","sampleForTryName$","sampleForImportName$","closeMe$"]],template:function(t,s){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"h5",2),e._uU(3,"Start a New Integration Analysis Based on Correlation"),e.qZA(),e.TgZ(4,"app-generate-new-merge-analysis-based-on-correlation",3),e.NdJ("integrationAnalysisRequest$",function(i){return s.processIntegrationAnalysisRequest(i)}),e.ALo(5,"async"),e.qZA(),e.qZA(),e.TgZ(6,"div",4),e.YNc(7,Pe,5,7,"div",5),e.TgZ(8,"div",6),e.TgZ(9,"div",7),e.TgZ(10,"app-select-item",8),e.NdJ("selectedItem$",function(i){return s.processSelectedIntegrationResultID(i)}),e.ALo(11,"async"),e.qZA(),e._UZ(12,"app-trigger-to-display-tutorial-gif",9),e.qZA(),e.qZA(),e.TgZ(13,"div",10),e.TgZ(14,"div",11),e._UZ(15,"app-display-integration-analysis-result-based-on-cor",12),e.ALo(16,"async"),e.qZA(),e.qZA(),e.TgZ(17,"div",13),e.TgZ(18,"app-download-project",14),e.NdJ("downloadProjectSignal$",function(i){return s.processDownloadProjectSignal(i)}),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&t&&(e.xp6(4),e.Q6J("datasetInfos",e.lcZ(5,9,s.allDatasetInfoForDisplay$)),e.xp6(3),e.Q6J("ngIf",s.ifShowTrySampleComponent),e.xp6(3),e.Q6J("inputItems",e.lcZ(11,11,s.allIntegrationCorAnalysisIDs$))("itemLabel","Available Integration Analysis")("emptyNote","Generate a integration analysis in the left sidebar")("formInlineOrNot",!0)("ifOutputFirstValue",!0),e.xp6(2),e.Q6J("tutorialGifInfos",s.tutorialGifInfos),e.xp6(3),e.Q6J("corAnalysisGSEAresultStatus",e.lcZ(16,13,s.corAnalysisGSEAresultStatus$)))},directives:[zt,a.O5,Jt.y,Xt.n,we,Ae.E,wt.P],pipes:[a.Ov],styles:[""]}),o})();const Be=["submitButton"];function Ne(o,g){if(1&o){const t=e.EpF();e.TgZ(0,"div"),e.TgZ(1,"app-select-item-object",5),e.NdJ("selectedItemObject$",function(n){return e.CHM(t),e.oxw().processSelectedDataset1(n)}),e.qZA(),e.qZA()}if(2&o){const t=e.oxw();e.xp6(1),e.Q6J("inputObjects",t.datasetInfos)("idAttribute","datasetID")("displayAttribute","datasetID")("itemLabel","Select Dataset1")}}function Oe(o,g){1&o&&(e.TgZ(0,"p",6),e._uU(1,"Please import two Expression Profile data first. "),e.TgZ(2,"a",7),e._uU(3,"Import Data"),e.qZA(),e.qZA())}function Ze(o,g){1&o&&(e.TgZ(0,"p",8),e._uU(1," Dataset1 and dataset2 have no overlapping samples. Select another one dataset or change sample names in the dataset\n"),e.qZA())}function Fe(o,g){if(1&o&&(e.TgZ(0,"div"),e.TgZ(1,"p",14),e._uU(2),e.qZA(),e._UZ(3,"app-display-limited-items",15),e.qZA()),2&o){const t=e.oxw().ngIf;e.xp6(2),e.hij(" Dataset1 and dataset2 have ",t.length," overlapping samples. These samples will be used for later use "),e.xp6(1),e.Q6J("items",t)("displayNum",10)}}function He(o,g){if(1&o){const t=e.EpF();e.TgZ(0,"div"),e.YNc(1,Fe,4,3,"div",4),e.TgZ(2,"div"),e.TgZ(3,"h5",9),e._uU(4,"Input a Gene of Interest"),e.qZA(),e.TgZ(5,"input",10),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw().asyncSelectedSymbol=n})("typeaheadOnSelect",function(n){return e.CHM(t),e.oxw().selectSymbol(n)}),e.qZA(),e.TgZ(6,"div",11),e.TgZ(7,"button",12,13),e.ALo(9,"async"),e._uU(10," Submit "),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&o){const t=g.ngIf,s=e.oxw();e.xp6(1),e.Q6J("ngIf",(null==t?null:t.length)>0),e.xp6(4),e.Q6J("disabled",!((null==s.commonSymbols?null:s.commonSymbols.length)>0))("typeahead",s.commonSymbols)("ngModel",s.asyncSelectedSymbol),e.xp6(2),e.Q6J("disabled",!e.lcZ(9,5,s.ifSubmitAvailable$))}}let Re=(()=>{class o extends at.e{constructor(t){super(),this.cdr=t,this.datasetInfos=[],this.commonSymbols=[],this.commonGenesRequest$=new e.vpe(null),this.oneGeneBetweenDatasetsRequest$=new e.vpe(null),this.datasetInfosForDataset2=[],this.dataset1$=new D.X(null),this.dataset2$=new D.X(null),this.inputSymbol$=new D.X(null),this.overlappingSamplesSubject=new D.X(null)}ngOnInit(){this.ifShowNoOverlappingSamplesNote$=(0,U.aj)([this.dataset1$,this.dataset2$]).pipe((0,u.U)(([t,s])=>!(!t||!s||(0,O.BY)([t.samples,s.samples]))),(0,z.R)(this.destroyNotifier$),(0,it.O)(!1)),(0,U.aj)([this.dataset1$,this.dataset2$]).pipe((0,u.U)(([t,s])=>{let n=[];return t&&s&&(0,O.BY)([t.samples,s.samples])&&(n=(0,O.kX)(t.samples.concat(s.samples))),n}),(0,z.R)(this.destroyNotifier$)).subscribe(this.overlappingSamplesSubject),(0,U.aj)([this.dataset1$,this.dataset2$]).pipe((0,u.U)(([t,s])=>{let n=[];return t&&s&&(0,O.BY)([t.samples,s.samples])&&(n=(0,O.kX)(t.samples.concat(s.samples))),n.length>=1?{dataset1ID:t.datasetID,dataset2ID:s.datasetID}:null}),(0,G.h)(t=>null!=t),(0,z.R)(this.destroyNotifier$)).subscribe(t=>{this.commonGenesRequest$.next(t)}),this.ifSubmitAvailable$=(0,U.aj)([this.dataset1$,this.dataset2$,this.inputSymbol$]).pipe((0,u.U)(([t,s,n])=>!!(t&&s&&n)),(0,it.O)(!1))}ngAfterViewInit(){(0,_t.R)(this.submitButton.nativeElement,"click").pipe((0,G.h)(t=>null!=t),(0,yt.M)(this.dataset1$.pipe((0,G.h)(t=>null!=t)),this.dataset2$.pipe((0,G.h)(t=>null!=t)),this.overlappingSamplesSubject.pipe((0,G.h)(t=>null!=t)),this.inputSymbol$.pipe((0,G.h)(t=>null!=t))),(0,u.U)(([t,s,n,i,r])=>{const p=[...new Set((0,O.sj)([...this.commonSymbols],r))];return{dataset1ID:s.datasetID,dataset2ID:n.datasetID,overlappingSamples:i,overlappingGenes:p,geneID:r}})).subscribe(t=>{this.oneGeneBetweenDatasetsRequest$.next(t)})}processSelectedDataset1(t){this.dataset1$.next(t),this._obtainDatasetInfosForDataset2(t)}processSelectedDataset2(t){this.dataset2$.next(t)}_obtainDatasetInfosForDataset2(t){const s=this.datasetInfos.filter(n=>n.datasetID!=t.datasetID&&n.speciesID==t.speciesID);this.datasetInfosForDataset2=[...s],this.cdr.detectChanges()}selectSymbol(t){this.inputSymbol$.next(t.item)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(e.sBO))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-generate-one-gene-between-datasets-request"]],viewQuery:function(t,s){if(1&t&&e.Gf(Be,5),2&t){let n;e.iGM(n=e.CRH())&&(s.submitButton=n.first)}},inputs:{datasetInfos:"datasetInfos",commonSymbols:"commonSymbols"},outputs:{commonGenesRequest$:"commonGenesRequest$",oneGeneBetweenDatasetsRequest$:"oneGeneBetweenDatasetsRequest$"},features:[e.qOj],decls:8,vars:12,consts:[[4,"ngIf","ngIfElse"],["importDataNote",""],["data-testid","dataset2",3,"inputObjects","idAttribute","displayAttribute","itemLabel","selectedItemObject$"],["data-testid","noOverlapSamplesAlert","class","text-danger",4,"ngIf"],[4,"ngIf"],["data-testid","dataset1",3,"inputObjects","idAttribute","displayAttribute","itemLabel","selectedItemObject$"],["data-testid","noDatasetNote"],["routerLink","/importData"],["data-testid","noOverlapSamplesAlert",1,"text-danger"],["for","species"],["typeaheadOptionField","name","placeholder","Type a symbol",1,"form-control","form-control-sm",3,"disabled","typeahead","ngModel","ngModelChange","typeaheadOnSelect"],[1,"mt-4","p-1"],["data-testid","submitOneGeneCorRequest",1,"btn","btn-expressvis",3,"disabled"],["submitButton",""],[1,"text-info"],[3,"items","displayNum"]],template:function(t,s){if(1&t&&(e.YNc(0,Ne,2,4,"div",0),e.YNc(1,Oe,4,0,"ng-template",null,1,e.W1O),e.TgZ(3,"app-select-item-object",2),e.NdJ("selectedItemObject$",function(i){return s.processSelectedDataset2(i)}),e.qZA(),e.YNc(4,Ze,2,0,"p",3),e.ALo(5,"async"),e.YNc(6,He,11,7,"div",4),e.ALo(7,"async")),2&t){const n=e.MAs(2);e.Q6J("ngIf",(null==s.datasetInfos?null:s.datasetInfos.length)>=2)("ngIfElse",n),e.xp6(3),e.Q6J("inputObjects",s.datasetInfosForDataset2)("idAttribute","datasetID")("displayAttribute","datasetID")("itemLabel","Select Dataset2"),e.xp6(1),e.Q6J("ngIf",e.lcZ(5,8,s.ifShowNoOverlappingSamplesNote$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(7,10,s.overlappingSamplesSubject))}},directives:[a.O5,It.w,_.yS,I.Fj,F.Bp,I.JJ,I.On,St.w],pipes:[a.Ov],styles:[""],changeDetection:0}),o})();var Le=h(471),Me=h(5686),Ee=h(5389);let $e=(()=>{class o extends at.e{constructor(){super(),this.filterInfo$=new e.vpe,this.filterInfoForm=new I.cw({dataset1CorFilterType:new I.NI("greaterAndEqual",I.kI.required),dataset1Cor:new I.NI(.5,[I.kI.required,I.kI.min(-1),I.kI.max(1)]),dataset2CorFilterType:new I.NI("greaterAndEqual",I.kI.required),dataset2Cor:new I.NI(.5,[I.kI.required,I.kI.min(-1),I.kI.max(1)])})}ngOnInit(){this.filterInfoForm.valueChanges.pipe((0,Me.b)(500),(0,Ee.x)()).subscribe(t=>{"VALID"===this.filterInfoForm.status&&this.filterInfo$.next(t)})}ngAfterViewInit(){this.filterInfoForm.patchValue({dataset1CorFilterType:"greaterAndEqual",dataset1Cor:.5,dataset2CorFilterType:"greaterAndEqual",dataset2Cor:.5})}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-generate-genes-cor-between-datasets-filter-info"]],outputs:{filterInfo$:"filterInfo$"},features:[e.qOj],decls:25,vars:1,consts:[[1,"form-inline",3,"formGroup"],[1,"mr-3","align-self-start"],["formControlName","dataset1CorFilterType","data-testid","inputDataset1CorFilterType",1,"form-control","form-control-sm"],["value","less"],["value","lessAndEqual"],["value","greater"],["value","greaterAndEqual"],["formControlName","dataset1Cor","max","1","min","-1","step","0.1","type","number","data-testid","inputDataset1Cor",1,"form-control","form-control-sm",2,"width","5rem"],["formControlName","dataset2CorFilterType","data-testid","inputDataset2CorFilterType",1,"form-control","form-control-sm"],["formControlName","dataset2Cor","type","number","max","1","min","-1","step","0.1","data-testid","inputDataset2Cor",1,"form-control","form-control-sm",2,"width","5rem"]],template:function(t,s){1&t&&(e.TgZ(0,"form",0),e.TgZ(1,"div",1),e._uU(2," Correlation coefficient in dataset1 is "),e.TgZ(3,"select",2),e.TgZ(4,"option",3),e._uU(5," < "),e.qZA(),e.TgZ(6,"option",4),e._uU(7," \u2264 "),e.qZA(),e.TgZ(8,"option",5),e._uU(9," > "),e.qZA(),e.TgZ(10,"option",6),e._uU(11," \u2265 "),e.qZA(),e.qZA(),e._UZ(12,"input",7),e.qZA(),e.TgZ(13,"div",1),e._uU(14," Correlation coefficient in dataset2 is "),e.TgZ(15,"select",8),e.TgZ(16,"option",3),e._uU(17," < "),e.qZA(),e.TgZ(18,"option",4),e._uU(19," \u2264 "),e.qZA(),e.TgZ(20,"option",5),e._uU(21," > "),e.qZA(),e.TgZ(22,"option",6),e._uU(23," \u2265 "),e.qZA(),e.qZA(),e._UZ(24,"input",9),e.qZA(),e.qZA()),2&t&&e.Q6J("formGroup",s.filterInfoForm)},directives:[I._Y,I.JL,I.sg,I.EJ,I.JJ,I.u,I.YN,I.Kr,I.Fj,I.wV,I.Fd,I.qQ],styles:[""],changeDetection:0}),o})();const ke=["svgElement"];let Ve=(()=>{class o{constructor(){this.selectedSymbol$=new e.vpe(null),this.height=500,this.width=500,this.marginRight=20,this.marginTop=20,this.marginLeft=80,this.marginBottom=80,this.pointSize=2,this.pointColor="rgb(135,206,235)",this.highlightColor="rgb(255, 87, 34)"}ngOnInit(){}ngAfterViewInit(){this.geneCorBetweenDatasetInfo&&(this._removeGraphic(),this._initSettings(),this._initMap())}ngOnChanges(t){t.geneCorBetweenDatasetInfo&&!t.geneCorBetweenDatasetInfo.isFirstChange()&&(this._removeGraphic(),this._initSettings(),this._initMap())}_removeGraphic(){(0,m.Ys)(this.svgElement.nativeElement).selectAll("*").remove()}_initSettings(){const t=this;this.pointsMapHeight=this.height-this.marginTop-this.marginBottom,this.pointsMapWidth=this.width-this.marginLeft-this.marginRight;let s=[],n=[];t.geneCorBetweenDatasetInfo.geneCors.forEach(c=>{s.push(c.corInDataset1),n.push(c.corInDataset2)});const i=(0,m.VV$)(n),r=(0,m.Fp7)(n),p=(r-i)/10;t.yScale=(0,m.BYU)().domain([i-p,r+p]).range([t.pointsMapHeight,0]);const l=(0,m.VV$)(s),f=(0,m.Fp7)(s),d=(f-l)/10;t.xScale=(0,m.BYU)().domain([l-d,f+d]).range([0,t.pointsMapWidth])}_initMap(){const t=this;t.d3Svg=(0,m.Ys)(this.svgElement.nativeElement).attr("height",t.height).attr("width",t.width),t.geneToolTipDiv=(0,m.Ys)("body").append("div").attr("class","d3Tooltip").style("opacity","0"),this._addPoints(),this._addAxises(),this._addZeroLines()}_addAxises(){const t=this,s=t.marginTop+t.pointsMapHeight,n=this.d3Svg.append("g").attr("transform","translate("+t.marginLeft+","+s+")").call((0,m.LLu)(t.xScale).tickFormat(S=>S.toString())),i=t.marginTop+t.pointsMapHeight+n.node().getBBox().height+20,r=t.marginLeft+.5*t.pointsMapWidth,l=(t.d3Svg.append("text").attr("transform","translate("+r+","+i+")").style("text-anchor","middle").style("font-size",20).text("Correlation in "+this.geneCorBetweenDatasetInfo.dataset1ID),t.marginLeft),f=this.d3Svg.append("g").attr("transform","translate("+l+","+t.marginTop+")").call((0,m.y4O)(t.yScale).tickFormat(S=>S.toString())),d=t.marginLeft-f.node().getBBox().width-10,c=t.marginTop+.5*t.pointsMapHeight;t.d3Svg.append("text").attr("transform","translate("+d+","+c+")rotate(-90)").style("text-anchor","middle").style("font-size",20).text("Correlation in "+this.geneCorBetweenDatasetInfo.dataset2ID)}_addZeroLines(){const t=this,s=t.d3Svg.append("g"),n=t.marginLeft+t.xScale(0);s.append("path").attr("d","M"+n+" "+t.marginTop+"V"+(t.marginTop+t.pointsMapHeight)).style("stroke","blue").style("stroke-dasharray","5");const i=t.marginTop+t.yScale(0);s.append("path").attr("d","M"+t.marginLeft+" "+i+"H"+(t.marginLeft+t.pointsMapWidth)).style("stroke","blue").style("stroke-dasharray","5")}_addPoints(){const t=this;this.d3Svg.append("g").attr("transform","translate("+this.marginLeft+","+this.marginTop+")").selectAll("genePoints").data(t.geneCorBetweenDatasetInfo.geneCors).enter().append("circle").attr("cx",function(n){return t.xScale(n.corInDataset1)}).attr("cy",function(n){return t.yScale(n.corInDataset2)}).attr("r",t.pointSize).style("fill",function(n){return t.geneCorBetweenDatasetInfo.highlightGenes.includes(n.geneName)?t.highlightColor:t.pointColor}).attr("stroke",function(n){return t.geneCorBetweenDatasetInfo.highlightGenes.includes(n.geneName)?t.highlightColor:t.pointColor}).attr("cursor","pointer").on("mousemove",function(n,i){t.geneToolTipDiv.transition().duration(200).style("opacity",.9),t.geneToolTipDiv.html("<p>"+i.geneName+"</p><p> Cor in dataset1:"+i.corInDataset1.toFixed(3)+"</p><p> Cor in dataset2:"+i.corInDataset2.toFixed(3)+"</p>").style("left",n.pageX+"px").style("top",n.pageY-28+"px")}).on("mouseout",function(n){t.geneToolTipDiv.transition().duration(500).style("opacity",0)}).on("dblclick",function(n,i){t.selectedSymbol$.next(i.geneName)})}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-d3-one-gene-cor-between-datasets"]],viewQuery:function(t,s){if(1&t&&e.Gf(ke,5),2&t){let n;e.iGM(n=e.CRH())&&(s.svgElement=n.first)}},inputs:{geneCorBetweenDatasetInfo:"geneCorBetweenDatasetInfo"},outputs:{selectedSymbol$:"selectedSymbol$"},features:[e.TTD],decls:2,vars:0,consts:[["svgElement",""]],template:function(t,s){1&t&&(e.O4$(),e._UZ(0,"svg",null,0))},styles:[""],changeDetection:0}),o})(),Ye=(()=>{class o{constructor(t){this.cdr=t}ngOnInit(){}ngAfterViewInit(){this.cdr.detectChanges()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(e.sBO))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-display-two-genes-two-datasets-cors-info"]],inputs:{twoGenesTwoDatasetsCorPointsInfo:"twoGenesTwoDatasetsCorPointsInfo"},decls:11,vars:4,consts:[[1,"row"],[1,"col-12","col-md-6"],[1,"text-center","mt-2"],[1,"d-flex","justify-content-center","border-right"],["appD3ExportMap","",3,"corPointsPlotInfo"],[1,"d-flex","justify-content-center"]],template:function(t,s){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"h5",2),e._uU(3),e.qZA(),e.TgZ(4,"div",3),e._UZ(5,"app-d3-cor-points-plot",4),e.qZA(),e.qZA(),e.TgZ(6,"div",1),e.TgZ(7,"h5",2),e._uU(8),e.qZA(),e.TgZ(9,"div",5),e._UZ(10,"app-d3-cor-points-plot",4),e.qZA(),e.qZA(),e.qZA()),2&t&&(e.xp6(3),e.hij(" In ",null==s.twoGenesTwoDatasetsCorPointsInfo?null:s.twoGenesTwoDatasetsCorPointsInfo.dataset1CorPointsInfo.termName," "),e.xp6(2),e.Q6J("corPointsPlotInfo",null==s.twoGenesTwoDatasetsCorPointsInfo?null:s.twoGenesTwoDatasetsCorPointsInfo.dataset1CorPointsInfo),e.xp6(3),e.hij(" In ",null==s.twoGenesTwoDatasetsCorPointsInfo?null:s.twoGenesTwoDatasetsCorPointsInfo.dataset2CorPointsInfo.termName," "),e.xp6(2),e.Q6J("corPointsPlotInfo",null==s.twoGenesTwoDatasetsCorPointsInfo?null:s.twoGenesTwoDatasetsCorPointsInfo.dataset2CorPointsInfo))},directives:[xt,X.I],styles:[""],changeDetection:0}),o})();const qe=["displayCorContent"];function je(o,g){1&o&&(e.TgZ(0,"div",7),e.TgZ(1,"p",3),e._uU(2," The app is computing correlation coefficients "),e.qZA(),e.qZA())}function We(o,g){if(1&o&&(e.TgZ(0,"div",8),e.TgZ(1,"div",3),e.TgZ(2,"h5"),e._uU(3),e.qZA(),e.qZA(),e.qZA()),2&o){const t=e.oxw();e.xp6(3),e.lnq("The result of ",null==t.oneGeneBetweenDatasetsResultStatus?null:t.oneGeneBetweenDatasetsResultStatus.result.geneName," in ",null==t.oneGeneBetweenDatasetsResultStatus?null:t.oneGeneBetweenDatasetsResultStatus.result.dataset1ID," and ",null==t.oneGeneBetweenDatasetsResultStatus?null:t.oneGeneBetweenDatasetsResultStatus.result.dataset2ID,"")}}function Ue(o,g){1&o&&(e.TgZ(0,"p",16),e._uU(1," Double click the point to display the two genes' correlation result in the two datasets "),e.qZA())}function ze(o,g){if(1&o){const t=e.EpF();e.TgZ(0,"div",9),e.TgZ(1,"div",10),e.TgZ(2,"h5",11),e._uU(3," Points Plot of Correlation "),e.qZA(),e.TgZ(4,"div",12),e.TgZ(5,"app-d3-one-gene-cor-between-datasets",13),e.NdJ("selectedSymbol$",function(n){return e.CHM(t),e.oxw().processSelectedSymbol(n)}),e.qZA(),e.qZA(),e.YNc(6,Ue,2,0,"p",14),e.qZA(),e.TgZ(7,"div",10),e.TgZ(8,"h5",11),e._uU(9," Correlation Info of the selected genes "),e.qZA(),e.TgZ(10,"app-display-terms-info-table-pagination",15),e.NdJ("clickedTermForPlot$",function(n){return e.CHM(t),e.oxw().processSelectedSymbol(n)}),e.qZA(),e.qZA(),e.qZA()}if(2&o){const t=e.oxw();e.xp6(5),e.Q6J("geneCorBetweenDatasetInfo",t.geneCorBetweenDatasetInfo),e.xp6(1),e.Q6J("ngIf",t.geneCorBetweenDatasetInfo),e.xp6(4),e.Q6J("termsInfoForTable",t.geneCorInfoForTable)("ifShowSelectIcon",!1)("ifShowFilterIcon",!1)("uniqueFeature","SYMBOL")}}function Je(o,g){if(1&o){const t=e.EpF();e.TgZ(0,"div",17),e.TgZ(1,"button",18),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return null==n.twoGenesCorModalRef?null:n.twoGenesCorModalRef.hide()}),e.TgZ(2,"span",19),e._uU(3,"\xd7"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(4,"div",20),e._UZ(5,"app-display-two-genes-two-datasets-cors-info",21),e.qZA(),e.TgZ(6,"div",22),e.TgZ(7,"button",23),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return null==n.twoGenesCorModalRef?null:n.twoGenesCorModalRef.hide()}),e._uU(8," close "),e.qZA(),e.qZA()}if(2&o){const t=e.oxw();e.xp6(5),e.Q6J("twoGenesTwoDatasetsCorPointsInfo",t.twoGenesTwoDatasetsCorPointsInfo)}}let Xe=(()=>{class o{constructor(t,s){this.modalService=t,this.cdr=s,this.filteredInfo={dataset1CorFilterType:"greater",dataset1Cor:.5,dataset2CorFilterType:"greater",dataset2Cor:.5}}ngOnInit(){var t;"finished"===(null===(t=this.oneGeneBetweenDatasetsResultStatus)||void 0===t?void 0:t.status)&&this._prepareDataForPlotAndTable(this.oneGeneBetweenDatasetsResultStatus.result,this.filteredInfo)}ngOnChanges(t){var s;t.oneGeneBetweenDatasetsResultStatus&&!t.oneGeneBetweenDatasetsResultStatus.isFirstChange()&&("finished"===(null===(s=this.oneGeneBetweenDatasetsResultStatus)||void 0===s?void 0:s.status)&&this._prepareDataForPlotAndTable(this.oneGeneBetweenDatasetsResultStatus.result,this.filteredInfo),this.cdr.detectChanges())}processSelectedSymbol(t){this.twoGenesCorModalRef=this.modalService.show(this.displayCorContent,Object.assign({},{class:"modal-lg"})),this._prepareTwoGenesTwoDatasetsPlotInfo(this.oneGeneBetweenDatasetsResultStatus.result,t)}filterGenes(t){var s;this.filteredInfo=t,"finished"===(null===(s=this.oneGeneBetweenDatasetsResultStatus)||void 0===s?void 0:s.status)&&this._prepareDataForPlotAndTable(this.oneGeneBetweenDatasetsResultStatus.result,t)}_prepareDataForPlotAndTable(t,s){if(t&&s){const n=O.PK[s.dataset1CorFilterType](t.geneCorsInDataset1.cors,s.dataset1Cor),i=O.PK[s.dataset2CorFilterType](t.geneCorsInDataset2.cors,s.dataset2Cor),r=Le.JN.and(new Set(n),new Set(i)),p=[...r].map(R=>t.otherGenes[R]),l=t.geneCorsInDataset1.cors,f=t.geneCorsInDataset1.pvalues,d=t.geneCorsInDataset2.cors,c=t.geneCorsInDataset2.pvalues,y=t.otherGenes,S=y.map((R,Z)=>({corInDataset1:l[Z],corInDataset2:d[Z],geneName:R}));this.geneCorBetweenDatasetInfo={dataset1ID:t.dataset1ID,dataset2ID:t.dataset2ID,geneCors:S,highlightGenes:p};let B=[];r.forEach(R=>{B.push({SYMBOL:y[R],corInDataset1:l[R],pValueInDataset1:f[R],corInDataset2:d[R],pValueInDataset2:c[R]})}),this.geneCorInfoForTable={features:["SYMBOL","corInDataset1","pValueInDataset1","corInDataset2","pValueInDataset2"],termsInfo:B},this.cdr.detectChanges()}else this.geneCorInfoForTable=null,this.geneCorBetweenDatasetInfo=null}_prepareTwoGenesTwoDatasetsPlotInfo(t,s){const n=t.otherGenes.indexOf(s);this.twoGenesTwoDatasetsCorPointsInfo={dataset1CorPointsInfo:{samples:t.samples,values1:t.valuesInDataset1,values2:t.otherGenesExpressionInDataset1[n],value1Name:t.geneName,value2Name:s,corInfo:{cor:t.geneCorsInDataset1.cors[n],pValue:t.geneCorsInDataset1.pvalues[n]},termName:t.dataset1ID},dataset2CorPointsInfo:{samples:t.samples,values1:t.valuesInDataset2,values2:t.otherGenesExpressionInDataset2[n],value1Name:t.geneName,value2Name:s,corInfo:{cor:t.geneCorsInDataset2.cors[n],pValue:t.geneCorsInDataset2.pvalues[n]},termName:t.dataset2ID}}}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(M.tT),e.Y36(e.sBO))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-display-one-gene-between-datasets-result"]],viewQuery:function(t,s){if(1&t&&e.Gf(qe,5,e.Rgc),2&t){let n;e.iGM(n=e.CRH())&&(s.displayCorContent=n.first)}},inputs:{oneGeneBetweenDatasetsResultStatus:"oneGeneBetweenDatasetsResultStatus"},features:[e.TTD],decls:10,vars:3,consts:[["class","row","data-testid","ongGeneCorLoadingNote",4,"ngIf"],["class","row mt-3 border-bottom",4,"ngIf"],[1,"row","pt-2"],[1,"col-12"],[3,"filterInfo$"],["class","row",4,"ngIf"],["displayCorContent",""],["data-testid","ongGeneCorLoadingNote",1,"row"],[1,"row","mt-3","border-bottom"],[1,"row"],[1,"col-12","col-md-6","border"],[1,"text-center","mt-2"],[1,"d-flex","justify-content-center"],["appD3ExportMap","",3,"geneCorBetweenDatasetInfo","selectedSymbol$"],["class","text-info",4,"ngIf"],[3,"termsInfoForTable","ifShowSelectIcon","ifShowFilterIcon","uniqueFeature","clickedTermForPlot$"],[1,"text-info"],[1,"modal-header"],["type","button","aria-label","Close",1,"btn-close","close","pull-right",3,"click"],["aria-hidden","true",1,"visually-hidden"],[1,"modal-body"],[3,"twoGenesTwoDatasetsCorPointsInfo"],[1,"modal-footer"],["data-testid","closeGeneListInput","type","button",1,"btn","btn-default",3,"click"]],template:function(t,s){1&t&&(e.YNc(0,je,3,0,"div",0),e.YNc(1,We,4,3,"div",1),e.TgZ(2,"div",2),e.TgZ(3,"div",3),e.TgZ(4,"h5"),e._uU(5,"Select Genes:"),e.qZA(),e.TgZ(6,"app-generate-genes-cor-between-datasets-filter-info",4),e.NdJ("filterInfo$",function(i){return s.filterGenes(i)}),e.qZA(),e.qZA(),e.qZA(),e.YNc(7,ze,11,6,"div",5),e.YNc(8,Je,9,1,"ng-template",null,6,e.W1O)),2&t&&(e.Q6J("ngIf","loading"===(null==s.oneGeneBetweenDatasetsResultStatus?null:s.oneGeneBetweenDatasetsResultStatus.status)),e.xp6(1),e.Q6J("ngIf","finished"===(null==s.oneGeneBetweenDatasetsResultStatus?null:s.oneGeneBetweenDatasetsResultStatus.status)),e.xp6(6),e.Q6J("ngIf","finished"===(null==s.oneGeneBetweenDatasetsResultStatus?null:s.oneGeneBetweenDatasetsResultStatus.status)))},directives:[a.O5,$e,Ve,X.I,Tt.v,Ye],styles:[""],changeDetection:0}),o})();function Qe(o,g){if(1&o){const t=e.EpF();e.TgZ(0,"div",10),e.TgZ(1,"div",11),e.TgZ(2,"app-try-sample",12),e.NdJ("sampleForTryName$",function(n){return e.CHM(t),e.oxw().processTrySampleFileName(n)})("sampleForImportName$",function(n){return e.CHM(t),e.oxw().processDownloadSampleData(n)})("closeMe$",function(n){return e.CHM(t),e.oxw().closeTrySampleComponent(n)}),e.ALo(3,"async"),e.ALo(4,"async"),e.qZA(),e.qZA(),e.qZA()}if(2&o){const t=e.oxw();e.xp6(2),e.Q6J("fileInfos",t.trySamplesInfos)("trySamplePercentage",e.lcZ(3,3,t.trySamplePercentage$))("downloadSampleDataPercentage",e.lcZ(4,5,t.downloadSampleDataPercentage$))}}function Ke(o,g){1&o&&(e.TgZ(0,"p"),e._uU(1,"Is computing correlation"),e.qZA())}let ts=(()=>{class o{constructor(t,s){this.facade=t,this.cdr=s,this.ifIsLoading=!1,this.trySamplesInfos=[{fileForImport:"Integration_Demo.zip",fileForTry:"integrationExp.json.gz",description:"Transcriptomic, Proteomics integration analysis"}],this.trySamplePercentage$=this.facade.trySamplePercentage$,this.ifShowTrySampleComponent=!0,this.downloadSampleDataPercentage$=this.facade.downloadSampleDataPercentage$}ngOnInit(){this.allDatasetInfoForDisplay$=this.facade.allDatasetInfoForDisplay$,this.commonSymbols$=this.facade.commonGenes$,this.oneGeneBetweenDatasetsResultStatus$=this.facade.oneGeneBetweenDatasetsResultStatus$}processTrySampleFileName(t){this.facade.prepareTrySampleData(t)}processDownloadSampleData(t){this.facade.downloadSampleData(t)}closeTrySampleComponent(t){this.ifShowTrySampleComponent=!1}processCommonGenesRequest(t){this.facade.requestCommonGenesInTwoDatasets(t)}processOneGeneBetweenDatasetsRequest(t){this.facade.processOneGeneBetweenDatasetsCorRequest(t)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(ot),e.Y36(e.sBO))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-one-gene-cor-between-datasets"]],decls:14,vars:11,consts:[[1,"row","flex-xl-nowrap"],[1,"col-12","col-md-3","col-xl-2","border-right"],[1,"mb-3","mt-5"],[3,"datasetInfos","commonSymbols","commonGenesRequest$","oneGeneBetweenDatasetsRequest$"],[1,"mb-4"],[1,"col-12","col-md-9","col-xl-10","mt-2"],["class","row border",4,"ngIf"],[4,"ngIf"],[1,"row"],[1,"col-12",3,"oneGeneBetweenDatasetsResultStatus"],[1,"row","border"],[1,"col-12","p-1"],[3,"fileInfos","trySamplePercentage","downloadSampleDataPercentage","sampleForTryName$","sampleForImportName$","closeMe$"]],template:function(t,s){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"h5",2),e._uU(3,"Start a New Integration Analysis"),e.qZA(),e.TgZ(4,"app-generate-one-gene-between-datasets-request",3),e.NdJ("commonGenesRequest$",function(i){return s.processCommonGenesRequest(i)})("oneGeneBetweenDatasetsRequest$",function(i){return s.processOneGeneBetweenDatasetsRequest(i)}),e.ALo(5,"async"),e.ALo(6,"async"),e.qZA(),e._UZ(7,"div",4),e.qZA(),e.TgZ(8,"div",5),e.YNc(9,Qe,5,7,"div",6),e.YNc(10,Ke,2,0,"p",7),e.TgZ(11,"div",8),e._UZ(12,"app-display-one-gene-between-datasets-result",9),e.ALo(13,"async"),e.qZA(),e.qZA(),e.qZA()),2&t&&(e.xp6(4),e.Q6J("datasetInfos",e.lcZ(5,5,s.allDatasetInfoForDisplay$))("commonSymbols",e.lcZ(6,7,s.commonSymbols$)),e.xp6(5),e.Q6J("ngIf",s.ifShowTrySampleComponent),e.xp6(1),e.Q6J("ngIf",s.ifIsLoading),e.xp6(2),e.Q6J("oneGeneBetweenDatasetsResultStatus",e.lcZ(13,9,s.oneGeneBetweenDatasetsResultStatus$)))},directives:[Re,a.O5,Xe,wt.P],pipes:[a.Ov],styles:[""]}),o})();function es(o,g){1&o&&e._UZ(0,"app-overview-cor-between-datasets",1)}function ss(o,g){1&o&&e._UZ(0,"app-one-gene-cor-between-datasets",1)}const At=function(o){return{active:o}},ns=[{path:"",component:(()=>{class o{constructor(){this.integrationType="focusedOnOneGene"}ngOnInit(){}setActiveIntegrationType(t){this.integrationType=t}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-integration-exp"]],decls:14,vars:9,consts:[[1,"row","flex-xl-nowrap"],[1,"col-12"],["data-testid","differentIntegrationType",1,"nav","nav-tabs"],[1,"nav-item"],["href","javascript:void(0)",1,"nav-link",3,"ngClass","click"],[1,"row",3,"ngSwitch"],["class","col-12",4,"ngSwitchCase"]],template:function(t,s){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"nav",2),e.TgZ(3,"li",3),e.TgZ(4,"a",4),e.NdJ("click",function(){return s.setActiveIntegrationType("overView")}),e.TgZ(5,"h4"),e._uU(6,"Gene-wise Correlation Analysis"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(7,"li",3),e.TgZ(8,"a",4),e.NdJ("click",function(){return s.setActiveIntegrationType("focusedOnOneGene")}),e.TgZ(9,"h4"),e._uU(10,"Correlation Analysis for the Gene of Interest"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(11,"div",5),e.YNc(12,es,1,0,"app-overview-cor-between-datasets",6),e.YNc(13,ss,1,0,"app-one-gene-cor-between-datasets",6),e.qZA()),2&t&&(e.xp6(4),e.Q6J("ngClass",e.VKq(5,At,"overView"===s.integrationType)),e.xp6(4),e.Q6J("ngClass",e.VKq(7,At,"focusedOnOneGene"===s.integrationType)),e.xp6(3),e.Q6J("ngSwitch",s.integrationType),e.xp6(1),e.Q6J("ngSwitchCase","overView"),e.xp6(1),e.Q6J("ngSwitchCase","focusedOnOneGene"))},directives:[a.mk,a.RF,a.n9,be,ts],styles:[""]}),o})(),data:{key:"IntegrationExp"}}];let is=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[_.Bz.forChild(ns)],_.Bz]}),o})(),os=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({providers:[ot],imports:[[a.ez,_.Bz,I.u5,I.UX,H.uH,P._t,C.HK,M.zk.forRoot(),F.H3.forRoot(),x.f,b.m,Y.D,is]]}),o})()},4813:(J,L,h)=>{h.d(L,{w:()=>F});var a=h(3668),_=h(6019);function I(C,H){if(1&C&&(a.TgZ(0,"p",3),a._uU(1),a.qZA()),2&C){const x=H.$implicit;a.xp6(1),a.Oqu(x)}}function P(C,H){if(1&C){const x=a.EpF();a.TgZ(0,"p",4),a.NdJ("click",function(Y){return a.CHM(x),a.oxw().displayAllItems(Y)}),a.TgZ(1,"a",5),a._uU(2,"more"),a.qZA(),a.qZA()}}function M(C,H){if(1&C){const x=a.EpF();a.TgZ(0,"p",4),a.NdJ("click",function(Y){return a.CHM(x),a.oxw().displayLimitedItems(Y)}),a.TgZ(1,"a",6),a._uU(2,"less"),a.qZA(),a.qZA()}}let F=(()=>{class C{constructor(){this.ifDisplayAll=!1}ngOnInit(){this.items&&this._preprocessItems()}ngOnChanges(x){x.items&&!x.items.isFirstChange()&&this._preprocessItems()}_preprocessItems(){this.ifDisplayAll=!1,this.displayedItems=this.items.slice(0,this.displayNum).map(x=>x),this.items.length<=this.displayNum&&(this.ifDisplayAll=!0)}displayAllItems(x){this.displayedItems=this.items,this.ifDisplayAll=!0}displayLimitedItems(x){this._preprocessItems()}}return C.\u0275fac=function(x){return new(x||C)},C.\u0275cmp=a.Xpm({type:C,selectors:[["app-display-limited-items"]],inputs:{items:"items",displayNum:"displayNum"},features:[a.TTD],decls:4,vars:3,consts:[[1,"d-flex","justify-content-start","flex-wrap"],["class","ml-2",4,"ngFor","ngForOf"],["class","ml-2",3,"click",4,"ngIf"],[1,"ml-2"],[1,"ml-2",3,"click"],["href","javascript:void(0)"],["href","javascript:void(0);"]],template:function(x,b){1&x&&(a.TgZ(0,"div",0),a.YNc(1,I,2,1,"p",1),a.YNc(2,P,3,0,"p",2),a.YNc(3,M,3,0,"p",2),a.qZA()),2&x&&(a.xp6(1),a.Q6J("ngForOf",b.displayedItems),a.xp6(1),a.Q6J("ngIf",!b.ifDisplayAll&&(null==b.displayedItems?null:b.displayedItems.length)>0),a.xp6(1),a.Q6J("ngIf",b.ifDisplayAll&&(null==b.displayedItems?null:b.displayedItems.length)>b.displayNum))},directives:[_.sg,_.O5],styles:[""],changeDetection:0}),C})()},94:(J,L,h)=>{h.d(L,{e:()=>I});var a=h(3405),_=h(3668);let I=(()=>{class P{constructor(){this.destroyNotifier$=new a.xQ}ngOnInit(){}ngOnDestroy(){this.destroyNotifier$.next(),this.destroyNotifier$.complete()}}return P.\u0275fac=function(F){return new(F||P)},P.\u0275cmp=_.Xpm({type:P,selectors:[["app-base-with-destroynotifier"]],decls:2,vars:0,template:function(F,C){1&F&&(_.TgZ(0,"p"),_._uU(1,"base-with-destroynotifier works!"),_.qZA())},styles:[""],changeDetection:0}),P})()},4816:(J,L,h)=>{h.d(L,{C:()=>F});var a=h(3668),_=h(9133),I=h(3405),P=h(6019);const M=function(C){return{"form-inline":C}};let F=(()=>{class C{constructor(x){this.cdr=x,this.formInlineOrNot=!1,this.outputNumber$=new a.vpe,this.destroyNotifier$=new I.xQ,this.numberForm=new _.cw({value:new _.NI("",_.kI.required)})}ngOnInit(){this.numberForm.valueChanges.subscribe(x=>{this.inputValue=parseFloat(x.value),this.outputNumber$.next(this.inputValue),this.cdr.detectChanges()}),this.inputValue=this.defaultValue,this.numberForm.patchValue({value:this.defaultValue})}ngOnDestroy(){this.destroyNotifier$.next(),this.destroyNotifier$.complete()}}return C.\u0275fac=function(x){return new(x||C)(a.Y36(a.sBO))},C.\u0275cmp=a.Xpm({type:C,selectors:[["app-input-number-with-range"]],inputs:{minValue:"minValue",maxValue:"maxValue",defaultValue:"defaultValue",formInlineOrNot:"formInlineOrNot",step:"step",numberFormat:"numberFormat",itemLabel:"itemLabel"},outputs:{outputNumber$:"outputNumber$"},decls:5,vars:8,consts:[[1,"mr-3","align-self-start",3,"ngClass","formGroup"],["formControlName","value","type","range","step","0.01",1,"form-control","form-control-sm",2,"width","10em",3,"min","max"]],template:function(x,b){1&x&&(a.TgZ(0,"form",0),a.TgZ(1,"h5"),a._uU(2),a.qZA(),a._UZ(3,"input",1),a._uU(4),a.qZA()),2&x&&(a.Q6J("ngClass",a.VKq(6,M,b.formInlineOrNot))("formGroup",b.numberForm),a.xp6(2),a.hij("",b.itemLabel,":"),a.xp6(1),a.Q6J("min",b.minValue)("max",b.maxValue),a.xp6(1),a.hij(" ",100*b.inputValue,"%\n"))},directives:[_._Y,_.JL,P.mk,_.sg,_.Fj,_.eT,_.JJ,_.u],styles:[""],changeDetection:0}),C})()},438:(J,L,h)=>{h.d(L,{w:()=>v});var a=h(3668),_=h(9133),I=h(3405),P=h(8735),M=h(8805),F=h(5389),C=h(6019);function H(D,T){1&D&&(a.TgZ(0,"option",6),a._uU(1," --- "),a.qZA())}function x(D,T){if(1&D&&(a.TgZ(0,"option",7),a._uU(1),a.qZA()),2&D){const w=T.$implicit,u=a.oxw();a.Q6J("value",w[u.idAttribute]),a.xp6(1),a.hij(" ",w[u.displayAttribute]," ")}}function b(D,T){if(1&D&&(a.TgZ(0,"label",8),a._uU(1),a.qZA()),2&D){const w=a.oxw();a.xp6(1),a.hij(" ",w.emptyNote," ")}}const Y=function(D){return{"form-inline":D}},e=function(D){return{"max-width":D}};let v=(()=>{class D{constructor(w){this.cdr=w,this.formInlineOrNot=!1,this.ifOutputFirstValue=!1,this.emptyNote="",this.ifWidthAuto=!1,this.formWidth="15rem",this.selectedItemObject$=new a.vpe,this.destroyNotifier$=new I.xQ,this.itemForm=new _.cw({itemValue:new _.NI("",_.kI.required)})}ngOnInit(){}ngAfterViewInit(){this.itemForm.get("itemValue").valueChanges.pipe((0,P.h)(w=>w),(0,M.R)(this.destroyNotifier$),(0,F.x)()).subscribe(w=>{if("VALID"===this.itemForm.get("itemValue").status){let u;for(let G of this.inputObjects)G[this.idAttribute]===w&&(u=G);this.selectedItemObject$.next(u||null)}else this.selectedItemObject$.next(null);this.cdr.detectChanges()}),this.ifOutputFirstValue&&this._outputSetFirstItemAsSelctedItem()}ngOnChanges(w){w.inputObjects&&!w.inputObjects.isFirstChange()&&(this.ifOutputFirstValue?this._outputSetFirstItemAsSelctedItem():this.itemForm.patchValue({itemValue:""}))}ngOnDestroy(){this.destroyNotifier$.next(),this.destroyNotifier$.complete()}_outputSetFirstItemAsSelctedItem(){this.inputObjects&&this.inputObjects.length>=1&&this.itemForm.patchValue({itemValue:this.inputObjects[0][this.idAttribute]})}}return D.\u0275fac=function(w){return new(w||D)(a.Y36(a.sBO))},D.\u0275cmp=a.Xpm({type:D,selectors:[["app-select-item-object"]],inputs:{inputObjects:"inputObjects",idAttribute:"idAttribute",displayAttribute:"displayAttribute",itemLabel:"itemLabel",formInlineOrNot:"formInlineOrNot",ifOutputFirstValue:"ifOutputFirstValue",emptyNote:"emptyNote",ifWidthAuto:"ifWidthAuto",formWidth:"formWidth"},outputs:{selectedItemObject$:"selectedItemObject$"},features:[a.TTD],decls:8,vars:11,consts:[[3,"ngClass","formGroup"],[1,"align-self-start"],["formControlName","itemValue","data-testid","selectItem",1,"form-control","form-control-sm",3,"ngStyle"],["value","",4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],["class","text-danger font-weight-light",4,"ngIf"],["value",""],[3,"value"],[1,"text-danger","font-weight-light"]],template:function(w,u){1&w&&(a.TgZ(0,"form",0),a.TgZ(1,"div",1),a.TgZ(2,"h5"),a._uU(3),a.qZA(),a.TgZ(4,"select",2),a.YNc(5,H,2,0,"option",3),a.YNc(6,x,2,2,"option",4),a.qZA(),a.YNc(7,b,2,1,"label",5),a.qZA(),a.qZA()),2&w&&(a.Q6J("ngClass",a.VKq(7,Y,u.formInlineOrNot))("formGroup",u.itemForm),a.xp6(3),a.hij("",u.itemLabel,":"),a.xp6(1),a.Q6J("ngStyle",a.VKq(9,e,u.ifWidthAuto?"none":u.formWidth)),a.xp6(1),a.Q6J("ngIf",!u.ifOutputFirstValue),a.xp6(1),a.Q6J("ngForOf",u.inputObjects),a.xp6(1),a.Q6J("ngIf",!((null==u.inputObjects?null:u.inputObjects.length)>=1)))},directives:[_._Y,_.JL,C.mk,_.sg,_.EJ,_.JJ,_.u,C.PC,C.O5,C.sg,_.YN,_.Kr],styles:[""],changeDetection:0}),D})()},3013:(J,L,h)=>{h.d(L,{y:()=>D});var a=h(3668),_=h(9133),I=h(3405),P=h(8735),M=h(8805),F=h(6019),C=h(5863);function H(T,w){if(1&T&&a._UZ(0,"app-display-notes-with-question-mark",8),2&T){const u=a.oxw();a.Q6J("note",u.questionNote)}}function x(T,w){if(1&T&&(a.TgZ(0,"option",9),a._uU(1),a.qZA()),2&T){const u=w.$implicit;a.Q6J("value",u),a.xp6(1),a.hij(" ",u," ")}}function b(T,w){if(1&T&&(a.TgZ(0,"label",10),a._uU(1),a.qZA()),2&T){const u=a.oxw();a.xp6(1),a.hij(" ",u.emptyNote," ")}}const Y=function(T){return{"form-inline":T}},e=function(T){return{"min-width":T}},v=function(T){return{"max-width":T}};let D=(()=>{class T{constructor(u){this.cdr=u,this.formInlineOrNot=!1,this.ifOutputFirstValue=!1,this.resetSelection=!1,this.ifWidthAuto=!1,this.ifShowQuestionNote=!1,this.questionNote="",this.formWidth="15rem",this.selectedItem$=new a.vpe,this.destroyNotifier$=new I.xQ,this.itemForm=new _.cw({itemValue:new _.NI("",_.kI.required)})}ngOnInit(){this.itemForm.get("itemValue").valueChanges.pipe((0,P.h)(u=>u),(0,M.R)(this.destroyNotifier$)).subscribe(u=>{"VALID"===this.itemForm.get("itemValue").status&&this.selectedItem$.next(u.toString()),this.cdr.detectChanges()}),this.ifOutputFirstValue&&this._outputSetFirstItemAsSelctedItem(),this.defaultItem&&this._outputDefaultItem()}ngOnChanges(u){u.inputItems&&!u.inputItems.isFirstChange()&&this.ifOutputFirstValue&&this._outputSetFirstItemAsSelctedItem(),u.resetSelection&&!u.resetSelection.isFirstChange()&&this.resetSelection&&(this.ifOutputFirstValue?this._outputSetFirstItemAsSelctedItem():this._resetAndoutputEmptyItem())}ngOnDestroy(){this.destroyNotifier$.next(),this.destroyNotifier$.complete()}_outputSetFirstItemAsSelctedItem(){this.itemForm.patchValue(this.inputItems&&this.inputItems.length>=1?{itemValue:this.inputItems[0]}:{itemValue:""})}_outputDefaultItem(){this.itemForm.patchValue(this.inputItems&&this.inputItems.length>=1?{itemValue:this.defaultItem}:{itemValue:""})}_resetAndoutputEmptyItem(){this.itemForm.patchValue({itemValue:""}),this.selectedItem$.next("")}}return T.\u0275fac=function(u){return new(u||T)(a.Y36(a.sBO))},T.\u0275cmp=a.Xpm({type:T,selectors:[["app-select-item"]],inputs:{inputItems:"inputItems",itemLabel:"itemLabel",emptyNote:"emptyNote",formInlineOrNot:"formInlineOrNot",ifOutputFirstValue:"ifOutputFirstValue",resetSelection:"resetSelection",ifWidthAuto:"ifWidthAuto",ifShowQuestionNote:"ifShowQuestionNote",questionNote:"questionNote",formWidth:"formWidth",defaultItem:"defaultItem"},outputs:{selectedItem$:"selectedItem$"},features:[a.TTD],decls:9,vars:14,consts:[[3,"formGroup"],[1,"align-self-start",3,"ngClass"],[1,"d-flex"],[3,"ngStyle"],["class","align-self-center ml-3 questionMark",3,"note",4,"ngIf"],["formControlName","itemValue","data-testid","selectItem",1,"form-control","form-control-sm",3,"ngStyle"],[3,"value",4,"ngFor","ngForOf"],["class","text-danger font-weight-light",4,"ngIf"],[1,"align-self-center","ml-3","questionMark",3,"note"],[3,"value"],[1,"text-danger","font-weight-light"]],template:function(u,G){1&u&&(a.TgZ(0,"form",0),a.TgZ(1,"div",1),a.TgZ(2,"div",2),a.TgZ(3,"h5",3),a._uU(4),a.qZA(),a.YNc(5,H,1,1,"app-display-notes-with-question-mark",4),a.qZA(),a.TgZ(6,"select",5),a.YNc(7,x,2,2,"option",6),a.qZA(),a.YNc(8,b,2,1,"label",7),a.qZA(),a.qZA()),2&u&&(a.Q6J("formGroup",G.itemForm),a.xp6(1),a.Q6J("ngClass",a.VKq(8,Y,G.formInlineOrNot)),a.xp6(2),a.Q6J("ngStyle",a.VKq(10,e,G.ifWidthAuto?"none":G.formWidth)),a.xp6(1),a.hij("",G.itemLabel,":"),a.xp6(1),a.Q6J("ngIf",G.ifShowQuestionNote),a.xp6(1),a.Q6J("ngStyle",a.VKq(12,v,G.ifWidthAuto?"none":G.formWidth)),a.xp6(1),a.Q6J("ngForOf",G.inputItems),a.xp6(1),a.Q6J("ngIf",G.emptyNote&&!((null==G.inputItems?null:G.inputItems.length)>=1)))},directives:[_._Y,_.JL,_.sg,F.mk,F.PC,F.O5,_.EJ,_.JJ,_.u,F.sg,C.m,_.YN,_.Kr],styles:[""],changeDetection:0}),T})()}}]);