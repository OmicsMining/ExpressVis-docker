"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[497],{7582:(W,N,r)=>{r.d(N,{q:()=>d});const d=(c,Z)=>c<Z?-1:c>Z?1:0},5497:(W,N,r)=>{r.r(N),r.d(N,{SurvivalExpModule:()=>Ye});var d=r(6019),c=r(9133),Z=r(7695),A=r(9256),E=r(3667),I=r(8702),F=r(3928),R=r(1144),t=r(3668),v=r(4099),G=r(2668),bt=r(4102),g=r(8735),_=r(8053),O=r(1125),w=r(5571),tt=r(9220),et=r(6813),f=r(8472),b=r(9204),x=r(6636),xt=r(7194),q=r(7473),yt=r(9744),it=r(8425),It=r(661),st=r(1118),L=r(7548),nt=r(1890),Tt=r(8970),at=r(1672);const k=s=>s.survivalExpState.datasetGeneListSurvivalResultState,Dt=(0,f.P1)(k,(s,l)=>s.entities[l.ID].survivalAnno),lt=(0,f.P1)(k,(s,l)=>s.ids),ot=(0,f.P1)(lt,(s,l)=>s.indexOf(l.ID)>=0),At=(0,f.P1)(k,(s,l)=>{const e=s.entities[l.ID].survivalSplit;return{endpointTime:e.endpointTime,endpointStatus:e.endpointStatus,highOrLows:e[l.geneID]}});var P=r(9232);const rt=function(s){let l;if("maxstatSplit"===s.highLowSplitSetting.method){const i=s.highLowSplitSetting;l=["split",i.method,i.settings.minProb,i.settings.maxProb].join("-")}else if("percentageSplit"===s.highLowSplitSetting.method){const i=s.highLowSplitSetting;l=["split",i.method,i.settings.percentageThreshold].join("-")}const e=["end",s.endpointSettings.timesAttribute,s.endpointSettings.statusAttribute].join("-");return[s.datasetID,s.groupName,s.geneListID,l,e].join("/")};var Ct=r(254),Y=r(4522),pt=r(8260),H=r(172),ct=r(2047);let $t=(()=>{class s{constructor(e){this.http=e,this.survivalRequestUrl=pt.N.serverUrl+"restful/clinical/localDataSurvivalAndForest/",this.KMrequestUrl=pt.N.serverUrl+"restful/clinical/localDataKMinfoForPlot/"}handleResponse(e){return e.type===Y.dt.Response?e.body:H.E}requestLocaldDataSurvival(e){const i=new Y.aW("POST",this.survivalRequestUrl,e,{reportProgress:!1,responseType:"json"});return this.http.request(i).pipe((0,_.U)(n=>this.handleResponse(n)),(0,ct.K)(n=>H.E),(0,g.h)(n=>n!==H.E))}requestKMdataInfoForPlot(e){const i=new Y.aW("POST",this.KMrequestUrl,e,{reportProgress:!1,responseType:"json"});return this.http.request(i).pipe((0,_.U)(n=>this.handleResponse(n)),(0,ct.K)(n=>H.E),(0,g.h)(n=>n!==H.E))}}return s.\u0275fac=function(e){return new(e||s)(t.LFG(Y.eN))},s.\u0275prov=t.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})();var Zt=r(9990),Ft=r(4205),Lt=r(5535),Nt=r(4473);let ut=(()=>{class s extends xt.g{constructor(e,i,n,a,p,u){super(e,a,p,u),this.store=e,this.survivalRequestService=i,this.trySamppleService=n,this.selectedDatasetSubject=new v.X(null),this.speciesIDsubject=new v.X(null),this.geneIDtypeSubject=new v.X(null),this.selectedStatusAttributeSubject=new v.X(null),this.datasetGeneListSurvivalRequest$=new v.X(null),this.survivalResultIDforRequest$=new v.X(null),this.oneGeneForKMinfoRequesSubject=new v.X(null),this.allDatasetInfoForDisplay$=this.store.pipe((0,f.Ys)(q.yz)).pipe((0,_.U)(o=>[...o].reverse())),this.availableGeneListNames$=this.store.pipe((0,f.Ys)(it.Dm),(0,_.U)(o=>(0,P.NT)(o))),this.allSurvivalResultIDs$=this.store.pipe((0,f.Ys)(lt),(0,_.U)(o=>(0,P.NT)(o))),this.ifSelectedDatasetHasClinical$=this.selectedDatasetSubject.pipe((0,g.h)(o=>null!=o),(0,b.w)(o=>this.store.pipe((0,f.Ys)(L.Z7,{datasetID:o})))),this.latestDatasetIDhasClinical$=this.store.pipe((0,f.Ys)(L.Xl)),this.datasetGroupNames$=this.selectedDatasetSubject.pipe((0,g.h)(o=>null!=o),(0,b.w)(o=>this.store.pipe((0,f.Ys)(q.XF,{datasetID:o})))),this.clinicalAttributes$=this.selectedDatasetSubject.pipe((0,g.h)(o=>null!=o),(0,b.w)(o=>this.store.pipe((0,f.Ys)(L.Z7,{datasetID:o}),(0,g.h)(h=>h),(0,_.U)(h=>o))),(0,b.w)(o=>this.store.pipe((0,f.Ys)(L.yH,{datasetID:o}),(0,x.q)(1)))),this.availableStatusValues$=this.selectedStatusAttributeSubject.pipe((0,g.h)(o=>null!=o),(0,w.M)(this.selectedDatasetSubject),(0,b.w)(([o,h])=>this.store.pipe((0,f.Ys)(L.Wx,{datasetID:h,statusAttribute:o}),(0,x.q)(1)))),this.datasetGeneListSurvivalRequest$.pipe((0,g.h)(o=>null!=o),(0,b.w)(o=>{const h=rt(o);return this.store.pipe((0,f.Ys)(ot,{ID:h}),(0,x.q)(1),(0,g.h)(S=>!S),(0,_.U)(S=>o))}),(0,b.w)(o=>{const h=o.datasetID,S=o.endpointSettings,j=rt(o),Q=this.store.pipe((0,f.Ys)(q.iR,{datasetID:h}),(0,x.q)(1)),z=this.store.pipe((0,f.Ys)(it.Vq,{ID:o.geneListID}),(0,x.q)(1)),B=this.store.pipe((0,f.Ys)(q.df,{datasetID:o.datasetID,groupName:o.groupName}),(0,x.q)(1));return(0,et.D)([Q,z,B]).pipe((0,b.w)(([y,C,D])=>C.IDtype===y.IDtype?this.store.pipe((0,f.Ys)(L.YK,{datasetID:o.datasetID,geneIDs:C.genes,samples:D,endpointStatusAttribute:S.statusAttribute,endpointTimesAttribute:S.timesAttribute}),(0,x.q)(1)):this.store.pipe((0,f.Ys)(nt.by,{ID:`${C.speciesID}-${y.IDtype}`,symbols:C.genes}),(0,x.q)(1),(0,b.w)(K=>this.store.pipe((0,f.Ys)(L.YK,{datasetID:o.datasetID,geneIDs:K,samples:D,endpointStatusAttribute:S.statusAttribute,endpointTimesAttribute:S.timesAttribute}),(0,x.q)(1))))),(0,_.U)(y=>Object.assign(Object.assign({},y),{highLowSplitSetting:o.highLowSplitSetting})),(0,b.w)(y=>this.survivalRequestService.requestLocaldDataSurvival(y)),(0,_.U)(y=>Object.assign(Object.assign({},y),{ID:j})))})).subscribe(o=>{this.store.dispatch(at.X({survivalResult:o}))}),this.datasetGeneListSurvivalAnno$=this.survivalResultIDforRequest$.pipe((0,g.h)(o=>null!=o),(0,b.w)(o=>this.store.pipe((0,f.Ys)(ot,{ID:o}),(0,x.q)(1),(0,g.h)(h=>h),(0,_.U)(h=>o))),(0,b.w)(o=>this.store.pipe((0,f.Ys)(Dt,{ID:o}),(0,x.q)(1)))),this.survivalResultIDforRequest$.pipe((0,g.h)(o=>null!=o),(0,_.U)(o=>function(s){return s.split("/")[0]}(o)),(0,b.w)(o=>this.store.pipe((0,f.Ys)(q.iR,{datasetID:o}),(0,x.q)(1)))).subscribe(o=>{this.selectedDatasetSubject.next(null==o?void 0:o.datasetID),this.speciesIDsubject.next(null==o?void 0:o.speciesID),this.geneIDtypeSubject.next(null==o?void 0:o.IDtype)}),this.KMlineDataInfoForPlot$=this.oneGeneForKMinfoRequesSubject.pipe((0,g.h)(o=>null!=o),(0,w.M)(this.survivalResultIDforRequest$,this.speciesIDsubject,this.geneIDtypeSubject),(0,b.w)(([o,h,S,j])=>{const Q=(0,Ct.sj)(S,j),z=this.store.pipe((0,f.Ys)(nt.ek,{IDtype:Q,geneID:o}),(0,x.q)(1)),B=this.store.pipe((0,f.Ys)(At,{ID:h,geneID:o}),(0,x.q)(1)).pipe((0,b.w)(y=>this.survivalRequestService.requestKMdataInfoForPlot({eventTimes:y.endpointTime,eventStatus:y.endpointStatus,highOrLows:y.highOrLows}).pipe((0,_.U)(D=>{let V=[];const K=Array.from(new Set(D.Label));for(const vt of K){let St={label:vt,data:[]};for(let $=0;$<D.Label.length;$++)D.Label[$]===vt&&St.data.push({timeLine:D.TimeLine[$],probability:D.Probability[$],obversed:D.Obversed[$],censored:D.Censored[$],riskNumber:D["Number at Risk"][$]});V.push(St)}return V}))));return(0,et.D)([z,B]).pipe((0,_.U)(([y,C])=>({geneInfo:y,KMlineDataInfos:C})))})),this.trySamppleService.trySampleData$.pipe((0,g.h)(Boolean)).subscribe(o=>{this.store.dispatch(yt.CF({newState:o.datasetListState})),this.store.dispatch(st.gw({newState:o.localExpressDataState})),this.store.dispatch(Tt.A({newState:o.geneAnnotationsState})),this.store.dispatch(It.c({newState:o.geneListState})),this.store.dispatch(at.R({newState:o.survivalExpState}))}),this.trySamplePercentage$=this.trySamppleService.trySamplePercentage$}updateDatasetClinicalInfo(e){this.store.dispatch(st.Uj({datasetClinicalInfo:e}))}processSelectedDatasetID(e){this.selectedDatasetSubject.next(e)}retrieveStatusValuesFromStore(e){this.selectedStatusAttributeSubject.next(e)}requestDatasetGeneListSurvivalInfo(e){this.datasetGeneListSurvivalRequest$.next(e)}requestSurvivalInfoFromStore(e){this.survivalResultIDforRequest$.next(e)}requestKMinfoForPlotOfOneGene(e){this.oneGeneForKMinfoRequesSubject.next(e)}downloadProjectSignal(){this.downloadService.downloadProject()}prepareTrySampleData(e){this.trySamppleService.requestTrySampleData(e)}downloadSampleData(e){this.downloadSampleService.downloadSampleData(e)}}return s.\u0275fac=function(e){return new(e||s)(t.LFG(f.yh),t.LFG($t),t.LFG(Zt.v),t.LFG(Ft.b),t.LFG(Lt.f),t.LFG(Nt.h))},s.\u0275prov=t.Yz7({token:s,factory:s.\u0275fac}),s})();var M=r(3405),Mt=r(6087),T=r(8805);function Gt(s,l){if(1&s&&(t.TgZ(0,"option"),t._uU(1),t.qZA()),2&s){const e=l.$implicit;t.xp6(1),t.hij(" ",e," ")}}function Ot(s,l){if(1&s&&(t.TgZ(0,"option"),t._uU(1),t.qZA()),2&s){const e=l.$implicit;t.xp6(1),t.hij(" ",e," ")}}function qt(s,l){if(1&s&&(t.TgZ(0,"option"),t._uU(1),t.qZA()),2&s){const e=l.$implicit;t.xp6(1),t.hij(" ",e," ")}}function Ht(s,l){1&s&&(t.TgZ(0,"p",6),t._uU(1," Times Attribute should not equal Status Attribute "),t.qZA())}const jt=s=>s.get("timesAttribute").value===s.get("statusAttribute").value?{timesEqualStatus:!0}:null;let Et=(()=>{class s{constructor(e){this.cdr=e,this.availableStatusValues=["1","0"],this.selectedStatusAttribute$=new t.vpe,this.endpointSettings$=new t.vpe,this.destroyNotifier$=new M.xQ}ngOnInit(){this.endAttrForm=new c.cw({timesAttribute:new c.NI("",[c.kI.required]),statusAttribute:new c.NI("",[c.kI.required]),statusValueToOne:new c.NI("",[c.kI.required])},[jt]),this.endAttrForm.get("statusAttribute").valueChanges.pipe((0,T.R)(this.destroyNotifier$)).subscribe(e=>{"VALID"===this.endAttrForm.get("statusAttribute").status&&this.selectedStatusAttribute$.next(e)}),this.endAttrForm.valueChanges.pipe((0,T.R)(this.destroyNotifier$)).subscribe(e=>{"VALID"===this.endAttrForm.status&&(this.endpointSettings$.next(e),this.cdr.detectChanges())})}ngOnDestroy(){this.destroyNotifier$.next(),this.destroyNotifier$.complete()}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(t.sBO))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-generate-endpoint-settings"]],inputs:{clinicalAttributes:"clinicalAttributes",availableStatusValues:"availableStatusValues"},outputs:{selectedStatusAttribute$:"selectedStatusAttribute$",endpointSettings$:"endpointSettings$"},decls:20,vars:5,consts:[[3,"formGroup"],["formControlName","timesAttribute",1,"form-control","form-control-sm"],[4,"ngFor","ngForOf"],["formControlName","statusAttribute",1,"form-control","form-control-sm"],["formControlName","statusValueToOne",1,"form-control","form-control-sm"],["style","color: red",4,"ngIf"],[2,"color","red"]],template:function(e,i){1&e&&(t.TgZ(0,"form",0),t.TgZ(1,"h5"),t._uU(2,"Select Survival Time:"),t.qZA(),t.TgZ(3,"select",1),t.TgZ(4,"option"),t._uU(5,"---"),t.qZA(),t.YNc(6,Gt,2,1,"option",2),t.qZA(),t.TgZ(7,"h5"),t._uU(8,"Select Status of End of Study:"),t.qZA(),t.TgZ(9,"select",3),t.TgZ(10,"option"),t._uU(11,"---"),t.qZA(),t.YNc(12,Ot,2,1,"option",2),t.qZA(),t.TgZ(13,"h5"),t._uU(14,"Endpoint of Interest in Status:"),t.qZA(),t.TgZ(15,"select",4),t.TgZ(16,"option"),t._uU(17,"---"),t.qZA(),t.YNc(18,qt,2,1,"option",2),t.qZA(),t.YNc(19,Ht,2,0,"p",5),t.qZA()),2&e&&(t.Q6J("formGroup",i.endAttrForm),t.xp6(6),t.Q6J("ngForOf",i.clinicalAttributes),t.xp6(6),t.Q6J("ngForOf",i.clinicalAttributes),t.xp6(6),t.Q6J("ngForOf",i.availableStatusValues),t.xp6(1),t.Q6J("ngIf",null==i.endAttrForm.errors?null:i.endAttrForm.errors.timesEqualStatus))},directives:[c._Y,c.JL,c.sg,c.EJ,c.JJ,c.u,c.YN,c.Kr,d.sg,d.O5],styles:[""],changeDetection:0}),s})();var J=r(3013),Rt=r(438),Pt=r(4816);function Yt(s,l){1&s&&(t.TgZ(0,"p",4),t._uU(1," Max probability should be bigger than min probability "),t.qZA())}const Jt=s=>parseFloat(s.get("minProbability").value)>=parseFloat(s.get("maxProbability").value)?{minUpMax:!0}:null;let Ut=(()=>{class s{constructor(e){this.cdr=e,this.maxStatSplitSetting$=new t.vpe(null),this.destroyNotifier$=new M.xQ,this.probilityForm=new c.cw({minProbability:new c.NI(.1,[c.kI.required,c.kI.min(0),c.kI.max(1)]),maxProbability:new c.NI(.9,[c.kI.required,c.kI.min(0),c.kI.max(1)])},[Jt])}ngOnInit(){this.probilityForm.valueChanges.pipe((0,O.O)(this.probilityForm.value),(0,T.R)(this.destroyNotifier$)).subscribe(e=>{"VALID"===this.probilityForm.status&&(this.maxStatSplitSetting$.next(e),this.cdr.detectChanges())})}ngAfterViewInit(){this.probilityForm.statusChanges.subscribe(e=>{this.cdr.detectChanges()})}ngOnDestroy(){this.destroyNotifier$.next(),this.destroyNotifier$.complete()}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(t.sBO))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-generate-min-max-probility-maxstatsplit"]],outputs:{maxStatSplitSetting$:"maxStatSplitSetting$"},decls:10,vars:6,consts:[[3,"formGroup"],["formControlName","minProbability","type","range","min","0","max","1","step","0.01",1,"form-control","form-control-sm",2,"width","10em"],["formControlName","maxProbability","type","range","step","0.01",1,"form-control","form-control-sm",2,"width","10em",3,"min","max"],["style","color: red",4,"ngIf"],[2,"color","red"]],template:function(e,i){1&e&&(t.TgZ(0,"form",0),t.TgZ(1,"h5"),t._uU(2,"Min Percent of Low Group:"),t.qZA(),t._UZ(3,"input",1),t._uU(4),t.TgZ(5,"h5"),t._uU(6,"Max Percent of Low Group:"),t.qZA(),t._UZ(7,"input",2),t._uU(8),t.YNc(9,Yt,2,0,"p",3),t.qZA()),2&e&&(t.Q6J("formGroup",i.probilityForm),t.xp6(4),t.hij(" ",100*i.probilityForm.get("minProbability").value,"% "),t.xp6(3),t.Q6J("min",0)("max",1),t.xp6(1),t.hij(" ",100*i.probilityForm.get("maxProbability").value,"% "),t.xp6(1),t.Q6J("ngIf",null==i.probilityForm.errors?null:i.probilityForm.errors.minUpMax))},directives:[c._Y,c.JL,c.sg,c.Fj,c.eT,c.JJ,c.u,d.O5],styles:[""],changeDetection:0}),s})();function Vt(s,l){if(1&s){const e=t.EpF();t.TgZ(0,"app-input-number-with-range",3),t.NdJ("outputNumber$",function(n){return t.CHM(e),t.oxw().processProbilityOfLowGroup(n)}),t.qZA()}2&s&&t.Q6J("minValue",0)("maxValue",1)("defaultValue",.5)("formInlineOrNot",!1)("step",.01)("itemLabel","Probility of Low Group")}function kt(s,l){if(1&s){const e=t.EpF();t.TgZ(0,"app-generate-min-max-probility-maxstatsplit",4),t.NdJ("maxStatSplitSetting$",function(n){return t.CHM(e),t.oxw().processMaxStatSplitSettings(n)}),t.qZA()}}let Xt=(()=>{class s{constructor(e){this.cdr=e,this.highLowSplitSetting$=new t.vpe,this.highLowSplitMethods=[{name:"percentageSplit",description:"Split High/Low Group Based on Percentage Threshold"},{name:"maxstatSplit",description:"Optimize High/Low Group to Find Smallest Log-rank P"}],this.selectedHighLowSplitMethod$=new v.X(null)}ngOnInit(){}processHighLowSplitMethod(e){this.selectedHighLowSplitMethod$.next(e.name),this.cdr.detectChanges()}processProbilityOfLowGroup(e){this.highLowSplitSetting$.next({method:"percentageSplit",settings:{percentageThreshold:e}})}processMaxStatSplitSettings(e){this.highLowSplitSetting$.next({method:"maxstatSplit",settings:{minProb:e.minProbability,maxProb:e.maxProbability}})}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(t.sBO))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-generate-survival-settings"]],outputs:{highLowSplitSetting$:"highLowSplitSetting$"},decls:5,vars:13,consts:[["data-testid","splitMethod",3,"inputObjects","idAttribute","displayAttribute","itemLabel","formInlineOrNot","ifOutputFirstValue","emptyNote","selectedItemObject$"],["data-testid","proOfLowGroup",3,"minValue","maxValue","defaultValue","formInlineOrNot","step","itemLabel","outputNumber$",4,"ngIf"],[3,"maxStatSplitSetting$",4,"ngIf"],["data-testid","proOfLowGroup",3,"minValue","maxValue","defaultValue","formInlineOrNot","step","itemLabel","outputNumber$"],[3,"maxStatSplitSetting$"]],template:function(e,i){1&e&&(t.TgZ(0,"app-select-item-object",0),t.NdJ("selectedItemObject$",function(a){return i.processHighLowSplitMethod(a)}),t.qZA(),t.YNc(1,Vt,1,6,"app-input-number-with-range",1),t.ALo(2,"async"),t.YNc(3,kt,1,0,"app-generate-min-max-probility-maxstatsplit",2),t.ALo(4,"async")),2&e&&(t.Q6J("inputObjects",i.highLowSplitMethods)("idAttribute","name")("displayAttribute","description")("itemLabel","Method to Split High&Low")("formInlineOrNot",!1)("ifOutputFirstValue",!0)("emptyNote","No methods is available"),t.xp6(1),t.Q6J("ngIf","percentageSplit"===t.lcZ(2,9,i.selectedHighLowSplitMethod$)),t.xp6(2),t.Q6J("ngIf","maxstatSplit"===t.lcZ(4,11,i.selectedHighLowSplitMethod$)))},directives:[Rt.w,d.O5,Pt.C,Ut],pipes:[d.Ov],styles:[""],changeDetection:0}),s})();var Qt=r(1026);const zt=["submitButton"];function Bt(s,l){if(1&s){const e=t.EpF();t.TgZ(0,"div"),t.TgZ(1,"app-select-dataset",9),t.NdJ("selectedDatasetID$",function(n){return t.CHM(e),t.oxw().processSelectedDataset(n)}),t.qZA(),t.qZA()}if(2&s){const e=t.oxw();t.xp6(1),t.Q6J("allDatasetInfoForDisplay",e.allDatasetInfoForDisplay)("formInlineOrNot",!1)}}function Kt(s,l){1&s&&(t.TgZ(0,"p",10),t._uU(1,"Please import a Expression Profile data first. "),t.TgZ(2,"a",11),t._uU(3,"Import Data"),t.qZA(),t.qZA())}function Wt(s,l){if(1&s){const e=t.EpF();t.TgZ(0,"div"),t.TgZ(1,"p",12),t._uU(2,"Warning: This dataset has no follow-up information. Please"),t.TgZ(3,"a",13),t.NdJ("click",function(n){return t.CHM(e),t.oxw().triggerImportClinicalDataSignal(n)}),t._uU(4,"import follow-up files and mapping files"),t.qZA(),t.qZA(),t.qZA()}}function te(s,l){if(1&s){const e=t.EpF();t.TgZ(0,"div"),t.TgZ(1,"app-select-item",14),t.NdJ("selectedItem$",function(n){return t.CHM(e),t.oxw().processSelectedGenelistID(n)}),t.qZA(),t.TgZ(2,"p",15),t._uU(3,"Info: If the genes of interest are not in the list. You can "),t.TgZ(4,"a",16),t.NdJ("click",function(n){return t.CHM(e),t.oxw().triggerInputGeneListSignal(n)}),t._uU(5," input a new gene list"),t.qZA(),t.qZA(),t.qZA()}if(2&s){const e=t.oxw();t.xp6(1),t.Q6J("inputItems",e.availableGeneListNames)("itemLabel","Gene List")("emptyNote","Please load or generate a new gene list first")("formInlineOrNot",!1)}}function ee(s,l){if(1&s){const e=t.EpF();t.TgZ(0,"p"),t._uU(1,"Please load or generate a new gene list."),t.TgZ(2,"a",17),t.NdJ("click",function(n){return t.CHM(e),t.oxw().triggerInputGeneListSignal(n)}),t._uU(3,"New Gene List"),t.qZA(),t.qZA()}}let ie=(()=>{class s{constructor(e){this.cdr=e,this.inputGeneListSignal$=new t.vpe,this.importClinicalSingal$=new t.vpe,this.selectedDatasetID$=new t.vpe,this.selectedStatusAttribute$=new t.vpe,this.survivalAnalysisequest$=new t.vpe,this.extendedDatasetGroupNames=["Use all samples"],this.selectedDatasetIDSubject=new v.X(null),this.selectedGroupSubject=new v.X(null),this.selectedGeneListIDSubject=new v.X(null),this.endpointSettingsSubject=new v.X(null),this.highLowSplitSettingSubject=new v.X(null),this.destroyNotifier$=new M.xQ}ngOnInit(){}ngAfterViewInit(){this.submitStream$=(0,Mt.R)(this.submitButton.nativeElement,"click"),this.ifSubmitAvailable$=(0,G.aj)([this.selectedDatasetIDSubject,this.selectedGroupSubject,this.selectedGeneListIDSubject,this.endpointSettingsSubject,this.highLowSplitSettingSubject]).pipe((0,_.U)(([e,i,n,a,p])=>!!(e&&i&&n&&a&&p)),(0,O.O)(!1),(0,T.R)(this.destroyNotifier$)),this.submitStream$.pipe((0,g.h)(e=>null!=e),(0,w.M)(this.selectedDatasetIDSubject.pipe((0,g.h)(e=>null!=e)),this.selectedGroupSubject.pipe((0,g.h)(e=>null!=e)),this.selectedGeneListIDSubject.pipe((0,g.h)(e=>null!=e)),this.endpointSettingsSubject.pipe((0,g.h)(e=>null!=e)),this.highLowSplitSettingSubject.pipe((0,g.h)(e=>null!=e)))).subscribe(([e,i,n,a,p,u])=>{this.survivalAnalysisequest$.next({datasetID:i,groupName:n,geneListID:a,endpointSettings:p,highLowSplitSetting:u})})}ngOnChanges(e){e.groupNames&&(this.extendedDatasetGroupNames=["Use all samples"].concat(this.groupNames),this.cdr.detectChanges())}ngOnDestroy(){this.destroyNotifier$.next(),this.destroyNotifier$.complete()}triggerInputGeneListSignal(e){this.inputGeneListSignal$.next(!0)}triggerImportClinicalDataSignal(e){this.importClinicalSingal$.next(!0)}processSelectedDataset(e){this.selectedDatasetID$.next(e),this.selectedDatasetIDSubject.next(e)}processSelectedStatusAttribute(e){this.selectedStatusAttribute$.next(e)}processSelectedGroupName(e){this.selectedGroupSubject.next(e)}processEndpointSettings(e){this.endpointSettingsSubject.next(e)}processSelectedGenelistID(e){this.selectedGeneListIDSubject.next(e)}processHighLowSplitSettings(e){this.highLowSplitSettingSubject.next(e)}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(t.sBO))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-generate-new-survival-analysis"]],viewQuery:function(e,i){if(1&e&&t.Gf(zt,5),2&e){let n;t.iGM(n=t.CRH())&&(i.submitButton=n.first)}},inputs:{allDatasetInfoForDisplay:"allDatasetInfoForDisplay",ifShowImportClinical:"ifShowImportClinical",clinicalAttributes:"clinicalAttributes",availableStatusValues:"availableStatusValues",groupNames:"groupNames",availableGeneListNames:"availableGeneListNames"},outputs:{inputGeneListSignal$:"inputGeneListSignal$",importClinicalSingal$:"importClinicalSingal$",selectedDatasetID$:"selectedDatasetID$",selectedStatusAttribute$:"selectedStatusAttribute$",survivalAnalysisequest$:"survivalAnalysisequest$"},features:[t.TTD],decls:15,vars:14,consts:[[4,"ngIf","ngIfElse"],["importDataNote",""],[4,"ngIf"],[3,"clinicalAttributes","availableStatusValues","selectedStatusAttribute$","endpointSettings$"],["data-testid","selectGroup",1,"mt-2",3,"inputItems","itemLabel","emptyNote","formInlineOrNot","selectedItem$"],["importGeneListNote",""],[3,"highLowSplitSetting$"],["data-testid","submitSurvivalAnalysis",1,"mt-3","btn","btn-expressvis",3,"disabled"],["submitButton",""],[3,"allDatasetInfoForDisplay","formInlineOrNot","selectedDatasetID$"],["data-testid","importDataNote"],["href","javascript:void(0)","routerLink","/importData"],[1,"text-warning"],["data-testid","importClinicalData","href","javascript:void(0)",3,"click"],["data-testid","selectGeneListForSurvival",1,"mt-2",3,"inputItems","itemLabel","emptyNote","formInlineOrNot","selectedItem$"],[1,"test-info"],["data-testid","moreNewGeneList","href","javascript:void(0)",3,"click"],["data-testid","newGeneList","href","javascript:void(0)",3,"click"]],template:function(e,i){if(1&e&&(t.YNc(0,Bt,2,2,"div",0),t.YNc(1,Kt,4,0,"ng-template",null,1,t.W1O),t.YNc(3,Wt,5,0,"div",2),t.TgZ(4,"app-generate-endpoint-settings",3),t.NdJ("selectedStatusAttribute$",function(a){return i.processSelectedStatusAttribute(a)})("endpointSettings$",function(a){return i.processEndpointSettings(a)}),t.qZA(),t.TgZ(5,"div"),t.TgZ(6,"app-select-item",4),t.NdJ("selectedItem$",function(a){return i.processSelectedGroupName(a)}),t.qZA(),t.qZA(),t.YNc(7,te,6,4,"div",0),t.YNc(8,ee,4,0,"ng-template",null,5,t.W1O),t.TgZ(10,"app-generate-survival-settings",6),t.NdJ("highLowSplitSetting$",function(a){return i.processHighLowSplitSettings(a)}),t.qZA(),t.TgZ(11,"button",7,8),t.ALo(13,"async"),t._uU(14," Submit\n"),t.qZA()),2&e){const n=t.MAs(2),a=t.MAs(9);t.Q6J("ngIf",(null==i.allDatasetInfoForDisplay?null:i.allDatasetInfoForDisplay.length)>=1)("ngIfElse",n),t.xp6(3),t.Q6J("ngIf",i.ifShowImportClinical),t.xp6(1),t.Q6J("clinicalAttributes",i.clinicalAttributes)("availableStatusValues",i.availableStatusValues),t.xp6(2),t.Q6J("inputItems",i.extendedDatasetGroupNames)("itemLabel","Select a Group for Analysis")("emptyNote","no groun")("formInlineOrNot",!1),t.xp6(1),t.Q6J("ngIf",(null==i.availableGeneListNames?null:i.availableGeneListNames.length)>0)("ngIfElse",a),t.xp6(4),t.Q6J("disabled",!t.lcZ(13,12,i.ifSubmitAvailable$))}},directives:[d.O5,Et,J.y,Xt,Qt.z,R.yS],pipes:[d.Ov],styles:[""],changeDetection:0}),s})();var ht=r(277),X=r(5043),se=r(7582),gt=r(8638),ne=r(3856);function ae(s,l){if(1&s){const e=t.EpF();t.TgZ(0,"th",10),t.NdJ("sort",function(n){return t.CHM(e),t.oxw().onSort(n)}),t._uU(1),t.qZA()}if(2&s){const e=l.$implicit;t.s9C("sortableColumn",e),t.xp6(1),t.hij(" ",e," ")}}function le(s,l){if(1&s&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&s){const e=l.$implicit,i=t.oxw().$implicit;t.xp6(1),t.hij(" ",i[e]," ")}}function oe(s,l){if(1&s){const e=t.EpF();t.TgZ(0,"tr"),t.TgZ(1,"td"),t.TgZ(2,"input",11),t.NdJ("click",function(n){return t.CHM(e),t.oxw().selectedOrCancelItem(n)}),t.qZA(),t.qZA(),t.TgZ(3,"td",12),t.NdJ("click",function(){const a=t.CHM(e).$implicit,p=t.oxw();return p.processSelectedGeneForPlot(a[p.uniqueFeature])}),t.TgZ(4,"div",13),t._UZ(5,"fa-icon",14),t.qZA(),t.qZA(),t.YNc(6,le,2,1,"td",4),t.qZA()}if(2&s){const e=l.$implicit,i=t.oxw();t.xp6(2),t.Q6J("checked",i.selectedIndexColumns.includes(e[i.uniqueFeature]))("value",e[i.uniqueFeature]),t.xp6(3),t.Q6J("icon",i.faChartLine)("size","1x"),t.xp6(1),t.Q6J("ngForOf",i.features)}}let re=(()=>{class s{constructor(e){this.cdr=e,this.selectedItems$=new t.vpe,this.clickedGeneForPlot$=new t.vpe,this.page=1,this.pageSize=5,this.faArrowUp=X.FPD,this.faArrowDown=X.r5q,this.faChartLine=X.Stf,this.selectedIndexColumns=[]}ngOnInit(){this.termsInfoForTable&&(this.selectedIndexColumns=[],this._prepareForTable(),this.refreshSubTermsInfo())}ngOnChanges(e){e.termsInfoForTable&&!e.termsInfoForTable.isFirstChange()&&(this.selectedIndexColumns=[],this._prepareForTable(),this.refreshSubTermsInfo())}_prepareForTable(){this.features=[...this.termsInfoForTable.features],this.termsInfo=[...this.termsInfoForTable.termsInfo],this.collectionSize=this.termsInfo.length}refreshSubTermsInfo(){this.subTermsInfo=this.termsInfo.slice((this.page-1)*this.pageSize,(this.page-1)*this.pageSize+this.pageSize),this.cdr.detectChanges()}onSort({column:e,direction:i}){this.headers.forEach(n=>{n.sortableColumn!==e&&(n.direction="")}),(""!=i||""!=e)&&(this.termsInfo=[...this.termsInfo].sort((n,a)=>{const p=(0,se.q)(n[e],a[e]);return"asc"===i?p:-p}),this.refreshSubTermsInfo())}selectedOrCancelItem(e){const n=e.target.value;e.target.checked?this.selectedIndexColumns.push(n):this.selectedIndexColumns.splice(this.selectedIndexColumns.indexOf(n),1),this.selectedItems$.next(this.selectedIndexColumns)}processSelectedGeneForPlot(e){this.clickedGeneForPlot$.next(e)}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(t.sBO))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-display-terms-info-table-pagination"]],viewQuery:function(e,i){if(1&e&&t.Gf(ht.Y,5),2&e){let n;t.iGM(n=t.CRH())&&(i.headers=n)}},inputs:{termsInfoForTable:"termsInfoForTable",termName:"termName",uniqueFeature:"uniqueFeature"},outputs:{selectedItems$:"selectedItems$",clickedGeneForPlot$:"clickedGeneForPlot$"},features:[t.TTD],decls:22,vars:12,consts:[[1,"table-responsive",2,"margin-left","10px","margin-right","10px"],[1,"table"],["sortable","",3,"sortableColumn","sort",4,"ngFor","ngForOf"],[1,"border-bottom"],[4,"ngFor","ngForOf"],[1,"d-flex","justify-content-between","align-items-center","p-2"],["data-testid","termsNum"],[3,"collectionSize","page","pageSize","maxSize","pageChange"],[1,"custom-select","mb-3",2,"width","auto",3,"ngModel","ngModelChange"],[3,"ngValue"],["sortable","",3,"sortableColumn","sort"],["type","checkbox",3,"checked","value","click"],[3,"click"],[1,"form-inline"],["ngbTooltip","Click to visualize KM plot",1,"hoverBigger",3,"icon","size"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"table",1),t.TgZ(2,"thead"),t.TgZ(3,"tr"),t.TgZ(4,"th"),t._uU(5,"Select"),t.qZA(),t.TgZ(6,"th"),t._uU(7,"View KM plot"),t.qZA(),t.YNc(8,ae,2,2,"th",2),t.qZA(),t.qZA(),t.TgZ(9,"tbody",3),t.YNc(10,oe,7,5,"tr",4),t.qZA(),t.qZA(),t.qZA(),t.TgZ(11,"div",5),t.TgZ(12,"p",6),t._uU(13),t.qZA(),t.TgZ(14,"ngb-pagination",7),t.NdJ("pageChange",function(a){return i.page=a})("pageChange",function(){return i.refreshSubTermsInfo()}),t.qZA(),t.TgZ(15,"select",8),t.NdJ("ngModelChange",function(a){return i.pageSize=a})("ngModelChange",function(){return i.refreshSubTermsInfo()}),t.TgZ(16,"option",9),t._uU(17,"5 per page"),t.qZA(),t.TgZ(18,"option",9),t._uU(19,"10 per page"),t.qZA(),t.TgZ(20,"option",9),t._uU(21,"20 per page"),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(8),t.Q6J("ngForOf",i.features),t.xp6(2),t.Q6J("ngForOf",i.subTermsInfo),t.xp6(3),t.AsE(" ",i.collectionSize," ",i.termName," "),t.xp6(1),t.Q6J("collectionSize",i.collectionSize)("page",i.page)("pageSize",i.pageSize)("maxSize",5),t.xp6(1),t.Q6J("ngModel",i.pageSize),t.xp6(1),t.Q6J("ngValue",5),t.xp6(2),t.Q6J("ngValue",10),t.xp6(2),t.Q6J("ngValue",20))},directives:[d.sg,gt.N9,c.EJ,c.JJ,c.On,c.YN,c.Kr,ht.Y,ne.BN,gt._L],styles:[""],changeDetection:0}),s})();var m=r(2707);const pe=["svgElement"];let ce=(()=>{class s{constructor(){this._svgWidth=600,this._svgHeight=160,this._svgMarginLeft=20,this._svgMarginTop=10,this._editableVariablesText="Variables",this._editableVariablesTextWidth=200,this._editableVariablesTextHeight=40,this._editableVariablesTextFontSize=18,this._baseIncreasingValue=40,this._xScaleRangeMin=120,this._xScaleRangeMax=400,this._editableHrText="HR (95% CI)",this._editablePValueText="PValue",this._editableXTitleText="Hazard Ratio"}ngOnInit(){}ngOnChanges(e){e.forestData&&!e.forestData.isFirstChange()&&this.forestData.length>0&&(this._removeGraphic(),this.forestData&&this._initMap())}ngAfterViewInit(){this.forestData&&this._initMap()}_initMap(){this._setSvgConfigures(),this._setEditableVariablesText(),this._setScale(),this._setXYAxisInSvg(),this._drawForestGraph(),this._drawDataTable(),this._setXTitle()}_setXTitle(){const i=`\n      outline: 0px;\n      text-align: center;\n      font-family: Arial;\n      font-size: ${this._editableVariablesTextFontSize}px;\n      font-weight: bold;\n    `;this._svgD3.append("g").attr("class","xTitle_g").append("foreignObject").attr("class","xTitleForeignObject").attr("requiredExtension","http://www.w3.org/1990/xhtml").attr("x",this._xScaleRangeMin+(this._xScaleRangeMax-this._xScaleRangeMin-200)/2).attr("y",4*this._svgMarginTop+this._editableVariablesTextHeight+this._increasedHeight).attr("width",200).attr("height",40).html(`\n        <p spellcheck=false contenteditable="true" style="${i}">\n          ${this._editableXTitleText}\n        </p>\n        `)}_drawDataTable(){const i=`\n      outline: 0px;\n      font-family: Arial;\n      font-size: ${this._editableVariablesTextFontSize}px;\n      font-weight: bold;\n    `,n=(this._svgWidth-this._xScaleRangeMax-20)/2+20,a=(this._svgWidth-this._xScaleRangeMax-20)/2-20;this._svgD3.append("g").attr("class","hr_g").append("foreignObject").attr("class","hrForeignObject").attr("requiredExtension","http://www.w3.org/1990/xhtml").attr("x",this._xScaleRangeMax+10).attr("y",this._svgMarginTop).attr("width",n).attr("height",40).html(`\n        <p spellcheck=false contenteditable="true" style="${i}">\n          ${this._editableHrText}\n        </p>\n        `),this._svgD3.append("g").attr("class","pvalue_g").append("foreignObject").attr("class","pvalueForeignObject").attr("requiredExtension","http://www.w3.org/1990/xhtml").attr("x",this._xScaleRangeMax+20+(this._svgWidth-this._xScaleRangeMax-20)/2+20).attr("y",this._svgMarginTop).attr("width",a).attr("height",40).html(`\n        <p spellcheck=false contenteditable="true" style="${i}">\n          ${this._editablePValueText}\n        </p>\n        `),this.forestData.forEach((p,u)=>{this._svgD3.append("g").attr("class","hrText").append("text").text(`${p.HR.toFixed(2)} (${p.HRLow.toFixed(2)}-${p.HRHigh.toFixed(2)})`).attr("x",this._xScaleRangeMax+10).attr("y",2*this._svgMarginTop+this._editableVariablesTextHeight+this._yScale.bandwidth()/2+u*this._yScale.bandwidth()).style("font-family","Arial").style("font-size","12px").style("font-weight","bold"),this._svgD3.append("g").attr("class","hrText").append("text").text(`${p.PValue.toFixed(4)}`).attr("x",this._xScaleRangeMax+20+(this._svgWidth-this._xScaleRangeMax-20)/2+20).attr("y",2*this._svgMarginTop+this._editableVariablesTextHeight+this._yScale.bandwidth()/2+u*this._yScale.bandwidth()).style("font-family","Arial").style("font-size","12px").style("font-weight","bold")})}_drawForestGraph(){const e=this._svgD3.append("g").attr("class","data_g");this.forestData.forEach((a,p)=>{const u=e.append("g").attr("class","group_g");u.append("line").attr("x1",this._xScale(a.HRLow)).attr("y1",2*this._svgMarginTop+this._editableVariablesTextHeight+this._yScale.bandwidth()/2+p*this._yScale.bandwidth()).attr("x2",this._xScale(a.HRHigh)).attr("y2",2*this._svgMarginTop+this._editableVariablesTextHeight+this._yScale.bandwidth()/2+p*this._yScale.bandwidth()).attr("stroke","DeepSkyBlue").attr("stroke-width",2),u.append("line").attr("x1",this._xScale(a.HRLow)).attr("y1",2*this._svgMarginTop+this._editableVariablesTextHeight+this._yScale.bandwidth()/2+p*this._yScale.bandwidth()+6).attr("x2",this._xScale(a.HRLow)).attr("y2",2*this._svgMarginTop+this._editableVariablesTextHeight+this._yScale.bandwidth()/2+p*this._yScale.bandwidth()-6).attr("stroke","DeepSkyBlue").attr("stroke-width",2),u.append("line").attr("x1",this._xScale(a.HRHigh)).attr("y1",2*this._svgMarginTop+this._editableVariablesTextHeight+this._yScale.bandwidth()/2+p*this._yScale.bandwidth()+6).attr("x2",this._xScale(a.HRHigh)).attr("y2",2*this._svgMarginTop+this._editableVariablesTextHeight+this._yScale.bandwidth()/2+p*this._yScale.bandwidth()-6).attr("stroke","DeepSkyBlue").attr("stroke-width",2),u.append("rect").attr("width",6).attr("height",6).attr("x",this._xScale(a.HR)-3).attr("y",2*this._svgMarginTop+this._editableVariablesTextHeight+this._yScale.bandwidth()/2+p*this._yScale.bandwidth()-3).attr("fill","DeepSkyBlue")})}_setXYAxisInSvg(){const e=this._setTicksNumber(parseFloat((0,m.VV$)(this.forestData,a=>a.HRLow)+""),parseFloat((0,m.Fp7)(this.forestData,a=>a.HRHigh)+""));this._xAxis=(0,m.LLu)(this._xScale).ticks(e),this._svgD3.append("g").call(this._xAxis).attr("class","xAxis").attr("transform",`translate(0, ${2*this._svgMarginTop+this._editableVariablesTextHeight+this._increasedHeight})`).attr("stroke-width",2);const i=this._getTicksAndOneIndexBySelector(".xAxis .tick text"),n=this._xScaleRangeMin+(this._xScaleRangeMax-this._xScaleRangeMin)/(i.size-1)*i.oneIndex;this._yAxis=(0,m.y4O)(this._yScale).tickPadding(n-this._xScaleRangeMin+20).tickSize(0),this._svgD3.append("g").call(this._yAxis).attr("class","yAxis").attr("transform",`translate(${n}, 0)`).attr("stroke-width",2).style("stroke-dasharray","4.4"),(0,m.td_)(".xAxis .tick text").style("font-family","Arial").style("font-size",11).style("font-weight","bold"),(0,m.td_)(".yAxis .tick text").style("font-family","Arial").style("font-weight","bold").style("font-size",14)}_getTicksAndOneIndexBySelector(e){const i=[];return(0,m.td_)(e).each(n=>i.push(Number(n))),{oneIndex:i.indexOf(1),size:i.length}}_setTicksNumber(e,i){let n=1;if(e>=1&&e<i){let a=1;for(;i>1&&!(i<=Math.pow(2,a));)a++;n+=a}if(i<=1&&e<i){let a=-1;for(;e<1&&!(e>=Math.pow(2,a));)a--;n+=Math.abs(a)}if(e<1&&i>1){let a=1,p=-1;for(;i>1&&!(i<=Math.pow(2,a));)a++;for(;e<1&&!(e>=Math.pow(2,p));)p--;n+=a+Math.abs(p)}return n}_setScale(){this._increasedHeight=this.forestData.length*this._baseIncreasingValue;const e=parseFloat((0,m.VV$)(this.forestData,n=>n.HRLow)+""),i=parseFloat((0,m.Fp7)(this.forestData,n=>n.HRHigh)+"");this._xScale=(0,m.p2C)().base(2).domain([e,i]).range([this._xScaleRangeMin,this._xScaleRangeMax]).nice(),this._yScale=(0,m.tiA)().domain(this.forestData.map(n=>n.variableName)).range([2*this._svgMarginTop+this._editableVariablesTextHeight,2*this._svgMarginTop+this._editableVariablesTextHeight+this._increasedHeight])}_setEditableVariablesText(){const e=`\n      outline: 0px;\n      font-family: Arial;\n      font-size: ${this._editableVariablesTextFontSize}px;\n      font-weight: bold;\n    `;this._svgD3.append("g").attr("class","variables_g").append("foreignObject").attr("class","variablesForeignObject").attr("requiredExtension","http://www.w3.org/1990/xhtml").attr("x",this._svgMarginLeft).attr("y",this._svgMarginTop).attr("width",this._editableVariablesTextWidth).attr("height",this._editableVariablesTextHeight).html(`\n        <p spellcheck=false contenteditable="true" style="${e}">\n          ${this._editableVariablesText}\n        </p>\n      `)}_setSvgConfigures(){this._svgD3=(0,m.Ys)(this.svgElement.nativeElement),this._svgD3.attr("width",this._svgWidth).attr("height",this._svgHeight+(this.forestData.length-1)*this._baseIncreasingValue)}_removeGraphic(){this._svgD3&&this._svgD3.selectAll("*").remove()}}return s.\u0275fac=function(e){return new(e||s)},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-d3-forest-plot"]],viewQuery:function(e,i){if(1&e&&t.Gf(pe,7),2&e){let n;t.iGM(n=t.CRH())&&(i.svgElement=n.first)}},inputs:{forestData:"forestData"},features:[t.TTD],decls:2,vars:0,consts:[[2,"border","1px solid black"],["svgElement",""]],template:function(e,i){1&e&&(t.O4$(),t._UZ(0,"svg",0,1))},styles:[""],changeDetection:0}),s})();function ue(s,l){if(1&s){const e=t.EpF();t.TgZ(0,"app-display-terms-info-table-pagination",8),t.NdJ("selectedItems$",function(n){return t.CHM(e),t.oxw().processSelectedProteins(n)})("clickedGeneForPlot$",function(n){return t.CHM(e),t.oxw().processClickedGeneForPlot(n)}),t.qZA()}if(2&s){const e=t.oxw();t.Q6J("termsInfoForTable",e.survivalAnnoInfoForTable)("termName","Genes/Proteins")("uniqueFeature",e.variableFeature)}}function he(s,l){1&s&&(t.TgZ(0,"p",9),t._uU(1," Please generate a new survival anslysis in the left side "),t.qZA())}function ge(s,l){if(1&s&&t._UZ(0,"app-d3-forest-plot",10),2&s){const e=t.oxw();t.Q6J("forestData",e.forestData)}}function de(s,l){1&s&&(t.TgZ(0,"p",11),t._uU(1,"Select variables from the table "),t.qZA())}let me=(()=>{class s{constructor(e){this.cdr=e,this.selectedGeneForKMplot$=new t.vpe,this.features=["Variable","n/N in high group","n/N in low group","favor/unfavor","Hazard ratio","Hazard ratio lower","Hazard ratio upper","HR (95% CI)","Wald test p-value","Log-rank test p-value"],this.variableFeature="Variable"}ngOnInit(){this.survivalAnno&&this._prepareForTable()}ngOnChanges(e){e.survivalAnno&&!e.survivalAnno.isFirstChange()&&this._prepareForTable()}_prepareForTable(){const e=(0,P.gG)(this.survivalAnno);this.survivalAnnoInfoForTable={features:this.features,termsInfo:e},this.cdr.detectChanges()}processSelectedProteins(e){const i=(0,P.Wv)(e,[...this.survivalAnno[this.variableFeature]]);let n=[];const a=this.survivalAnno.Variable,p=this.survivalAnno["Hazard ratio lower"],u=this.survivalAnno["Hazard ratio"],o=this.survivalAnno["Hazard ratio upper"],h=this.survivalAnno["Wald test p-value"];i.forEach(S=>{n.push({variableName:a[S],HRLow:p[S],HR:u[S],HRHigh:o[S],PValue:h[S]})}),this.forestData=[...n],this.cdr.detectChanges()}processClickedGeneForPlot(e){this.selectedGeneForKMplot$.next(e)}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(t.sBO))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-display-survival-analysis-results"]],inputs:{survivalAnno:"survivalAnno"},outputs:{selectedGeneForKMplot$:"selectedGeneForKMplot$"},features:[t.TTD],decls:13,vars:4,consts:[[1,"row"],[1,"col-12","col-md-6","border"],[1,"text-center"],[3,"termsInfoForTable","termName","uniqueFeature","selectedItems$","clickedGeneForPlot$",4,"ngIf","ngIfElse"],["generateNewSurvivalNote",""],[1,"col-12","col-md-5","border"],[3,"forestData",4,"ngIf","ngIfElse"],["selectVariablesNote",""],[3,"termsInfoForTable","termName","uniqueFeature","selectedItems$","clickedGeneForPlot$"],[2,"color","red"],[3,"forestData"],[1,"text-danger"]],template:function(e,i){if(1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"h5",2),t._uU(3," Survival Analysis Annotation "),t.qZA(),t.YNc(4,ue,1,3,"app-display-terms-info-table-pagination",3),t.YNc(5,he,2,0,"ng-template",null,4,t.W1O),t.qZA(),t.TgZ(7,"div",5),t.TgZ(8,"h5",2),t._uU(9," Survival Forest of the Selected Variables "),t.qZA(),t.YNc(10,ge,1,1,"app-d3-forest-plot",6),t.YNc(11,de,2,0,"ng-template",null,7,t.W1O),t.qZA(),t.qZA()),2&e){const n=t.MAs(6),a=t.MAs(12);t.xp6(4),t.Q6J("ngIf",i.survivalAnnoInfoForTable)("ngIfElse",n),t.xp6(6),t.Q6J("ngIf",(null==i.forestData?null:i.forestData.length)>=1)("ngIfElse",a)}},directives:[d.O5,re,ce],styles:[""],changeDetection:0}),s})();var fe=r(4547),_e=r(5826),U=r(3314),dt=r(3139);let mt=(()=>{class s extends dt.S{constructor(){super()}obtainClinicalImportInfo(e,i,n){return function(s,l,e,i){let n=[],a={};const p=l.indexOf(e);let u=new Map;return i.forEach(o=>{a[o]=[],u.set(o,l.indexOf(o))}),s.forEach(o=>{n.push(o[p]);for(const[h,S]of u.entries())a[h].push(o[S])}),{patientIDs:n,clinicalAttributes:i,clinicalAttrValues:a}}(this.textMatrix.slice(1),e,i,n)}}return s.\u0275fac=function(e){return new(e||s)},s.\u0275prov=t.Yz7({token:s,factory:s.\u0275fac}),s})();var ft=r(6872);function Se(s,l){if(1&s&&(t.TgZ(0,"th"),t.TgZ(1,"p",7),t._uU(2),t.qZA(),t.qZA()),2&s){const e=l.$implicit;t.xp6(2),t.hij(" ",e," ")}}function be(s,l){if(1&s&&(t.TgZ(0,"td",9),t._uU(1),t.ALo(2,"trimString"),t.qZA()),2&s){const e=l.$implicit;t.s9C("title",e),t.xp6(1),t.hij(" ",t.xi3(2,2,e,20)," ")}}function xe(s,l){if(1&s&&(t.TgZ(0,"tr"),t.YNc(1,be,3,5,"td",8),t.qZA()),2&s){const e=l.$implicit;t.xp6(1),t.Q6J("ngForOf",e)}}let ye=(()=>{class s{constructor(e){this.importService=e,this.clinicalImportInfo$=new t.vpe,this.fileHeaders$=new U.y(null),this.firstLines$=new U.y(null),this.patientIDcolumn$=new v.X(null),this.destroyNotifier$=new M.xQ}ngOnInit(){this.firstLines$=this.importService.firstLines$.pipe((0,T.R)(this.destroyNotifier$)),this.fileHeaders$=this.importService.fileHeaders$.pipe((0,T.R)(this.destroyNotifier$)),this.patientIDcolumn$.pipe((0,g.h)(e=>null!=e),(0,w.M)(this.fileHeaders$),(0,_.U)(([e,i])=>{let n=[];return i.forEach(a=>{a!=e&&n.push(a)}),this.importService.obtainClinicalImportInfo(i,e,n)}),(0,T.R)(this.destroyNotifier$)).subscribe(e=>{this.clinicalImportInfo$.next(e)})}ngOnDestroy(){this.destroyNotifier$.next(),this.destroyNotifier$.complete()}processClinicalFile(e){this.importService.initLoadedFile(e)}processSelectedPatientIDcolumn(e){this.patientIDcolumn$.next(e)}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(mt))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-import-clinical-values"]],outputs:{clinicalImportInfo$:"clinicalImportInfo$"},features:[t._Bn([mt])],decls:16,vars:12,consts:[["data-testid","clinicalFile","role","form"],[1,"form-group"],["type","file",1,"form","ml-2",3,"change"],["data-testid","selectPatientIDcol",1,"mt-2",3,"inputItems","itemLabel","emptyNote","formInlineOrNot","selectedItem$"],[1,"table-responsive","mr-2","ml-2"],[1,"table","table-bordered","mt-2"],[4,"ngFor","ngForOf"],[1,"font-weight-bold"],[3,"title",4,"ngFor","ngForOf"],[3,"title"]],template:function(e,i){1&e&&(t.TgZ(0,"form",0),t.TgZ(1,"div",1),t.TgZ(2,"h5"),t._uU(3,"Follow-up File: "),t.qZA(),t.TgZ(4,"input",2),t.NdJ("change",function(a){return i.processClinicalFile(a)}),t.qZA(),t.qZA(),t.qZA(),t.TgZ(5,"app-select-item",3),t.NdJ("selectedItem$",function(a){return i.processSelectedPatientIDcolumn(a)}),t.ALo(6,"async"),t.qZA(),t.TgZ(7,"div",4),t.TgZ(8,"table",5),t.TgZ(9,"thead"),t.TgZ(10,"tr"),t.YNc(11,Se,3,1,"th",6),t.ALo(12,"async"),t.qZA(),t.qZA(),t.TgZ(13,"tbody"),t.YNc(14,xe,2,1,"tr",6),t.ALo(15,"async"),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(5),t.Q6J("inputItems",t.lcZ(6,6,i.fileHeaders$))("itemLabel","Choose PatientID Column of Follow-up File")("emptyNote","select clinical file first")("formInlineOrNot",!1),t.xp6(6),t.Q6J("ngForOf",t.lcZ(12,8,i.fileHeaders$)),t.xp6(3),t.Q6J("ngForOf",t.lcZ(15,10,i.firstLines$)))},directives:[c._Y,c.JL,c.F,J.y,d.sg],pipes:[d.Ov,ft.K],styles:[""],changeDetection:0}),s})(),_t=(()=>{class s extends dt.S{constructor(){super()}obtainMapperObject(e,i){return((s,l,e)=>{const i=[...s[0]],n=i.indexOf(l),a=i.indexOf(e);let p={};return s.slice(1).forEach(u=>{p[u[a]]=u[n]}),p})(this.textMatrix,e,i)}}return s.\u0275fac=function(e){return new(e||s)},s.\u0275prov=t.Yz7({token:s,factory:s.\u0275fac}),s})();function Te(s,l){if(1&s&&(t.TgZ(0,"th"),t.TgZ(1,"p",9),t._uU(2),t.qZA(),t.qZA()),2&s){const e=l.$implicit;t.xp6(2),t.hij(" ",e," ")}}function De(s,l){if(1&s&&(t.TgZ(0,"td",11),t._uU(1),t.ALo(2,"trimString"),t.qZA()),2&s){const e=l.$implicit;t.s9C("title",e),t.xp6(1),t.hij(" ",t.xi3(2,2,e,20)," ")}}function Ae(s,l){if(1&s&&(t.TgZ(0,"tr"),t.YNc(1,De,3,5,"td",10),t.qZA()),2&s){const e=l.$implicit;t.xp6(1),t.Q6J("ngForOf",e)}}function we(s,l){1&s&&(t.TgZ(0,"p",12),t._uU(1," Error: PatientID column should not equal sampleID column\n"),t.qZA())}let Ce=(()=>{class s{constructor(e){this.importService=e,this.mapperDic$=new t.vpe,this.fileHeaders$=new U.y(null),this.firstLines$=new U.y(null),this.patientIDcolumnSubject=new v.X(null),this.sampleColumnSubject=new v.X(null),this.destroyNotifier$=new M.xQ}ngOnInit(){this.firstLines$=this.importService.firstLines$.pipe((0,T.R)(this.destroyNotifier$)),this.fileHeaders$=this.importService.fileHeaders$.pipe((0,T.R)(this.destroyNotifier$)),(0,G.aj)([this.patientIDcolumnSubject.pipe((0,g.h)(Boolean)),this.sampleColumnSubject.pipe((0,g.h)(Boolean))]).pipe((0,g.h)(([e,i])=>e!==i),(0,_.U)(([e,i])=>this.importService.obtainMapperObject(e.toString().trim(),i.toString().trim()))).subscribe(e=>{this.mapperDic$.next(e)}),this.ifShowEuqalError$=(0,G.aj)([this.patientIDcolumnSubject.pipe((0,g.h)(Boolean)),this.sampleColumnSubject.pipe((0,g.h)(Boolean))]).pipe((0,_.U)(([e,i])=>e===i),(0,O.O)(!1),(0,T.R)(this.destroyNotifier$))}ngOnDestroy(){this.destroyNotifier$.next(),this.destroyNotifier$.complete()}processMapperFile(e){this.importService.initLoadedFile(e)}processSelectedPatientIDcolumn(e){this.patientIDcolumnSubject.next(e)}processSelectedSampleIDColumn(e){this.sampleColumnSubject.next(e)}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(_t))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-import-mapper-file"]],outputs:{mapperDic$:"mapperDic$"},features:[t._Bn([_t])],decls:20,vars:23,consts:[["data-testid","sample2patientIDfile","role","form"],[1,"form-group"],["type","file",1,"form","ml-2",3,"change"],[1,"table-responsive","mr-2","ml-2"],[1,"table","table-bordered","mt-2"],[4,"ngFor","ngForOf"],["data-testid","selectPatientIDcolInMapper",1,"mt-2",3,"inputItems","itemLabel","emptyNote","formInlineOrNot","ifOutputFirstValue","selectedItem$"],["data-testid","selectSampleColInMapper",1,"mt-2",3,"inputItems","itemLabel","emptyNote","formInlineOrNot","ifOutputFirstValue","selectedItem$"],["data-testid","equalError","class","text-danger",4,"ngIf"],[1,"font-weight-bold"],[3,"title",4,"ngFor","ngForOf"],[3,"title"],["data-testid","equalError",1,"text-danger"]],template:function(e,i){1&e&&(t.TgZ(0,"form",0),t.TgZ(1,"div",1),t.TgZ(2,"h5"),t._uU(3,"Mapper File: "),t.qZA(),t.TgZ(4,"input",2),t.NdJ("change",function(a){return i.processMapperFile(a)}),t.qZA(),t.qZA(),t.qZA(),t.TgZ(5,"div",3),t.TgZ(6,"table",4),t.TgZ(7,"thead"),t.TgZ(8,"tr"),t.YNc(9,Te,3,1,"th",5),t.ALo(10,"async"),t.qZA(),t.qZA(),t.TgZ(11,"tbody"),t.YNc(12,Ae,2,1,"tr",5),t.ALo(13,"async"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(14,"app-select-item",6),t.NdJ("selectedItem$",function(a){return i.processSelectedPatientIDcolumn(a)}),t.ALo(15,"async"),t.qZA(),t.TgZ(16,"app-select-item",7),t.NdJ("selectedItem$",function(a){return i.processSelectedSampleIDColumn(a)}),t.ALo(17,"async"),t.qZA(),t.YNc(18,we,2,0,"p",8),t.ALo(19,"async")),2&e&&(t.xp6(9),t.Q6J("ngForOf",t.lcZ(10,13,i.fileHeaders$)),t.xp6(3),t.Q6J("ngForOf",t.lcZ(13,15,i.firstLines$)),t.xp6(2),t.Q6J("inputItems",t.lcZ(15,17,i.fileHeaders$))("itemLabel","Choose PatientID Column of Mapping File")("emptyNote","select clinical file first")("formInlineOrNot",!1)("ifOutputFirstValue",!1),t.xp6(2),t.Q6J("inputItems",t.lcZ(17,19,i.fileHeaders$))("itemLabel","Choose SampleID Column of Mapping File")("emptyNote","select clinical file first")("formInlineOrNot",!1)("ifOutputFirstValue",!1),t.xp6(2),t.Q6J("ngIf",t.lcZ(19,21,i.ifShowEuqalError$)))},directives:[c._Y,c.JL,c.F,d.sg,J.y,d.O5],pipes:[d.Ov,ft.K],styles:[""],changeDetection:0}),s})(),$e=(()=>{class s{constructor(){this.clinicalData$=new t.vpe,this.clinicalImportInfoSubject=new v.X(null),this.samples2patientIDsSubject=new v.X(null),this.clinicalSubmit$=new v.X(null),this.destroyNotifier$=new M.xQ}ngOnInit(){this.clinicalSubmit$.pipe((0,g.h)(e=>e),(0,w.M)(this.clinicalImportInfoSubject.pipe((0,g.h)(e=>null!=e)),this.samples2patientIDsSubject.pipe((0,g.h)(e=>null!=e)))).subscribe(([e,i,n])=>{this.clinicalData$.next({clinicalInfo:i,sample2patientID:n})})}ngAfterViewInit(){this.ifSubmitAvailable$=(0,G.aj)([this.clinicalImportInfoSubject,this.samples2patientIDsSubject]).pipe((0,_.U)(([e,i])=>!(!e||!i)),(0,O.O)(!1),(0,T.R)(this.destroyNotifier$))}ngOnDestroy(){this.destroyNotifier$.next(),this.destroyNotifier$.complete()}processClinicalImportInfo(e){this.clinicalImportInfoSubject.next(e)}processSamples2patientIDs(e){this.samples2patientIDsSubject.next(e)}submitClinicalImportInfo(e){this.clinicalSubmit$.next(!0)}}return s.\u0275fac=function(e){return new(e||s)},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-import-clinical-data"]],outputs:{clinicalData$:"clinicalData$"},decls:9,vars:3,consts:[[3,"clinicalImportInfo$"],[3,"mapperDic$"],["data-testid","submitClinical",1,"button","btn-expressvis","mt-2",3,"disabled","click"]],template:function(e,i){1&e&&(t.TgZ(0,"h4"),t._uU(1," 1. Upload Follow-up Data:\n"),t.qZA(),t.TgZ(2,"app-import-clinical-values",0),t.NdJ("clinicalImportInfo$",function(a){return i.processClinicalImportInfo(a)}),t.qZA(),t.TgZ(3,"h4"),t._uU(4," 2. Upload Mapping File of PatientID and SampleID:\n"),t.qZA(),t.TgZ(5,"app-import-mapper-file",1),t.NdJ("mapperDic$",function(a){return i.processSamples2patientIDs(a)}),t.qZA(),t.TgZ(6,"button",2),t.NdJ("click",function(a){return i.submitClinicalImportInfo(a)}),t.ALo(7,"async"),t._uU(8," Submit Follow-up and Mapping Files\n"),t.qZA()),2&e&&(t.xp6(6),t.Q6J("disabled",!t.lcZ(7,1,i.ifSubmitAvailable$)))},directives:[ye,Ce],pipes:[d.Ov],styles:[""],changeDetection:0}),s})();var Ze=r(6588);const Fe=["svgElement"];let Le=(()=>{class s{constructor(e){this.cdr=e,this._svgWidth=600,this._svgHeight=480,this._svgMarginTop=10,this._svgMarginLeft=20,this._svgMarginRight=20,this._svgTitle="Kaplan-Meier Curve",this._svgTitleHeight=40,this._svgXScaleStartIndex=40,this._svgXAxisLength=400,this._svgYAxisLength=300,this._labels=[],this._colors=["rgb(236, 84, 84)","blue","cyan","green","pink","black","red","gray","brown","green","blue","brown","violet","orange","yellow"],this._svgXTitle="Time Line",this._svgXTitleHeight=20,this._svgYTitle="Probability (%)",this._svgYTitleWidth=20,this._svgYTitleHeight=200,this._descriptionTextString="p=0.08",this._ticks=[],this._riskNumberDataSet=[]}ngOnInit(){}ngOnChanges(e){e.kmlineData&&!e.kmlineData.isFirstChange()&&this.kmlineData&&(this._removeGraphic(),this.kmlineData.length>0&&this._initMap())}ngAfterViewInit(){this.kmlineData&&this.kmlineData.length>0&&this._initMap()}_initMap(){this._setSvgAttributes(),this._setSvgEditableTitle(),this._setScale(),this._setAxis(),this._getLabels(),this._drawKmLine(),this._drawLegend(),this._setSvgEditableXTitle(),this._setSvgEditableYTitle(),this._descriptionText(),this._drawTable()}_drawTable(){const p=20*this._labels.length+20+this._svgMarginTop;this._getAxisTicks(".xAxis .tick text"),this._getRiskData(this.kmlineData,this._ticks),this._svgD3.attr("height",this._svgHeight+p);const u=this._svgD3.append("g").attr("class","tableTitleText");u.append("text").text("Number at risk").attr("width",100).attr("height",20).attr("x",2*this._svgXScaleStartIndex).attr("y",13*this._svgMarginTop+this._svgTitleHeight+this._svgYAxisLength).style("font-family","Arial").style("font-size","16px").style("font-weight","bold"),this._riskNumberDataSet.forEach((o,h)=>{u.append("text").text(this._labels[h]).attr("x",this._svgMarginLeft).attr("y",16*this._svgMarginTop+this._svgTitleHeight+this._svgYAxisLength+20*h).style("font-family","Arial").style("font-size","12px").style("font-weight","bold"),o.forEach((S,j)=>{u.append("text").text(S).attr("x",2*this._svgXScaleStartIndex+this._svgXAxisLength/(this._ticks.length-1)*j).attr("y",16*this._svgMarginTop+this._svgTitleHeight+this._svgYAxisLength+20*h).style("font-family","Arial").style("font-size","12px").style("font-weight","bold")})})}_getRiskData(e,i){const n=[];for(let a=0;a<e.length;a++){let p=[];for(let u=0;u<i.length;u++){let o=!1;for(let h=0;h<e[a].data.length;h++)if(i[u]===e[a].data[h].timeLine){p.push(e[a].data[h].riskNumber),o=!o;break}if(!o)for(let h=0;h<e[a].data.length;h++)e[a].data[h].timeLine<i[u]&&h+1<=e[a].data.length&&(h+1===e[a].data.length||e[a].data[h+1].timeLine>i[u])&&p.push(e[a].data[h].riskNumber)}n.push(p)}this._riskNumberDataSet=n}_getAxisTicks(e){const i=[];(0,m.td_)(e).each(n=>{i.push(n)}),this._ticks=i}_descriptionText(){this._svgD3.append("g").attr("class","svgDescriptionText").append("foreignObject").attr("class","descriptionTextForeignObject").attr("requiredExtension","http://www.w3.org/1990/xhtml").attr("width",300).attr("height",20).attr("x",2*this._svgXScaleStartIndex).attr("y",8*this._svgMarginTop+this._svgTitleHeight+this._svgYAxisLength).html(`<p spellcheck=false contenteditable="true" style="\n      width: 300px;\n      height: 20px;\n      outline: 0px;\n      text-align: left;\n      line-height: 20px;\n      font-family: Arial;\n      font-size: 12px;\n      font-weight: bold;\n      font-style: italic;\n    ">${"Description Information: "+this._descriptionTextString}</p>`)}_setSvgEditableYTitle(){const e=`\n      position: relative;\n      top: ${this._svgYTitleHeight/2}px;\n      left: ${-this._svgYTitleHeight+this._svgMarginLeft}px;\n      width: ${this._svgYTitleHeight}px;\n      height: ${this._svgYTitleWidth}px;\n      text-align: center;\n      line-height: ${this._svgYTitleHeight}px;\n      font-family: Arial;\n      font-size: 16px;\n      font-weight: bold;\n      transform:rotate(-90deg);\n      white-space:nowrap;\n    `;this._svgD3.append("g").attr("class","svgYTitle").append("foreignObject").attr("class","yTitleForeignObject").attr("requiredExtension","http://www.w3.org/1990/xhtml").attr("width",this._svgYTitleWidth).attr("height",this._svgYTitleHeight).attr("x",this._svgMarginLeft).attr("y",2*this._svgMarginTop+(this._svgTitleHeight+this._svgYAxisLength-this._svgYTitleHeight)/2).html(`\n      <p spellcheck=false contenteditable="true" style="${e}">${this._svgYTitle}</p>`)}_setSvgEditableXTitle(){const e=this._svgWidth-this._svgMarginLeft-this._svgMarginRight,i=`\n      width: ${e}px;\n      height: ${this._svgXTitleHeight}px;\n      text-align: center;\n      line-height: ${this._svgXTitleHeight}px;\n      font-family: Arial;\n      font-size: 16px;\n      font-weight: bold;\n    `;this._svgD3.append("g").attr("class","svgXTitle").append("foreignObject").attr("class","xTitleForeignObject").attr("requiredExtension","http://www.w3.org/1990/xhtml").attr("width",e).attr("height",this._svgXTitleHeight).attr("x",this._svgMarginLeft).attr("y",5*this._svgMarginTop+this._svgTitleHeight+this._svgYAxisLength).html(`<p spellcheck=false contenteditable="true" style="${i}">${this._svgXTitle}</p>`)}_drawLegend(){for(let p=0;p<this._labels.length;p++)this._svgD3.append("line").attr("x1",2*this._svgXScaleStartIndex+this._svgXAxisLength).attr("y1",2*this._svgMarginTop+this._svgTitleHeight+20*p).attr("x2",2*this._svgXScaleStartIndex+this._svgXAxisLength+20).attr("y2",2*this._svgMarginTop+this._svgTitleHeight+20*p).attr("stroke-width",3).attr("stroke",this._colors[p]),this._svgD3.append("text").text(this._labels[p]).attr("x",2*this._svgXScaleStartIndex+this._svgXAxisLength+20+5).attr("y",2*this._svgMarginTop+this._svgTitleHeight+20*p+3).style("font-family","Arial").style("font-size",12).style("font-weight","bold")}_drawKmLine(){this.kmlineData.forEach((e,i)=>{let n="";e.data.forEach((a,p)=>{const u=a.censored>0?(0,m.NAG)().type(m.tJO).size(60):(0,m.NAG)().type(m.JFv).size(16);this._svgD3.append("g").attr("transform",`translate(${this._svgXScale(a.timeLine)+this._svgXScaleStartIndex}, ${this._svgYScale(100*a.probability)})`).append("path").attr("d",u).attr("transform","rotate(-45)").attr("fill",this._colors[this._labels.indexOf(e.label)]).on("mousemove",()=>{this._svgD3.append("foreignObject").attr("class","info").attr("width",130).attr("height",100).html(`\n              <div style="background-color: ${this._colors[i]}; padding-left: 10px">\n              <p>\n              Label: ${e.label}<br>\n              Time Line: ${a.timeLine}<br>\n              Probability: ${a.probability.toFixed(4)}<br>\n              Obversed: ${a.obversed}<br>\n              Censored: ${a.censored}<br>\n              Number at risk: ${a.riskNumber}\n              </p>\n              </div>\n              `).attr("x",this._svgXScale(a.timeLine)-this._svgXScaleStartIndex).attr("y",this._svgYScale(100*a.probability-2)).attr("color","white").style("font-size",12).style("font-weight","bold")}).on("mouseout",()=>{(0,m.td_)(".info").remove()}),n+=0===p?`M ${this._svgXScale(a.timeLine)+this._svgXScaleStartIndex} ${this._svgYScale(100*a.probability)} `:`L ${this._svgXScale(a.timeLine)+this._svgXScaleStartIndex} ${this._svgYScale(100*this.kmlineData[i].data[p-1].probability)} L ${this._svgXScale(a.timeLine)+this._svgXScaleStartIndex} ${this._svgYScale(100*a.probability)} `}),this._svgD3.append("path").attr("d",n).attr("stroke",this._colors[i]).attr("fill","none").attr("stroke-width",3)})}_getLabels(){const e=[];this.kmlineData.forEach(i=>{e.push(i.label)}),this._labels=e}_setAxis(){const e=(0,m.LLu)(this._svgXScale),i=(0,m.y4O)(this._svgYScale);this._svgD3.append("g").call(e).attr("class","xAxis").attr("transform",`translate(${this._svgXScaleStartIndex}, ${2*this._svgMarginTop+this._svgTitleHeight+this._svgYAxisLength})`).attr("stroke-width",2),this._svgD3.append("g").call(i).attr("class","yAxis").attr("transform",`translate(${2*this._svgXScaleStartIndex}, 0)`).attr("stroke-width",2),(0,m.td_)(".tick text").style("font-family","Arial").style("font-weight","bold").style("font-size","12px")}_setScale(){this._svgXScale=(0,m.BYU)(),this._svgYScale=(0,m.BYU)(),this._svgXScale.domain(this._getTimeLineRange()).range([this._svgXScaleStartIndex,this._svgXScaleStartIndex+this._svgXAxisLength]).nice(),this._svgYScale.domain([0,100].reverse()).range([2*this._svgMarginTop+this._svgTitleHeight,2*this._svgMarginTop+this._svgTitleHeight+this._svgYAxisLength]).nice()}_getTimeLineRange(){const e=[],i=[];return this.kmlineData.map(p=>{e.push(parseFloat((0,m.VV$)(p.data,u=>u.timeLine)+"")),i.push(parseFloat((0,m.Fp7)(p.data,u=>u.timeLine)+""))}),[parseFloat((0,m.VV$)(e,p=>p)+""),parseFloat((0,m.Fp7)(i,p=>p)+"")]}_setSvgEditableTitle(){const e=this._svgWidth-this._svgMarginLeft-this._svgMarginRight,i=`\n      width: ${e}px;\n      height: ${this._svgTitleHeight}px;\n\n      text-align: center;\n      line-height: ${this._svgTitleHeight}px;\n      font-family: Arial;\n      font-size: 20px;\n      font-weight: bold;\n    `;this._svgD3.append("g").attr("class","svgTitle").append("foreignObject").attr("class","titleForeignObject").attr("requiredExtension","http://www.w3.org/1990/xhtml").attr("width",e).attr("height",this._svgTitleHeight).attr("x",this._svgMarginLeft).attr("y",this._svgMarginTop).html(`<p spellcheck=false contenteditable="true" style="${i}">${this._svgTitle}</p>`)}_setSvgAttributes(){this._svgD3=(0,m.Ys)(this.svgElement.nativeElement),this._svgD3.attr("width",this._svgWidth).attr("height",this._svgHeight).style("border","1px solid black")}_removeGraphic(){this._svgD3&&this._svgD3.selectAll("*").remove()}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(t.sBO))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-d3-kmline-plot"]],viewQuery:function(e,i){if(1&e&&t.Gf(Fe,7),2&e){let n;t.iGM(n=t.CRH())&&(i.svgElement=n.first)}},inputs:{kmlineData:"kmlineData"},features:[t.TTD],decls:2,vars:0,consts:[["svgElement",""]],template:function(e,i){1&e&&(t.O4$(),t._UZ(0,"svg",null,0))},styles:[""],changeDetection:0}),s})(),Ne=(()=>{class s{constructor(){this.closeSignal$=new t.vpe}ngOnInit(){this._obtainKMlineData(),this._obtainGeneInfo()}ngOnChanges(e){e.oneGeneClinicalInfo&&!e.oneGeneClinicalInfo.isFirstChange()&&(this._obtainKMlineData(),this._obtainGeneInfo())}closeModalForOneGeneClinicalInfo(e){this.closeSignal$.next(!0)}_obtainKMlineData(){var e;this.oneGeneClinicalInfo&&(this.kmLineData=[...null===(e=this.oneGeneClinicalInfo)||void 0===e?void 0:e.KMlineDataInfos])}_obtainGeneInfo(){var e;this.oneGeneClinicalInfo&&(this.geneInfo=Object.assign({},null===(e=this.oneGeneClinicalInfo)||void 0===e?void 0:e.geneInfo))}}return s.\u0275fac=function(e){return new(e||s)},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-display-one-gene-clinical-info"]],inputs:{oneGeneClinicalInfo:"oneGeneClinicalInfo"},outputs:{closeSignal$:"closeSignal$"},features:[t.TTD],decls:9,vars:2,consts:[[2,"height","1rem"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"pr-3","pl-3"],[1,"p-3"],[3,"kmlineData"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"button",1),t.NdJ("click",function(a){return i.closeModalForOneGeneClinicalInfo(a)}),t.TgZ(2,"span",2),t._uU(3,"\xd7"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(4,"div",3),t.TgZ(5,"p"),t._uU(6),t.qZA(),t.qZA(),t.TgZ(7,"div",4),t._UZ(8,"app-d3-kmline-plot",5),t.qZA()),2&e&&(t.xp6(6),t.hij("SYMBOL: ",null==i.geneInfo?null:i.geneInfo.SYMBOL,""),t.xp6(2),t.Q6J("kmlineData",i.kmLineData))},directives:[Le],styles:[""],changeDetection:0}),s})();const Me=["inputGeneListComponent"],Ge=["importClinicalData"];function Oe(s,l){if(1&s){const e=t.EpF();t.TgZ(0,"div",17),t.TgZ(1,"div",18),t.TgZ(2,"app-try-sample",19),t.NdJ("sampleForTryName$",function(n){return t.CHM(e),t.oxw().processTrySampleFileName(n)})("sampleForImportName$",function(n){return t.CHM(e),t.oxw().processDownloadSampleData(n)})("closeMe$",function(n){return t.CHM(e),t.oxw().closeTrySampleComponent(n)}),t.ALo(3,"async"),t.qZA(),t.qZA(),t.qZA()}if(2&s){const e=t.oxw();t.xp6(2),t.Q6J("fileInfos",e.trySamplesInfos)("trySamplePercentage",t.lcZ(3,2,e.trySamplePercentage$))}}function qe(s,l){1&s&&(t.TgZ(0,"p",28),t._uU(1," Success: The follow-up data has been successfully loaded. Close the modal and go back to the main page "),t.qZA())}function He(s,l){if(1&s){const e=t.EpF();t.TgZ(0,"div",20),t.TgZ(1,"button",21),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return null==n.importClinicalModalRef?null:n.importClinicalModalRef.hide()}),t.TgZ(2,"span",22),t._uU(3,"\xd7"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(4,"div",23),t.TgZ(5,"app-import-clinical-data",24),t.NdJ("clinicalData$",function(n){return t.CHM(e),t.oxw().processClinicalData(n)}),t.qZA(),t.qZA(),t.TgZ(6,"div",25),t.YNc(7,qe,2,0,"p",26),t.ALo(8,"async"),t.TgZ(9,"button",27),t.NdJ("click",function(){return t.CHM(e),t.oxw().importClinicalModalRef.hide()}),t._uU(10," close "),t.qZA(),t.qZA()}if(2&s){const e=t.oxw();t.xp6(7),t.Q6J("ngIf",t.lcZ(8,1,e.ifShowClinicalSuccessNote$))}}function je(s,l){if(1&s){const e=t.EpF();t.TgZ(0,"div",20),t.TgZ(1,"h3"),t._uU(2,"Generate a New Gene List"),t.qZA(),t.TgZ(3,"button",21),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return null==n.inputGenelistModalRef?null:n.inputGenelistModalRef.hide()}),t.TgZ(4,"span",22),t._uU(5,"\xd7"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(6,"div",23),t.TgZ(7,"app-generate-new-gene-list",29),t.NdJ("outputGeneList$",function(n){return t.CHM(e),t.oxw().processInputGeneList(n)})("annotationTermsRequest$",function(n){return t.CHM(e),t.oxw().processAnnotationTermsRequest(n)})("annotationGenesRequest$",function(n){return t.CHM(e),t.oxw().processAnnotationGenesRequest(n)})("geneListFromDatasetRequest$",function(n){return t.CHM(e),t.oxw().processGeneListFromDatasetRequest(n)}),t.ALo(8,"async"),t.ALo(9,"async"),t.ALo(10,"async"),t.ALo(11,"async"),t.ALo(12,"async"),t.ALo(13,"async"),t.qZA(),t.qZA(),t.TgZ(14,"div",25),t.TgZ(15,"button",30),t.NdJ("click",function(){return t.CHM(e),t.oxw().inputGenelistModalRef.hide()}),t._uU(16,"close"),t.qZA(),t.qZA()}if(2&s){const e=t.oxw();t.xp6(7),t.Q6J("availableSpecies",t.lcZ(8,6,e.availableSpecies$))("availableGeneIDtypes",t.lcZ(9,8,e.availableGeneIDtypes$))("annotationTerms",t.lcZ(10,10,e.annotationTerms$))("allDatasetInfoForDisplay",t.lcZ(11,12,e.allDatasetInfoForDisplay$))("geneNumberAfterFilter",t.lcZ(12,14,e.geneNumberAfterFilter$))("latestAddedGeneListID",t.lcZ(13,16,e.latestAddedGenelistName$))}}function Ee(s,l){if(1&s){const e=t.EpF();t.TgZ(0,"app-display-one-gene-clinical-info",31),t.NdJ("closeSignal$",function(n){return t.CHM(e),t.oxw().closeModalForOneGeneClinicalInfo(n)}),t.ALo(1,"async"),t.qZA()}if(2&s){const e=t.oxw();t.Q6J("oneGeneClinicalInfo",t.lcZ(1,1,e.oneGeneClinicalInfo$))}}const Re=[{path:"",component:(()=>{class s{constructor(e,i,n){this.facade=e,this.modalService=i,this.cdr=n,this.trySamplesInfos=[{fileForTry:"ProteomicsSurvivalExp.json.gz",fileForImport:"proteomics with clinical.zip",description:"Proteomics data"}],this.allDatasetInfoForDisplay$=this.facade.allDatasetInfoForDisplay$.pipe((0,bt.d)(4)),this.availableGeneListNames$=this.facade.availableGeneListNames$,this.clinicalAttributes$=this.facade.clinicalAttributes$,this.availableStatusValues$=this.facade.availableStatusValues$,this.datasetGroupNames$=this.facade.datasetGroupNames$,this.datasetGeneListSurvivalAnno$=this.facade.datasetGeneListSurvivalAnno$,this.trySamplePercentage$=this.facade.trySamplePercentage$,this.ifShowTrySampleComponent=!0,this.latestAddedGenelistName$=this.facade.latestAddedGenelistName$,this.annotationTerms$=this.facade.annotationTerms$,this.geneNumberAfterFilter$=this.facade.geneNumberAfterFilter$,this.oneGeneClinicalInfo$=this.facade.KMlineDataInfoForPlot$,this.ifShowOneGeneClinicalInfo=!1,this.allAvailableGeneIDtypes=tt.k1,this.allAvailableSpecies=tt.it,this.datasetIDSubject=new v.X(null),this.clinicalDataSubject=new v.X(null)}ngOnInit(){this.allSurvivalResultIDs$=this.facade.allSurvivalResultIDs$.pipe((0,g.h)(Boolean),(0,_.U)(e=>e.reverse())),this.ifShowImportClinical$=this.facade.ifSelectedDatasetHasClinical$.pipe((0,_.U)(e=>!e),(0,O.O)(!1)),this.availableSpecies$=this.datasetIDSubject.pipe((0,w.M)(this.allDatasetInfoForDisplay$),(0,_.U)(([e,i])=>{if(e&&i){let n;for(let p of i)if(p.datasetID===e){n=p.speciesID;break}let a=[];for(const p of this.allAvailableSpecies)p.taxID===n&&a.push(p);return a}return this.allAvailableSpecies})),this.availableGeneIDtypes$=this.datasetIDSubject.pipe((0,w.M)(this.allDatasetInfoForDisplay$),(0,_.U)(([e,i])=>{if(e&&i){let n,a;for(let u of i)if(u.datasetID===e){n=u.IDtype;break}for(const u of this.allAvailableGeneIDtypes)if(u.name===n){a=u;break}return[a,{name:"SYMBOL",description:"Gene Symbol"}]}return this.allAvailableGeneIDtypes})),this.clinicalDataSubject.pipe((0,g.h)(e=>null!=e),(0,w.M)(this.datasetIDSubject)).subscribe(([e,i])=>{const n=Object.assign(Object.assign({},e),{datasetID:i});this.facade.updateDatasetClinicalInfo(n)}),this.ifShowClinicalSuccessNote$=(0,G.aj)([this.facade.latestDatasetIDhasClinical$.pipe((0,g.h)(Boolean)),this.datasetIDSubject.pipe((0,g.h)(Boolean))]).pipe((0,_.U)(([e,i])=>e===i))}processSelectedDataset(e){this.datasetIDSubject.next(e),this.facade.processSelectedDatasetID(e)}processImportClinicalDataSignal(e){this.importClinicalModalRef=this.modalService.show(this.importClinicalData),this.cdr.detectChanges()}processSelectedStatusAttribute(e){this.facade.retrieveStatusValuesFromStore(e)}processClinicalData(e){this.clinicalDataSubject.next(e)}processInputGeneListSignal(e){this.inputGenelistModalRef=this.modalService.show(this.inputGeneListComponent),this.cdr.detectChanges()}processInputGeneList(e){this.facade.addGeneListToTheStore(e)}processAnnotationTermsRequest(e){this.facade.requestAnnotationTerms(e)}processAnnotationGenesRequest(e){this.facade.requestAnnotationGenes(e)}processGeneListFromDatasetRequest(e){this.facade.processNewGeneListFromDatasetRequest(e)}processDatasetGenelistSurvivalRequest(e){this.facade.requestDatasetGeneListSurvivalInfo(e)}processSelectedResultID(e){this.facade.requestSurvivalInfoFromStore(e)}processSelectedGeneForKMplot(e){this.facade.requestKMinfoForPlotOfOneGene(e),this.ifShowOneGeneClinicalInfo=!0}closeModalForOneGeneClinicalInfo(e){this.ifShowOneGeneClinicalInfo=!1}processTrySampleFileName(e){this.facade.prepareTrySampleData(e)}closeTrySampleComponent(e){this.ifShowTrySampleComponent=!1}processDownloadProjectSignal(e){this.facade.downloadProjectSignal()}processDownloadSampleData(e){this.facade.downloadSampleData(e)}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(ut),t.Y36(A.tT),t.Y36(t.sBO))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-survival-exp"]],viewQuery:function(e,i){if(1&e&&(t.Gf(Me,5,t.Rgc),t.Gf(Ge,5,t.Rgc)),2&e){let n;t.iGM(n=t.CRH())&&(i.inputGeneListComponent=n.first),t.iGM(n=t.CRH())&&(i.importClinicalData=n.first)}},decls:29,vars:30,consts:[[1,"row","flex-xl-nowrap"],[1,"col-12","col-md-3","col-xl-2","border"],[1,"mt-4"],[1,"sidebar"],[3,"allDatasetInfoForDisplay","ifShowImportClinical","clinicalAttributes","availableStatusValues","groupNames","availableGeneListNames","inputGeneListSignal$","importClinicalSingal$","selectedDatasetID$","selectedStatusAttribute$","survivalAnalysisequest$"],[1,"col-12","col-md-9","col-xl-10","mt-2"],["class","row border",4,"ngIf"],[1,"row","mt-2","border"],[1,"col-12"],[3,"inputItems","itemLabel","emptyNote","formInlineOrNot","ifOutputFirstValue","selectedItem$"],[1,"row","mt-2"],[3,"survivalAnno","selectedGeneForKMplot$"],[1,"row","mt-4"],[3,"downloadProjectSignal$"],["importClinicalData",""],["inputGeneListComponent",""],["cdkDrag","","class","moveFreeDiv border p-2",3,"oneGeneClinicalInfo","closeSignal$",4,"ngIf"],[1,"row","border"],[1,"col-12","p-1"],[3,"fileInfos","trySamplePercentage","sampleForTryName$","sampleForImportName$","closeMe$"],[1,"modal-header"],["type","button","aria-label","Close",1,"btn-close","close","pull-right",3,"click"],["aria-hidden","true",1,"visually-hidden"],[1,"modal-body"],[3,"clinicalData$"],[1,"modal-footer"],["class","text-success","data-testid","clinicalSuccessNote",4,"ngIf"],["data-testid","closeClinicalImport","type","button",1,"btn","btn-default",3,"click"],["data-testid","clinicalSuccessNote",1,"text-success"],[3,"availableSpecies","availableGeneIDtypes","annotationTerms","allDatasetInfoForDisplay","geneNumberAfterFilter","latestAddedGeneListID","outputGeneList$","annotationTermsRequest$","annotationGenesRequest$","geneListFromDatasetRequest$"],["data-testid","closeGeneListInput","type","button",1,"btn","btn-default","btn-sm",3,"click"],["cdkDrag","",1,"moveFreeDiv","border","p-2",3,"oneGeneClinicalInfo","closeSignal$"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"h3",2),t._uU(3,"Generate a New Survival Analysis"),t.qZA(),t.TgZ(4,"div",3),t.TgZ(5,"app-generate-new-survival-analysis",4),t.NdJ("inputGeneListSignal$",function(a){return i.processInputGeneListSignal(a)})("importClinicalSingal$",function(a){return i.processImportClinicalDataSignal(a)})("selectedDatasetID$",function(a){return i.processSelectedDataset(a)})("selectedStatusAttribute$",function(a){return i.processSelectedStatusAttribute(a)})("survivalAnalysisequest$",function(a){return i.processDatasetGenelistSurvivalRequest(a)}),t.ALo(6,"async"),t.ALo(7,"async"),t.ALo(8,"async"),t.ALo(9,"async"),t.ALo(10,"async"),t.ALo(11,"async"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(12,"div",5),t.YNc(13,Oe,4,4,"div",6),t.TgZ(14,"div",7),t.TgZ(15,"div",8),t.TgZ(16,"app-select-item",9),t.NdJ("selectedItem$",function(a){return i.processSelectedResultID(a)}),t.ALo(17,"async"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(18,"div",10),t.TgZ(19,"div",8),t.TgZ(20,"app-display-survival-analysis-results",11),t.NdJ("selectedGeneForKMplot$",function(a){return i.processSelectedGeneForKMplot(a)}),t.ALo(21,"async"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(22,"div",12),t.TgZ(23,"app-download-project",13),t.NdJ("downloadProjectSignal$",function(a){return i.processDownloadProjectSignal(a)}),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.YNc(24,He,11,3,"ng-template",null,14,t.W1O),t.YNc(26,je,17,18,"ng-template",null,15,t.W1O),t.YNc(28,Ee,2,3,"app-display-one-gene-clinical-info",16)),2&e&&(t.xp6(5),t.Q6J("allDatasetInfoForDisplay",t.lcZ(6,14,i.allDatasetInfoForDisplay$))("ifShowImportClinical",t.lcZ(7,16,i.ifShowImportClinical$))("clinicalAttributes",t.lcZ(8,18,i.clinicalAttributes$))("availableStatusValues",t.lcZ(9,20,i.availableStatusValues$))("groupNames",t.lcZ(10,22,i.datasetGroupNames$))("availableGeneListNames",t.lcZ(11,24,i.availableGeneListNames$)),t.xp6(8),t.Q6J("ngIf",i.ifShowTrySampleComponent),t.xp6(3),t.Q6J("inputItems",t.lcZ(17,26,i.allSurvivalResultIDs$))("itemLabel","Available Survival Analysis")("emptyNote","Generate a survival analysis in the left sidebar")("formInlineOrNot",!0)("ifOutputFirstValue",!0),t.xp6(4),t.Q6J("survivalAnno",t.lcZ(21,28,i.datasetGeneListSurvivalAnno$)),t.xp6(8),t.Q6J("ngIf",i.ifShowOneGeneClinicalInfo))},directives:[ie,d.O5,J.y,me,fe.E,_e.P,$e,Ze.D,Ne,Z.Zt],pipes:[d.Ov],styles:[".sidebar[_ngcontent-%COMP%]{position:-webkit-sticky;position:sticky;top:1rem;max-height:calc(100vh - 4rem);margin-right:-1rem;overflow-x:hidden;overflow-y:auto}"]}),s})()}];let Pe=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({imports:[[R.Bz.forChild(Re)],R.Bz]}),s})(),Ye=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({providers:[ut],imports:[[d.ez,c.u5,c.UX,A.zk.forRoot(),Z._t,F.m,E.D,I.f,Pe]]}),s})()},277:(W,N,r)=>{r.d(N,{Y:()=>Z});var d=r(3668);const c={asc:"desc",desc:"","":"asc"};let Z=(()=>{class A{constructor(I,F){this.renderer=I,this.el=F,this.sortableColumn="",this.direction="",this.sort=new d.vpe}rotate(){const I=this.el.nativeElement;this.direction&&this.renderer.removeClass(I,this.direction),this.direction=c[this.direction],this.direction&&this.renderer.addClass(I,this.direction),this.sort.emit({column:this.sortableColumn,direction:this.direction})}}return A.\u0275fac=function(I){return new(I||A)(d.Y36(d.Qsj),d.Y36(d.SBq))},A.\u0275dir=d.lG2({type:A,selectors:[["th","sortable",""]],hostVars:4,hostBindings:function(I,F){1&I&&d.NdJ("click",function(){return F.rotate()}),2&I&&d.ekj("asc","asc"===F.direction)("desc","desc"===F.direction)},inputs:{sortableColumn:"sortableColumn",direction:"direction"},outputs:{sort:"sort"}}),A})()}}]);