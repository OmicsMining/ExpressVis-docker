"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[32],{3063:(F,P,h)=>{h.d(P,{Q8:()=>i}),h(5139);var c=h(3668);h(3314),h(3405),h(5686);let y=(()=>{class o{create(s){return"undefined"==typeof MutationObserver?null:new MutationObserver(s)}}return o.\u0275fac=function(s){return new(s||o)},o.\u0275prov=(0,c.Yz7)({factory:function(){return new o},token:o,providedIn:"root"}),o})(),i=(()=>{class o{}return o.\u0275fac=function(s){return new(s||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({providers:[y]}),o})()},7582:(F,P,h)=>{h.d(P,{q:()=>e});const e=(c,T)=>c<T?-1:c>T?1:0},8779:(F,P,h)=>{h.d(P,{g:()=>i});var e=h(4522),c=h(172),T=h(540),I=h(8053),C=h(8735),y=h(2047),x=h(8260),v=h(3668);let i=(()=>{class o{constructor(s){this.http=s,this.enrichUrl=x.N.serverUrl+"restful/enrichment/pathway/"}handleResponse(s){return s.type===e.dt.Response?s.body:c.E}requestGenesEnrichedAnnotations(s){const r=new e.aW("POST",this.enrichUrl,s,{reportProgress:!1,responseType:"json"});return this.http.request(r).pipe((0,I.U)(u=>this.handleResponse(u)),(0,C.h)(u=>u!==c.E),(0,I.U)(u=>u),(0,y.K)(u=>(0,T._)(u)))}}return o.\u0275fac=function(s){return new(s||o)(v.LFG(e.eN))},o.\u0275prov=v.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})()},4250:(F,P,h)=>{h.d(P,{u:()=>s});var e=h(3668),c=h(9133),T=h(5043),I=h(5686),C=h(5389),y=h(8053),x=h(6019),v=h(3856),i=h(8638);function o(r,u){if(1&r&&(e.TgZ(0,"option",22),e._uU(1),e.qZA()),2&r){const m=u.$implicit;e.Q6J("value",m),e.xp6(1),e.hij(" ",m," ")}}function p(r,u){if(1&r){const m=e.EpF();e.TgZ(0,"div",9),e.TgZ(1,"div",10),e.TgZ(2,"select",11),e.YNc(3,o,2,2,"option",12),e.qZA(),e.TgZ(4,"select",13),e.TgZ(5,"option",14),e._uU(6,"contains"),e.qZA(),e.TgZ(7,"option",15),e._uU(8,"does not contain"),e.qZA(),e.TgZ(9,"option",16),e._uU(10,"is"),e.qZA(),e.TgZ(11,"option",17),e._uU(12,"is not"),e.qZA(),e.TgZ(13,"option",18),e._uU(14,"is up"),e.qZA(),e.TgZ(15,"option",19),e._uU(16,"is down"),e.qZA(),e.qZA(),e._UZ(17,"input",20),e.TgZ(18,"fa-icon",21),e.NdJ("click",function(){const f=e.CHM(m).index;return e.oxw().removeFilterStep(f)}),e.qZA(),e.qZA(),e.qZA()}if(2&r){const m=u.index,d=e.oxw();e.Q6J("formGroupName",m),e.xp6(3),e.Q6J("ngForOf",d.dataAttributes),e.xp6(15),e.Q6J("icon",d.faMinusCircle)("size","1x")}}let s=(()=>{class r{constructor(m){this.formBuilder=m,this.filterStepsInfo$=new e.vpe,this.faPlusCircle=T.KtF,this.faMinusCircle=T.uMC,this.filterStepsForm=this.formBuilder.group({filterSteps:this.formBuilder.array([this._createFilterStepFormGroup()]),matchType:new c.NI("and")})}ngOnInit(){this.filterStepsSubscription=this.filterStepsForm.valueChanges.pipe((0,I.b)(500),(0,C.x)(),(0,y.U)(m=>{const d=m.filterSteps.filter(_=>_.attribute&&_.filterValue);return{matchType:m.matchType,filterSteps:d}}),(0,C.x)((m,d)=>JSON.stringify(m)===JSON.stringify(d))).subscribe(m=>{this.filterStepsInfo$.next(m)})}ngOnDestroy(){this.filterStepsSubscription.unsubscribe()}addFilterStepFormGroup(){this.filterStepsForm.get("filterSteps").push(this._createFilterStepFormGroup())}removeFilterStep(m){this.filterStepsForm.get("filterSteps").removeAt(m)}_createFilterStepFormGroup(){return new c.cw({attribute:new c.NI("",c.kI.required),filterType:new c.NI("contain"),filterValue:new c.NI("",c.kI.required)})}}return r.\u0275fac=function(m){return new(m||r)(e.Y36(c.qu))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-define-filter-steps"]],inputs:{dataAttributes:"dataAttributes"},outputs:{filterStepsInfo$:"filterStepsInfo$"},decls:12,vars:5,consts:[[3,"formGroup"],["formArrayName","filterSteps"],[1,"mb-1"],[1,"form-inline"],[1,"form-control","form-control-sm",3,"formControl"],["value","and"],["value","or"],[3,"formGroupName",4,"ngFor","ngForOf"],["ngbTooltip","add a filter step",1,"hoverBigger","mt-1","ml-1",3,"icon","size","click"],[3,"formGroupName"],[1,"form-inline","form-group-sm"],["formControlName","attribute","data-testid","selectAttribute",1,"form-control","form-control-sm",2,"width","6rem"],[3,"value",4,"ngFor","ngForOf"],["formControlName","filterType",1,"form-control","form-control-sm",2,"width","8rem"],["value","contain"],["value","notContain"],["value","is"],["value","isNot"],["value","up"],["value","down"],["formControlName","filterValue","type","text","data-testid","inputFilterValue",1,"form-control","form-control-sm",2,"width","5rem"],["ngbTooltip","Delete a filter step",1,"ml-1","hoverBigger",3,"icon","size","click"],[3,"value"]],template:function(m,d){1&m&&(e.TgZ(0,"form",0),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e.TgZ(3,"form",3),e.TgZ(4,"select",4),e.TgZ(5,"option",5),e._uU(6,"Match all (AND)"),e.qZA(),e.TgZ(7,"option",6),e._uU(8,"Match any (OR)"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.YNc(9,p,19,4,"div",7),e.qZA(),e.qZA(),e.TgZ(10,"div",3),e.TgZ(11,"fa-icon",8),e.NdJ("click",function(){return d.addFilterStepFormGroup()}),e.qZA(),e.qZA()),2&m&&(e.Q6J("formGroup",d.filterStepsForm),e.xp6(4),e.Q6J("formControl",d.filterStepsForm.get("matchType")),e.xp6(5),e.Q6J("ngForOf",d.filterStepsForm.get("filterSteps").controls),e.xp6(2),e.Q6J("icon",d.faPlusCircle)("size","1x"))},directives:[c._Y,c.JL,c.sg,c.CE,c.F,c.EJ,c.JJ,c.oH,c.YN,c.Kr,x.sg,v.BN,i._L,c.x0,c.u,c.Fj],styles:[""],changeDetection:0}),r})()},8200:(F,P,h)=>{h.d(P,{r:()=>te});var e=h(3668),c=h(5043),T=h(6019),I=h(7582),C=h(277),y=h(8638),x=h(9133),v=h(3856);function i(a,b){if(1&a){const t=e.EpF();e.TgZ(0,"th",9),e.NdJ("sort",function(l){return e.CHM(t),e.oxw().onSort(l)}),e._uU(1),e.qZA()}if(2&a){const t=b.$implicit;e.s9C("sortableColumn",t),e.xp6(1),e.hij(" ",t," ")}}function o(a,b){if(1&a&&(e.TgZ(0,"td",15),e._uU(1),e.qZA()),2&a){const t=b.$implicit;e.s9C("title",t),e.xp6(1),e.hij(" ",t," ")}}const p=function(a){return{"background-color":a}};function s(a,b){if(1&a){const t=e.EpF();e.TgZ(0,"tr",10),e.TgZ(1,"td",11),e.NdJ("click",function(){const g=e.CHM(t).index;return e.oxw().processSelectedAnnotation(g)}),e.TgZ(2,"div",12),e._UZ(3,"fa-icon",13),e.qZA(),e.qZA(),e.YNc(4,o,2,2,"td",14),e.TgZ(5,"td",11),e.NdJ("click",function(){const g=e.CHM(t).index;return e.oxw().processSelectedAnnotation(g)}),e.TgZ(6,"div",12),e._UZ(7,"fa-icon",13),e.qZA(),e.qZA(),e.qZA()}if(2&a){const t=b.$implicit,n=b.index,l=e.oxw();e.Q6J("ngStyle",e.VKq(6,p,l.clickedIndex==n?"lightskyblue":"white")),e.xp6(3),e.Q6J("icon",l.faTable)("size","1x"),e.xp6(1),e.Q6J("ngForOf",t),e.xp6(3),e.Q6J("icon",l.faTable)("size","1x")}}let r=(()=>{class a{constructor(t){this.cdr=t,this.selectedAnnotationTermGenes$=new e.vpe,this.annotationTermOrder=1,this.annotationIDOrder=0,this.annotationGenesOrder=-1,this.genesSplitRe=new RegExp(";|,"),this.page=1,this.pageSize=5,this.faTable=c.B3e,this.faArrowUp=c.FPD,this.faArrowDown=c.r5q}ngOnInit(){this.enrichedAnnotationsInfo&&(this._initDataForTable(),this.refreshSubEnrichedValues())}ngOnChanges(t){t.enrichedAnnotationsInfo&&!t.enrichedAnnotationsInfo.isFirstChange()&&(this._initDataForTable(),this.refreshSubEnrichedValues(),this.cdr.detectChanges())}_initDataForTable(){this.annotationGenesOrder=this.enrichedAnnotationsInfo.headers.length-1,this.enrichedValues=this.enrichedAnnotationsInfo.enrichedValues,this.headerNames=this.enrichedAnnotationsInfo.headers,this.collectionSize=this.enrichedValues.length}refreshSubEnrichedValues(){this._obtainSubEnrichedValues(),this._obtainCickedIndex(),this.cdr.detectChanges()}processSelectedAnnotation(t){const n=this.enrichedAnnotationsInfo.enrichedValues[t],l=n[this.annotationTermOrder],g=n[this.annotationGenesOrder].trim().split(this.genesSplitRe);this.selectedAnnotationTermGenes$.next({annotationID:n[this.annotationIDOrder],annotationTerm:l,genes:g}),this.clickedIndex=t,this.clickedAnnotationID=this.subEnrichedValues[t][0],this.cdr.detectChanges()}onSort({column:t,direction:n}){if(this.headers.forEach(l=>{l.sortableColumn!==t&&(l.direction="")}),""!=n||""!=t){const l=this.headerNames.indexOf(t);this.enrichedValues=[...this.enrichedValues].sort((g,E)=>{const Z=(0,I.q)(g[l],E[l]);return"asc"===n?Z:-Z}),this.refreshSubEnrichedValues()}}_obtainCickedIndex(){this.clickedIndex=null;for(let t=0;t<this.subEnrichedValues.length;t++)if(this.subEnrichedValues[t][0]===this.clickedAnnotationID){this.clickedIndex=t;break}}_obtainSubEnrichedValues(){this.subEnrichedValues=this.enrichedValues.slice((this.page-1)*this.pageSize,(this.page-1)*this.pageSize+this.pageSize)}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(e.sBO))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-enriched-annotations-table-pagination"]],viewQuery:function(t,n){if(1&t&&e.Gf(C.Y,5),2&t){let l;e.iGM(l=e.CRH())&&(n.headers=l)}},inputs:{enrichedAnnotationsInfo:"enrichedAnnotationsInfo"},outputs:{selectedAnnotationTermGenes$:"selectedAnnotationTermGenes$"},features:[e.TTD],decls:20,vars:11,consts:[[1,"table-responsive","border",2,"margin-left","10px","margin-right","10px"],[1,"table","table-striped"],["sortable","",3,"sortableColumn","sort",4,"ngFor","ngForOf"],[3,"ngStyle",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-between","align-items-center","p-2"],["data-testid","annotationTermsNum"],[3,"collectionSize","page","pageSize","maxSize","pageChange"],[1,"custom-select","mb-3",2,"width","auto",3,"ngModel","ngModelChange"],[3,"ngValue"],["sortable","",3,"sortableColumn","sort"],[3,"ngStyle"],[3,"click"],[1,"form-inline"],["ngbTooltip","Click to Show Genes in this Annotation Term",1,"hoverBigger",3,"icon","size"],[3,"title",4,"ngFor","ngForOf"],[3,"title"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"table",1),e.TgZ(2,"thead"),e.TgZ(3,"tr"),e._UZ(4,"th"),e.YNc(5,i,2,2,"th",2),e._UZ(6,"th"),e.qZA(),e.qZA(),e.TgZ(7,"tbody"),e.YNc(8,s,8,8,"tr",3),e.qZA(),e.qZA(),e.qZA(),e.TgZ(9,"div",4),e.TgZ(10,"p",5),e._uU(11),e.qZA(),e.TgZ(12,"ngb-pagination",6),e.NdJ("pageChange",function(g){return n.page=g})("pageChange",function(){return n.refreshSubEnrichedValues()}),e.qZA(),e.TgZ(13,"select",7),e.NdJ("ngModelChange",function(g){return n.pageSize=g})("ngModelChange",function(){return n.refreshSubEnrichedValues()}),e.TgZ(14,"option",8),e._uU(15,"5 per page"),e.qZA(),e.TgZ(16,"option",8),e._uU(17,"10 per page"),e.qZA(),e.TgZ(18,"option",8),e._uU(19,"20 per page"),e.qZA(),e.qZA(),e.qZA()),2&t&&(e.xp6(5),e.Q6J("ngForOf",n.enrichedAnnotationsInfo.headers),e.xp6(3),e.Q6J("ngForOf",n.subEnrichedValues),e.xp6(3),e.hij(" ",n.collectionSize," Terms "),e.xp6(1),e.Q6J("collectionSize",n.collectionSize)("page",n.page)("pageSize",n.pageSize)("maxSize",5),e.xp6(1),e.Q6J("ngModel",n.pageSize),e.xp6(1),e.Q6J("ngValue",5),e.xp6(2),e.Q6J("ngValue",10),e.xp6(2),e.Q6J("ngValue",20))},directives:[T.sg,y.N9,x.EJ,x.JJ,x.On,x.YN,x.Kr,C.Y,T.PC,v.BN,y._L],styles:["table[_ngcontent-%COMP%]{border-collapse:collapse;display:block}thead[_ngcontent-%COMP%]{text-align:center}thead[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]{text-align:center;display:block}tbody[_ngcontent-%COMP%]{text-align:center;overflow-y:scroll;overflow-x:hidden}td[_ngcontent-%COMP%], th[_ngcontent-%COMP%]{text-align:left;height:2em;overflow:hidden;white-space:nowrap}"],changeDetection:0}),a})();var u=h(7682),m=h(5479),d=h(6872);function _(a,b){if(1&a){const t=e.EpF();e.TgZ(0,"div",3),e.TgZ(1,"input",4),e.NdJ("click",function(){const g=e.CHM(t).index;return e.oxw().toggleItem(g)}),e.qZA(),e.TgZ(2,"label"),e._uU(3),e.ALo(4,"trimString"),e.qZA(),e.qZA()}if(2&a){const t=b.$implicit,n=b.index,l=e.oxw();e.s9C("title",t),e.xp6(1),e.Q6J("checked",l.selectedItemsIndexSet.has(n)),e.xp6(2),e.Oqu(e.xi3(4,3,t,20))}}let f=(()=>{class a{constructor(){this.selectedItems$=new e.vpe,this.selectedItemsIndexSet=new Set([])}ngOnInit(){this.items&&this._generateInitialIndexSet()}ngOnChanges(t){t.items&&!t.items.isFirstChange()&&this._generateInitialIndexSet()}toggleItem(t){this.selectedItemsIndexSet.has(t)?this.selectedItemsIndexSet.delete(t):this.selectedItemsIndexSet.add(t),this._outputSelectedTerms()}_generateInitialIndexSet(){this.selectedItemsIndexSet=this.items.length>=10?new Set([0,1,2,3,4,5,6,7,8,9]):new Set([...Array(this.items.length).keys()]),this._outputSelectedTerms()}_outputSelectedTerms(){const t=[...this.selectedItemsIndexSet].map(n=>this.items[n]);this.selectedItems$.next(t)}}return a.\u0275fac=function(t){return new(t||a)},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-select-multiple-items-virtual-scroll"]],inputs:{items:"items"},outputs:{selectedItems$:"selectedItems$"},features:[e.TTD],decls:3,vars:1,consts:[[1,"ml-3",2,"display","flex","flex-direction","row"],["itemSize","14",2,"height","200px","border","1px solid black","width","200px","overflow-x","scroll"],["style","height:20px","class","form-check",3,"title",4,"cdkVirtualFor","cdkVirtualForOf"],[1,"form-check",2,"height","20px",3,"title"],["type","checkbox",1,"form-check-input",3,"checked","click"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"cdk-virtual-scroll-viewport",1),e.YNc(2,_,5,6,"div",2),e.qZA(),e.qZA()),2&t&&(e.xp6(2),e.Q6J("cdkVirtualForOf",n.items))},directives:[m.N7,m.xd,m.x0],pipes:[d.K],styles:[".cdk-virtual-scroll-content-wrapper[_ngcontent-%COMP%]   .viewport[_ngcontent-%COMP%]{display:flex;flex-direction:row}"],changeDetection:0}),a})();var S=h(766),A=h(2707);let O=(()=>{class a{constructor(){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d")}computeStringWidth(t,n,l){return this.context.font=`${n}px ${l}`,Math.ceil(this.context.measureText(t).width)}computeStringHeight(t,n,l){return this.context.font=`${n}px ${l}`,Math.ceil(this.context.measureText(t).height)}}return a.\u0275fac=function(t){return new(t||a)},a.\u0275prov=e.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();const D=["svgElement"];let V=(()=>{class a{constructor(t){this.computeStringWidthService=t,this.svgHeight=300,this.svgWidth=300,this.marginTop=40,this.marginBottom=50,this.marginRight=10,this.marginLeft=50,this.gridWidth=200,this.gridHeight=200,this.borderWidth=1,this.barWidth=15,this.barColor="#ff8080",this.paddingInner=.25,this.paddingOuter=.3,this.yLabelFontSize=15,this.yLabelFontStyle="times new roman",this.axisBottomTitleFontSize=20,this.axisBottomLableSize=15,this.geneNumberTextFrontsize=10}ngOnInit(){}ngAfterViewInit(){this.enrichedInfo&&(this._removeGraphic(),this._initMap(),this._transformMap(),this._moveGraphic2center())}ngOnChanges(t){t.enrichedInfo&&!t.enrichedInfo.isFirstChange()&&(this._removeGraphic(),this._initMap(),this._transformMap(),this._moveGraphic2center())}_initMap(){let t=this;const n=this.enrichedInfo.enrichedTerms;this._initSettings(),this.d3Svg=(0,S.Z)(t.svgElement.nativeElement);const l=(0,A.tiA)().range([0,t.gridHeight]).domain(n).paddingInner(t.paddingInner).paddingOuter(t.paddingOuter);t.yAxis=this.d3Svg.append("g").attr("transform","translate("+t.marginLeft+","+t.marginTop+")").call((0,A.y4O)(l).tickSize(0)),t.yAxis.selectAll("text").style("font-size",t.yLabelFontSize).style("font-style",t.yLabelFontStyle);let g=Math.max(...t.enrichedInfo.pValues);g*=1.1;const E=(0,A.BYU)().domain([0,g]).range([0,t.gridWidth]),Z=t.marginTop+t.gridHeight;t.xAxis=this.d3Svg.append("g").attr("transform","translate("+t.marginLeft+","+Z+")").call((0,A.LLu)(E).ticks(5)),t.xAxis.selectAll("text").style("font-size",t.axisBottomLableSize),t.borderElement=this.d3Svg.append("rect").attr("transform","translate("+(t.marginLeft+.5*t.borderWidth)+","+t.marginTop+")").attr("width",t.gridWidth).attr("height",t.gridHeight).attr("fill","none").attr("stroke","black").attr("stroke-width",t.borderWidth);const M=t.marginTop+t.gridHeight+t.xAxis.node().getBBox().height+t.axisBottomTitleFontSize,G=t.marginLeft+.5*t.gridWidth;t.xTitle=this.d3Svg.append("text").attr("transform","translate("+G+","+M+")").style("text-anchor","middle").style("font-size",t.axisBottomTitleFontSize).text("-log10(P Value)");const B=t.marginTop-10,L=t.marginLeft+.5*t.gridWidth;t.plotTitle=this.d3Svg.append("text").attr("transform","translate("+L+","+B+")").attr("text-anchor","middle").text(t.enrichedInfo.annotationType);const $=t.enrichedInfo.pValues;t.barElements=this.d3Svg.append("g").attr("transform","translate("+t.marginLeft+","+t.marginTop+")"),t.barElements.selectAll("bar").data(t.enrichedInfo.pValues).enter().append("rect").attr("x",t.borderWidth).attr("y",function(w,N){return l(n[N])}).attr("height",l.bandwidth()).attr("width",function(w){return E(w)}).attr("fill",t.barColor),t.barNumberElements=this.d3Svg.append("g").attr("transform","translate("+t.marginLeft+","+t.marginTop+")"),t.barNumberElements.selectAll("numberText").data(t.enrichedInfo.geneNumbers).enter().append("text").attr("x",function(w,N){return E($[N])+2}).attr("y",function(w,N){return l(n[N])+.5*t.barWidth+.3*t.geneNumberTextFrontsize}).attr("font-size",t.geneNumberTextFrontsize).text(function(w){return w})}_initSettings(){this.marginLeft=this._generateMarginLeft(),this.gridHeight=this._generateGridHeight(),this.svgWidth=this.marginLeft+this.gridWidth+this.marginRight,this.svgHeight=this.marginTop+this.gridHeight+this.marginBottom}_generateMarginLeft(){const t=this.enrichedInfo.enrichedTerms.map(l=>this.computeStringWidthService.computeStringWidth(l,this.yLabelFontSize,this.yLabelFontStyle));return Math.max(...t)+20}_generateGridHeight(){const t=this.enrichedInfo.enrichedTerms.length;return t*this.barWidth+this.barWidth*this.paddingInner/(1-this.paddingInner)*(t-1)+2*this.paddingOuter*this.barWidth/(1-this.paddingInner)}_transformMap(){let t=this;t.d3Svg.call((0,A.sPX)().scaleExtent([.2,5]).on("zoom",function(n){const l=(0,A.P2S)(this);t._zoomAccordingTransform(l)})).on("dblclick.zoom",null)}_zoomAccordingTransform(t){let n=this,{x:l,y:g,k:E}=t;n.xAxis.attr("transform",`translate(${n.marginLeft+l}, ${n.marginTop+n.gridHeight*E+g}) scale(${E})`),n.yAxis.attr("transform",`translate(${n.marginLeft+l}, ${n.marginTop+g}) scale(${E})`);const L=n.marginTop+(n.gridHeight+n.xAxis.node().getBBox().height+n.axisBottomTitleFontSize)*E+g;n.xTitle.attr("transform",`translate(${n.marginLeft+.5*n.gridWidth*E+l}, ${L}) scale(${E})`),n.barElements.attr("transform",`translate(${n.marginLeft+l}, ${n.marginTop+g}) scale(${E})`),n.barNumberElements.attr("transform",`translate(${n.marginLeft+l}, ${n.marginTop+g}) scale(${E})`),n.borderElement.attr("transform",`translate(${n.marginLeft+.5*n.borderWidth*E+l}, ${n.marginTop+g}) scale(${E})`),n.plotTitle.attr("transform",`translate(${n.marginLeft+.5*n.gridWidth*E+l}, ${n.marginTop-10+g}) scale(${E})`)}_moveGraphic2center(){const t=.5*(this.marginLeft+this.gridWidth+this.marginRight),n=.5*this.svgElement.nativeElement.width.baseVal.value,l=A.CRH.scale(1).translate(n-t,0);this._zoomAccordingTransform(l),this.d3Svg.node().__zoom=l}_removeGraphic(){this.d3Svg&&this.d3Svg.selectAll("*").remove()}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(O))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-d3-enriched-bar-plot"]],viewQuery:function(t,n){if(1&t&&e.Gf(D,5),2&t){let l;e.iGM(l=e.CRH())&&(n.svgElement=l.first)}},inputs:{enrichedInfo:"enrichedInfo"},features:[e.TTD],decls:3,vars:0,consts:[[2,"z-index","-10"],[2,"height","80vh","width","100%"],["svgElement",""]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.O4$(),e._UZ(1,"svg",1,2),e.qZA())},styles:["svg[_ngcontent-%COMP%]{display:block;margin:auto}"],changeDetection:0}),a})();const U=function(a){return{visibility:a}};let k=(()=>{class a{constructor(){this.itemsSectionVisibility="hidden"}ngOnInit(){this.enrichedAnnotations&&this._prepareTermsForSelecting()}ngOnChanges(t){t.enrichedAnnotations&&!t.enrichedAnnotations.isFirstChange()&&this._prepareTermsForSelecting()}toogleSelectSection(){this.itemsSectionVisibility="hidden"===this.itemsSectionVisibility?"visible":"hidden"}_prepareTermsForSelecting(){this.allAnnotationTerms=this.enrichedAnnotations.enrichedValues.map(n=>n[1])}_obtainEnrichedInfoForPlot(t){const n=new Set(t);let M=[],G=[],B=[];this.enrichedAnnotations.enrichedValues.forEach(L=>{n.has(L[1])&&(M.push(L[1]),G.push(L[3]),B.push(L[5]))}),this.enrichedInfoForPlot={annotationType:this.enrichedAnnotations.annotationType,enrichedTerms:M,pValues:G,geneNumbers:B}}processSelectedSelectedAnnotations(t){this._obtainEnrichedInfoForPlot(t)}}return a.\u0275fac=function(t){return new(t||a)},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-enriched-annotations-plot"]],inputs:{enrichedAnnotations:"enrichedAnnotations"},features:[e.TTD],decls:5,vars:5,consts:[[1,"d-flex","align-content-start","flex-wrap"],["type","button btn-sm btn-expressvis",3,"click"],[2,"position","fixed",3,"ngStyle","items","selectedItems$"],[2,"z-index","10",3,"enrichedInfo"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"button",1),e.NdJ("click",function(){return n.toogleSelectSection()}),e._uU(2,"Select Items For Plot"),e.qZA(),e.qZA(),e.TgZ(3,"app-select-multiple-items-virtual-scroll",2),e.NdJ("selectedItems$",function(g){return n.processSelectedSelectedAnnotations(g)}),e.qZA(),e._UZ(4,"app-d3-enriched-bar-plot",3)),2&t&&(e.xp6(3),e.Q6J("ngStyle",e.VKq(3,U,n.itemsSectionVisibility))("items",n.allAnnotationTerms),e.xp6(1),e.Q6J("enrichedInfo",n.enrichedInfoForPlot))},directives:[f,T.PC,V],styles:[""],changeDetection:0}),a})();var z=h(6458);const W=function(a){return{active:a}};function J(a,b){if(1&a){const t=e.EpF();e.TgZ(0,"li",14),e.NdJ("click",function(){const g=e.CHM(t).$implicit;return e.oxw().changeAnnotationType(g)}),e.TgZ(1,"a",15),e._uU(2),e.qZA(),e.qZA()}if(2&a){const t=b.$implicit,n=e.oxw();e.xp6(1),e.Q6J("ngClass",e.VKq(2,W,n.selectedAnnotationType===t)),e.xp6(1),e.hij("",t," ")}}function Y(a,b){if(1&a){const t=e.EpF();e.TgZ(0,"li",16),e.TgZ(1,"a",17),e.NdJ("click",function(){const g=e.CHM(t).$implicit;return e.oxw().changeDisplayTypeOfAllTerms(g)}),e._uU(2),e.qZA(),e.qZA()}if(2&a){const t=b.$implicit,n=e.oxw();e.xp6(1),e.Q6J("ngClass",e.VKq(2,W,n.selectedDisplayTypeOfAllTerms===t)),e.xp6(1),e.hij(" ",t," ")}}function Q(a,b){if(1&a){const t=e.EpF();e.TgZ(0,"app-enriched-annotations-table-pagination",18),e.NdJ("selectedAnnotationTermGenes$",function(l){return e.CHM(t),e.oxw().processSelectedAnnotationTermGenes(l)}),e.qZA()}if(2&a){const t=e.oxw();e.Q6J("enrichedAnnotationsInfo",t.enrichedAnnotationsInfoForTable)}}function H(a,b){if(1&a&&e._UZ(0,"app-enriched-annotations-plot",19),2&a){const t=e.oxw();e.Q6J("enrichedAnnotations",t.enrichedAnnotationsInfoForTable)}}function K(a,b){if(1&a){const t=e.EpF();e.TgZ(0,"li",16),e.TgZ(1,"a",17),e.NdJ("click",function(){const g=e.CHM(t).$implicit;return e.oxw().changeDisplayTypeOfOneTerm(g)}),e._uU(2),e.qZA(),e.qZA()}if(2&a){const t=b.$implicit,n=e.oxw();e.xp6(1),e.Q6J("ngClass",e.VKq(2,W,n.selectedDisplayTypeOfOneTerm===t)),e.xp6(1),e.hij(" ",t," ")}}function j(a,b){if(1&a){const t=e.EpF();e.TgZ(0,"app-display-genes-info-table-pagination",20),e.NdJ("selectedGene$",function(l){return e.CHM(t),e.oxw().processSelectedGene(l)}),e.qZA()}if(2&a){const t=e.oxw();e.Q6J("genesInfoForTable",t.annotationTermGenesInfoForTable)}}function X(a,b){if(1&a&&(e.TgZ(0,"p",21),e._uU(1," Click "),e._UZ(2,"fa-icon",22),e._uU(3," in the annotation terms table (left) to show genes information in the selected annotation term "),e.qZA()),2&a){const t=e.oxw();e.xp6(2),e.Q6J("icon",t.faTable)("size","1x")}}function ee(a,b){if(1&a){const t=e.EpF();e.TgZ(0,"button",23),e.NdJ("click",function(l){return e.CHM(t),e.oxw().processClickedKeggButton(l)}),e._uU(1," Visualize this Pathway in KeggExp "),e.qZA()}}let te=(()=>{class a{constructor(t){this.cdr=t,this.selectedAnnotationTermGenes$=new e.vpe,this.selectedKEGGpathway$=new e.vpe,this.selectedGene$=new e.vpe,this.faTable=c.B3e,this.selectedAnnotationType="KEGG Pathway",this.displayTypesOfAllTerms=["Table","Bar Plot"],this.selectedDisplayTypeOfAllTerms="Table",this.displayTypesOfOneTerm=["Table"],this.ifShowToKeggExpNote=!1}ngOnInit(){}ngOnChanges(t){t.geneListErichedResultStatus&&this.geneListErichedResultStatus&&(this.annotationTypes=this.geneListErichedResultStatus.result.enrichedAnnotations.map(n=>n.annotationType),this.selectedAnnotationType=this.annotationTypes[0],this.changeAnnotationType(this.selectedAnnotationType))}changeAnnotationType(t){this.selectedAnnotationType=t,this._obtainOneAnnotationEnrichedData(t),this.selectedAnnotationTermGenes$.next({annotationID:"",annotationTerm:"",genes:[]}),this.ifShowToKeggExpNote=!1,this.cdr.detectChanges()}_obtainOneAnnotationEnrichedData(t){let n;for(const l of this.geneListErichedResultStatus.result.enrichedAnnotations)l.annotationType==t&&(n=l);this.enrichedAnnotationsInfoForTable={annotationType:n.annotationType,headers:n.enrichedResult.attributes,enrichedValues:n.enrichedResult.enrichedInfos}}changeDisplayTypeOfAllTerms(t){this.selectedDisplayTypeOfAllTerms=t,this.cdr.detectChanges()}changeDisplayTypeOfOneTerm(t){}_formatGenesEnrichedDownloadFile(){return"string"}processSelectedAnnotationTermGenes(t){this.ifShowToKeggExpNote="KEGG Pathway"===this.selectedAnnotationType,this.selectedAnnotationTermGenes$.next(t),this.selectedAnnotationID=t.annotationID}processClickedKeggButton(t){this.selectedKEGGpathway$.next(this.selectedAnnotationID)}processSelectedGene(t){this.selectedGene$.next(t)}downloadEnrichedAnnotations(t){const l=this.enrichedAnnotationsInfoForTable.enrichedValues;let g=this.enrichedAnnotationsInfoForTable.headers.join("\t")+"\n";g+=l.map(B=>B.join("\t")).join("\n");const M=this._formatGenesEnrichedDownloadFile();let G=new Blob([g],{type:"text/csv;charset=utf-8"});saveAs(G,M)}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(e.sBO))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-display-enriched-annotations"]],inputs:{geneListErichedResultStatus:"geneListErichedResultStatus",annotationTermGenesInfoForTable:"annotationTermGenesInfoForTable"},outputs:{selectedAnnotationTermGenes$:"selectedAnnotationTermGenes$",selectedKEGGpathway$:"selectedKEGGpathway$",selectedGene$:"selectedGene$"},features:[e.TTD],decls:19,vars:8,consts:[[1,"row"],["data-testid","switchAnnotations",1,"nav","nav-tabs"],["class","nav-item",3,"click",4,"ngFor","ngForOf"],[1,"col-12","col-lg-6","border"],[1,"text-center",2,"margin-bottom","0"],["data-testid","switchAnnoDisplayType",1,"nav","nav-tabs"],["class","nav-item",4,"ngFor","ngForOf"],["appTableHeaderBodySameWidth","",3,"enrichedAnnotationsInfo","selectedAnnotationTermGenes$",4,"ngIf"],[3,"enrichedAnnotations",4,"ngIf"],[1,"col-12","col-lg-6"],[1,"nav","nav-tabs"],[3,"genesInfoForTable","selectedGene$",4,"ngIf"],["data-testid","clickAnnotationTermNote",4,"ngIf"],["data-testid","toKeggExp","class","btn btn-sm btn-expressvis",3,"click",4,"ngIf"],[1,"nav-item",3,"click"],["href","javascript:void(0)",1,"nav-link",3,"ngClass"],[1,"nav-item"],["href","javascript:void(0)",1,"nav-link",3,"ngClass","click"],["appTableHeaderBodySameWidth","",3,"enrichedAnnotationsInfo","selectedAnnotationTermGenes$"],[3,"enrichedAnnotations"],[3,"genesInfoForTable","selectedGene$"],["data-testid","clickAnnotationTermNote"],[3,"icon","size"],["data-testid","toKeggExp",1,"btn","btn-sm","btn-expressvis",3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"ul",1),e.YNc(2,J,3,4,"li",2),e.qZA(),e.qZA(),e.TgZ(3,"div",0),e.TgZ(4,"div",3),e.TgZ(5,"h5",4),e._uU(6," Enriched Annotation Terms "),e.qZA(),e.TgZ(7,"ul",5),e.YNc(8,Y,3,4,"li",6),e.qZA(),e.YNc(9,Q,1,1,"app-enriched-annotations-table-pagination",7),e.YNc(10,H,1,1,"app-enriched-annotations-plot",8),e.qZA(),e.TgZ(11,"div",9),e.TgZ(12,"h5",4),e._uU(13," Genes In the Selected Annotation Term "),e.qZA(),e.TgZ(14,"ul",10),e.YNc(15,K,3,4,"li",6),e.qZA(),e.YNc(16,j,1,1,"app-display-genes-info-table-pagination",11),e.YNc(17,X,4,2,"p",12),e.YNc(18,ee,2,0,"button",13),e.qZA(),e.qZA()),2&t&&(e.xp6(2),e.Q6J("ngForOf",n.annotationTypes),e.xp6(6),e.Q6J("ngForOf",n.displayTypesOfAllTerms),e.xp6(1),e.Q6J("ngIf","Table"===n.selectedDisplayTypeOfAllTerms&&n.geneListErichedResultStatus),e.xp6(1),e.Q6J("ngIf","Bar Plot"===n.selectedDisplayTypeOfAllTerms),e.xp6(5),e.Q6J("ngForOf",n.displayTypesOfOneTerm),e.xp6(1),e.Q6J("ngIf",(null==n.annotationTermGenesInfoForTable?null:n.annotationTermGenesInfoForTable.genesInfo.length)>0),e.xp6(1),e.Q6J("ngIf",!((null==n.annotationTermGenesInfoForTable?null:n.annotationTermGenesInfoForTable.genesInfo.length)>0)),e.xp6(1),e.Q6J("ngIf",n.ifShowToKeggExpNote))},directives:[T.sg,T.O5,T.mk,r,u.n,k,z.T,v.BN],styles:[""],changeDetection:0}),a})()},6458:(F,P,h)=>{h.d(P,{T:()=>m});var e=h(3668),c=h(277),T=h(5043),I=h(7582),C=h(9232),y=h(471),x=h(4250),v=h(6019),i=h(8638),o=h(9133),p=h(3856);function s(d,_){if(1&d){const f=e.EpF();e.TgZ(0,"th",11),e.NdJ("sort",function(A){return e.CHM(f),e.oxw().onSort(A)}),e._uU(1),e.qZA()}if(2&d){const f=_.$implicit;e.Q6J("sortableColumn",f),e.xp6(1),e.hij(" ",f," ")}}function r(d,_){if(1&d&&(e.TgZ(0,"td"),e._uU(1),e.qZA()),2&d){const f=_.$implicit,S=e.oxw().$implicit;e.xp6(1),e.hij(" ",S[f]," ")}}function u(d,_){if(1&d){const f=e.EpF();e.TgZ(0,"tr"),e.TgZ(1,"td",12),e.NdJ("click",function(){const O=e.CHM(f).index;return e.oxw().processSelectedGene(O)}),e.TgZ(2,"div",13),e._UZ(3,"fa-icon",14),e.qZA(),e.qZA(),e.YNc(4,r,2,1,"td",5),e.qZA()}if(2&d){const f=e.oxw();e.xp6(3),e.Q6J("icon",f.faChartBar)("size","1x"),e.xp6(1),e.Q6J("ngForOf",f.features)}}let m=(()=>{class d{constructor(f){this.cdr=f,this.selectedGene$=new e.vpe,this.page=1,this.pageSize=5,this.faArrowUp=T.FPD,this.faArrowDown=T.r5q,this.faChartBar=T.koM}ngOnInit(){this.genesInfoForTable&&(this._prepareForTable(),this.refreshSubGenesInfo())}ngOnChanges(f){f.genesInfoForTable&&!f.genesInfoForTable.isFirstChange()&&(this._prepareForTable(),this.refreshSubGenesInfo())}_prepareForTable(){this.features=[...this.genesInfoForTable.features],this.genesInfo=[...this.genesInfoForTable.genesInfo],this.filteredGenesInfo=[...this.genesInfoForTable.genesInfo],this.collectionSize=this.filteredGenesInfo.length}refreshSubGenesInfo(){this.subGenesInfo=this.filteredGenesInfo.slice((this.page-1)*this.pageSize,(this.page-1)*this.pageSize+this.pageSize),this.cdr.detectChanges()}onSort({column:f,direction:S}){this.headers.forEach(A=>{A.sortableColumn!==f&&(A.direction="")}),(""!=S||""!=f)&&(this.filteredGenesInfo=[...this.filteredGenesInfo].sort((A,O)=>{const D=(0,I.q)(A[f],O[f]);return"asc"===S?D:-D}),this.refreshSubGenesInfo())}filterGenes(f){const S=f.matchType;let A=[];if(f.filterSteps.length>=1){for(let D of f.filterSteps){const V=D.attribute,U=D.filterType,k=D.filterValue.toLowerCase();let z=this.genesInfo.map(J=>J[V]);const W=C.qP[U](z,k);A.push(new Set(W))}const O=A.reduce(y.JN[S]);this.filteredGenesInfo=[...O].map(D=>this.genesInfo[D])}else this.filteredGenesInfo=[...this.genesInfo];this.collectionSize=this.filteredGenesInfo.length,this.refreshSubGenesInfo()}processSelectedGene(f){this.selectedGene$.next(this.subGenesInfo[f][this.features[0]])}}return d.\u0275fac=function(f){return new(f||d)(e.Y36(e.sBO))},d.\u0275cmp=e.Xpm({type:d,selectors:[["app-display-genes-info-table-pagination"]],viewQuery:function(f,S){if(1&f&&e.Gf(c.Y,5),2&f){let A;e.iGM(A=e.CRH())&&(S.headers=A)}},inputs:{genesInfoForTable:"genesInfoForTable"},outputs:{selectedGene$:"selectedGene$"},features:[e.TTD],decls:21,vars:12,consts:[[1,"mt-1",3,"dataAttributes","filterStepsInfo$"],[1,"table-responsive","mt-1",2,"margin-left","10px","margin-right","10px"],[1,"table"],["sortable","",3,"sortableColumn","sort",4,"ngFor","ngForOf"],[1,"border-bottom"],[4,"ngFor","ngForOf"],[1,"d-flex","justify-content-between","align-items-center","p-2"],["data-testid","diffGenesNum"],[3,"collectionSize","page","pageSize","maxSize","pageChange"],[1,"custom-select","mb-3",2,"width","auto",3,"ngModel","ngModelChange"],[3,"ngValue"],["sortable","",3,"sortableColumn","sort"],[3,"click"],[1,"form-inline"],["ngbTooltip","Click to visualize expression",1,"hoverBigger",3,"icon","size"]],template:function(f,S){1&f&&(e.TgZ(0,"app-define-filter-steps",0),e.NdJ("filterStepsInfo$",function(O){return S.filterGenes(O)}),e.qZA(),e.TgZ(1,"div",1),e.TgZ(2,"table",2),e.TgZ(3,"thead"),e.TgZ(4,"tr"),e.TgZ(5,"th"),e._uU(6," View Expression "),e.qZA(),e.YNc(7,s,2,2,"th",3),e.qZA(),e.qZA(),e.TgZ(8,"tbody",4),e.YNc(9,u,5,3,"tr",5),e.qZA(),e.qZA(),e.qZA(),e.TgZ(10,"div",6),e.TgZ(11,"p",7),e._uU(12),e.qZA(),e.TgZ(13,"ngb-pagination",8),e.NdJ("pageChange",function(O){return S.page=O})("pageChange",function(){return S.refreshSubGenesInfo()}),e.qZA(),e.TgZ(14,"select",9),e.NdJ("ngModelChange",function(O){return S.pageSize=O})("ngModelChange",function(){return S.refreshSubGenesInfo()}),e.TgZ(15,"option",10),e._uU(16,"5 per page"),e.qZA(),e.TgZ(17,"option",10),e._uU(18,"10 per page"),e.qZA(),e.TgZ(19,"option",10),e._uU(20,"20 per page"),e.qZA(),e.qZA(),e.qZA()),2&f&&(e.Q6J("dataAttributes",S.features),e.xp6(7),e.Q6J("ngForOf",S.features),e.xp6(2),e.Q6J("ngForOf",S.subGenesInfo),e.xp6(3),e.hij(" ",S.collectionSize," Genes "),e.xp6(1),e.Q6J("collectionSize",S.collectionSize)("page",S.page)("pageSize",S.pageSize)("maxSize",5),e.xp6(1),e.Q6J("ngModel",S.pageSize),e.xp6(1),e.Q6J("ngValue",5),e.xp6(2),e.Q6J("ngValue",10),e.xp6(2),e.Q6J("ngValue",20))},directives:[x.u,v.sg,i.N9,o.EJ,o.JJ,o.On,o.YN,o.Kr,c.Y,p.BN,i._L],styles:["table[_ngcontent-%COMP%]{max-height:80vh}tbody[_ngcontent-%COMP%]{text-align:start;overflow-y:scroll;overflow-x:hidden}td[_ngcontent-%COMP%], th[_ngcontent-%COMP%]{text-align:left;height:2em;white-space:nowrap}"],changeDetection:0}),d})()},6988:(F,P,h)=>{h.d(P,{R:()=>y});var e=h(3668),c=h(2707),T=h(2307);const I=["boxPlot"];let C=(()=>{class x{constructor(i){this.elRef=i,this.groupsNames=[],this.groupsNames2Labels={},this.groupsLabels=[],this.groupPairsForPvalues=[],this.boxPlotSettings={pointSize:4,boxWidth:25,width:500,height:350,marginTop:30,marginBottom:70,marginLeft:100,marginRight:30,axisBottomLableSize:1.5,axisLeftLableSize:1.5,axisLeftTitleSize:25,axisStrokeWidth:1.5,axisBottomLableRotation:-30},this.pvalueLineGap=20,this.hostElement=this.elRef.nativeElement}ngOnInit(){}ngOnChanges(i){i.geneExpForBoxPlot&&!i.geneExpForBoxPlot.isFirstChange()&&(this._removeGraphic(),this._prepareDataForVis(),this._addGraphic(),this._addPvalueLabels())}ngAfterViewInit(){this.geneExpForBoxPlot&&(this._removeGraphic(),this._prepareDataForVis(),this._addGraphic(),this._addPvalueLabels())}_prepareDataForVis(){this.allValues=this._obtainAllValues(),this.groupsNames=this._obtainGroupNames(),this.groupSamplesValues=this._obtainGroupSampleValues(),this.groupExpStat=this._computeStatistics(),this.groupsNames2Labels=this._obtainGroupName2GroupLabel()}_obtainAllValues(){const i=[];return this.geneExpForBoxPlot.groupsExpInfo.forEach(o=>{o.samplesExpInfo.forEach(p=>{i.push(p.value)})}),i}_obtainGroupNames(){return this.geneExpForBoxPlot.groupsExpInfo.map(o=>o.groupName)}_obtainGroupSampleValues(){let i=[];return this.geneExpForBoxPlot.groupsExpInfo.forEach(o=>{o.samplesExpInfo.forEach(p=>{i.push({groupName:o.groupName,value:p.value,sampleName:p.sampleName})})}),i}_obtainGroupName2GroupLabel(){let i={};return this.geneExpForBoxPlot.groupsExpInfo.forEach(o=>{i[o.groupName]=o.groupName+"(n="+o.samplesExpInfo.length.toString()+")"}),i}_removeGraphic(){let i=(0,c.Ys)(this.hostElement).selectAll("svg");i&&i.remove()}_addGraphic(){this._initGraphicSettings(),this._addSvg(),this._addBorder(),this._addXlabels(),this._addYlabels(),this._addStaticsBox(),this._addPoints(),this._addPvalueLabels()}_initGraphicSettings(){this.marginLeft=this.boxPlotSettings.marginLeft,this.marginRight=this.boxPlotSettings.marginRight,this.marginTop=this.boxPlotSettings.marginTop,this.marginBottom=this._obtainMarginBottom(),this.marginLeft=this._obtainMarginLeft(),this.graphicWidth=this.boxPlotSettings.boxWidth*this.groupsNames.length*2,this.width=this.marginLeft+this.graphicWidth+this.marginRight,this.graphicHeight=this.boxPlotSettings.height-this.marginTop-this.marginBottom,this.boxWidth=this.boxPlotSettings.boxWidth,this.pointSize=this.boxPlotSettings.pointSize,this.jitterWidth=this.boxWidth/2}_addSvg(){this.svg=(0,c.Ys)(this.boxPlot.nativeElement).append("svg").attr("width",this.width).attr("height",this.boxPlotSettings.height).style("display","block").style("margin","auto")}_addBorder(){let i=this;this.svg.append("rect").attr("transform","translate("+i.marginLeft+","+i.marginTop+")").attr("x",0).attr("y",0).attr("height",i.graphicHeight).attr("width",i.graphicWidth).attr("fill","none").attr("stroke","black").attr("stroke-width",this.boxPlotSettings.axisStrokeWidth)}_addXlabels(){let i=this;this.xScale=(0,c.tiA)().range([0,i.graphicWidth]).domain(this.groupsNames).paddingInner(1).paddingOuter(.5);const o=i.marginTop+i.graphicHeight;this.svg.append("g").attr("transform","translate("+i.marginLeft+","+o+")").call((0,c.LLu)(this.xScale).tickFormat(s=>this.groupsNames2Labels[s])).selectAll("text").style("font-size",this.boxPlotSettings.axisBottomLableSize+"rem").attr("transform","rotate("+this.boxPlotSettings.axisBottomLableRotation+")").style("text-anchor",this._determineAxisBottomTextAnchor())}_addYlabels(){let i=this;const o=this.groupExpStat.map(D=>D.max),p=this.groupExpStat.map(D=>D.min),s=Math.max((0,c.Fp7)(this.allValues),(0,c.Fp7)(o)),r=Math.min((0,c.VV$)(this.allValues),(0,c.VV$)(p)),m=(this.geneExpForBoxPlot.groupPairsPvalue.length+.1)*this.pvalueLineGap,d=5*(s-r)/(i.graphicHeight-m-10),_=m*(s-r)/(i.graphicHeight-m-10);this.yScale=(0,c.BYU)().domain([r-d,s+d+_]).range([i.graphicHeight,0]);let f=this.svg.append("g").attr("transform","translate("+i.marginLeft+","+i.marginTop+")").call((0,c.y4O)(this.yScale).ticks(5));f.selectAll("text").style("font-size",this.boxPlotSettings.axisLeftLableSize+"rem");const S=i.marginLeft-f.node().getBBox().width-10,A=i.marginTop+.5*i.graphicHeight;this.svg.append("text").attr("transform","translate("+S+","+A+")rotate(-90)").style("text-anchor","middle").style("font-size",this.boxPlotSettings.axisLeftTitleSize).text("Expression Value")}_addStaticsBox(){let i=this,o=this.xScale,p=this.yScale,s=this.svg.append("g");s.selectAll("vertLines").data(this.groupExpStat).enter().append("line").attr("transform","translate("+i.marginLeft+","+i.marginTop+")").attr("x1",function(r){return o(r.groupName)}).attr("x2",function(r){return o(r.groupName)}).attr("y1",function(r){return p(r.min)}).attr("y2",function(r){return p(r.max)}).attr("stroke","black").style("width",40),s.selectAll("boxes").data(this.groupExpStat).enter().append("rect").attr("transform","translate("+i.marginLeft+","+i.marginTop+")").attr("x",function(r){return o(r.groupName)-i.boxWidth/2}).attr("y",function(r){return p(r.q3)}).attr("height",function(r){return p(r.q1)-p(r.q3)}).attr("width",i.boxWidth).attr("stroke","black").style("fill","white"),s.selectAll("medianLines").data(this.groupExpStat).enter().append("line").attr("transform","translate("+i.marginLeft+","+i.marginTop+")").attr("x1",function(r){return o(r.groupName)-i.boxWidth/2}).attr("x2",function(r){return o(r.groupName)+i.boxWidth/2}).attr("y1",function(r){return p(r.median)}).attr("y2",function(r){return p(r.median)}).attr("stroke","black").style("width",80),s.selectAll("upLines").data(this.groupExpStat).enter().append("line").attr("transform","translate("+i.marginLeft+","+i.marginTop+")").attr("x1",function(r){return o(r.groupName)-i.boxWidth/4}).attr("x2",function(r){return o(r.groupName)+i.boxWidth/4}).attr("y1",function(r){return p(r.max)}).attr("y2",function(r){return p(r.max)}).attr("stroke","black").style("width",80),s.selectAll("downLines").data(this.groupExpStat).enter().append("line").attr("transform","translate("+i.marginLeft+","+i.marginTop+")").attr("x1",function(r){return o(r.groupName)-i.boxWidth/4}).attr("x2",function(r){return o(r.groupName)+i.boxWidth/4}).attr("y1",function(r){return p(r.min)}).attr("y2",function(r){return p(r.min)}).attr("stroke","black").style("width",80)}_addPoints(){let i=(0,c.Ys)(this.hostElement).append("div").attr("class","tooltip").style("opacity",0);var o=this;this.svg.append("g").selectAll("samplePoints").data(this.groupSamplesValues).enter().append("circle").attr("transform","translate("+o.marginLeft+","+o.marginTop+")").attr("cx",function(s){return o.xScale(s.groupName)-o.jitterWidth/2+Math.random()*o.jitterWidth}).attr("cy",function(s){return o.yScale(s.value)}).attr("r",o.pointSize).style("fill","black").attr("stroke","black").on("mousemove",function(s){i.transition().duration(200).style("opacity",.9),i.html(s.sampleName).style("left",s.pageX+"px").style("top",s.pageY-28+"px")}).on("mouseout",function(s){i.transition().duration(500).style("opacity",0)})}_determineAxisBottomTextAnchor(){return 0==this.boxPlotSettings.axisBottomLableRotation?"center":"end"}_obtainMarginBottom(){let i=0;const o=(0,T.H)(this.boxPlotSettings.axisBottomLableSize);let p=[];for(const s in this.groupsNames2Labels)p.push(this.groupsNames2Labels[s]);return p.forEach(s=>{const r=-this.boxPlotSettings.axisBottomLableRotation*Math.PI/180,u=s.length*o*Math.sin(r)+1.32*o*Math.cos(r);u>i&&(i=u)}),i+5}_obtainMarginLeft(){const i=-this.boxPlotSettings.axisBottomLableRotation*Math.PI/180,o=(0,T.H)(this.boxPlotSettings.axisBottomLableSize),p=this.groupsNames[0].length*o*Math.cos(i);return p>=this.boxPlotSettings.marginLeft?p:this.boxPlotSettings.marginLeft}_computeStatistics(){return this.geneExpForBoxPlot.groupsExpInfo.map(o=>{const p=o.samplesExpInfo.map(f=>f.value).sort(c.j2p),s=(0,c.VRg)(p,.25),r=(0,c.VRg)(p,.5),u=(0,c.VRg)(p,.75),m=u-s;return{groupName:o.groupName,q1:s,median:r,q3:u,interQuantileRange:m,min:s-1.5*m,max:u+1.5*m}})}_addPvalueLabels(){const i=this.marginLeft,o=this.boxPlotSettings.marginTop;this.svg.selectAll(".pValueElement").remove();const p=this._preparePvalueLables(),s=this.pvalueLineGap;let r=this.xScale,u=this.yScale,m=this.svg.append("g").attr("class","pValueElement");m.selectAll("pValueLines").data(p).enter().append("line").attr("transform","translate("+i+","+o+")").attr("x1",function(d){return r(d.baseGroup)}).attr("x2",function(d){return r(d.targetGroup)}).attr("y1",function(d,_){return u(d.y)-(_+.5)*s}).attr("y2",function(d,_){return u(d.y)-(_+.5)*s}).attr("stroke","black").style("width",80),m.selectAll("pValueGroup1Lines").data(p).enter().append("line").attr("transform","translate("+i+","+o+")").attr("x1",function(d){return r(d.baseGroup)}).attr("x2",function(d){return r(d.baseGroup)}).attr("y1",function(d,_){return u(d.y)-(_+.5)*s+s/4}).attr("y2",function(d,_){return u(d.y)-(_+.5)*s}).attr("stroke","black").style("width",80),m.selectAll("pValueGroup1Lines").data(p).enter().append("line").attr("transform","translate("+i+","+o+")").attr("x1",function(d){return r(d.targetGroup)}).attr("x2",function(d){return r(d.targetGroup)}).attr("y1",function(d,_){return u(d.y)-(_+.5)*s+s/4}).attr("y2",function(d,_){return u(d.y)-(_+.5)*s}).attr("stroke","black").style("width",80),m.selectAll("pValuestext").data(p).enter().append("text").attr("transform","translate("+i+","+o+")").attr("x",function(d){return(r(d.targetGroup)+r(d.baseGroup))/2}).attr("y",function(d,_){return u(d.y)-(_+.5)*s}).attr("text-anchor","middle").text(function(d){const _=d.pValue;return _<=1e-4?"****":_<=.001&&_>1e-4?"***":_<=.01&&_>.001?"**":_<=.05&&_>.01?"*":"ns"})}_preparePvalueLables(){const i=this._obtainTheUppestBoxBorder();return this.geneExpForBoxPlot.groupPairsPvalue.map((p,s)=>({baseGroup:p.baseGroup,targetGroup:p.targetGroup,y:i,pValue:p.pValue}))}_obtainTheUppestBoxBorder(){let i=[];this.geneExpForBoxPlot.groupPairsPvalue.forEach(s=>{i.push(s.baseGroup),i.push(s.targetGroup)});const o=new Set(i);let p=[];return this.groupExpStat.forEach(s=>{o.has(s.groupName)&&p.push(s.max)}),(0,c.Fp7)(p)}}return x.\u0275fac=function(i){return new(i||x)(e.Y36(e.SBq))},x.\u0275cmp=e.Xpm({type:x,selectors:[["app-expression-box-plot"]],viewQuery:function(i,o){if(1&i&&e.Gf(I,5),2&i){let p;e.iGM(p=e.CRH())&&(o.boxPlot=p.first)}},inputs:{geneExpForBoxPlot:"geneExpForBoxPlot"},features:[e.TTD],decls:2,vars:0,consts:[[1,"d-flex","align-items-center"],["boxPlot",""]],template:function(i,o){1&i&&e._UZ(0,"div",0,1)},styles:[""],changeDetection:0}),x})(),y=(()=>{class x{constructor(){this.closeSignal$=new e.vpe}ngOnInit(){}closeModalForExpression(i){this.closeSignal$.next(!0)}}return x.\u0275fac=function(i){return new(i||x)},x.\u0275cmp=e.Xpm({type:x,selectors:[["app-display-one-gene-expression"]],inputs:{geneExpForBoxPlot:"geneExpForBoxPlot"},outputs:{closeSignal$:"closeSignal$"},decls:9,vars:3,consts:[[2,"height","1rem"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[3,"geneExpForBoxPlot"]],template:function(i,o){1&i&&(e.TgZ(0,"div",0),e.TgZ(1,"button",1),e.NdJ("click",function(s){return o.closeModalForExpression(s)}),e.TgZ(2,"span",2),e._uU(3,"\xd7"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(4,"p"),e._uU(5),e.qZA(),e._UZ(6,"p"),e.TgZ(7,"div"),e._UZ(8,"app-expression-box-plot",3),e.qZA()),2&i&&(e.xp6(5),e.AsE("",null==o.geneExpForBoxPlot?null:o.geneExpForBoxPlot.geneInfo.ID,", ",null==o.geneExpForBoxPlot?null:o.geneExpForBoxPlot.geneInfo.SYMBOL,""),e.xp6(3),e.Q6J("geneExpForBoxPlot",o.geneExpForBoxPlot))},directives:[C],styles:[""],changeDetection:0}),x})()},7682:(F,P,h)=>{h.d(P,{n:()=>c});var e=h(3668);let c=(()=>{class T{constructor(C,y){this.renderer=C,this.el=y}ngAfterViewInit(){if(this.el.nativeElement.querySelector("table")){this.makeEquealHeaderBodyWidth(),this.tableObserver=new MutationObserver(()=>{this.makeEquealHeaderBodyWidth()}),this.tableObserver.observe(this.el.nativeElement.querySelector("table"),{subtree:!0,childList:!0});const C=this.el.nativeElement.querySelector("div"),y=this.el.nativeElement.querySelector("table"),x=this.el.nativeElement.querySelector("thead"),v=this.el.nativeElement.querySelector("tbody");this.renderer.listen(C,"scroll",i=>{const p=(i.srcElement.scrollLeft+y.offsetWidth).toString()+"px";this.renderer.setStyle(x,"width",p),this.renderer.setStyle(v,"width",p)})}}ngOnDestroy(){this.tableObserver&&(this.tableObserver.disconnect(),this.tableObserver=void 0)}makeEquealHeaderBodyWidth(){let C=[];C=[...this.el.nativeElement.querySelectorAll("thead tr th")].map(v=>v.offsetWidth),this.el.nativeElement.querySelectorAll("tbody tr").forEach(v=>{v.querySelectorAll("td").forEach((i,o)=>{const p=i.offsetWidth;p>=C[o]&&(C[o]=p)})});const x=C.map(v=>v.toString()+"px");this.el.nativeElement.querySelectorAll("thead tr th").forEach((v,i)=>{v.style.minWidth=x[i],v.style.maxWidth=x[i]}),this.el.nativeElement.querySelectorAll("tbody tr").forEach(v=>{v.querySelectorAll("td").forEach((i,o)=>{i.style.minWidth=x[o],i.style.maxWidth=x[o]})})}}return T.\u0275fac=function(C){return new(C||T)(e.Y36(e.Qsj),e.Y36(e.SBq))},T.\u0275dir=e.lG2({type:T,selectors:[["","appTableHeaderBodySameWidth",""]]}),T})()},277:(F,P,h)=>{h.d(P,{Y:()=>T});var e=h(3668);const c={asc:"desc",desc:"","":"asc"};let T=(()=>{class I{constructor(y,x){this.renderer=y,this.el=x,this.sortableColumn="",this.direction="",this.sort=new e.vpe}rotate(){const y=this.el.nativeElement;this.direction&&this.renderer.removeClass(y,this.direction),this.direction=c[this.direction],this.direction&&this.renderer.addClass(y,this.direction),this.sort.emit({column:this.sortableColumn,direction:this.direction})}}return I.\u0275fac=function(y){return new(y||I)(e.Y36(e.Qsj),e.Y36(e.SBq))},I.\u0275dir=e.lG2({type:I,selectors:[["th","sortable",""]],hostVars:4,hostBindings:function(y,x){1&y&&e.NdJ("click",function(){return x.rotate()}),2&y&&e.ekj("asc","asc"===x.direction)("desc","desc"===x.direction)},inputs:{sortableColumn:"sortableColumn",direction:"direction"},outputs:{sort:"sort"}}),I})()}}]);