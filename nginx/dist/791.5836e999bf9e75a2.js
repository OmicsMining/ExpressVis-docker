"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[791],{1791:(gn,X,c)=>{c.r(X),c.d(X,{ClusterExpModule:()=>dn});var x=c(6019),W=c(1144),Se=c(4522),_=c(9133),Ie=c(3063),Ce=c(5479),Y=c(7695),K=c(9256),H=c(8638),O=c(3856),ve=c(3667),Te=c(3928),be=c(8702),e=c(3668),G=c(5043),ee=c(9220),v=c(4099),te=c(2668),ne=c(4102),w=c(5571),T=c(8053),S=c(8735);const xe=function(i){return[i.datasetID,i.genelistID,i.acrossGroupsOrSamples,i.clusterMethod,i.clusterMethodSetting].join("/")},q=function(i,l){return[i,l].join("/")};var C=c(8472),B=c(6813),ye=c(2411),y=c(9204),D=c(6636),Ae=c(2047),we=c(1366),se=c(5389),z=c(1890),Le=c(8970),U=c(2277),He=c(885);const ie=i=>i.clusterExpState.hierarchicalClusList,ae=i=>i.clusterExpState.datasetGeneListClusterResultState,$e=(0,C.P1)(ae,(i,l)=>i.ids),Me=(0,C.P1)(ae,(i,l)=>i.entities[l.clusterResultID]),Ze=(0,C.P1)(i=>i.clusterExpState.clusterResultMapTransformState,(i,l)=>i.entities[l.clusterResultID]),Fe=(0,C.P1)(i=>i.clusterExpState.datasetInfoForCluster,He.ig);(0,C.P1)(Fe,(i,l)=>i[l.datasetID]),(0,C.P1)(ie,(i,l)=>{const t=l.datasetID,n=l.clusterMethod;let s=!1;for(let o of i)if(o.clusterMethod===n&&o.datasetID===t){s=!0;break}return s}),(0,C.P1)(ie,(i,l)=>{const t=l.datasetID,n=l.clusterMethod;let s;for(let o of i)if(o.clusterMethod===n&&o.datasetID===t){s=o;break}return s});var V=c(8425),oe=c(661),P=c(7473),Ne=c(9744),j=c(7548),Oe=c(1118),Q=c(7499),Be=c(7194),Ve=c(4165),We=c(8779),Ye=c(9990),qe=c(9868),Pe=c(4205),je=c(5535),Je=c(4473);let le=(()=>{class i extends Be.g{constructor(t,n,s,o,r,m,g,h){super(t,m,g,h),this.store=t,this.clusterService=n,this.enrichmentService=s,this.trySamppleService=o,this.interAppsInteractService=r,this.requestHierarchicalResultByMethod$=new v.X(null),this.clusterRequest$=new v.X(null),this.IDforRequestResultAndTransformSubject=new v.X(null),this.selectedGenesInfoSubject=new v.X(null),this.speciesIDSubject=new v.X(null),this.geneIDtypeSubject=new v.X(null),this.datasetIDSubject=new v.X(null),this.enrichRequestGenesSubject=new v.X(null),this.oneGeneExpRequestSubject=new v.X(null),this.selectedGenesEnrichedResultSubject$=new v.X(null),this.visSelectedGenesPPIsSubject=new v.X(null),this.addSelectedToGeneListsSubject=new v.X(null),this.geneList2PPIExpSubject=new v.X(null),this.visKeggPathwaySubject=new v.X(null),this.hierarchicalResultForDisplay$=new v.X(null),this.selectedGenesEnrichedResultStatus$=this.selectedGenesEnrichedResultSubject$.asObservable(),this.allDatasetInfoForDisplay$=this.store.pipe((0,C.Ys)(P.yz)).pipe((0,T.U)(a=>[...a].reverse())),this.clusterRequest$.pipe((0,S.h)(a=>null!=a),(0,y.w)(a=>{const u=this.store.pipe((0,C.Ys)(P.iR,{datasetID:a.datasetID}),(0,D.q)(1)),d=this.store.pipe((0,C.Ys)(V.Vq,{ID:a.genelistID}),(0,D.q)(1)).pipe((0,y.w)(f=>this.store.pipe((0,C.Ys)(j.l,{datasetID:a.datasetID,geneIDs:f.genes}),(0,D.q)(1))));return(0,B.D)([u,d]).pipe((0,y.w)(([f,I])=>{const R=`${f.speciesID}-${f.IDtype}`,A=this.clusterService.requestNormalizedValuesSpecificClusterResult({experimentType:f.experimentType,dataArray:I.expressionValues,genes:I.geneIDs,samples:f.samples,groups:f.groups,acrossGroupsOrSamples:a.acrossGroupsOrSamples,clusterMethod:a.clusterMethod,clusterMethodSetting:a.clusterMethodSetting}),F=this.store.pipe((0,C.Ys)(z.MR,{ID:R,geneIDs:I.geneIDs}),(0,D.q)(1));return(0,B.D)([A,F]).pipe((0,T.U)(([L,$])=>{let M;M="SYMBOL"!=f.IDtype?L.leftUniqueTerms.map(ge=>$.get(ge)):[...L.leftUniqueTerms];const N=Object.assign(Object.assign({},L),{leftDisplayTerms:M});return{clusterResultID:xe(a),datasetID:f.datasetID,genelistID:a.genelistID,acrossGroupsOrSamples:a.acrossGroupsOrSamples,clusterMethod:a.clusterMethod,clusterMethodSetting:a.clusterMethodSetting,result:N}}))}))})).subscribe(a=>{this.store.dispatch(U.Ys({clusterResult:a})),this.store.dispatch(U.X5({clusterMapTransform:{clusterResultID:a.clusterResultID,transform:{x:0,y:0,k:1}}}))}),this.availableClusterResultIDs$=this.store.pipe((0,C.Ys)($e)),this.IDforRequestResultAndTransformSubject.pipe((0,S.h)(a=>null!=a),(0,T.U)(a=>function(i){const l=i.split("/");let t;const n=l[3];return"Kmeans"===n?t=parseInt(l[4]):"Hierarchical"===n&&(t=l[4]),{datasetID:l[0],genelistID:l[1],acrossGroupsOrSamples:l[2],clusterMethod:n,clusterMethodSetting:t}}(a)),(0,y.w)(a=>this.store.pipe((0,C.Ys)(P.iR,{datasetID:a.datasetID}),(0,D.q)(1),(0,T.U)(u=>({geneIDtype:u.IDtype,datasetID:u.datasetID,speciesID:u.speciesID}))))).subscribe(a=>{this.geneIDtypeSubject.next(a.geneIDtype),this.datasetIDSubject.next(a.datasetID),this.speciesIDSubject.next(a.speciesID)}),this.datasetGeneListClusterResultAndTransform$=this.IDforRequestResultAndTransformSubject.pipe((0,S.h)(a=>null!=a),(0,y.w)(a=>{const u=this.store.pipe((0,C.Ys)(Me,{clusterResultID:a}),(0,D.q)(1)),d=this.store.pipe((0,C.Ys)(Ze,{clusterResultID:a}),(0,D.q)(1));return(0,B.D)([u,d]).pipe((0,T.U)(([f,I])=>Object.assign(Object.assign({},f),{transform:I.transform})))})),this.phenotypeDataOfCurrentDataset$=this.datasetIDSubject.pipe((0,S.h)(a=>null!=a),(0,y.w)(a=>this.store.pipe((0,C.Ys)(j.nL,{datasetID:a})))),this.selectedGenesInfo$=this.selectedGenesInfoSubject.pipe((0,S.h)(a=>null!=a),(0,w.M)(this.geneIDtypeSubject.pipe((0,S.h)(a=>null!=a)),this.datasetIDSubject.pipe((0,S.h)(a=>null!=a)),this.speciesIDSubject.pipe((0,S.h)(a=>null!=a))),(0,y.w)(([a,u,d,f])=>{const I=(0,Q.sj)(f,u),b=this.store.pipe((0,C.Ys)(z.en,{IDtype:I,geneIDs:a.genes}),(0,D.q)(1)),R=this.store.pipe((0,C.Ys)(j.l,{datasetID:d,geneIDs:a.genes}),(0,D.q)(1));return(0,B.D)([b,R]).pipe((0,T.U)(([A,F])=>(0,Q.Dj)(F,A)))})),this.enrichRequestGenesSubject.pipe((0,S.h)(a=>null!=a),(0,w.M)(this.selectedGenesInfoSubject.pipe((0,S.h)(a=>null!=a)),this.geneIDtypeSubject.pipe((0,S.h)(a=>null!=a)),this.speciesIDSubject.pipe((0,S.h)(a=>null!=a)),this.IDforRequestResultAndTransformSubject.pipe((0,S.h)(a=>null!=a))),(0,y.w)(([a,u,d,f,I])=>{const b={speciesID:f,geneIDtype:d,genes:u.genes,backgroundGenes:a.backgroundGenes},R=q(I,u.clickedNode);return this.enrichmentService.requestGenesEnrichedAnnotations(b).pipe((0,T.U)(A=>({status:"finished",statusValue:"finished",result:{geneListID:R,geneIDtype:d,speciesID:f,enrichedAnnotations:A}})),(0,Ae.K)(A=>(0,ye.of)({status:"error",statusValue:`Error occured while requesting enriched annoations. error:${A.status}, errorText:${A.statusText}`})))})).subscribe(a=>{this.selectedGenesEnrichedResultSubject$.next(a)}),this.selectedGeneExpForBoxPlot$=this.oneGeneExpRequestSubject.pipe((0,S.h)(a=>null!=a),(0,w.M)(this.datasetIDSubject.pipe((0,S.h)(a=>null!=a)),this.geneIDtypeSubject.pipe((0,S.h)(a=>null!=a)),this.speciesIDSubject.pipe((0,S.h)(a=>null!=a))),(0,y.w)(([a,u,d,f])=>{const I=(0,Q.sj)(f,d),b=this.store.pipe((0,C.Ys)(z.ek,{IDtype:I,geneID:a}),(0,D.q)(1)),R=this.store.pipe((0,C.Ys)(P.pO,{datasetID:u}),(0,D.q)(1)),A=this.store.pipe((0,C.Ys)(j.l,{datasetID:u,geneIDs:[a]}),(0,D.q)(1));return(0,B.D)([b,R,A]).pipe((0,T.U)(([F,L,$])=>{const M=$.expressionValues[0],N=$.samples;return{geneInfo:F,groupsExpInfo:L.map(fe=>{const mn=fe.samples.map(_e=>({sampleName:_e,value:M[N.indexOf(_e)]}));return{groupName:fe.name,samplesExpInfo:mn}}),groupPairsPvalue:[]}}))})),this.visSelectedGenesPPIsSubject.pipe((0,S.h)(Boolean),(0,w.M)(this.IDforRequestResultAndTransformSubject.pipe((0,S.h)(a=>null!=a)),this.speciesIDSubject.pipe((0,S.h)(a=>null!=a)),this.geneIDtypeSubject.pipe((0,S.h)(a=>null!=a)),this.selectedGenesInfoSubject.pipe((0,S.h)(a=>null!=a))),(0,T.U)(([a,u,d,f,I])=>({name:q(u,I.clickedNode),speciesID:d,IDtype:f,genes:I.genes})),(0,we.b)(a=>{this.geneList2PPIExpSubject.next(a)}),(0,y.w)(a=>this.store.pipe((0,C.Ys)(V.Ef,{geneListID:a.name}),(0,D.q)(1),(0,S.h)(u=>!u),(0,T.U)(u=>a)))).subscribe(a=>{this.store.dispatch(oe.J({geneList:a}))}),(0,te.aj)([this.store.pipe((0,C.Ys)(V.Dm)),this.geneList2PPIExpSubject.pipe((0,S.h)(a=>null!=a))]).pipe((0,y.w)(([a,u])=>this.store.pipe((0,C.Ys)(V.Ef,{geneListID:u.name}),(0,D.q)(1),(0,S.h)(d=>d),(0,T.U)(d=>u.name))),(0,se.x)()).subscribe(a=>{this.interAppsInteractService.sendGeneList2PPIExp(a)}),this.addSelectedToGeneListsSubject.pipe((0,S.h)(Boolean),(0,w.M)(this.IDforRequestResultAndTransformSubject.pipe((0,S.h)(a=>null!=a)),this.speciesIDSubject.pipe((0,S.h)(a=>null!=a)),this.geneIDtypeSubject.pipe((0,S.h)(a=>null!=a)),this.selectedGenesInfoSubject.pipe((0,S.h)(a=>null!=a))),(0,T.U)(([a,u,d,f,I])=>({name:q(u,I.clickedNode),speciesID:d,IDtype:f,genes:I.genes})),(0,y.w)(a=>this.store.pipe((0,C.Ys)(V.Ef,{geneListID:a.name}),(0,D.q)(1),(0,S.h)(u=>!u),(0,T.U)(u=>a)))).subscribe(a=>{this.store.dispatch(oe.J({geneList:a}))}),this.visKeggPathwaySubject.pipe((0,S.h)(a=>null!=a),(0,w.M)(this.speciesIDSubject),(0,T.U)(([a,u])=>({speciesID:u,pathwayID:a}))).subscribe(a=>{this.interAppsInteractService.sendPathway2KeggExp(a)}),this.trySamppleService.trySampleData$.pipe((0,S.h)(Boolean)).subscribe(a=>{this.store.dispatch(Ne.CF({newState:a.datasetListState})),this.store.dispatch(Oe.gw({newState:a.localExpressDataState})),this.store.dispatch(Le.A({newState:a.geneAnnotationsState})),this.store.dispatch(U.N8({newState:a.clusterExpState}))}),this.trySamplePercentage$=this.trySamppleService.trySamplePercentage$}processClusteringRequest(t){this.clusterRequest$.next(t)}requestClusterResultAndTransform(t){this.IDforRequestResultAndTransformSubject.next(t)}requestSelectedGenesInfo(t){this.selectedGenesInfoSubject.next(t)}requestEnrichedAnnotations(t){this.enrichRequestGenesSubject.next(t)}requestOneGeneExpressionForBoxplot(t){this.oneGeneExpRequestSubject.next(t)}prepareTrySampleData(t){this.trySamppleService.requestTrySampleData(t)}visSelectedGenesPPIs(){this.visSelectedGenesPPIsSubject.next(!0)}addSelectedToGeneLists(){this.addSelectedToGeneListsSubject.next(!0)}visKeggPathway(t){this.visKeggPathwaySubject.next(t)}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(C.yh),e.LFG(Ve.W),e.LFG(We.g),e.LFG(Ye.v),e.LFG(qe.h),e.LFG(Pe.b),e.LFG(je.f),e.LFG(Je.h))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i})();var ke=c(1954),J=c(3405),Z=c(8805);const ze=["Hierarchical","Kmeans"],Ue=["average","single","complete"];var re=c(3013);function Qe(i,l){if(1&i&&(e.TgZ(0,"label",3),e._uU(1),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.hij(" ",t.outRangeLabel," ")}}const Xe=function(i){return{"form-inline":i}};let Ke=(()=>{class i{constructor(t){this.cdr=t,this.formInlineOrNot=!1,this.outputNumber$=new e.vpe,this.destroyNotifier$=new J.xQ}ngOnInit(){this.numberForm=new _.cw({inputNumber:new _.NI(null,[_.kI.required,_.kI.max(10),_.kI.min(1)])}),this.numberForm.get("inputNumber").valueChanges.pipe((0,S.h)(t=>t),(0,Z.R)(this.destroyNotifier$),(0,se.x)()).subscribe(t=>{"VALID"===this.numberForm.get("inputNumber").status&&this.outputNumber$.next(t),this.cdr.detectChanges()})}ngOnDestroy(){this.destroyNotifier$.next(),this.destroyNotifier$.complete()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-input-number"]],inputs:{rangeMin:"rangeMin",rangeMax:"rangeMax",inputLabel:"inputLabel",outRangeLabel:"outRangeLabel",formInlineOrNot:"formInlineOrNot"},outputs:{outputNumber$:"outputNumber$"},decls:4,vars:6,consts:[[3,"ngClass","formGroup"],["type","number","formControlName","inputNumber",1,"form-control","form-control-sm"],["data-testid","inputNumAlert","class","text-danger font-weight-light",4,"ngIf"],["data-testid","inputNumAlert",1,"text-danger","font-weight-light"]],template:function(t,n){1&t&&(e.TgZ(0,"form",0),e._uU(1),e._UZ(2,"input",1),e.YNc(3,Qe,2,1,"label",2),e.qZA()),2&t&&(e.Q6J("ngClass",e.VKq(4,Xe,n.formInlineOrNot))("formGroup",n.numberForm),e.xp6(1),e.hij(" ",n.inputLabel,": "),e.xp6(2),e.Q6J("ngIf",n.numberForm.get("inputNumber").invalid))},directives:[_._Y,_.JL,x.mk,_.sg,_.wV,_.Fj,_.JJ,_.u,x.O5],styles:[""],changeDetection:0}),i})();function et(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"app-select-item",3),e.NdJ("selectedItem$",function(s){return e.CHM(t),e.oxw().processHierarchicalLinkage(s)}),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("inputItems",t.linkageCriterias)("itemLabel","Linkage Criteria")("formInlineOrNot",!1)("ifWidthAuto",!0)}}function tt(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"app-input-number",4),e.NdJ("outputNumber$",function(s){return e.CHM(t),e.oxw().processKmeansClusterNum(s)}),e.qZA()}2&i&&e.Q6J("rangeMin",2)("rangeMax","Infinity")("inputLabel","Cluster Number")("outRangeLabel","Cluster Number should be larger than 2")("formInlineOrNot",!1)}let nt=(()=>{class i{constructor(){this.clusterMethodInfo$=new e.vpe,this.clusterMethods=ze,this.linkageCriterias=Ue,this.destroyNotifier$=new J.xQ,this.methodInfoForm=new _.cw({clusterMethod:new _.NI("",_.kI.required),clusterMethodSetting:new _.NI("",_.kI.required)})}ngOnInit(){this.methodInfoForm.valueChanges.pipe((0,Z.R)(this.destroyNotifier$)).subscribe(t=>{var n;"VALID"===(null===(n=this.methodInfoForm)||void 0===n?void 0:n.status)&&this.clusterMethodInfo$.next(t)})}processClusterMethod(t){this.selectedClusterMethod=t,this.methodInfoForm.patchValue({clusterMethod:t})}processHierarchicalLinkage(t){this.methodInfoForm.patchValue({clusterMethodSetting:t})}processKmeansClusterNum(t){this.methodInfoForm.patchValue({clusterMethodSetting:t})}ngOnDestroy(){this.destroyNotifier$.next(),this.destroyNotifier$.complete()}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-select-cluster-method-and-parameter"]],outputs:{clusterMethodInfo$:"clusterMethodInfo$"},decls:3,vars:6,consts:[["data-testid","selectClusterMethod",1,"mt-2",3,"inputItems","itemLabel","formInlineOrNot","ifWidthAuto","selectedItem$"],["class","mt-2","data-testid","selectHierarLinkage",3,"inputItems","itemLabel","formInlineOrNot","ifWidthAuto","selectedItem$",4,"ngIf"],["class","mt-2","data-testid","inputKmeansNum",3,"rangeMin","rangeMax","inputLabel","outRangeLabel","formInlineOrNot","outputNumber$",4,"ngIf"],["data-testid","selectHierarLinkage",1,"mt-2",3,"inputItems","itemLabel","formInlineOrNot","ifWidthAuto","selectedItem$"],["data-testid","inputKmeansNum",1,"mt-2",3,"rangeMin","rangeMax","inputLabel","outRangeLabel","formInlineOrNot","outputNumber$"]],template:function(t,n){1&t&&(e.TgZ(0,"app-select-item",0),e.NdJ("selectedItem$",function(o){return n.processClusterMethod(o)}),e.qZA(),e.YNc(1,et,1,4,"app-select-item",1),e.YNc(2,tt,1,5,"app-input-number",2)),2&t&&(e.Q6J("inputItems",n.clusterMethods)("itemLabel","Cluster Method")("formInlineOrNot",!1)("ifWidthAuto",!0),e.xp6(1),e.Q6J("ngIf","Hierarchical"===n.selectedClusterMethod),e.xp6(1),e.Q6J("ngIf","Kmeans"===n.selectedClusterMethod))},directives:[re.y,x.O5,Ke],styles:[""],changeDetection:0}),i})();var st=c(1026);function it(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"div"),e.TgZ(1,"app-select-dataset",10),e.NdJ("selectedDatasetID$",function(s){return e.CHM(t),e.oxw().processSelectedDatasetID(s)}),e.qZA(),e.qZA()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("allDatasetInfoForDisplay",t.allDatasetInfoForDisplay)("formInlineOrNot",!1)}}function at(i,l){1&i&&(e.TgZ(0,"h5"),e._uU(1,"Dataset:"),e.qZA(),e.TgZ(2,"p"),e._uU(3,"Please import a dataset first. "),e.TgZ(4,"a",11),e._uU(5,"Import Data"),e.qZA(),e.qZA())}function ot(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"div"),e.TgZ(1,"app-select-item",12),e.NdJ("selectedItem$",function(s){return e.CHM(t),e.oxw().processSelectedGenelistID(s)}),e.qZA(),e.qZA()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("inputItems",t.availableGeneListNames)("itemLabel","Gene List")("emptyNote","Please load or generate a new gene list first")("formInlineOrNot",!1)("ifWidthAuto",!0)}}function lt(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"h5"),e._uU(1,"Gene List:"),e.qZA(),e.TgZ(2,"p"),e._uU(3,"Please load or generate a new gene list "),e.TgZ(4,"a",13),e.NdJ("click",function(s){return e.CHM(t),e.oxw().triggerInputGeneListSignal(s)}),e._uU(5,"New Gene List"),e.qZA(),e.qZA()}}let rt=(()=>{class i{constructor(t){this.cdr=t,this.inputNewGeneListSignal$=new e.vpe,this.clusterRequestInfo$=new e.vpe,this.selectedDatasetID$=new e.vpe,this.acrossTypes=["Across Samples","Across Groups"],this.clusterRequestInfoForm=new _.cw({datasetID:new _.NI("",_.kI.required),genelistID:new _.NI("",_.kI.required),acrossGroupsOrSamples:new _.NI("",_.kI.required),clusterMethod:new _.NI("",_.kI.required),clusterMethodSetting:new _.NI("",_.kI.required)}),this.clusterRequestInfoForm.statusChanges.subscribe(n=>{this.cdr.detectChanges()})}ngOnInit(){}processSelectedDatasetID(t){this.clusterRequestInfoForm.patchValue({datasetID:t}),this.selectedDatasetID$.next(t)}processSelectedGenelistID(t){this.clusterRequestInfoForm.patchValue({genelistID:t})}processAcrossType(t){this.clusterRequestInfoForm.patchValue({acrossGroupsOrSamples:t})}processClusterMethodInfo(t){this.clusterRequestInfoForm.patchValue({clusterMethod:t.clusterMethod,clusterMethodSetting:t.clusterMethodSetting})}submitClusterRequest(t){this.clusterRequestInfo$.next(this.clusterRequestInfoForm.value)}triggerInputGeneListSignal(t){this.inputNewGeneListSignal$.next(!0)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-generate-new-cluster-analysis"]],inputs:{allDatasetInfoForDisplay:"allDatasetInfoForDisplay",availableGeneListNames:"availableGeneListNames"},outputs:{inputNewGeneListSignal$:"inputNewGeneListSignal$",clusterRequestInfo$:"clusterRequestInfo$",selectedDatasetID$:"selectedDatasetID$"},decls:19,vars:8,consts:[[1,"mt-4"],[4,"ngIf","ngIfElse"],["importDataNote",""],["importGeneListNote",""],[1,"mt-2",3,"inputItems","itemLabel","ifOutputFirstValue","selectedItem$"],[1,"mt-3"],[3,"clusterMethodInfo$"],["data-testid","submitNewCluster",1,"mt-2","btn","btn-expressvis",3,"disabled","click"],[1,"border-top","mt-4"],["data-testid","newGeneList",1,"btn","btn-sm",3,"click"],[3,"allDatasetInfoForDisplay","formInlineOrNot","selectedDatasetID$"],["routerLink","/importData"],["data-testid","selectGeneList",1,"mt-2",3,"inputItems","itemLabel","emptyNote","formInlineOrNot","ifWidthAuto","selectedItem$"],["href","javascript:void(0)",3,"click"]],template:function(t,n){if(1&t&&(e.TgZ(0,"h5",0),e._uU(1," Generate a Clustering Analysis\n"),e.qZA(),e.TgZ(2,"div"),e.YNc(3,it,2,2,"div",1),e.YNc(4,at,6,0,"ng-template",null,2,e.W1O),e.YNc(6,ot,2,5,"div",1),e.YNc(7,lt,6,0,"ng-template",null,3,e.W1O),e.TgZ(9,"app-select-between-two-using-radio",4),e.NdJ("selectedItem$",function(o){return n.processAcrossType(o)}),e.qZA(),e.TgZ(10,"div",5),e.TgZ(11,"app-select-cluster-method-and-parameter",6),e.NdJ("clusterMethodInfo$",function(o){return n.processClusterMethodInfo(o)}),e.qZA(),e.qZA(),e.TgZ(12,"button",7),e.NdJ("click",function(o){return n.submitClusterRequest(o)}),e._uU(13," Submit "),e.qZA(),e.TgZ(14,"p",8),e._uU(15,"If the genes are not in the gene lists, click the following button to input a new gene list "),e.qZA(),e.TgZ(16,"button",9),e.NdJ("click",function(o){return n.triggerInputGeneListSignal(o)}),e._uU(17," Load or Generate a new gene list "),e.qZA(),e._UZ(18,"div"),e.qZA()),2&t){const s=e.MAs(5),o=e.MAs(8);e.xp6(3),e.Q6J("ngIf",(null==n.allDatasetInfoForDisplay?null:n.allDatasetInfoForDisplay.length)>0)("ngIfElse",s),e.xp6(3),e.Q6J("ngIf",(null==n.availableGeneListNames?null:n.availableGeneListNames.length)>0)("ngIfElse",o),e.xp6(3),e.Q6J("inputItems",n.acrossTypes)("itemLabel","Across samples or groups")("ifOutputFirstValue",!0),e.xp6(3),e.Q6J("disabled","VALID"!=n.clusterRequestInfoForm.status)}},directives:[x.O5,ke.W,nt,st.z,W.yS,re.y],styles:[""],changeDetection:0}),i})();function ct(i,l){if(1&i&&(e.TgZ(0,"option",5),e._uU(1),e.qZA()),2&i){const t=l.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t," ")}}function pt(i,l){1&i&&(e.TgZ(0,"label",6),e._uU(1," Generate a Cluster Analysis in the Left Sidebar "),e.qZA())}let ut=(()=>{class i{constructor(){this.selectedClusterID$=new e.vpe,this.destroyNotifier$=new J.xQ,this.clusterSelectForm=new _.cw({clusterID:new _.NI("",_.kI.required)})}ngOnInit(){this.clusterSelectForm.get("clusterID").valueChanges.pipe((0,Z.R)(this.destroyNotifier$)).subscribe(t=>{this.selectedClusterID$.next(t)})}ngOnChanges(t){t.geneListclusterIDs&&!t.geneListclusterIDs.isFirstChange()&&this.clusterSelectForm.patchValue({clusterID:[...this.geneListclusterIDs][0]})}ngOnDestroy(){this.destroyNotifier$.next(),this.destroyNotifier$.complete()}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-select-a-cluster-result"]],inputs:{geneListclusterIDs:"geneListclusterIDs"},outputs:{selectedClusterID$:"selectedClusterID$"},features:[e.TTD],decls:6,vars:3,consts:[[1,"form-inline",3,"formGroup"],["for","clusterSelect"],["formControlName","clusterID",1,"form-control","form-control-sm","ml-2"],[3,"value",4,"ngFor","ngForOf"],["class","text-danger font-weight-light",4,"ngIf"],[3,"value"],[1,"text-danger","font-weight-light"]],template:function(t,n){1&t&&(e.TgZ(0,"form",0),e.TgZ(1,"label",1),e._uU(2,"Select a Cluster Result:"),e.qZA(),e.TgZ(3,"select",2),e.YNc(4,ct,2,2,"option",3),e.qZA(),e.YNc(5,pt,2,0,"label",4),e.qZA()),2&t&&(e.Q6J("formGroup",n.clusterSelectForm),e.xp6(4),e.Q6J("ngForOf",n.geneListclusterIDs),e.xp6(1),e.Q6J("ngIf",!((null==n.geneListclusterIDs?null:n.geneListclusterIDs.length)>=1&&n.geneListclusterIDs)))},directives:[_._Y,_.JL,_.sg,_.EJ,_.JJ,_.u,x.sg,x.O5,_.YN,_.Kr],styles:[""],changeDetection:0}),i})();var ht=c(9918),E=c(2307),ce=c(5686),pe=c(94);function dt(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"div",2),e.TgZ(1,"fa-icon",3),e.NdJ("click",function(s){return e.CHM(t),e.oxw().showToggleOff(s)}),e.qZA(),e.qZA()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("icon",t.faToggleOn)("size","1x")("ngbTooltip",t.onToolTip)}}function mt(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"div",4),e.TgZ(1,"fa-icon",3),e.NdJ("click",function(s){return e.CHM(t),e.oxw().showToggleOn(s)}),e.qZA(),e.qZA()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("icon",t.faToggleOff)("size","1x")("ngbTooltip",t.offToolTip)}}let gt=(()=>{class i{constructor(){this.defaultToggleStatus="on",this.onToolTip="Toggle Off",this.offToolTip="Toggle On",this.toggleStatus$=new e.vpe,this.faToggleOn=G.WZW,this.faToggleOff=G.Bl_}ngOnInit(){this.toggleStatus=this.defaultToggleStatus}showToggleOff(t){this.toggleStatus="off",this.toggleStatus$.next(this.toggleStatus)}showToggleOn(t){this.toggleStatus="on",this.toggleStatus$.next(this.toggleStatus)}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-toogle-on-off"]],inputs:{defaultToggleStatus:"defaultToggleStatus",onToolTip:"onToolTip",offToolTip:"offToolTip"},outputs:{toggleStatus$:"toggleStatus$"},decls:2,vars:2,consts:[["data-testid","toggleOn",4,"ngIf"],["data-testid","toggleOff",4,"ngIf"],["data-testid","toggleOn"],[1,"hoverBigger",3,"icon","size","ngbTooltip","click"],["data-testid","toggleOff"]],template:function(t,n){1&t&&(e.YNc(0,dt,2,3,"div",0),e.YNc(1,mt,2,3,"div",1)),2&t&&(e.Q6J("ngIf","on"===n.toggleStatus),e.xp6(1),e.Q6J("ngIf","off"===n.toggleStatus))},directives:[x.O5,O.BN,H._L],styles:[""],changeDetection:0}),i})();function ft(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"button",4),e.NdJ("click",function(){const o=e.CHM(t).$implicit;return e.oxw().outputColorScaleSetting(o)}),e._uU(1),e.qZA()}if(2&i){const t=l.$implicit;e.xp6(1),e.AsE(" Low ",t.lowValueColor,", High ",t.highValueColor," ")}}let ue=(()=>{class i{constructor(){this.colorScaleSetting$=new e.vpe,this.colorScaleInfos=[{lowValueColor:"blue",middleValueColor:"white",highValueColor:"red"},{lowValueColor:"blue",middleValueColor:"grey",highValueColor:"yellow"},{lowValueColor:"green",middleValueColor:"white",highValueColor:"red"}]}ngOnInit(){}outputColorScaleSetting(t){this.colorScaleSetting$.next(t)}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-select-color-scale"]],outputs:{colorScaleSetting$:"colorScaleSetting$"},decls:5,vars:1,consts:[["ngbDropdown","",1,"d-inline-block"],["id","dropdownBasic1","ngbDropdownToggle","",1,"btn","btn-sm","btn-outline-expressvis"],["ngbDropdownMenu","","aria-labelledby","dropdownBasic1"],["ngbDropdownItem","",3,"click",4,"ngFor","ngForOf"],["ngbDropdownItem","",3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"button",1),e._uU(2,"Color"),e.qZA(),e.TgZ(3,"div",2),e.YNc(4,ft,2,2,"button",3),e.qZA(),e.qZA()),2&t&&(e.xp6(4),e.Q6J("ngForOf",n.colorScaleInfos))},directives:[H.jt,H.iD,H.Vi,x.sg,H.TH],styles:[""],changeDetection:0}),i})();var _t=c(5150),he=c(2326),de=c(3945),me=c(9232),St=c(4080);function It(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"div"),e.TgZ(1,"div",8),e.TgZ(2,"p",9),e._uU(3),e.qZA(),e.TgZ(4,"div",10),e.TgZ(5,"fa-icon",11),e.NdJ("click",function(){const o=e.CHM(t).index;return e.oxw().removeThisAnnotation(o)}),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&i){const t=l.$implicit,n=e.oxw();e.xp6(3),e.Oqu(t),e.xp6(2),e.Q6J("icon",n.faMinus)("size","1x")}}function Ct(i,l){if(1&i&&(e.TgZ(0,"option",12),e._uU(1),e.qZA()),2&i){const t=l.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t," ")}}let vt=(()=>{class i{constructor(){this.samplesAnnotations$=new e.vpe,this.closeSignal$=new e.vpe,this.formWidth="10rem",this.faMinus=G.Kl4,this.faPlus=G.r8p,this.selectedAnnotations=[],this.annotationNames=[]}ngOnInit(){this.phenotypeData&&(this.annotationNames=Object.keys(this.phenotypeData)),this.existedSamplesAnnotations&&(this.selectedAnnotations=this.existedSamplesAnnotations.map(t=>t.annotationName))}ngOnChanges(t){t.phenotypeData&&!t.phenotypeData.isFirstChange()&&this.phenotypeData&&(this.annotationNames=Object.keys(this.phenotypeData),this.selectedAnnotations=this.existedSamplesAnnotations.map(n=>n.annotationName)),t.existedSamplesAnnotations&&!t.existedSamplesAnnotations&&(this.selectedAnnotations=this.existedSamplesAnnotations.map(n=>n.annotationName))}removeThisAnnotation(t){this.selectedAnnotations=this.selectedAnnotations.filter((n,s)=>s!=t),this._outputSamplesAnnotations()}addAnewAnnotation(t){this.selectedAnnotations.push(t.target.value),this._outputSamplesAnnotations()}closeThisComponent(t){this.closeSignal$.next(!0)}_outputSamplesAnnotations(){const t=this.selectedAnnotations.map(n=>{let s=new Map,o=[];for(let[h,a]of(0,me.$R)(this.phenotypeData.samples,this.phenotypeData[n]))s.set(h,a),o.push(a);const r=[...new Set(o)],m=(0,St.y)(r.length);let g=new Map;for(let[h,a]of(0,me.$R)(r,m))g.set(h,a);return{annotationName:n,annotationValues:s,values2color:g}});this.samplesAnnotations$.next(t)}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-generate-info-for-samples-annotations"]],inputs:{phenotypeData:"phenotypeData",existedSamplesAnnotations:"existedSamplesAnnotations"},outputs:{samplesAnnotations$:"samplesAnnotations$",closeSignal$:"closeSignal$"},features:[e.TTD],decls:13,vars:6,consts:[[2,"height","1rem"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[4,"ngFor","ngForOf"],[1,"form-inline"],[1,"hoverBigger",3,"icon","size"],["formControlName","itemValue","data-testid","selectItem",1,"form-control","form-control-sm","ml-1",3,"change"],[3,"value",4,"ngFor","ngForOf"],[1,"d-flex"],[2,"margin-bottom","0rem"],[1,"form-inline","ml-1"],["ngbTooltip","Delete this annotation",1,"hoverBigger",3,"icon","size","click"],[3,"value"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"button",1),e.NdJ("click",function(o){return n.closeThisComponent(o)}),e.TgZ(2,"span",2),e._uU(3,"\xd7"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(4,"p"),e._uU(5,"Select a attribute from phenotype data and add it to samples annotations"),e.qZA(),e.YNc(6,It,6,3,"div",3),e.TgZ(7,"div",4),e._UZ(8,"fa-icon",5),e.TgZ(9,"select",6),e.NdJ("change",function(o){return n.addAnewAnnotation(o)}),e.TgZ(10,"option"),e._uU(11,"---"),e.qZA(),e.YNc(12,Ct,2,2,"option",7),e.qZA(),e.qZA()),2&t&&(e.xp6(6),e.Q6J("ngForOf",n.selectedAnnotations),e.xp6(2),e.Q6J("icon",n.faPlus)("size","1x"),e.xp6(1),e.Udp("width",n.formWidth),e.xp6(3),e.Q6J("ngForOf",n.annotationNames))},directives:[x.sg,O.BN,_.EJ,_.JJ,_.u,_.YN,_.Kr,H._L],styles:[""],changeDetection:0}),i})();const Tt=["svgContainer"];function bt(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"div",12),e.TgZ(1,"app-change-figure-settings",13),e.NdJ("modifiedSettings$",function(s){return e.CHM(t),e.oxw().changePlotSettings(s)})("closeSignal$",function(s){return e.CHM(t),e.oxw().showSettings(s)}),e.qZA(),e.qZA()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("plotSettingInfoList",t.plotSettingInfoList)}}function xt(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"div",14),e.TgZ(1,"app-generate-info-for-samples-annotations",15),e.NdJ("samplesAnnotations$",function(s){return e.CHM(t),e.oxw().processSamplesAnnotations(s)})("closeSignal$",function(s){return e.CHM(t),e.oxw().showAddSampplesAnnotationbarComponent(s)}),e.qZA(),e.qZA()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("phenotypeData",t.phenotypeData)("existedSamplesAnnotations",t.existedSamplesAnnotations)}}const Dt=function(i){return{"min-height":i}};let Rt=(()=>{class i extends pe.e{constructor(t){super(),this.cdr=t,this.genesSelected$=new e.vpe,this.faCog=G.b7W,this.faPlus=G.r8p,this.defaultBasicSetting={width:300,height:500,marginTop:10,marginRight:60,marginBottom:50,marginLeft:5,leftDendgroWidth:60,topDendgroHeight:50,heatmapWidth:200,heatmapHeight:300,verticalScaleIndicatorWidth:30,horizontalScaleIndicatorHeight:15,xLabelRotationDegree:-30,xLabelsFontSize:1,yLabelsFontSize:.5,annotationBarHeight:10,indicatorAnnotationBarGap:2,annotationBarHeatmapGap:2,annotationWithinGap:1,yLabelsWidth:20,annotationLabelWidth:10},this.ifShowSettingsComponent=!1,this.plotSettingInfoList=[{name:"width",defaultValue:300,minValue:50,maxValue:500,stepValue:1},{name:"height",defaultValue:250,minValue:50,maxValue:600,stepValue:1}],this.containerMinHeight=500,this.changedSettingsSubject=new v.X(null),this.existedSamplesAnnotations=[],this.downloadPngName="hierarchical-cluster-result.png",this.downloadPDFname="hierarchical-cluster-result.pdf",this.ifShowAddSamplesBarComponent=!1}ngOnInit(){this.changedSettingsSubject.pipe((0,S.h)(t=>null!=t),(0,ce.b)(2e3),(0,Z.R)(this.destroyNotifier$)).subscribe(t=>{this._preparePlotSettingInfoList()}),this._determineContainerMinHeight()}ngAfterViewInit(){this._extractHierarchicalResultForDisplay()}ngOnChanges(t){t.clusterResultTransform&&!t.clusterResultTransform.isFirstChange()&&this._extractHierarchicalResultForDisplay()}changePlotSettings(t){const n=Object.assign(Object.assign({},t),{height:this.initialBasicSetting.marginTop+t.horizontalScaleIndicatorHeight+t.topDendgroHeight+t.heatmapHeight+t.marginBottom,width:this.initialBasicSetting.marginLeft+t.leftDendgroWidth+t.verticalScaleIndicatorWidth+t.heatmapWidth+this.initialBasicSetting.yLabelsWidth+t.marginRight,indicatorAnnotationBarGap:this.initialBasicSetting.annotationBarHeatmapGap,annotationBarHeight:this.initialBasicSetting.annotationBarHeight,annotationBarHeatmapGap:this.initialBasicSetting.annotationBarHeatmapGap,annotationWithinGap:this.initialBasicSetting.annotationWithinGap,yLabelsWidth:this.initialBasicSetting.yLabelsWidth,yLabelsFontSize:this.initialBasicSetting.yLabelsFontSize,annotationLabelWidth:this.initialBasicSetting.annotationLabelWidth,marginLeft:this.initialBasicSetting.marginLeft,marginTop:this.initialBasicSetting.marginTop});this.hierarchicalResultForDisplay=Object.assign(Object.assign({},this.hierarchicalResultForDisplay),{basicSetting:Object.assign({},n)}),this.initialBasicSetting=Object.assign({},n),this.changedSettingsSubject.next(n)}showSettings(t){this.ifShowSettingsComponent=!this.ifShowSettingsComponent,this.ifShowAddSamplesBarComponent=!1}showAddSampplesAnnotationbarComponent(t){this.ifShowAddSamplesBarComponent=!this.ifShowAddSamplesBarComponent,this.ifShowSettingsComponent=!1}processSamplesAnnotations(t){const n=this.initialBasicSetting.indicatorAnnotationBarGap+this.initialBasicSetting.annotationBarHeatmapGap+t.length*(this.initialBasicSetting.annotationBarHeight+this.initialBasicSetting.annotationWithinGap),s=Object.assign(Object.assign({},this.hierarchicalResultForDisplay.basicSetting),{height:this.initialBasicSetting.height+n});this.initialBasicSetting=Object.assign({},s),this.changedSettingsSubject.next(s),this.hierarchicalResultForDisplay=Object.assign(Object.assign({},this.hierarchicalResultForDisplay),{samplesAnnotations:t,basicSetting:s}),this.existedSamplesAnnotations=[...t],this.cdr.detectChanges()}displayTopDendgrogramWithRawOrder(t){let n="on"===t;this.hierarchicalResultForDisplay=Object.assign(Object.assign({},this.hierarchicalResultForDisplay),{ifDisplayTopTermsWithRawOrder:n})}displayLeftDendgrogramWithRawOrder(t){let n="on"===t;this.hierarchicalResultForDisplay=Object.assign(Object.assign({},this.hierarchicalResultForDisplay),{ifDisplayLeftTermsWithRawOrder:n})}processNodesSelected(t){this.genesSelected$.next({clickedNode:t.clickedNode,genes:t.selectedNodes})}processColorScaleSetting(t){this.hierarchicalResultForDisplay=Object.assign(Object.assign({},this.hierarchicalResultForDisplay),{colorScaleSetting:t})}_extractHierarchicalResultForDisplay(){if(this.clusterResultTransform){const t=this.clusterResultTransform.result;this.initialBasicSetting=this._obtainBasicSettings(),this.hierarchicalResultForDisplay={clusterResult:Object.assign({},t),transform:Object.assign({},this.clusterResultTransform.transform),basicSetting:this.initialBasicSetting,colorScaleSetting:{lowValueColor:"blue",middleValueColor:"white",highValueColor:"red"},ifDisplayTopTermsWithRawOrder:!1,ifDisplayLeftTermsWithRawOrder:!1},this._preparePlotSettingInfoList(),this.downloadPngName=this.clusterResultTransform.clusterResultID+".png"}this.cdr.detectChanges()}_determineContainerMinHeight(){this.containerMinHeight=.7*document.documentElement.clientHeight-500>0?.7*document.documentElement.clientHeight:500}_obtainBasicSettings(){const t=Object.assign({},this.defaultBasicSetting),n=this._obtainSvgWidth(),s=this._obtainIdeamHeatmapWidth(),o=this.defaultBasicSetting.marginLeft+this.defaultBasicSetting.verticalScaleIndicatorWidth+this.defaultBasicSetting.leftDendgroWidth+this.defaultBasicSetting.yLabelsWidth+this.defaultBasicSetting.marginRight,r=this._obtainYlabelsWidth();if(o+s<=n){t.heatmapWidth=s,t.width=n;const m=t.marginLeft+t.verticalScaleIndicatorWidth+t.leftDendgroWidth+t.heatmapWidth+t.marginRight;m+r<=t.width?(t.yLabelsWidth=r,t.width=m+r):t.yLabelsWidth=n-m}else t.width=n,t.heatmapWidth=n-o;return t.marginBottom=this._obtainMarginBottom(),t.height=this.containerMinHeight-30,t.heatmapHeight=t.height-(t.marginTop+t.horizontalScaleIndicatorHeight+t.topDendgroHeight+t.marginBottom),t}_obtainSvgWidth(){return this.svgContainer.nativeElement.clientWidth}_obtainIdeamHeatmapWidth(){const t=-this.defaultBasicSetting.xLabelRotationDegree*Math.PI/180;return(0,E.H9)(this.defaultBasicSetting.xLabelsFontSize)/Math.sin(t)*this.clusterResultTransform.result.topDisplayTerms.length}_obtainYlabelsWidth(){let t=0;const n=(0,E.H9)(this.defaultBasicSetting.yLabelsFontSize);return this.clusterResultTransform.result.leftDisplayTerms.forEach(s=>{const o=(null==s?void 0:s.length)*n;o>t&&(t=o)}),t+5}_obtainMarginBottom(){let t=0;const n=(0,E.H9)(this.defaultBasicSetting.xLabelsFontSize);return this.clusterResultTransform.result.topDisplayTerms.forEach(s=>{const o=-this.defaultBasicSetting.xLabelRotationDegree*Math.PI/180,r=s.length*n*Math.sin(o)+1.32*n*Math.cos(o);r>t&&(t=r)}),t+5}_preparePlotSettingInfoList(){this.plotSettingInfoList=[{name:"marginRight",defaultValue:this.initialBasicSetting.marginRight,minValue:5,maxValue:200,stepValue:1},{name:"marginBottom",defaultValue:this.initialBasicSetting.marginBottom,minValue:5,maxValue:200,stepValue:1},{name:"xLabelRotationDegree",defaultValue:this.initialBasicSetting.xLabelRotationDegree,minValue:-90,maxValue:0,stepValue:1},{name:"xLabelsFontSize",defaultValue:this.initialBasicSetting.xLabelsFontSize,minValue:.5,maxValue:5,stepValue:.1},{name:"leftDendgroWidth",defaultValue:this.initialBasicSetting.leftDendgroWidth,minValue:10,maxValue:200,stepValue:1},{name:"topDendgroHeight",defaultValue:this.initialBasicSetting.topDendgroHeight,minValue:10,maxValue:200,stepValue:1},{name:"heatmapWidth",defaultValue:this.initialBasicSetting.heatmapWidth,minValue:50,maxValue:800,stepValue:1},{name:"heatmapHeight",defaultValue:this.initialBasicSetting.heatmapHeight,minValue:50,maxValue:800,stepValue:1},{name:"verticalScaleIndicatorWidth",defaultValue:this.initialBasicSetting.verticalScaleIndicatorWidth,minValue:5,maxValue:100,stepValue:1},{name:"horizontalScaleIndicatorHeight",defaultValue:this.initialBasicSetting.horizontalScaleIndicatorHeight,minValue:10,maxValue:100,stepValue:1}]}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-vis-hierarchical-cluster-result"]],viewQuery:function(t,n){if(1&t&&e.Gf(Tt,5),2&t){let s;e.iGM(s=e.CRH())&&(n.svgContainer=s.first)}},inputs:{clusterResultTransform:"clusterResultTransform",phenotypeData:"phenotypeData"},outputs:{genesSelected$:"genesSelected$"},features:[e.qOj,e.TTD],decls:14,vars:20,consts:[[1,"d-flex","justify-content-end","align-items-center"],[1,"ml-1",3,"defaultToggleStatus","onToolTip","offToolTip","toggleStatus$"],[1,"ml-1"],["ngbTooltip","Click to add samples annotation bar",1,"hoverBigger","close",3,"icon","size","click"],["ngbTooltip","Change heatmap color scale",1,"ml-1",3,"colorScaleSetting$"],[1,"form-inline","ml-1"],["ngbTooltip","Click to change settings of the plot",1,"hoverBigger","close",3,"icon","size","click"],["cdkDrag","","class","border p-3","style","position: absolute; z-index: 1014;top: 2rem; right: -10rem; background-color: white",4,"ngIf"],["cdkDrag","","class","border p-3","style","position: absolute; z-index: 1014;top: 2rem; right: -10rem; background-color: white; width: 20rem",4,"ngIf"],[1,"d-flex","flex-column","justify-content-center",3,"ngStyle"],["svgContainer",""],["appD3ExportMap","",3,"pngName","pdfName","hierarchicalResultForDisplay","auditTime","highlightUseCoverOrClass","nodesSelected$"],["cdkDrag","",1,"border","p-3",2,"position","absolute","z-index","1014","top","2rem","right","-10rem","background-color","white"],[3,"plotSettingInfoList","modifiedSettings$","closeSignal$"],["cdkDrag","",1,"border","p-3",2,"position","absolute","z-index","1014","top","2rem","right","-10rem","background-color","white","width","20rem"],[3,"phenotypeData","existedSamplesAnnotations","samplesAnnotations$","closeSignal$"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"app-toogle-on-off",1),e.NdJ("toggleStatus$",function(o){return n.displayTopDendgrogramWithRawOrder(o)}),e.qZA(),e.TgZ(2,"app-toogle-on-off",1),e.NdJ("toggleStatus$",function(o){return n.displayLeftDendgrogramWithRawOrder(o)}),e.qZA(),e.TgZ(3,"div",2),e._uU(4," Annotation "),e.TgZ(5,"fa-icon",3),e.NdJ("click",function(o){return n.showAddSampplesAnnotationbarComponent(o)}),e.qZA(),e.qZA(),e.TgZ(6,"app-select-color-scale",4),e.NdJ("colorScaleSetting$",function(o){return n.processColorScaleSetting(o)}),e.qZA(),e.TgZ(7,"div",5),e.TgZ(8,"fa-icon",6),e.NdJ("click",function(o){return n.showSettings(o)}),e.qZA(),e.qZA(),e.qZA(),e.YNc(9,bt,2,1,"div",7),e.YNc(10,xt,2,2,"div",8),e.TgZ(11,"div",9,10),e.TgZ(13,"app-dendgrogram-vis",11),e.NdJ("nodesSelected$",function(o){return n.processNodesSelected(o)}),e.qZA(),e.qZA()),2&t&&(e.xp6(1),e.Q6J("defaultToggleStatus","off")("onToolTip","Cluster columns")("offToolTip","Do not cluster columns"),e.xp6(1),e.Q6J("defaultToggleStatus","off")("onToolTip","Cluster rows")("offToolTip","Do not cluster rows"),e.xp6(3),e.Q6J("icon",n.faPlus)("size","sm"),e.xp6(3),e.Q6J("icon",n.faCog)("size","sm"),e.xp6(1),e.Q6J("ngIf",n.ifShowSettingsComponent),e.xp6(1),e.Q6J("ngIf",n.ifShowAddSamplesBarComponent),e.xp6(1),e.Q6J("ngStyle",e.VKq(18,Dt,n.containerMinHeight)),e.xp6(2),e.Q6J("pngName",n.downloadPngName)("pdfName",n.downloadPDFname)("hierarchicalResultForDisplay",n.hierarchicalResultForDisplay)("auditTime",300)("highlightUseCoverOrClass","useCover"))},directives:[gt,O.BN,H._L,ue,x.O5,x.PC,_t.J,he.I,Y.Zt,de.q,vt],styles:[""],changeDetection:0}),i})();var p=c(3203),yt=c(8105);const At=["svgElement"],wt=["heatmap"],Lt=["heatmapCoverRects"],Ht=["xLabels"],Gt=["xLabelsCoverRects"],Et=["yLabels"],$t=["yLabelsCoverRects"],Mt=["verticalScaleIndicators"],Zt=["horizontalScaleIndicators"],Ft=["upCoverForHighlight"],Nt=["downCoverForHighlight"];let Ot=(()=>{class i{constructor(){this.selectedClusterIndex$=new e.vpe,this.mapSettings$=new e.vpe,this.clusterGap=4,this.svgHeight=100,this.svgWidth=200,this.marginTop=10,this.marginLeft=10,this.marginRight=10,this.marginBottom=10,this.verticalScaleIndicatorWidth=30,this.verticalIndicatorHeatmapGap=5,this.VERTICAL_MOVE_BAR_HEIGHT=5,this.HORIZONAL_MOVE_BAR_WIDTH=5,this.horizontalScaleIndicatorHeight=30,this.horizontalIndicatorHeatmapGap=5,this.xLabelFontSize=2,this.xLabelRotationDegree=-30,this.yLabelFontSize=1,this.rowHeight=4,this.rectWidth=6,this.clickedClusterIndex=-1,this.transformOneDirectionInfo={realTranslateX:0,realTranslateY:0,zoomTranslateX:0,zoomTranslateY:0,realScaleX:1,realScaleY:1,zoomScale:1},this.initialxLableXTranslate=[],this.zoomFromScaleBar$=new v.X(null),this.destroyNotifier$=new J.xQ,this.zoomFromScaleBar$.pipe((0,Z.R)(this.destroyNotifier$),(0,S.h)(t=>null!=t),(0,yt.e)(this.auditTime)).subscribe(t=>{const n=t.scaleBarSetting;if("vertical"===t.sourceOrientation){const s=this._convertScrollBarParameters2zoomParameters(t.sourceOrientation,n,Object.assign({},this.transformOneDirectionInfo));this._transformMapUsingRealZoomValues(s.realTranslateX,s.realTranslateY,s.realScaleX,s.realScaleY),this._updateTransformInfo(s),this._modifyVerticalScaleIndicators(n.smallEndRectLong,n.middleRectLong,n.bigEndRectLong,n.indicatorLong,this.VERTICAL_MOVE_BAR_HEIGHT),this._toggleYlabelsVisibility(s.realScaleY),this.clickedClusterIndex>=0&&this._highlightClickedCluster(this.clickedClusterIndex),this.mapSettings$.next(s)}else if("horizontal"===t.sourceOrientation){const s=this._convertScrollBarParameters2zoomParameters(t.sourceOrientation,n,Object.assign({},this.transformOneDirectionInfo));this._transformMapUsingRealZoomValues(s.realTranslateX,s.realTranslateY,s.realScaleX,s.realScaleY),this._updateTransformInfo(s),this._modifyHorizontalScaleIndicators(n.smallEndRectLong,n.middleRectLong,n.bigEndRectLong,n.indicatorLong,this.HORIZONAL_MOVE_BAR_WIDTH),this.mapSettings$.next(s)}})}ngOnInit(){}ngAfterViewInit(){this._initMap()}ngOnChanges(t){t.kmeansClusterResult&&!t.kmeansClusterResult.isFirstChange()&&this._initMap()}ngOnDestroy(){this.destroyNotifier$.next(),this.destroyNotifier$.complete()}_removeGraphicAndResetSettings(){if(this.d3Svg){let t=function(n){(0,p.Ys)(n).selectAll("*").remove()};t(this.heatmap.nativeElement),t(this.heatmapCoverRects.nativeElement),t(this.verticalScaleIndicators.nativeElement),t(this.horizontalScaleIndicators.nativeElement),t(this.xLabels.nativeElement),t(this.xLabelsCoverRects.nativeElement),t(this.yLabels.nativeElement),t(this.yLabelsCoverRects.nativeElement)}this.transformOneDirectionInfo={realTranslateX:0,realTranslateY:0,zoomTranslateX:0,zoomTranslateY:0,realScaleX:1,realScaleY:1,zoomScale:1}}_initMap(){this.kmeansClusterResult&&(this._removeGraphicAndResetSettings(),this._prepareSvgSettings(),this._drawHeatmaps(),this._addXlabels(),this._addYlabels(),this._toggleYlabelsVisibility(this.transformOneDirectionInfo.realScaleY),this._drawCoversForHighlight(),this._addVerticalScaleIndicators(),this._addHorizontalScaleIndicators(),this._addCoverBoxes())}_prepareSvgSettings(){const t=this.kmeansClusterResult.basicSetting;this.clusterNum=this.kmeansClusterResult.subClusters.length,this.rowsNum=this._computeRowsNum(),this.xLabelsNum=this._computeRectsNum(),this.svgHeight=t.height,this.svgWidth=t.width,this.marginRight=t.marginRight,this.marginBottom=t.marginBottom,this.marginLeft=t.marginLeft,this.heatmapHeight=t.heatmapHeight,this.heatmapWidth=t.heatmapWidth,this.verticalScaleIndicatorWidth=t.verticalScaleIndicatorWidth,this.verticalIndicatorHeatmapGap=t.verticalIndicatorHeatmapGap,this.horizontalScaleIndicatorHeight=t.horizontalScaleIndicatorHeight,this.horizontalIndicatorHeatmapGap=t.horizontalIndicatorHeatmapGap,this.svgLeft2HeatmapWidth=this.marginLeft+this.verticalScaleIndicatorWidth+this.verticalIndicatorHeatmapGap,this.svgTop2HeatmapHeight=this.marginTop+this.horizontalScaleIndicatorHeight+this.horizontalIndicatorHeatmapGap,this.rowHeight=this._computeRowHeight(),this.rectWidth=this._computeRectWidth(),this.Y_LABLE_CHARACTER_HEIGHT=(0,E.Po)(this.yLabelFontSize),this.clustersYpos=this._computeSubclustersYpos(),this.topDisplayTerms=this.kmeansClusterResult.topDisplayTerms,this.d3Svg=(0,p.Ys)(this.svgElement.nativeElement),this.d3Svg.attr("width",this.svgWidth),this.d3Svg.attr("height",this.svgHeight)}_drawHeatmaps(){const t=this,n=this._obtainAllValuesAsArray(),s=this.kmeansClusterResult.colorScaleSetting,o=(0,p.BYU)().domain([0,.5,1]).range([s.lowValueColor,s.middleValueColor,s.highValueColor]),r=(0,p.BYU)().domain([(0,p.VV$)(n),(0,p.Fp7)(n)]).range([0,1]);(0,p.Ys)(this.heatmap.nativeElement).attr("transform","translate("+t.svgLeft2HeatmapWidth+" "+t.svgTop2HeatmapHeight+")"),this.kmeansClusterResult.subClusters.forEach((m,g)=>{const h=m.dataMatrix;(0,p.Ys)(this.heatmap.nativeElement).append("g").attr("class","subMap").attr("ifClicked",!1).attr("transform","translate(0 "+t.clustersYpos[g]+")").on("click",function(){"false"===(0,p.Ys)(this).attr("ifClicked")?(t.selectedClusterIndex$.next(g),(0,p.Ys)(this).attr("ifClicked",!0),t.clickedClusterIndex=g,t._highlightClickedCluster(g)):(t.selectedClusterIndex$.next(-1),t.clickedClusterIndex=-1,t._disHighlightClickedCluster(),(0,p.Ys)(this).attr("ifClicked",!1))}).selectAll(".row").data(h).enter().append("g").attr("transform",function(d,f){return"translate(0, "+f*t.rowHeight+")"}).selectAll(".rect").data(function(d){return d}).enter().append("rect").attr("class","grid").attr("width",t.rectWidth).attr("height",t.rowHeight).attr("x",function(d,f){return t.rectWidth*f}).attr("stroke-width",0).style("fill",function(d){if(isNaN(d))return"white";{let f=r(d);return o(f)}})})}_addYlabels(){const t=this;(0,p.Ys)(this.yLabels.nativeElement).attr("transform","translate("+(t.svgLeft2HeatmapWidth+t.heatmapWidth)+" "+t.svgTop2HeatmapHeight+")").attr("visibility","hidden"),this.kmeansClusterResult.subClusters.forEach((n,s)=>{const o=n.leftDisplayTerms;(0,p.Ys)(this.yLabels.nativeElement).append("g").attr("class","subYlabelText").attr("transform","translate(0 "+t.clustersYpos[s]+")").selectAll("text").data(o).enter().append("text").attr("transform",function(m,g){return"translate(0, "+(g+.5)*t.rowHeight+")"}).text(function(m){return m}).attr("dy",.32*t.yLabelFontSize+"em").style("font-size",t.yLabelFontSize+"em")})}_toggleYlabelsVisibility(t){(0,p.Ys)(this.yLabels.nativeElement).attr("visibility",t*this.rowHeight>=.5*this.Y_LABLE_CHARACTER_HEIGHT?"visible":"hidden")}_addXlabels(){let t=this;(0,p.Ys)(t.xLabels.nativeElement).attr("transform","translate("+t.svgLeft2HeatmapWidth+" "+(t.svgHeight-t.marginBottom)+")").selectAll(".xLabels").data(t.topDisplayTerms).enter().append("text").attr("transform",function(o,r){const m=(r+.5)*t.rectWidth;return t.initialxLableXTranslate.push(m),"translate("+m+",0) rotate("+t.xLabelRotationDegree+")"}).text(o=>o).style("text-anchor","end").attr("font-size",t.xLabelFontSize+"em").attr("dy",.32*t.xLabelFontSize+"em")}_addVerticalScaleIndicators(){var t=this;let n=(0,p.Ys)(this.verticalScaleIndicators.nativeElement).attr("transform","translate("+t.marginLeft+" "+t.svgTop2HeatmapHeight+")");n.append("rect").attr("id","indicatorUp").attr("height",0).attr("width",t.verticalScaleIndicatorWidth).attr("fill","grey").attr("fill-opacity",.5);var s=(0,p.ohM)().on("start",function(m,g){const a=(0,p.Ys)(this).attr("y")-m.y;g.deltaY=a}).on("drag",function(m,g){let h=(0,p.Ys)(this);const a=m.y+g.deltaY,u=parseFloat(h.attr("height"));let d;d=a<=0?0:a>=t.heatmapHeight-u?t.heatmapHeight-u:a;const b=t.heatmapHeight-d-u;t.zoomFromScaleBar$.next({sourceOrientation:"vertical",scaleBarSetting:{smallEndRectLong:d,middleRectLong:u,bigEndRectLong:b,indicatorLong:u+d+b}})});n.append("g").selectAll("rect").data([{deltaX:0,deltaY:0}]).enter().append("rect").attr("id","indicatorMiddle").attr("height",t.heatmapHeight).attr("width",t.verticalScaleIndicatorWidth).attr("x",0).attr("y",0).attr("fill","grey").attr("fill-opacity",.1).style("cursor","row-resize").call(s),n.append("rect").attr("id","indicatorDown").attr("height",0).attr("width",t.verticalScaleIndicatorWidth).attr("fill","grey").attr("fill-opacity",.5);var o=(0,p.ohM)().on("start",function(m,g){const a=(0,p.Ys)(this).attr("y")-m.y;g.deltaY=a}).on("drag",function(m,g){const h=parseFloat((0,p.Ys)("#moveBarDown").attr("y")),a=m.y+g.deltaY;if(a<h&&a>=-15&&m.y<=t.heatmapHeight){let u;u=m.y<=-t.VERTICAL_MOVE_BAR_HEIGHT?-t.VERTICAL_MOVE_BAR_HEIGHT:m.y>=t.heatmapHeight?t.heatmapHeight:m.y,(0,p.Ys)(this).attr("y",u);const d=h-u-t.VERTICAL_MOVE_BAR_HEIGHT,f=u+t.VERTICAL_MOVE_BAR_HEIGHT,I=t.heatmapHeight-h;t.zoomFromScaleBar$.next({sourceOrientation:"vertical",scaleBarSetting:{smallEndRectLong:f,middleRectLong:d,bigEndRectLong:I,indicatorLong:d+f+I}})}});n.append("g").selectAll("rect").data([{deltaY:0}]).enter().append("rect").attr("id","moveBarUp").attr("height",t.VERTICAL_MOVE_BAR_HEIGHT).attr("width",t.verticalScaleIndicatorWidth).attr("fill","black").style("cursor","row-resize").attr("y",-t.VERTICAL_MOVE_BAR_HEIGHT).call(o);var r=(0,p.ohM)().on("drag",function(m){const g=parseFloat((0,p.Ys)("#moveBarUp").attr("y")),h=m.y;if(h>=g+t.VERTICAL_MOVE_BAR_HEIGHT&&h>=-15&&h<=t.heatmapHeight+5){let a;a=m.y<=-t.VERTICAL_MOVE_BAR_HEIGHT?-t.VERTICAL_MOVE_BAR_HEIGHT:m.y>=t.heatmapHeight?t.heatmapHeight:h,(0,p.Ys)(this).attr("y",a);const u=a-g-t.VERTICAL_MOVE_BAR_HEIGHT,d=g+t.VERTICAL_MOVE_BAR_HEIGHT,f=t.heatmapHeight-a;t.zoomFromScaleBar$.next({sourceOrientation:"vertical",scaleBarSetting:{smallEndRectLong:d,middleRectLong:u,bigEndRectLong:f,indicatorLong:u+d+f}})}});n.append("rect").attr("id","moveBarDown").attr("height",t.VERTICAL_MOVE_BAR_HEIGHT).attr("width",t.verticalScaleIndicatorWidth).attr("y",t.heatmapHeight).attr("fill","black").style("cursor","row-resize").call(r)}_addHorizontalScaleIndicators(){var t=this;let n=(0,p.Ys)(this.horizontalScaleIndicators.nativeElement).attr("transform","translate("+t.svgLeft2HeatmapWidth+" "+t.marginTop+")");n.append("rect").attr("id","topIndicatorLeft").attr("height",t.horizontalScaleIndicatorHeight).attr("width",0).attr("fill","grey").attr("fill-opacity",.5);var s=(0,p.ohM)().on("start",function(m,g){const a=(0,p.Ys)(this).attr("x")-m.x;g.deltaX=a}).on("drag",function(m,g){let h=(0,p.Ys)(this);const a=m.x+g.deltaX,u=parseFloat(h.attr("width"));let d;d=a<=0?0:a>=t.heatmapWidth-u?t.heatmapWidth-u:a;const b=t.heatmapWidth-d-u;t.zoomFromScaleBar$.next({sourceOrientation:"horizontal",scaleBarSetting:{smallEndRectLong:d,middleRectLong:u,bigEndRectLong:b,indicatorLong:d+u+b}})});n.append("g").selectAll("rect").data([{deltaX:0,deltaY:0}]).enter().append("rect").attr("id","topIndicatorMiddle").attr("height",t.horizontalScaleIndicatorHeight).attr("width",t.heatmapWidth).attr("fill","grey").attr("fill-opacity",.1).style("cursor","col-resize").call(s),n.append("rect").attr("id","topIndicatorRight").attr("height",t.horizontalScaleIndicatorHeight).attr("width",0).attr("fill","grey").attr("fill-opacity",.5);var o=(0,p.ohM)().on("start",function(m,g){const a=(0,p.Ys)(this).attr("x")-m.x;g.deltaX=a}).on("drag",function(m){const g=parseFloat((0,p.Ys)("#moveBarRight").attr("x")),h=m.x;if(h<g&&h>=-15&&h<=t.heatmapWidth){let a;a=h<=-t.HORIZONAL_MOVE_BAR_WIDTH?-t.HORIZONAL_MOVE_BAR_WIDTH:h>=t.heatmapWidth?t.heatmapWidth:h,(0,p.Ys)(this).attr("x",a);const u=g-a-t.HORIZONAL_MOVE_BAR_WIDTH,d=a+t.HORIZONAL_MOVE_BAR_WIDTH,f=t.heatmapWidth-g;t.zoomFromScaleBar$.next({sourceOrientation:"horizontal",scaleBarSetting:{smallEndRectLong:d,middleRectLong:u,bigEndRectLong:f,indicatorLong:d+u+f}})}});n.append("g").selectAll("rect").data([{deltaX:0}]).enter().append("rect").attr("id","moveBarLeft").attr("height",t.horizontalScaleIndicatorHeight).attr("width",t.HORIZONAL_MOVE_BAR_WIDTH).attr("fill","black").style("cursor","col-resize").attr("x",-t.HORIZONAL_MOVE_BAR_WIDTH).call(o);var r=(0,p.ohM)().on("drag",function(m){const g=parseFloat((0,p.Ys)("#moveBarLeft").attr("x")),h=m.x;if(h>g+t.HORIZONAL_MOVE_BAR_WIDTH&&h<=t.heatmapWidth+t.HORIZONAL_MOVE_BAR_WIDTH){let a;a=h<=-t.HORIZONAL_MOVE_BAR_WIDTH?-t.HORIZONAL_MOVE_BAR_WIDTH:h>=t.heatmapWidth?t.heatmapWidth:h,(0,p.Ys)(this).attr("x",a);const u=a-g-t.HORIZONAL_MOVE_BAR_WIDTH,d=g+t.HORIZONAL_MOVE_BAR_WIDTH,f=t.heatmapWidth-a;t.zoomFromScaleBar$.next({sourceOrientation:"horizontal",scaleBarSetting:{smallEndRectLong:d,middleRectLong:u,bigEndRectLong:f,indicatorLong:d+u+f}})}});n.append("rect").attr("id","moveBarRight").attr("height",t.horizontalScaleIndicatorHeight).attr("width",t.HORIZONAL_MOVE_BAR_WIDTH).attr("x",t.heatmapWidth).attr("fill","black").style("cursor","col-resize").call(r)}_highlightClickedCluster(t){const n=this,s=this.transformOneDirectionInfo.realTranslateY,o=this.transformOneDirectionInfo.realScaleY,r=s+n.clustersYpos[t]*o,m=r>=0?r:0;(0,p.Ys)(n.upCoverForHighlight.nativeElement).select("rect").attr("visibility","visible").attr("height",m);const h=n.heatmapHeight-(s+n.clustersYpos[t+1]*o),a=h>=0?h:0;(0,p.Ys)(n.downCoverForHighlight.nativeElement).select("rect").attr("visibility","visible").attr("height",a).attr("y",-a)}_disHighlightClickedCluster(){(0,p.Ys)(this.upCoverForHighlight.nativeElement).select("rect").attr("visibility","hidden"),(0,p.Ys)(this.downCoverForHighlight.nativeElement).select("rect").attr("visibility","hidden")}_drawCoversForHighlight(){const t=this;(0,p.Ys)(t.upCoverForHighlight.nativeElement).attr("transform","translate("+(t.svgLeft2HeatmapWidth-2)+" "+t.svgTop2HeatmapHeight+")").append("rect").attr("width",t.svgWidth).attr("height",50).attr("fill","white").attr("visibility","hidden").style("opacity",.9),(0,p.Ys)(t.downCoverForHighlight.nativeElement).attr("transform","translate("+(t.svgLeft2HeatmapWidth-2)+" "+(t.svgTop2HeatmapHeight+t.heatmapHeight)+")").append("rect").attr("width",t.svgWidth).attr("height",50).attr("y",-50).attr("fill","white").attr("visibility","hidden").style("opacity",.9)}_addCoverBoxes(){this._addHeatmapCoverRects(),this._addXlabelsCoverRects(),this._addYlabelsCoverRects()}_addHeatmapCoverRects(){const t=this,n=(0,p.Ys)(t.heatmapCoverRects.nativeElement).attr("transform","translate(0, 0)");n.append("rect").attr("height",t.svgTop2HeatmapHeight+1).attr("width",t.svgWidth).attr("fill","white"),n.append("rect").attr("x",0).attr("y",t.svgTop2HeatmapHeight+t.heatmapHeight-1).attr("width",t.svgWidth).attr("height",t.svgHeight-t.svgTop2HeatmapHeight-t.heatmapHeight+1).attr("fill","white"),n.append("rect").attr("y",t.svgTop2HeatmapHeight).attr("width",t.svgLeft2HeatmapWidth).attr("height",t.heatmapHeight).attr("fill","white"),n.append("rect").attr("x",t.svgLeft2HeatmapWidth+t.heatmapWidth).attr("y",t.svgTop2HeatmapHeight).attr("width",t.marginRight).attr("height",t.heatmapHeight).attr("fill","white")}_addXlabelsCoverRects(){var t=this;let n=(0,p.Ys)(t.xLabelsCoverRects.nativeElement);const s=-this.xLabelRotationDegree*Math.PI/180;n.append("rect").attr("x",0).attr("y",t.svgTop2HeatmapHeight+t.heatmapHeight).attr("width",t.svgLeft2HeatmapWidth-t.marginBottom*Math.cos(s)).attr("height",t.marginBottom).attr("fill","white")}_addYlabelsCoverRects(){var t=this;let n=(0,p.Ys)(t.yLabelsCoverRects.nativeElement);const s=t.svgLeft2HeatmapWidth+t.heatmapWidth;n.append("rect").attr("id","yLableTopCover").attr("transform","translate("+s+" 0)").attr("width",t.marginRight).attr("height",t.svgTop2HeatmapHeight).attr("fill","white");const o=t.svgLeft2HeatmapWidth+t.heatmapWidth,r=t.svgTop2HeatmapHeight+t.heatmapHeight;n.append("rect").attr("id","yLableDownCover").attr("transform","translate("+o+" "+r+")").attr("width",t.marginRight).attr("height",t.marginBottom).attr("fill","white")}_obtainAllValuesAsArray(){let t=[];return this.kmeansClusterResult.subClusters.forEach(n=>{n.dataMatrix.forEach(s=>{t=t.concat(s)})}),t}_convertScrollBarParameters2zoomParameters(t,n,s){const{smallEndRectLong:o,middleRectLong:r,indicatorLong:g}=Object.assign({},n),h=g/r,a=-o*h;return"vertical"===t?Object.assign(Object.assign({},s),{realScaleY:h,realTranslateY:a}):"horizontal"===t?Object.assign(Object.assign({},s),{realScaleX:h,realTranslateX:a}):void 0}_updateTransformInfo(t){this.transformOneDirectionInfo=Object.assign({},t)}_transformMapUsingRealZoomValues(t,n,s,o){const r=this,m=(0,p.Ys)(r.heatmap.nativeElement),g=(0,p.Ys)(r.xLabels.nativeElement),h=(0,p.Ys)(r.yLabels.nativeElement),I=((0,p.Ys)(r.upCoverForHighlight.nativeElement),(0,p.Ys)(r.downCoverForHighlight.nativeElement),r.svgLeft2HeatmapWidth+t),b=r.svgTop2HeatmapHeight+r.heatmapHeight,R=r.svgLeft2HeatmapWidth+r.heatmapWidth,A=r.svgTop2HeatmapHeight+n;if(m.attr("transform","translate("+(r.marginLeft+r.verticalScaleIndicatorWidth+r.verticalIndicatorHeatmapGap+t)+" "+(r.svgTop2HeatmapHeight+n)+") scale("+s+" "+o+")"),g.attr("transform","translate("+I+" "+b+")"),h.attr("transform","translate("+R+" "+A+") scale(1 1)"),g.selectAll("text").attr("transform",function(L,$){return"translate("+s*(r.initialxLableXTranslate[1]-r.initialxLableXTranslate[0])*($+.5)+" 0)rotate("+r.xLabelRotationDegree+")"}),"visible"===(0,p.Ys)(this.yLabels.nativeElement).attr("visibility")){const L=h.selectAll(".subYlabelText");L.attr("transform",function($,M){return"translate(0 "+o*r.clustersYpos[M]+")"}),L.each(function($,M){(0,p.Ys)(this).selectAll("text").attr("transform",function(N,k){return"translate(0 "+r.rowHeight*(k+.5)*o+")"})})}}_modifyVerticalScaleIndicators(t,n,s,o,r){(0,p.Ys)("#indicatorUp").attr("height",t),(0,p.Ys)("#indicatorMiddle").attr("height",n).attr("y",t),(0,p.Ys)("#indicatorDown").attr("height",s).attr("y",t+n),(0,p.Ys)("#moveBarUp").attr("y",t-r),(0,p.Ys)("#moveBarDown").attr("y",t+n)}_modifyHorizontalScaleIndicators(t,n,s,o,r){(0,p.Ys)("#topIndicatorLeft").attr("width",t),(0,p.Ys)("#topIndicatorMiddle").attr("width",n).attr("x",t),(0,p.Ys)("#topIndicatorRight").attr("width",s).attr("x",t+n),(0,p.Ys)("#moveBarLeft").attr("x",t-r),(0,p.Ys)("#moveBarRight").attr("x",t+n)}_computeRowsNum(){let t=0;return this.kmeansClusterResult.subClusters.forEach(n=>{t+=n.dataMatrix.length}),t}_computeRectsNum(){return this.kmeansClusterResult.topUniqueTerms.length}_computeSubclustersYpos(){let t=0,n=[];return this.kmeansClusterResult.subClusters.forEach((s,o)=>{n.push(t),t=t+this.rowHeight*s.dataMatrix.length+this.clusterGap}),n}_obtainMarginRight(){let t=0;const n=(0,E.H9)(this.yLabelFontSize);return this._obtainLeftDisplayTerms().forEach(o=>{const r=o.length*n;r>t&&(t=r)}),t}_obtainMarginBottom(){let t=0;const n=(0,E.H9)(this.xLabelFontSize),s=-this.xLabelRotationDegree*Math.PI/180;return this.kmeansClusterResult.topDisplayTerms.forEach(o=>{const r=o.length*n*Math.sin(s)+1.32*n*Math.cos(s);r>t&&(t=r)}),t}_obtainMarginLeft(){const t=-this.xLabelRotationDegree*Math.PI/180;return this.marginBottom*Math.cos(t)-this.verticalScaleIndicatorWidth}_obtainLeftDisplayTerms(){let t=[];return this.kmeansClusterResult.subClusters.forEach(n=>{t=t.concat(n.leftDisplayTerms)}),t}_computeRowHeight(){return(this.heatmapHeight-(this.clusterNum-1)*this.clusterGap)/this.rowsNum}_computeRectWidth(){return this.heatmapWidth/this.xLabelsNum}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-kmeans-vis"]],viewQuery:function(t,n){if(1&t&&(e.Gf(At,5),e.Gf(wt,5),e.Gf(Lt,5),e.Gf(Ht,5),e.Gf(Gt,5),e.Gf(Et,5),e.Gf($t,5),e.Gf(Mt,5),e.Gf(Zt,5),e.Gf(Ft,5),e.Gf(Nt,5)),2&t){let s;e.iGM(s=e.CRH())&&(n.svgElement=s.first),e.iGM(s=e.CRH())&&(n.heatmap=s.first),e.iGM(s=e.CRH())&&(n.heatmapCoverRects=s.first),e.iGM(s=e.CRH())&&(n.xLabels=s.first),e.iGM(s=e.CRH())&&(n.xLabelsCoverRects=s.first),e.iGM(s=e.CRH())&&(n.yLabels=s.first),e.iGM(s=e.CRH())&&(n.yLabelsCoverRects=s.first),e.iGM(s=e.CRH())&&(n.verticalScaleIndicators=s.first),e.iGM(s=e.CRH())&&(n.horizontalScaleIndicators=s.first),e.iGM(s=e.CRH())&&(n.upCoverForHighlight=s.first),e.iGM(s=e.CRH())&&(n.downCoverForHighlight=s.first)}},inputs:{kmeansClusterResult:"kmeansClusterResult",auditTime:"auditTime"},outputs:{selectedClusterIndex$:"selectedClusterIndex$",mapSettings$:"mapSettings$"},features:[e.TTD],decls:22,vars:0,consts:[["svgElement",""],["heatmap",""],["heatmapCoverRects",""],["data-testid","xLabels"],["xLabels",""],["xLabelsCoverRects",""],["data-testid","yLabels"],["yLabels",""],["yLabelsCoverRects",""],["verticalScaleIndicators",""],["horizontalScaleIndicators",""],["data-testid","upCoverForHighlight"],["upCoverForHighlight",""],["data-testid","downCoverForHighlight"],["downCoverForHighlight",""]],template:function(t,n){1&t&&(e.O4$(),e.TgZ(0,"svg",null,0),e._UZ(2,"g",null,1),e._UZ(4,"g",null,2),e._UZ(6,"g",3,4),e._UZ(8,"g",null,5),e._UZ(10,"g",6,7),e._UZ(12,"g",null,8),e._UZ(14,"g",null,9),e._UZ(16,"g",null,10),e._UZ(18,"g",11,12),e._UZ(20,"g",13,14),e.qZA())},styles:[""],changeDetection:0}),i})();const Bt=["svgContainer"];function Vt(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"div",8),e.TgZ(1,"app-change-figure-settings",9),e.NdJ("modifiedSettings$",function(s){return e.CHM(t),e.oxw().changePlotSettings(s)})("closeSignal$",function(s){return e.CHM(t),e.oxw().showSettings(s)}),e.qZA(),e.qZA()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("plotSettingInfoList",t.plotSettingInfoList)}}const Wt=function(i){return{"min-height":i}};let Yt=(()=>{class i extends pe.e{constructor(t){super(),this.cdr=t,this.genesSelected$=new e.vpe,this.faCog=G.b7W,this.ifShowSettingsComponent=!1,this.containerMinHeight=500,this.defaultBasicSetting={width:300,height:500,marginTop:5,marginLeft:5,marginRight:10,marginBottom:10,heatmapWidth:200,heatmapHeight:300,xLabelsFontSize:1.5,xLabelRotationDegree:-30,verticalScaleIndicatorWidth:30,verticalIndicatorHeatmapGap:5,horizontalScaleIndicatorHeight:30,horizontalIndicatorHeatmapGap:5},this.plotSettingInfoList=[{name:"width",defaultValue:300,minValue:50,maxValue:500,stepValue:1},{name:"height",defaultValue:250,minValue:50,maxValue:600,stepValue:1}],this.downloadPngName="Kmeans-cluster-result.png",this.downloadPDFname="Kmeans-cluster-result.pdf",this.changedSettingsSubject=new v.X(null)}ngOnInit(){this.changedSettingsSubject.pipe((0,S.h)(t=>null!=t),(0,ce.b)(2e3),(0,Z.R)(this.destroyNotifier$)).subscribe(t=>{this.initialBasicSetting=Object.assign({},t),this._preparePlotSettingInfoList()}),this._determineContainerMinHeight()}ngAfterViewInit(){this._obtainKmeansVisInfo()}ngOnChanges(t){t.kmeansClusterResult&&!t.kmeansClusterResult.isFirstChange()&&this._obtainKmeansVisInfo()}showSettings(t){this.ifShowSettingsComponent=!this.ifShowSettingsComponent}changePlotSettings(t){const n=Object.assign(Object.assign({},t),{height:this.defaultBasicSetting.marginTop+t.horizontalScaleIndicatorHeight+this.defaultBasicSetting.verticalIndicatorHeatmapGap+t.heatmapHeight+t.marginBottom,width:this.defaultBasicSetting.marginLeft+t.verticalScaleIndicatorWidth+this.defaultBasicSetting.verticalIndicatorHeatmapGap+t.heatmapWidth+t.marginRight,verticalIndicatorHeatmapGap:this.defaultBasicSetting.verticalIndicatorHeatmapGap,horizontalIndicatorHeatmapGap:this.defaultBasicSetting.horizontalIndicatorHeatmapGap,marginLeft:this.defaultBasicSetting.marginLeft,marginTop:this.defaultBasicSetting.marginTop});this.kmeansClusterResult=Object.assign(Object.assign({},this.kmeansClusterResult),{basicSetting:Object.assign({},n)}),this.changedSettingsSubject.next(n)}processColorScaleSetting(t){this.kmeansClusterResult=Object.assign(Object.assign({},this.kmeansClusterResult),{colorScaleSetting:t})}processSelectedClusterIndex(t){if(t>=0){const n=this.kmeansClusterResult.subClusters[t].leftUniqueTerms,s={clickedNode:t.toString(),genes:n};this.genesSelected$.next(s)}else this.genesSelected$.next({clickedNode:"",genes:[]})}_obtainKmeansVisInfo(){if(this.clusterResultAndTransform){this.downloadPngName=this.clusterResultAndTransform.clusterResultID+".png";const t=function(i){const l=i.result,t=l.dataArray,n=l.leftUniqueTerms,s=l.leftDisplayTerms,o={};l.clusterIndex.forEach((g,h)=>{o.hasOwnProperty(g)?o[g].push(h):o[g]=[h]});let r=[];const m=l.clusterIndex.reduce((g,h)=>Math.max(g,h),0);for(let g=0;g<=m;g++){let h=[],a=[],u=[];o[g].forEach(d=>{h.push(t[d]),a.push(n[d]),u.push(s[d])}),r.push({dataMatrix:h,leftUniqueTerms:a,leftDisplayTerms:u})}return{subClusters:r,topUniqueTerms:l.topUniqueTerms,topDisplayTerms:l.topDisplayTerms}}(this.clusterResultAndTransform),n=this._obtainBasicSettings();this.kmeansClusterResult=Object.assign(Object.assign({},t),{basicSetting:Object.assign({},n),colorScaleSetting:{lowValueColor:"blue",middleValueColor:"white",highValueColor:"red"}}),this.initialBasicSetting=Object.assign({},n),this._preparePlotSettingInfoList()}this.cdr.detectChanges()}_obtainBasicSettings(){const t=Object.assign({},this.defaultBasicSetting),n=this._obtainSvgWidth(),s=this._obtainIdeamHeatmapWidth(),o=this.defaultBasicSetting.marginLeft+this.defaultBasicSetting.verticalScaleIndicatorWidth+this.defaultBasicSetting.verticalIndicatorHeatmapGap+this.defaultBasicSetting.marginRight,r=this._obtainMarginRight();if(o+s<=n){t.heatmapWidth=s,t.width=n;const m=t.marginLeft+t.verticalScaleIndicatorWidth+t.verticalIndicatorHeatmapGap+t.heatmapWidth;m+r<=t.width?(t.marginRight=r,t.width=m+r):t.marginRight=n-m}else t.width=n,t.heatmapWidth=n-o;return t.marginBottom=this._obtainMarginBottom(),t.height=this.containerMinHeight-30,t.heatmapHeight=t.height-(t.marginTop+t.horizontalScaleIndicatorHeight+t.horizontalIndicatorHeatmapGap+t.marginBottom),t}_obtainSvgWidth(){return this.svgContainer.nativeElement.clientWidth}_obtainIdeamHeatmapWidth(){const t=-this.defaultBasicSetting.xLabelRotationDegree*Math.PI/180;return(0,E.H9)(this.defaultBasicSetting.xLabelsFontSize)/Math.sin(t)*this.clusterResultAndTransform.result.topDisplayTerms.length}_obtainMarginRight(){let t=0;const n=(0,E.H9)(1);return this.clusterResultAndTransform.result.leftDisplayTerms.forEach(s=>{const o=(null==s?void 0:s.length)*n;o>t&&(t=o)}),t+5}_obtainMarginBottom(){let t=0;const n=(0,E.H9)(this.defaultBasicSetting.xLabelsFontSize);return this.clusterResultAndTransform.result.topDisplayTerms.forEach(s=>{const o=-this.defaultBasicSetting.xLabelRotationDegree*Math.PI/180,r=s.length*n*Math.sin(o)+1.32*n*Math.cos(o);r>t&&(t=r)}),t+5}_determineContainerMinHeight(){this.containerMinHeight=.7*document.documentElement.clientHeight-500>0?.7*document.documentElement.clientHeight:500}_preparePlotSettingInfoList(){this.plotSettingInfoList=[{name:"marginRight",defaultValue:this.initialBasicSetting.marginRight,minValue:5,maxValue:200,stepValue:1},{name:"marginBottom",defaultValue:this.initialBasicSetting.marginBottom,minValue:5,maxValue:200,stepValue:1},{name:"xLabelRotationDegree",defaultValue:this.initialBasicSetting.xLabelRotationDegree,minValue:-90,maxValue:0,stepValue:1},{name:"xLabelsFontSize",defaultValue:this.initialBasicSetting.xLabelsFontSize,minValue:.5,maxValue:5,stepValue:.1},{name:"heatmapWidth",defaultValue:this.initialBasicSetting.heatmapWidth,minValue:50,maxValue:800,stepValue:1},{name:"heatmapHeight",defaultValue:this.initialBasicSetting.heatmapHeight,minValue:50,maxValue:800,stepValue:1},{name:"verticalScaleIndicatorWidth",defaultValue:this.initialBasicSetting.verticalScaleIndicatorWidth,minValue:5,maxValue:100,stepValue:1},{name:"horizontalScaleIndicatorHeight",defaultValue:this.initialBasicSetting.horizontalScaleIndicatorHeight,minValue:10,maxValue:100,stepValue:1}]}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-vis-kmeans-cluster-result"]],viewQuery:function(t,n){if(1&t&&e.Gf(Bt,5),2&t){let s;e.iGM(s=e.CRH())&&(n.svgContainer=s.first)}},inputs:{clusterResultAndTransform:"clusterResultAndTransform"},outputs:{genesSelected$:"genesSelected$"},features:[e.qOj,e.TTD],decls:8,vars:9,consts:[[1,"d-flex","justify-content-end"],[3,"colorScaleSetting$"],[1,"form-inline"],["ngbTooltip","Click to change settings of the plot",1,"hoverBigger","close",3,"icon","size","click"],["cdkDrag","","class","border p-3","style","position: absolute; z-index: 1014;top: 2rem; right: -10rem; background-color: white",4,"ngIf"],[1,"d-flex","flex-column","justify-content-center",3,"ngStyle"],["svgContainer",""],["appD3ExportMap","",3,"pngName","pdfName","kmeansClusterResult","selectedClusterIndex$"],["cdkDrag","",1,"border","p-3",2,"position","absolute","z-index","1014","top","2rem","right","-10rem","background-color","white"],[3,"plotSettingInfoList","modifiedSettings$","closeSignal$"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"app-select-color-scale",1),e.NdJ("colorScaleSetting$",function(o){return n.processColorScaleSetting(o)}),e.qZA(),e.TgZ(2,"div",2),e.TgZ(3,"fa-icon",3),e.NdJ("click",function(o){return n.showSettings(o)}),e.qZA(),e.qZA(),e.qZA(),e.YNc(4,Vt,2,1,"div",4),e.TgZ(5,"div",5,6),e.TgZ(7,"app-kmeans-vis",7),e.NdJ("selectedClusterIndex$",function(o){return n.processSelectedClusterIndex(o)}),e.qZA(),e.qZA()),2&t&&(e.xp6(3),e.Q6J("icon",n.faCog)("size","sm"),e.xp6(1),e.Q6J("ngIf",n.ifShowSettingsComponent),e.xp6(1),e.Q6J("ngStyle",e.VKq(7,Wt,n.containerMinHeight)),e.xp6(2),e.Q6J("pngName",n.downloadPngName)("pdfName",n.downloadPDFname)("kmeansClusterResult",n.kmeansClusterResult))},directives:[ue,O.BN,H._L,x.O5,x.PC,Ot,he.I,Y.Zt,de.q],styles:[""],changeDetection:0}),i})();function qt(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"app-vis-hierarchical-cluster-result",2),e.NdJ("genesSelected$",function(s){return e.CHM(t),e.oxw().processGenesSelected(s)}),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("clusterResultTransform",t.clusterResultAndTransform)("phenotypeData",t.phenotypeData)}}function Pt(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"app-vis-kmeans-cluster-result",3),e.NdJ("genesSelected$",function(s){return e.CHM(t),e.oxw().processGenesSelected(s)}),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("clusterResultAndTransform",t.clusterResultAndTransform)}}let jt=(()=>{class i{constructor(t){this.cdr=t,this.genesSelected$=new e.vpe}ngOnInit(){this._obtainClusterMethid()}ngOnChanges(t){t.clusterResultAndTransform&&!t.clusterResultAndTransform.isFirstChange()&&this._obtainClusterMethid()}_obtainClusterMethid(){this.clusterResultAndTransform&&(this.clusterMethod=this.clusterResultAndTransform.clusterMethod,this.genesSelected$.next({clickedNode:"",genes:[]})),this.cdr.detectChanges()}processGenesSelected(t){this.genesSelected$.next(t)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-vis-cluster-result-with-map"]],inputs:{clusterResultAndTransform:"clusterResultAndTransform",phenotypeData:"phenotypeData"},outputs:{genesSelected$:"genesSelected$"},features:[e.TTD],decls:2,vars:2,consts:[[3,"clusterResultTransform","phenotypeData","genesSelected$",4,"ngIf"],[3,"clusterResultAndTransform","genesSelected$",4,"ngIf"],[3,"clusterResultTransform","phenotypeData","genesSelected$"],[3,"clusterResultAndTransform","genesSelected$"]],template:function(t,n){1&t&&(e.YNc(0,qt,1,2,"app-vis-hierarchical-cluster-result",0),e.YNc(1,Pt,1,1,"app-vis-kmeans-cluster-result",1)),2&t&&(e.Q6J("ngIf","Hierarchical"===n.clusterMethod),e.xp6(1),e.Q6J("ngIf","Kmeans"===n.clusterMethod))},directives:[x.O5,Rt,Yt],styles:[""],changeDetection:0}),i})();var Jt=c(4547),kt=c(5826),zt=c(6458);function Ut(i,l){if(1&i&&(e.TgZ(0,"p",5),e._uU(1),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.hij(" The genes selected from the clustering heatmap with name '",t.addSelectedGenesInfo.currentGeneListID,"' has been added to gene lists. You can use it in other apps\n")}}let Qt=(()=>{class i{constructor(){this.genesForEnrichment$=new e.vpe,this.visPPIsRequest$=new e.vpe,this.selectedGene$=new e.vpe,this.addSelectedGenesToStore$=new e.vpe,this.ifGenesSelected=!1}ngOnInit(){var t;this.ifGenesSelected=(null===(t=this.genesInfoForTable)||void 0===t?void 0:t.genesInfo.length)>=1}ngOnChanges(t){var n;t.genesInfoForTable&&!t.genesInfoForTable.isFirstChange()&&(this.ifGenesSelected=(null===(n=this.genesInfoForTable)||void 0===n?void 0:n.genesInfo.length)>=1)}requestEnrichedAnalysis(t){const n=this.genesInfoForTable.features[0],s=this.genesInfoForTable.genesInfo.map(o=>o[n]);this.genesForEnrichment$.next(s)}visPPInetwork(t){this.visPPIsRequest$.next(!0)}processedSelectedGene(t){this.selectedGene$.next(t)}addSelectedGenesToGeneList(t){this.addSelectedGenesToStore$.next(!0)}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-selected-genes-management"]],inputs:{genesInfoForTable:"genesInfoForTable",addSelectedGenesInfo:"addSelectedGenesInfo"},outputs:{genesForEnrichment$:"genesForEnrichment$",visPPIsRequest$:"visPPIsRequest$",selectedGene$:"selectedGene$",addSelectedGenesToStore$:"addSelectedGenesToStore$"},features:[e.TTD],decls:8,vars:5,consts:[[3,"genesInfoForTable","selectedGene$"],["data-testid","enrichSubmit",1,"btn","btn-sm","btn-expressvis","mr-2","mt-1",3,"disabled","click"],["data-testid","triggerVisPPI",1,"btn","btn-sm","btn-expressvis","mr-2","mt-1",3,"disabled","click"],["data-testid","addToGeneList",1,"btn","btn-sm","btn-expressvis","mr-2","mt-1",3,"disabled","click"],["class","text-success","data-testid","clusterSelectedGenesHasBeenAddedNote",4,"ngIf"],["data-testid","clusterSelectedGenesHasBeenAddedNote",1,"text-success"]],template:function(t,n){1&t&&(e.TgZ(0,"app-display-genes-info-table-pagination",0),e.NdJ("selectedGene$",function(o){return n.processedSelectedGene(o)}),e.qZA(),e.TgZ(1,"button",1),e.NdJ("click",function(o){return n.requestEnrichedAnalysis(o)}),e._uU(2," Enrichment Analysis\n"),e.qZA(),e.TgZ(3,"button",2),e.NdJ("click",function(o){return n.visPPInetwork(o)}),e._uU(4," Visualize PPIs in PPIExp\n"),e.qZA(),e.TgZ(5,"button",3),e.NdJ("click",function(o){return n.addSelectedGenesToGeneList(o)}),e._uU(6," Add Genes To Gene Lists\n"),e.qZA(),e.YNc(7,Ut,2,1,"p",4)),2&t&&(e.Q6J("genesInfoForTable",n.genesInfoForTable),e.xp6(1),e.Q6J("disabled",!n.ifGenesSelected),e.xp6(2),e.Q6J("disabled",!n.ifGenesSelected),e.xp6(2),e.Q6J("disabled",!n.ifGenesSelected||(null==n.addSelectedGenesInfo?null:n.addSelectedGenesInfo.ifAdded)),e.xp6(2),e.Q6J("ngIf",null==n.addSelectedGenesInfo?null:n.addSelectedGenesInfo.ifAdded))},directives:[zt.T,x.O5],styles:[""],changeDetection:0}),i})();var Xt=c(6988),Kt=c(7166),en=c(4146),tn=c(5346);const nn=["inputGeneListComponent"],sn=["enrichmentContent"];function an(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"div",24),e.TgZ(1,"div",25),e.TgZ(2,"app-try-sample",26),e.NdJ("sampleForTryName$",function(s){return e.CHM(t),e.oxw().processTrySampleFileName(s)})("sampleForImportName$",function(s){return e.CHM(t),e.oxw().processDownloadSampleData(s)})("closeMe$",function(s){return e.CHM(t),e.oxw().closeTrySampleComponent(s)}),e.ALo(3,"async"),e.ALo(4,"async"),e.qZA(),e.qZA(),e.qZA()}if(2&i){const t=e.oxw();e.xp6(2),e.Q6J("fileInfos",t.trySamplesInfos)("trySamplePercentage",e.lcZ(3,3,t.trySamplePercentage$))("downloadSampleDataPercentage",e.lcZ(4,5,t.downloadSampleDataPercentage$))}}function on(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"app-selected-genes-management",27),e.NdJ("genesForEnrichment$",function(s){return e.CHM(t),e.oxw().processEnrichmentRequest(s)})("selectedGene$",function(s){return e.CHM(t),e.oxw().processSelectedGene(s)})("visPPIsRequest$",function(s){return e.CHM(t),e.oxw().processVisPPIsRequest(s)})("addSelectedGenesToStore$",function(s){return e.CHM(t),e.oxw().processAddSelectedGenesToStoreSignal(s)}),e.ALo(1,"async"),e.ALo(2,"async"),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("genesInfoForTable",e.lcZ(1,2,t.genesInfoForTable$))("addSelectedGenesInfo",e.lcZ(2,4,t.addSelectedGenesInfo$))}}function ln(i,l){1&i&&(e.TgZ(0,"p",28),e._uU(1," Click one line in the left dendgrogram to select genes in its children nodes (for hierarchical clustering analysis); Or click on the heatmap to select genes in the clicked cluster (For Kmeans clustering analysis); "),e.qZA())}function rn(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"app-display-one-gene-expression",29),e.NdJ("closeSignal$",function(s){return e.CHM(t),e.oxw().closeModalForExpression(s)}),e.ALo(1,"async"),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("geneExpForBoxPlot",e.lcZ(1,1,t.geneExpForBoxPlot$))}}function cn(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"div",30),e.TgZ(1,"h3"),e._uU(2,"Generate a New Gene List"),e.qZA(),e.TgZ(3,"button",31),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return null==s.inputGenelistModalRef?null:s.inputGenelistModalRef.hide()}),e.TgZ(4,"span",32),e._uU(5,"\xd7"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(6,"div",33),e.TgZ(7,"app-generate-new-gene-list",34),e.NdJ("outputGeneList$",function(s){return e.CHM(t),e.oxw().processInputGeneList(s)})("annotationTermsRequest$",function(s){return e.CHM(t),e.oxw().processAnnotationTermsRequest(s)})("annotationGenesRequest$",function(s){return e.CHM(t),e.oxw().processAnnotationGenesRequest(s)})("geneListFromDatasetRequest$",function(s){return e.CHM(t),e.oxw().processGeneListFromDatasetRequest(s)})("geneListFromExistedRequest$",function(s){return e.CHM(t),e.oxw().processGeneListFromExistedRequest(s)}),e.ALo(8,"async"),e.ALo(9,"async"),e.ALo(10,"async"),e.ALo(11,"async"),e.ALo(12,"async"),e.ALo(13,"async"),e.ALo(14,"async"),e.qZA(),e.qZA(),e.TgZ(15,"div",35),e.TgZ(16,"button",36),e.NdJ("click",function(){return e.CHM(t),e.oxw().inputGenelistModalRef.hide()}),e._uU(17,"close"),e.qZA(),e.qZA()}if(2&i){const t=e.oxw();e.xp6(7),e.Q6J("defaultWay","Obtain Top Variable Genes from Dataset")("availableSpecies",e.lcZ(8,8,t.availableSpecies$))("availableGeneIDtypes",e.lcZ(9,10,t.availableGeneIDtypes$))("annotationTerms",e.lcZ(10,12,t.annotationTerms$))("allDatasetInfoForDisplay",e.lcZ(11,14,t.allDatasetInfoForDisplay$))("geneNumberAfterFilter",e.lcZ(12,16,t.geneNumberAfterFilter$))("availableGeneLists",e.lcZ(13,18,t.availableGeneLists$))("latestAddedGeneListID",e.lcZ(14,20,t.latestAddedGenelistName$))}}function pn(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"div",30),e.TgZ(1,"h4",37),e._uU(2,"Genes Enrichment Analysis"),e.qZA(),e.TgZ(3,"button",31),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return null==s.enrichedModalRef?null:s.enrichedModalRef.hide()}),e.TgZ(4,"span",32),e._uU(5,"\xd7"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(6,"div",33),e.TgZ(7,"app-display-enriched-annotations",38),e.NdJ("selectedAnnotationTermGenes$",function(s){return e.CHM(t),e.oxw().processSelectedAnnotationTermGenes(s)})("selectedKEGGpathway$",function(s){return e.CHM(t),e.oxw().processSelectedKEGGpathway(s)})("selectedGene$",function(s){return e.CHM(t),e.oxw().processSelectedGene(s)}),e.ALo(8,"async"),e.ALo(9,"async"),e.qZA(),e.qZA(),e.TgZ(10,"div",35),e.TgZ(11,"button",39),e.NdJ("click",function(){return e.CHM(t),e.oxw().enrichedModalRef.hide()}),e._uU(12," close "),e.qZA(),e.qZA()}if(2&i){const t=e.oxw();e.xp6(7),e.Q6J("geneListErichedResultStatus",e.lcZ(8,2,t.geneListEnrichedResultStatus$))("annotationTermGenesInfoForTable",e.lcZ(9,4,t.annotationTermGenesInfoForTable$))}}const un=[{path:"",component:(()=>{class i{constructor(t,n,s){this.facade=t,this.modalService=n,this.cdr=s,this.availableGeneListNames$=this.facade.allGeneListIDs$.pipe((0,ne.d)(2)),this.allDatasetInfoForDisplay$=this.facade.allDatasetInfoForDisplay$,this.availableClusterResultIDs$=this.facade.availableClusterResultIDs$,this.clusterResultAndTransform$=this.facade.datasetGeneListClusterResultAndTransform$,this.phenotypeDataOfCurrentDataset$=this.facade.phenotypeDataOfCurrentDataset$,this.genesInfoForTable$=this.facade.selectedGenesInfo$.pipe((0,ne.d)(1)),this.geneExpForBoxPlot$=this.facade.selectedGeneExpForBoxPlot$,this.latestAddedGenelistName$=this.facade.latestAddedGenelistName$,this.annotationTerms$=this.facade.annotationTerms$,this.geneNumberAfterFilter$=this.facade.geneNumberAfterFilter$,this.availableGeneLists$=this.facade.allGeneLists$,this.geneListEnrichedResultStatus$=this.facade.selectedGenesEnrichedResultStatus$,this.selectedGenesInfoSubject=new v.X(null),this.trySamplesInfos=[{fileForImport:"RNA-seq-sample-data1.zip",fileForTry:"RNAseqClusterExp.json.gz",description:"RNA-seq Data"}],this.trySamplePercentage$=this.facade.trySamplePercentage$,this.ifShowTrySampleComponent=!0,this.downloadSampleDataPercentage$=this.facade.downloadSampleDataPercentage$,this.tutorialGifInfos=[{name:"New clustering analysis",src:"/static/images/interactiveOperations/ClusterExp-1-Import.gif"},{name:"Operations within the heatmap",src:"/static/images/interactiveOperations/ClusterExp-2-Heatmap.gif"},{name:"Select genes from the heatmap and display one gene's expression",src:"/static/images/interactiveOperations/ClusterExp-3-Genes Selected.gif"},{name:"Functional enrichment analysis and its related operations",src:"/static/images/interactiveOperations/ClusterExp-4-Enrichment.gif"}],this.allAvailableSpecies=ee.it,this.availableGeneIDtypes=ee.k1,this.selectedDatasetIDsubject=new v.X(null),this.annotationTermGenesSubject=new v.X(null),this.genesForEncirhmentSubject=new v.X(null),this.ifShowOneGeneExpression=!1,this.faTimes=G.NBC,this.faTable=G.B3e}ngOnInit(){this.availableGeneIDtypes$=this.selectedDatasetIDsubject.pipe((0,w.M)(this.allDatasetInfoForDisplay$),(0,T.U)(([t,n])=>{if(t){let s;return n.forEach(r=>{r.datasetID===t&&(s={name:r.IDtype,description:r.IDtype})}),[Object.assign({},s)]}return this.availableGeneIDtypes})),this.availableSpecies$=this.selectedDatasetIDsubject.pipe((0,w.M)(this.allDatasetInfoForDisplay$),(0,T.U)(([t,n])=>{if(t&&n){let s;for(let r of n)if(r.datasetID===t){s=r.speciesID;break}let o=[];for(const r of this.allAvailableSpecies)r.taxID===s&&o.push(r);return o}return this.allAvailableSpecies})),this.genesForEncirhmentSubject.pipe((0,S.h)(t=>null!=t),(0,w.M)(this.clusterResultAndTransform$.pipe((0,S.h)(t=>null!=t))),(0,T.U)(([t,n])=>({genes:t,backgroundGenes:n.result.leftUniqueTerms}))).subscribe(t=>{this.facade.requestEnrichedAnnotations(t)}),this.annotationTermGenesInfoForTable$=this.annotationTermGenesSubject.pipe((0,S.h)(t=>null!=t),(0,w.M)(this.genesInfoForTable$.pipe((0,S.h)(t=>null!=t))),(0,T.U)(([t,n])=>{const s=t.genes,o=n.features[0],r=n.genesInfo.filter(m=>s.includes(m[o]));return{features:n.features,genesInfo:r}})),this.addSelectedGenesInfo$=(0,te.aj)([this.selectedGenesInfoSubject.pipe((0,S.h)(t=>null!=t)),this.availableGeneListNames$.pipe((0,S.h)(t=>null!=t)),this.clusterResultAndTransform$.pipe((0,S.h)(t=>null!=t),(0,T.U)(t=>t.clusterResultID))]).pipe((0,T.U)(([t,n,s])=>{const o=q(s,t.clickedNode);return{ifAdded:n.includes(o),currentGeneListID:o}}))}processSelectedDatasetID(t){this.selectedDatasetIDsubject.next(t)}processClusterRequestInfo(t){this.facade.processClusteringRequest(t)}processSelectedClusterResultID(t){this.facade.requestClusterResultAndTransform(t)}processInputGeneListSignal(t){this.inputGenelistModalRef=this.modalService.show(this.inputGeneListComponent),this.cdr.detectChanges()}processInputGeneList(t){this.facade.inputGeneList(t)}processAnnotationTermsRequest(t){this.facade.requestAnnotationTerms(t)}processAnnotationGenesRequest(t){this.facade.requestAnnotationGenes(t)}processGeneListFromDatasetRequest(t){this.facade.processNewGeneListFromDatasetRequest(t)}processGeneListFromExistedRequest(t){this.facade.processNewGeneListFromExistedRequest(t)}processGenesSelected(t){this.facade.requestSelectedGenesInfo(t),this.selectedGenesInfoSubject.next(t)}processEnrichmentRequest(t){this.genesForEncirhmentSubject.next(t),this.enrichedModalRef=this.modalService.show(this.enrichmentContent,Object.assign({},{class:"modal-xl"}))}processSelectedAnnotationTermGenes(t){this.annotationTermGenesSubject.next(t)}processSelectedKEGGpathway(t){var n;this.facade.visKeggPathway(t),null===(n=this.enrichedModalRef)||void 0===n||n.hide()}processVisPPIsRequest(t){this.facade.visSelectedGenesPPIs()}processAddSelectedGenesToStoreSignal(t){this.facade.addSelectedToGeneLists()}processSelectedGene(t){this.ifShowOneGeneExpression=!0,this.facade.requestOneGeneExpressionForBoxplot(t)}closeModalForExpression(t){this.ifShowOneGeneExpression=!1}downloadGenes(t){}processDownloadProjectSignal(t){this.facade.downloadProjectSignal()}processTrySampleFileName(t){this.facade.prepareTrySampleData(t)}closeTrySampleComponent(t){this.ifShowTrySampleComponent=!1}processDownloadSampleData(t){this.facade.downloadSampleData(t)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(le),e.Y36(K.tT),e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-cluster-exp"]],viewQuery:function(t,n){if(1&t&&(e.Gf(nn,5,e.Rgc),e.Gf(sn,5,e.Rgc)),2&t){let s;e.iGM(s=e.CRH())&&(n.inputGeneListComponent=s.first),e.iGM(s=e.CRH())&&(n.enrichmentContent=s.first)}},decls:36,vars:26,consts:[[1,"row","flex-xl-nowrap"],[1,"col-12","col-md-3","col-xl-2","border","bd-sidebar"],[3,"allDatasetInfoForDisplay","availableGeneListNames","selectedDatasetID$","clusterRequestInfo$","inputNewGeneListSignal$"],[1,"col-12","col-md-9","col-xl-10","mt-2"],["class","row border",4,"ngIf"],[1,"row","mt-2"],[1,"col-12","d-flex","justify-content-between"],["data-testid","selectClusterResultID",3,"geneListclusterIDs","selectedClusterID$"],[3,"tutorialGifInfos"],[1,"row","row-cols-3","mt-1"],[1,"col-12","col-md-7","order-1","order-md-1","border"],[1,"text-center",2,"margin-bottom","0"],[1,"col-12","col-md-5","order-3","order-md-3","border"],[1,"text-center"],[1,"col-12","col-md-7","order-2","order-md-4","border","mainVisSection",3,"clusterResultAndTransform","phenotypeData","genesSelected$"],[1,"col-12","col-md-5","order-4","order-md-6","border","mainVisSection",2,"background-color","white"],[3,"genesInfoForTable","addSelectedGenesInfo","genesForEnrichment$","selectedGene$","visPPIsRequest$","addSelectedGenesToStore$",4,"ngIf"],["data-testid","selectedGenesFromHeatmapNote","class","text-info",4,"ngIf"],[1,"row","mt-4"],[1,"col-12"],[3,"downloadProjectSignal$"],["cdkDrag","","class","moveFreeDiv border",3,"geneExpForBoxPlot","closeSignal$",4,"ngIf"],["inputGeneListComponent",""],["enrichmentContent",""],[1,"row","border"],[1,"col-12","p-1"],[3,"fileInfos","trySamplePercentage","downloadSampleDataPercentage","sampleForTryName$","sampleForImportName$","closeMe$"],[3,"genesInfoForTable","addSelectedGenesInfo","genesForEnrichment$","selectedGene$","visPPIsRequest$","addSelectedGenesToStore$"],["data-testid","selectedGenesFromHeatmapNote",1,"text-info"],["cdkDrag","",1,"moveFreeDiv","border",3,"geneExpForBoxPlot","closeSignal$"],[1,"modal-header"],["type","button","aria-label","Close",1,"btn-close","close","pull-right",3,"click"],["aria-hidden","true",1,"visually-hidden"],[1,"modal-body"],[3,"defaultWay","availableSpecies","availableGeneIDtypes","annotationTerms","allDatasetInfoForDisplay","geneNumberAfterFilter","availableGeneLists","latestAddedGeneListID","outputGeneList$","annotationTermsRequest$","annotationGenesRequest$","geneListFromDatasetRequest$","geneListFromExistedRequest$"],[1,"modal-footer"],["data-testid","closeGeneListInput","type","button",1,"btn","btn-default","btn-sm",3,"click"],[1,"modal-title"],[3,"geneListErichedResultStatus","annotationTermGenesInfoForTable","selectedAnnotationTermGenes$","selectedKEGGpathway$","selectedGene$"],["data-testid","closeGeneListInput","type","button",1,"btn","btn-default",3,"click"]],template:function(t,n){if(1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"app-generate-new-cluster-analysis",2),e.NdJ("selectedDatasetID$",function(o){return n.processSelectedDatasetID(o)})("clusterRequestInfo$",function(o){return n.processClusterRequestInfo(o)})("inputNewGeneListSignal$",function(o){return n.processInputGeneListSignal(o)}),e.ALo(3,"async"),e.ALo(4,"async"),e.qZA(),e.qZA(),e.TgZ(5,"div",3),e.YNc(6,an,5,7,"div",4),e.TgZ(7,"div",5),e.TgZ(8,"div",6),e.TgZ(9,"app-select-a-cluster-result",7),e.NdJ("selectedClusterID$",function(o){return n.processSelectedClusterResultID(o)}),e.ALo(10,"reverse"),e.ALo(11,"async"),e.qZA(),e._UZ(12,"app-trigger-to-display-tutorial-gif",8),e.qZA(),e.qZA(),e.TgZ(13,"div",9),e.TgZ(14,"div",10),e.TgZ(15,"h5",11),e._uU(16," Heatmap "),e.qZA(),e.qZA(),e.TgZ(17,"div",12),e.TgZ(18,"h5",13),e._uU(19," Genes Selected "),e.qZA(),e.qZA(),e.TgZ(20,"app-vis-cluster-result-with-map",14),e.NdJ("genesSelected$",function(o){return n.processGenesSelected(o)}),e.ALo(21,"async"),e.ALo(22,"async"),e.qZA(),e.TgZ(23,"div",15),e.YNc(24,on,3,6,"app-selected-genes-management",16),e.ALo(25,"async"),e.YNc(26,ln,2,0,"p",17),e.ALo(27,"async"),e.qZA(),e.qZA(),e.TgZ(28,"div",18),e.TgZ(29,"div",19),e.TgZ(30,"app-download-project",20),e.NdJ("downloadProjectSignal$",function(o){return n.processDownloadProjectSignal(o)}),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.YNc(31,rn,2,3,"app-display-one-gene-expression",21),e.qZA(),e.YNc(32,cn,18,22,"ng-template",null,22,e.W1O),e.YNc(34,pn,13,6,"ng-template",null,23,e.W1O)),2&t){let s,o;e.xp6(2),e.Q6J("allDatasetInfoForDisplay",e.lcZ(3,10,n.allDatasetInfoForDisplay$))("availableGeneListNames",e.lcZ(4,12,n.availableGeneListNames$)),e.xp6(4),e.Q6J("ngIf",n.ifShowTrySampleComponent),e.xp6(3),e.Q6J("geneListclusterIDs",e.lcZ(10,14,e.lcZ(11,16,n.availableClusterResultIDs$))),e.xp6(3),e.Q6J("tutorialGifInfos",n.tutorialGifInfos),e.xp6(8),e.Q6J("clusterResultAndTransform",e.lcZ(21,18,n.clusterResultAndTransform$))("phenotypeData",e.lcZ(22,20,n.phenotypeDataOfCurrentDataset$)),e.xp6(4),e.Q6J("ngIf",(null==(s=e.lcZ(25,22,n.genesInfoForTable$))?null:s.genesInfo.length)>0),e.xp6(2),e.Q6J("ngIf",!((null==(o=e.lcZ(27,24,n.genesInfoForTable$))?null:o.genesInfo.length)>0)),e.xp6(5),e.Q6J("ngIf",n.ifShowOneGeneExpression)}},directives:[rt,x.O5,ut,ht.n,jt,Jt.E,kt.P,Qt,Xt.R,Y.Zt,Kt.D,en.r],pipes:[x.Ov,tn.B],styles:[""]}),i})(),data:{key:"ClusterExp"}}];let hn=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[W.Bz.forChild(un)],W.Bz]}),i})(),dn=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[le],imports:[[x.ez,W.Bz,Se.JF,_.u5,_.UX,Ie.Q8,Ce.Cl,Y._t,H.HK,O.uH,K.zk.forRoot(),ve.D,be.f,Te.m,hn]]}),i})()}}]);