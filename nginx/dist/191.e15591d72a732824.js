"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[191],{8191:(Wt,U,c)=>{c.r(U),c.d(U,{ClusterExpModule:()=>Vt});var D=c(6019),F=c(1144),ue=c(4522),_=c(9133),pe=c(3063),de=c(5479),k=c(7695),X=c(9256),he=c(3856),me=c(3667),ge=c(3928),fe=c(8702),e=c(3668),z=c(5043),Q=c(9220),S=c(4099),K=c(2668),ee=c(4102),G=c(5571),T=c(8053),I=c(8735);const _e=function(a){return[a.datasetID,a.genelistID,a.acrossGroupsOrSamples,a.clusterMethod,a.clusterMethodSetting].join("/")},Z=function(a,l){return[a,l].join("/")};var C=c(8472),M=c(6813),Ce=c(2411),L=c(9204),R=c(6636),Se=c(2047),Te=c(1366),te=c(5389),P=c(1890),be=c(8970),V=c(2277),Re=c(885);const se=a=>a.clusterExpState.hierarchicalClusList,ne=a=>a.clusterExpState.datasetGeneListClusterResultState,De=(0,C.P1)(ne,(a,l)=>a.ids),Le=(0,C.P1)(ne,(a,l)=>a.entities[l.clusterResultID]),Ge=(0,C.P1)(a=>a.clusterExpState.clusterResultMapTransformState,(a,l)=>a.entities[l.clusterResultID]),Ae=(0,C.P1)(a=>a.clusterExpState.datasetInfoForCluster,Re.ig);(0,C.P1)(Ae,(a,l)=>a[l.datasetID]),(0,C.P1)(se,(a,l)=>{const t=l.datasetID,s=l.clusterMethod;let n=!1;for(let i of a)if(i.clusterMethod===s&&i.datasetID===t){n=!0;break}return n}),(0,C.P1)(se,(a,l)=>{const t=l.datasetID,s=l.clusterMethod;let n;for(let i of a)if(i.clusterMethod===s&&i.datasetID===t){n=i;break}return n});var N=c(8425),ae=c(661),O=c(7473),we=c(9744),j=c(7548),Ee=c(1118),W=c(254),He=c(7194),$e=c(4165),Me=c(8779),Ne=c(9990),Fe=c(9868),Ze=c(4205),Oe=c(5535),Ye=c(4473);let re=(()=>{class a extends He.g{constructor(t,s,n,i,u,g,m,h){super(t,g,m,h),this.store=t,this.clusterService=s,this.enrichmentService=n,this.trySamppleService=i,this.interAppsInteractService=u,this.requestHierarchicalResultByMethod$=new S.X(null),this.clusterRequest$=new S.X(null),this.IDforRequestResultAndTransformSubject=new S.X(null),this.selectedGenesInfoSubject=new S.X(null),this.speciesIDSubject=new S.X(null),this.geneIDtypeSubject=new S.X(null),this.datasetIDSubject=new S.X(null),this.enrichRequestGenesSubject=new S.X(null),this.oneGeneExpRequestSubject=new S.X(null),this.selectedGenesEnrichedResultSubject$=new S.X(null),this.visSelectedGenesPPIsSubject=new S.X(null),this.addSelectedToGeneListsSubject=new S.X(null),this.geneList2PPIExpSubject=new S.X(null),this.visKeggPathwaySubject=new S.X(null),this.hierarchicalResultForDisplay$=new S.X(null),this.selectedGenesEnrichedResultStatus$=this.selectedGenesEnrichedResultSubject$.asObservable(),this.allDatasetInfoForDisplay$=this.store.pipe((0,C.Ys)(O.yz)).pipe((0,T.U)(r=>[...r].reverse())),this.clusterRequest$.pipe((0,I.h)(r=>null!=r),(0,L.w)(r=>{const o=this.store.pipe((0,C.Ys)(O.iR,{datasetID:r.datasetID}),(0,R.q)(1)),d=this.store.pipe((0,C.Ys)(N.Vq,{ID:r.genelistID}),(0,R.q)(1)).pipe((0,L.w)(f=>this.store.pipe((0,C.Ys)(j.l,{datasetID:r.datasetID,geneIDs:f.genes}),(0,R.q)(1))));return(0,M.D)([o,d]).pipe((0,L.w)(([f,v])=>{const x=`${f.speciesID}-${f.IDtype}`,y=this.clusterService.requestNormalizedValuesSpecificClusterResult({experimentType:f.experimentType,dataArray:v.expressionValues,genes:v.geneIDs,samples:f.samples,groups:f.groups,acrossGroupsOrSamples:r.acrossGroupsOrSamples,clusterMethod:r.clusterMethod,clusterMethodSetting:r.clusterMethodSetting}),E=this.store.pipe((0,C.Ys)(P.MR,{ID:x,geneIDs:v.geneIDs}),(0,R.q)(1));return(0,M.D)([y,E]).pipe((0,T.U)(([A,w])=>{const H=A.leftUniqueTerms.map(le=>w.get(le)),$=Object.assign(Object.assign({},A),{leftDisplayTerms:H});return{clusterResultID:_e(r),datasetID:f.datasetID,genelistID:r.genelistID,acrossGroupsOrSamples:r.acrossGroupsOrSamples,clusterMethod:r.clusterMethod,clusterMethodSetting:r.clusterMethodSetting,result:$}}))}))})).subscribe(r=>{this.store.dispatch(V.Ys({clusterResult:r})),this.store.dispatch(V.X5({clusterMapTransform:{clusterResultID:r.clusterResultID,transform:{x:0,y:0,k:1}}}))}),this.availableClusterResultIDs$=this.store.pipe((0,C.Ys)(De)),this.IDforRequestResultAndTransformSubject.pipe((0,I.h)(r=>null!=r),(0,T.U)(r=>function(a){const l=a.split("/");let t;const s=l[3];return"Kmeans"===s?t=parseInt(l[4]):"Hierarchical"===s&&(t=l[4]),{datasetID:l[0],genelistID:l[1],acrossGroupsOrSamples:l[2],clusterMethod:s,clusterMethodSetting:t}}(r)),(0,L.w)(r=>this.store.pipe((0,C.Ys)(O.iR,{datasetID:r.datasetID}),(0,R.q)(1),(0,T.U)(o=>({geneIDtype:o.IDtype,datasetID:o.datasetID,speciesID:o.speciesID}))))).subscribe(r=>{this.geneIDtypeSubject.next(r.geneIDtype),this.datasetIDSubject.next(r.datasetID),this.speciesIDSubject.next(r.speciesID)}),this.datasetGeneListClusterResultAndTransform$=this.IDforRequestResultAndTransformSubject.pipe((0,I.h)(r=>null!=r),(0,L.w)(r=>{const o=this.store.pipe((0,C.Ys)(Le,{clusterResultID:r}),(0,R.q)(1)),d=this.store.pipe((0,C.Ys)(Ge,{clusterResultID:r}),(0,R.q)(1));return(0,M.D)([o,d]).pipe((0,T.U)(([f,v])=>Object.assign(Object.assign({},f),{transform:v.transform})))})),this.selectedGenesInfo$=this.selectedGenesInfoSubject.pipe((0,I.h)(r=>null!=r),(0,G.M)(this.geneIDtypeSubject.pipe((0,I.h)(r=>null!=r)),this.datasetIDSubject.pipe((0,I.h)(r=>null!=r)),this.speciesIDSubject.pipe((0,I.h)(r=>null!=r))),(0,L.w)(([r,o,d,f])=>{const v=(0,W.sj)(f,o),b=this.store.pipe((0,C.Ys)(P.en,{IDtype:v,geneIDs:r.genes}),(0,R.q)(1)),x=this.store.pipe((0,C.Ys)(j.l,{datasetID:d,geneIDs:r.genes}),(0,R.q)(1));return(0,M.D)([b,x]).pipe((0,T.U)(([y,E])=>(0,W.Dj)(E,y)))})),this.enrichRequestGenesSubject.pipe((0,I.h)(r=>null!=r),(0,G.M)(this.selectedGenesInfoSubject.pipe((0,I.h)(r=>null!=r)),this.geneIDtypeSubject.pipe((0,I.h)(r=>null!=r)),this.speciesIDSubject.pipe((0,I.h)(r=>null!=r)),this.IDforRequestResultAndTransformSubject.pipe((0,I.h)(r=>null!=r))),(0,L.w)(([r,o,d,f,v])=>{const b={speciesID:f,geneIDtype:d,genes:o.genes,backgroundGenes:r.backgroundGenes},x=Z(v,o.clickedNode);return this.enrichmentService.requestGenesEnrichedAnnotations(b).pipe((0,T.U)(y=>({status:"finished",statusValue:"finished",result:{geneListID:x,geneIDtype:d,speciesID:f,enrichedAnnotations:y}})),(0,Se.K)(y=>(0,Ce.of)({status:"error",statusValue:`Error occured while requesting enriched annoations. error:${y.status}, errorText:${y.statusText}`})))})).subscribe(r=>{this.selectedGenesEnrichedResultSubject$.next(r)}),this.selectedGeneExpForBoxPlot$=this.oneGeneExpRequestSubject.pipe((0,I.h)(r=>null!=r),(0,G.M)(this.datasetIDSubject.pipe((0,I.h)(r=>null!=r)),this.geneIDtypeSubject.pipe((0,I.h)(r=>null!=r)),this.speciesIDSubject.pipe((0,I.h)(r=>null!=r))),(0,L.w)(([r,o,d,f])=>{const v=(0,W.sj)(f,d),b=this.store.pipe((0,C.Ys)(P.ek,{IDtype:v,geneID:r}),(0,R.q)(1)),x=this.store.pipe((0,C.Ys)(O.pO,{datasetID:o}),(0,R.q)(1)),y=this.store.pipe((0,C.Ys)(j.l,{datasetID:o,geneIDs:[r]}),(0,R.q)(1));return(0,M.D)([b,x,y]).pipe((0,T.U)(([E,A,w])=>{const H=w.expressionValues[0],$=w.samples;return{geneInfo:E,groupsExpInfo:A.map(oe=>{const jt=oe.samples.map(ce=>({sampleName:ce,value:H[$.indexOf(ce)]}));return{groupName:oe.name,samplesExpInfo:jt}}),groupPairsPvalue:[]}}))})),this.visSelectedGenesPPIsSubject.pipe((0,I.h)(Boolean),(0,G.M)(this.IDforRequestResultAndTransformSubject.pipe((0,I.h)(r=>null!=r)),this.speciesIDSubject.pipe((0,I.h)(r=>null!=r)),this.geneIDtypeSubject.pipe((0,I.h)(r=>null!=r)),this.selectedGenesInfoSubject.pipe((0,I.h)(r=>null!=r))),(0,T.U)(([r,o,d,f,v])=>({name:Z(o,v.clickedNode),speciesID:d,IDtype:f,genes:v.genes})),(0,Te.b)(r=>{this.geneList2PPIExpSubject.next(r)}),(0,L.w)(r=>this.store.pipe((0,C.Ys)(N.Ef,{geneListID:r.name}),(0,R.q)(1),(0,I.h)(o=>!o),(0,T.U)(o=>r)))).subscribe(r=>{this.store.dispatch(ae.J({geneList:r}))}),(0,K.aj)([this.store.pipe((0,C.Ys)(N.Dm)),this.geneList2PPIExpSubject.pipe((0,I.h)(r=>null!=r))]).pipe((0,L.w)(([r,o])=>this.store.pipe((0,C.Ys)(N.Ef,{geneListID:o.name}),(0,R.q)(1),(0,I.h)(d=>d),(0,T.U)(d=>o.name))),(0,te.x)()).subscribe(r=>{this.interAppsInteractService.sendGeneList2PPIExp(r)}),this.addSelectedToGeneListsSubject.pipe((0,I.h)(Boolean),(0,G.M)(this.IDforRequestResultAndTransformSubject.pipe((0,I.h)(r=>null!=r)),this.speciesIDSubject.pipe((0,I.h)(r=>null!=r)),this.geneIDtypeSubject.pipe((0,I.h)(r=>null!=r)),this.selectedGenesInfoSubject.pipe((0,I.h)(r=>null!=r))),(0,T.U)(([r,o,d,f,v])=>({name:Z(o,v.clickedNode),speciesID:d,IDtype:f,genes:v.genes})),(0,L.w)(r=>this.store.pipe((0,C.Ys)(N.Ef,{geneListID:r.name}),(0,R.q)(1),(0,I.h)(o=>!o),(0,T.U)(o=>r)))).subscribe(r=>{this.store.dispatch(ae.J({geneList:r}))}),this.visKeggPathwaySubject.pipe((0,I.h)(r=>null!=r),(0,G.M)(this.speciesIDSubject),(0,T.U)(([r,o])=>({speciesID:o,pathwayID:r}))).subscribe(r=>{this.interAppsInteractService.sendPathway2KeggExp(r)}),this.trySamppleService.trySampleData$.pipe((0,I.h)(Boolean)).subscribe(r=>{this.store.dispatch(we.CF({newState:r.datasetListState})),this.store.dispatch(Ee.gw({newState:r.localExpressDataState})),this.store.dispatch(be.A({newState:r.geneAnnotationsState})),this.store.dispatch(V.N8({newState:r.clusterExpState}))}),this.trySamplePercentage$=this.trySamppleService.trySamplePercentage$}processClusteringRequest(t){this.clusterRequest$.next(t)}requestClusterResultAndTransform(t){this.IDforRequestResultAndTransformSubject.next(t)}requestSelectedGenesInfo(t){this.selectedGenesInfoSubject.next(t)}requestEnrichedAnnotations(t){this.enrichRequestGenesSubject.next(t)}requestOneGeneExpressionForBoxplot(t){this.oneGeneExpRequestSubject.next(t)}prepareTrySampleData(t){this.trySamppleService.requestTrySampleData(t)}visSelectedGenesPPIs(){this.visSelectedGenesPPIsSubject.next(!0)}addSelectedToGeneLists(){this.addSelectedToGeneListsSubject.next(!0)}visKeggPathway(t){this.visKeggPathwaySubject.next(t)}}return a.\u0275fac=function(t){return new(t||a)(e.LFG(C.yh),e.LFG($e.W),e.LFG(Me.g),e.LFG(Ne.v),e.LFG(Fe.h),e.LFG(Ze.b),e.LFG(Oe.f),e.LFG(Ye.h))},a.\u0275prov=e.Yz7({token:a,factory:a.\u0275fac}),a})();var qe=c(1954),Y=c(3405),q=c(8805);const Be=["Hierarchical","Kmeans"],Pe=["average","single","complete"];var ie=c(3013);function Ve(a,l){if(1&a&&(e.TgZ(0,"label",3),e._uU(1),e.qZA()),2&a){const t=e.oxw();e.xp6(1),e.hij(" ",t.outRangeLabel," ")}}const je=function(a){return{"form-inline":a}};let We=(()=>{class a{constructor(t){this.cdr=t,this.formInlineOrNot=!1,this.outputNumber$=new e.vpe,this.destroyNotifier$=new Y.xQ}ngOnInit(){this.numberForm=new _.cw({inputNumber:new _.NI(null,[_.kI.required,_.kI.max(10),_.kI.min(1)])}),this.numberForm.get("inputNumber").valueChanges.pipe((0,I.h)(t=>t),(0,q.R)(this.destroyNotifier$),(0,te.x)()).subscribe(t=>{"VALID"===this.numberForm.get("inputNumber").status&&this.outputNumber$.next(t),this.cdr.detectChanges()})}ngOnDestroy(){this.destroyNotifier$.next(),this.destroyNotifier$.complete()}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(e.sBO))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-input-number"]],inputs:{rangeMin:"rangeMin",rangeMax:"rangeMax",inputLabel:"inputLabel",outRangeLabel:"outRangeLabel",formInlineOrNot:"formInlineOrNot"},outputs:{outputNumber$:"outputNumber$"},decls:4,vars:6,consts:[[3,"ngClass","formGroup"],["type","number","formControlName","inputNumber",1,"form-control","form-control-sm"],["data-testid","inputNumAlert","class","text-danger font-weight-light",4,"ngIf"],["data-testid","inputNumAlert",1,"text-danger","font-weight-light"]],template:function(t,s){1&t&&(e.TgZ(0,"form",0),e._uU(1),e._UZ(2,"input",1),e.YNc(3,Ve,2,1,"label",2),e.qZA()),2&t&&(e.Q6J("ngClass",e.VKq(4,je,s.formInlineOrNot))("formGroup",s.numberForm),e.xp6(1),e.hij(" ",s.inputLabel,": "),e.xp6(2),e.Q6J("ngIf",s.numberForm.get("inputNumber").invalid))},directives:[_._Y,_.JL,D.mk,_.sg,_.wV,_.Fj,_.JJ,_.u,D.O5],styles:[""],changeDetection:0}),a})();function Je(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"app-select-item",3),e.NdJ("selectedItem$",function(n){return e.CHM(t),e.oxw().processHierarchicalLinkage(n)}),e.qZA()}if(2&a){const t=e.oxw();e.Q6J("inputItems",t.linkageCriterias)("itemLabel","Linkage Criteria")("formInlineOrNot",!1)("formWidth","100%")}}function Ue(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"app-input-number",4),e.NdJ("outputNumber$",function(n){return e.CHM(t),e.oxw().processKmeansClusterNum(n)}),e.qZA()}2&a&&e.Q6J("rangeMin",2)("rangeMax","Infinity")("inputLabel","Cluster Number")("outRangeLabel","Cluster Number should be larger than 2")("formInlineOrNot",!1)}let ke=(()=>{class a{constructor(){this.clusterMethodInfo$=new e.vpe,this.clusterMethods=Be,this.linkageCriterias=Pe,this.destroyNotifier$=new Y.xQ,this.methodInfoForm=new _.cw({clusterMethod:new _.NI("",_.kI.required),clusterMethodSetting:new _.NI("",_.kI.required)})}ngOnInit(){this.methodInfoForm.valueChanges.pipe((0,q.R)(this.destroyNotifier$)).subscribe(t=>{var s;"VALID"===(null===(s=this.methodInfoForm)||void 0===s?void 0:s.status)&&this.clusterMethodInfo$.next(t)})}processClusterMethod(t){this.selectedClusterMethod=t,this.methodInfoForm.patchValue({clusterMethod:t})}processHierarchicalLinkage(t){this.methodInfoForm.patchValue({clusterMethodSetting:t})}processKmeansClusterNum(t){this.methodInfoForm.patchValue({clusterMethodSetting:t})}ngOnDestroy(){this.destroyNotifier$.next(),this.destroyNotifier$.complete()}}return a.\u0275fac=function(t){return new(t||a)},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-select-cluster-method-and-parameter"]],outputs:{clusterMethodInfo$:"clusterMethodInfo$"},decls:3,vars:6,consts:[["data-testid","selectClusterMethod",1,"mt-2",3,"inputItems","itemLabel","formInlineOrNot","formWidth","selectedItem$"],["class","mt-2","data-testid","selectHierarLinkage",3,"inputItems","itemLabel","formInlineOrNot","formWidth","selectedItem$",4,"ngIf"],["class","mt-2","data-testid","inputKmeansNum",3,"rangeMin","rangeMax","inputLabel","outRangeLabel","formInlineOrNot","outputNumber$",4,"ngIf"],["data-testid","selectHierarLinkage",1,"mt-2",3,"inputItems","itemLabel","formInlineOrNot","formWidth","selectedItem$"],["data-testid","inputKmeansNum",1,"mt-2",3,"rangeMin","rangeMax","inputLabel","outRangeLabel","formInlineOrNot","outputNumber$"]],template:function(t,s){1&t&&(e.TgZ(0,"app-select-item",0),e.NdJ("selectedItem$",function(i){return s.processClusterMethod(i)}),e.qZA(),e.YNc(1,Je,1,4,"app-select-item",1),e.YNc(2,Ue,1,5,"app-input-number",2)),2&t&&(e.Q6J("inputItems",s.clusterMethods)("itemLabel","Cluster Method")("formInlineOrNot",!1)("formWidth","100%"),e.xp6(1),e.Q6J("ngIf","Hierarchical"===s.selectedClusterMethod),e.xp6(1),e.Q6J("ngIf","Kmeans"===s.selectedClusterMethod))},directives:[ie.y,D.O5,We],styles:[""],changeDetection:0}),a})();var Xe=c(1026);function ze(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"div"),e.TgZ(1,"app-select-dataset",10),e.NdJ("selectedDatasetID$",function(n){return e.CHM(t),e.oxw().processSelectedDatasetID(n)}),e.qZA(),e.qZA()}if(2&a){const t=e.oxw();e.xp6(1),e.Q6J("allDatasetInfoForDisplay",t.allDatasetInfoForDisplay)("formInlineOrNot",!1)}}function Qe(a,l){1&a&&(e.TgZ(0,"h5"),e._uU(1,"Dataset:"),e.qZA(),e.TgZ(2,"p"),e._uU(3,"Please import a dataset first. "),e.TgZ(4,"a",11),e._uU(5,"Import Data"),e.qZA(),e.qZA())}function Ke(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"div"),e.TgZ(1,"app-select-item",12),e.NdJ("selectedItem$",function(n){return e.CHM(t),e.oxw().processSelectedGenelistID(n)}),e.qZA(),e.qZA()}if(2&a){const t=e.oxw();e.xp6(1),e.Q6J("inputItems",t.availableGeneListNames)("itemLabel","Gene List")("emptyNote","Please load or generate a new gene list first")("formInlineOrNot",!1)}}function et(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"h5"),e._uU(1,"Gene List:"),e.qZA(),e.TgZ(2,"p"),e._uU(3,"Please load or generate a new gene list "),e.TgZ(4,"a",13),e.NdJ("click",function(n){return e.CHM(t),e.oxw().triggerInputGeneListSignal(n)}),e._uU(5,"New Gene List"),e.qZA(),e.qZA()}}let tt=(()=>{class a{constructor(t){this.cdr=t,this.inputNewGeneListSignal$=new e.vpe,this.clusterRequestInfo$=new e.vpe,this.selectedDatasetID$=new e.vpe,this.acrossTypes=["Across Samples","Across Groups"],this.clusterRequestInfoForm=new _.cw({datasetID:new _.NI("",_.kI.required),genelistID:new _.NI("",_.kI.required),acrossGroupsOrSamples:new _.NI("",_.kI.required),clusterMethod:new _.NI("",_.kI.required),clusterMethodSetting:new _.NI("",_.kI.required)}),this.clusterRequestInfoForm.statusChanges.subscribe(s=>{this.cdr.detectChanges()})}ngOnInit(){}processSelectedDatasetID(t){this.clusterRequestInfoForm.patchValue({datasetID:t}),this.selectedDatasetID$.next(t)}processSelectedGenelistID(t){this.clusterRequestInfoForm.patchValue({genelistID:t})}processAcrossType(t){this.clusterRequestInfoForm.patchValue({acrossGroupsOrSamples:t})}processClusterMethodInfo(t){this.clusterRequestInfoForm.patchValue({clusterMethod:t.clusterMethod,clusterMethodSetting:t.clusterMethodSetting})}submitClusterRequest(t){this.clusterRequestInfo$.next(this.clusterRequestInfoForm.value)}triggerInputGeneListSignal(t){this.inputNewGeneListSignal$.next(!0)}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(e.sBO))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-generate-new-cluster-analysis"]],inputs:{allDatasetInfoForDisplay:"allDatasetInfoForDisplay",availableGeneListNames:"availableGeneListNames"},outputs:{inputNewGeneListSignal$:"inputNewGeneListSignal$",clusterRequestInfo$:"clusterRequestInfo$",selectedDatasetID$:"selectedDatasetID$"},decls:19,vars:7,consts:[[1,"mt-4"],[4,"ngIf","ngIfElse"],["importDataNote",""],["importGeneListNote",""],[1,"mt-2",3,"inputItems","itemLabel","selectedItem$"],[1,"mt-3"],[3,"clusterMethodInfo$"],["data-testid","submitNewCluster",1,"mt-2","btn","btn-expressvis",3,"disabled","click"],[1,"border-top","mt-4"],["data-testid","newGeneList",1,"btn","btn-sm",3,"click"],[3,"allDatasetInfoForDisplay","formInlineOrNot","selectedDatasetID$"],["routerLink","/importData"],["data-testid","selectGeneList",1,"mt-2",3,"inputItems","itemLabel","emptyNote","formInlineOrNot","selectedItem$"],["href","javascript:void(0)",3,"click"]],template:function(t,s){if(1&t&&(e.TgZ(0,"h5",0),e._uU(1," Generate a Clustering Analysis\n"),e.qZA(),e.TgZ(2,"div"),e.YNc(3,ze,2,2,"div",1),e.YNc(4,Qe,6,0,"ng-template",null,2,e.W1O),e.YNc(6,Ke,2,4,"div",1),e.YNc(7,et,6,0,"ng-template",null,3,e.W1O),e.TgZ(9,"app-select-between-two-using-radio",4),e.NdJ("selectedItem$",function(i){return s.processAcrossType(i)}),e.qZA(),e.TgZ(10,"div",5),e.TgZ(11,"app-select-cluster-method-and-parameter",6),e.NdJ("clusterMethodInfo$",function(i){return s.processClusterMethodInfo(i)}),e.qZA(),e.qZA(),e.TgZ(12,"button",7),e.NdJ("click",function(i){return s.submitClusterRequest(i)}),e._uU(13," Submit "),e.qZA(),e.TgZ(14,"p",8),e._uU(15,"If the genes are not in the gene lists, click the following button to input a new gene list "),e.qZA(),e.TgZ(16,"button",9),e.NdJ("click",function(i){return s.triggerInputGeneListSignal(i)}),e._uU(17," Load or Generate a new gene list "),e.qZA(),e._UZ(18,"div"),e.qZA()),2&t){const n=e.MAs(5),i=e.MAs(8);e.xp6(3),e.Q6J("ngIf",(null==s.allDatasetInfoForDisplay?null:s.allDatasetInfoForDisplay.length)>0)("ngIfElse",n),e.xp6(3),e.Q6J("ngIf",(null==s.availableGeneListNames?null:s.availableGeneListNames.length)>0)("ngIfElse",i),e.xp6(3),e.Q6J("inputItems",s.acrossTypes)("itemLabel","Across samples or groups"),e.xp6(3),e.Q6J("disabled","VALID"!=s.clusterRequestInfoForm.status)}},directives:[D.O5,qe.W,ke,Xe.z,F.yS,ie.y],styles:[""],changeDetection:0}),a})();function st(a,l){if(1&a&&(e.TgZ(0,"option",5),e._uU(1),e.qZA()),2&a){const t=l.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t," ")}}function nt(a,l){1&a&&(e.TgZ(0,"label",6),e._uU(1," Generate a Cluster Analysis in the Left Sidebar "),e.qZA())}let at=(()=>{class a{constructor(){this.selectedClusterID$=new e.vpe,this.destroyNotifier$=new Y.xQ,this.clusterSelectForm=new _.cw({clusterID:new _.NI("",_.kI.required)})}ngOnInit(){this.clusterSelectForm.get("clusterID").valueChanges.pipe((0,q.R)(this.destroyNotifier$)).subscribe(t=>{this.selectedClusterID$.next(t)})}ngOnChanges(t){t.geneListclusterIDs&&!t.geneListclusterIDs.isFirstChange()&&this.clusterSelectForm.patchValue({clusterID:[...this.geneListclusterIDs][0]})}ngOnDestroy(){this.destroyNotifier$.next(),this.destroyNotifier$.complete()}}return a.\u0275fac=function(t){return new(t||a)},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-select-a-cluster-result"]],inputs:{geneListclusterIDs:"geneListclusterIDs"},outputs:{selectedClusterID$:"selectedClusterID$"},features:[e.TTD],decls:6,vars:3,consts:[[1,"form-inline",3,"formGroup"],["for","clusterSelect"],["formControlName","clusterID",1,"form-control","form-control-sm","ml-2"],[3,"value",4,"ngFor","ngForOf"],["class","text-danger font-weight-light",4,"ngIf"],[3,"value"],[1,"text-danger","font-weight-light"]],template:function(t,s){1&t&&(e.TgZ(0,"form",0),e.TgZ(1,"label",1),e._uU(2,"Select a Cluster Result:"),e.qZA(),e.TgZ(3,"select",2),e.YNc(4,st,2,2,"option",3),e.qZA(),e.YNc(5,nt,2,0,"label",4),e.qZA()),2&t&&(e.Q6J("formGroup",s.clusterSelectForm),e.xp6(4),e.Q6J("ngForOf",s.geneListclusterIDs),e.xp6(1),e.Q6J("ngIf",!((null==s.geneListclusterIDs?null:s.geneListclusterIDs.length)>=1&&s.geneListclusterIDs)))},directives:[_._Y,_.JL,_.sg,_.EJ,_.JJ,_.u,D.sg,D.O5,_.YN,_.Kr],styles:[""],changeDetection:0}),a})();var rt=c(5150);let it=(()=>{class a{constructor(){this.genesSelected$=new e.vpe}ngOnInit(){this._extractHierarchicalResultForDisplay()}ngOnChanges(t){t.clusterResultTransform&&!t.clusterResultTransform.isFirstChange()&&this._extractHierarchicalResultForDisplay()}_extractHierarchicalResultForDisplay(){this.clusterResultTransform&&(this.hierarchicalResultForDisplay={clusterResult:Object.assign({},this.clusterResultTransform.result),transform:Object.assign({},this.clusterResultTransform.transform),basicSetting:null})}processNodesSelected(t){this.genesSelected$.next({clickedNode:t.clickedNode,genes:t.selectedNodes})}}return a.\u0275fac=function(t){return new(t||a)},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-vis-hierarchical-cluster-result"]],inputs:{clusterResultTransform:"clusterResultTransform"},outputs:{genesSelected$:"genesSelected$"},features:[e.TTD],decls:1,vars:3,consts:[[3,"hierarchicalResultForDisplay","auditTime","highlightUseCoverOrClass","nodesSelected$"]],template:function(t,s){1&t&&(e.TgZ(0,"app-dendgrogram-vis",0),e.NdJ("nodesSelected$",function(i){return s.processNodesSelected(i)}),e.qZA()),2&t&&e.Q6J("hierarchicalResultForDisplay",s.hierarchicalResultForDisplay)("auditTime",300)("highlightUseCoverOrClass","useCover")},directives:[rt.J],styles:[""],changeDetection:0}),a})();var p=c(2707),J=c(2307),lt=c(8105);const ot=["svgContainer"],ct=["svgElement"],ut=["heatmap"],pt=["heatmapCoverRects"],dt=["xLabels"],ht=["xLabelsCoverRects"],mt=["yLabels"],gt=["yLabelsCoverRects"],ft=["verticalScaleIndicators"],_t=["horizontalScaleIndicators"],It=["upCoverForHighlight"],vt=["downCoverForHighlight"];let Ct=(()=>{class a{constructor(){this.selectedClusterIndex$=new e.vpe,this.mapSettings$=new e.vpe,this.clusterGap=4,this.svgHeight=100,this.svgWidth=200,this.marginTop=10,this.marginLeft=10,this.marginRight=10,this.marginBottom=10,this.verticalScaleIndicatorWidth=30,this.verticalIndicatorHeatmapGap=5,this.VERTICAL_MOVE_BAR_HEIGHT=5,this.HORIZONAL_MOVE_BAR_WIDTH=5,this.horizontalScaleIndicatorHeight=30,this.horizontalIndicatorHeatmapGap=5,this.xLabelFontSize=2,this.xLabelRotationDegree=-30,this.yLabelFontSize=1,this.rowHeight=4,this.rectWidth=6,this.clickedClusterIndex=-1,this.transformOneDirectionInfo={realTranslateX:0,realTranslateY:0,zoomTranslateX:0,zoomTranslateY:0,realScaleX:1,realScaleY:1,zoomScale:1},this.initialxLableXTranslate=[],this.zoomFromScaleBar$=new S.X(null),this.destroyNotifier$=new Y.xQ,this.zoomFromScaleBar$.pipe((0,q.R)(this.destroyNotifier$),(0,I.h)(t=>null!=t),(0,lt.e)(this.auditTime)).subscribe(t=>{const s=t.scaleBarSetting;if("vertical"===t.sourceOrientation){const n=this._convertScrollBarParameters2zoomParameters(t.sourceOrientation,s,Object.assign({},this.transformOneDirectionInfo));this._transformMapUsingRealZoomValues(n.realTranslateX,n.realTranslateY,n.realScaleX,n.realScaleY),this._updateTransformInfo(n),this._modifyVerticalScaleIndicators(s.smallEndRectLong,s.middleRectLong,s.bigEndRectLong,s.indicatorLong,this.VERTICAL_MOVE_BAR_HEIGHT),this._toggleYlabelsVisibility(n.realScaleY),this.clickedClusterIndex>=0&&this._highlightClickedCluster(this.clickedClusterIndex),this.mapSettings$.next(n)}else if("horizontal"===t.sourceOrientation){const n=this._convertScrollBarParameters2zoomParameters(t.sourceOrientation,s,Object.assign({},this.transformOneDirectionInfo));this._transformMapUsingRealZoomValues(n.realTranslateX,n.realTranslateY,n.realScaleX,n.realScaleY),this._updateTransformInfo(n),this._modifyHorizontalScaleIndicators(s.smallEndRectLong,s.middleRectLong,s.bigEndRectLong,s.indicatorLong,this.HORIZONAL_MOVE_BAR_WIDTH),this.mapSettings$.next(n)}})}ngOnInit(){}ngAfterViewInit(){this._initMap()}ngOnChanges(t){t.kmeansClusterResult&&!t.kmeansClusterResult.isFirstChange()&&this._initMap()}ngOnDestroy(){this.destroyNotifier$.next(),this.destroyNotifier$.complete()}_initMap(){this.kmeansClusterResult&&(this._prepareSvgSettings(),this._drawHeatmaps(),this._addXlabels(),this._addYlabels(),this._toggleYlabelsVisibility(this.transformOneDirectionInfo.realScaleY),this._drawCoversForHighlight(),this._addVerticalScaleIndicators(),this._addHorizontalScaleIndicators(),this._addCoverBoxes())}_prepareSvgSettings(){this.clusterNum=this.kmeansClusterResult.subClusters.length,this.rowsNum=this._computeRowsNum(),this.xLabelsNum=this._computeRectsNum(),this.svgHeight=this.svgContainer.nativeElement.clientHeight,this.svgWidth=this.svgContainer.nativeElement.clientWidth,this.marginRight=this._obtainMarginRight(),this.marginBottom=this._obtainMarginBottom(),this.marginLeft=this._obtainMarginLeft(),this.heatmapHeight=this.svgHeight-this.marginTop-this.horizontalScaleIndicatorHeight-this.horizontalIndicatorHeatmapGap-this.marginBottom,this.heatmapWidth=this.svgWidth-this.marginLeft-this.verticalScaleIndicatorWidth-this.verticalIndicatorHeatmapGap-this.marginRight,this.svgLeft2HeatmapWidth=this.marginLeft+this.verticalScaleIndicatorWidth+this.verticalIndicatorHeatmapGap,this.svgTop2HeatmapHeight=this.marginTop+this.horizontalScaleIndicatorHeight+this.horizontalIndicatorHeatmapGap,this.rowHeight=this._computeRowHeight(),this.rectWidth=this._computeRectWidth(),this.Y_LABLE_CHARACTER_HEIGHT=(0,J.P)(this.yLabelFontSize),this.clustersYpos=this._computeSubclustersYpos(),this.topDisplayTerms=this.kmeansClusterResult.topDisplayTerms,this.d3Svg=(0,p.Ys)(this.svgElement.nativeElement),this.d3Svg.attr("width",this.svgWidth)}_drawHeatmaps(){const t=this,s=this._obtainAllValuesAsArray();let n=(0,p.sXR)("blue","yellow");const i=(0,p.BYU)().domain([(0,p.VV$)(s),(0,p.Fp7)(s)]).range([0,1]);(0,p.Ys)(this.heatmap.nativeElement).attr("transform","translate("+t.svgLeft2HeatmapWidth+" "+t.svgTop2HeatmapHeight+")"),this.kmeansClusterResult.subClusters.forEach((u,g)=>{const m=u.dataMatrix;(0,p.Ys)(this.heatmap.nativeElement).append("g").attr("class","subMap").attr("ifClicked",!1).attr("transform","translate(0 "+t.clustersYpos[g]+")").on("click",function(){"false"===(0,p.Ys)(this).attr("ifClicked")?(t.selectedClusterIndex$.next(g),(0,p.Ys)(this).attr("ifClicked",!0),t.clickedClusterIndex=g,t._highlightClickedCluster(g)):(t.selectedClusterIndex$.next(-1),t.clickedClusterIndex=-1,t._disHighlightClickedCluster(),(0,p.Ys)(this).attr("ifClicked",!1))}).selectAll(".row").data(m).enter().append("g").attr("transform",function(o,d){return"translate(0, "+d*t.rowHeight+")"}).selectAll(".rect").data(function(o){return o}).enter().append("rect").attr("class","grid").attr("width",t.rectWidth).attr("height",t.rowHeight).attr("x",function(o,d){return t.rectWidth*d}).attr("stroke-width",0).style("fill",function(o){if(isNaN(o))return"white";{let d=i(o);return n(d)}})})}_addYlabels(){const t=this;(0,p.Ys)(this.yLabels.nativeElement).attr("transform","translate("+(t.svgLeft2HeatmapWidth+t.heatmapWidth)+" "+t.svgTop2HeatmapHeight+")").attr("visibility","hidden"),this.kmeansClusterResult.subClusters.forEach((s,n)=>{const i=s.leftDisplayTerms;(0,p.Ys)(this.yLabels.nativeElement).append("g").attr("class","subYlabelText").attr("transform","translate(0 "+t.clustersYpos[n]+")").selectAll("text").data(i).enter().append("text").attr("transform",function(g,m){return"translate(0, "+(m+.5)*t.rowHeight+")"}).text(function(g){return g}).attr("dy",.32*t.yLabelFontSize+"em").style("font-size",t.yLabelFontSize+"em")})}_toggleYlabelsVisibility(t){(0,p.Ys)(this.yLabels.nativeElement).attr("visibility",t*this.rowHeight>=.5*this.Y_LABLE_CHARACTER_HEIGHT?"visible":"hidden")}_addXlabels(){let t=this;(0,p.Ys)(t.xLabels.nativeElement).attr("transform","translate("+t.svgLeft2HeatmapWidth+" "+(t.svgHeight-t.marginBottom)+")").selectAll(".xLabels").data(t.topDisplayTerms).enter().append("text").attr("transform",function(i,u){const g=(u+.5)*t.rectWidth;return t.initialxLableXTranslate.push(g),"translate("+g+",0) rotate("+t.xLabelRotationDegree+")"}).text(i=>i).style("text-anchor","end").attr("font-size",t.xLabelFontSize+"em").attr("dy",.32*t.xLabelFontSize+"em")}_addVerticalScaleIndicators(){var t=this;let s=(0,p.Ys)(this.verticalScaleIndicators.nativeElement).attr("transform","translate("+t.marginLeft+" "+t.svgTop2HeatmapHeight+")");s.append("rect").attr("id","indicatorUp").attr("height",0).attr("width",t.verticalScaleIndicatorWidth).attr("fill","grey").attr("fill-opacity",.5);var n=(0,p.ohM)().on("start",function(g,m){const r=(0,p.Ys)(this).attr("y")-g.y;m.deltaY=r}).on("drag",function(g,m){let h=(0,p.Ys)(this);const r=g.y+m.deltaY,o=parseFloat(h.attr("height"));let d;d=r<=0?0:r>=t.heatmapHeight-o?t.heatmapHeight-o:r;const b=t.heatmapHeight-d-o;t.zoomFromScaleBar$.next({sourceOrientation:"vertical",scaleBarSetting:{smallEndRectLong:d,middleRectLong:o,bigEndRectLong:b,indicatorLong:o+d+b}})});s.append("g").selectAll("rect").data([{deltaX:0,deltaY:0}]).enter().append("rect").attr("id","indicatorMiddle").attr("height",t.heatmapHeight).attr("width",t.verticalScaleIndicatorWidth).attr("x",0).attr("y",0).attr("fill","grey").attr("fill-opacity",.1).style("cursor","row-resize").call(n),s.append("rect").attr("id","indicatorDown").attr("height",0).attr("width",t.verticalScaleIndicatorWidth).attr("fill","grey").attr("fill-opacity",.5);var i=(0,p.ohM)().on("start",function(g,m){const r=(0,p.Ys)(this).attr("y")-g.y;m.deltaY=r}).on("drag",function(g,m){const h=parseFloat((0,p.Ys)("#moveBarDown").attr("y")),r=g.y+m.deltaY;if(r<h&&r>=-15&&g.y<=t.heatmapHeight){let o;o=g.y<=-t.VERTICAL_MOVE_BAR_HEIGHT?-t.VERTICAL_MOVE_BAR_HEIGHT:g.y>=t.heatmapHeight?t.heatmapHeight:g.y,(0,p.Ys)(this).attr("y",o);const d=h-o-t.VERTICAL_MOVE_BAR_HEIGHT,f=o+t.VERTICAL_MOVE_BAR_HEIGHT,v=t.heatmapHeight-h;t.zoomFromScaleBar$.next({sourceOrientation:"vertical",scaleBarSetting:{smallEndRectLong:f,middleRectLong:d,bigEndRectLong:v,indicatorLong:d+f+v}})}});s.append("g").selectAll("rect").data([{deltaY:0}]).enter().append("rect").attr("id","moveBarUp").attr("height",t.VERTICAL_MOVE_BAR_HEIGHT).attr("width",t.verticalScaleIndicatorWidth).attr("fill","black").style("cursor","row-resize").attr("y",-t.VERTICAL_MOVE_BAR_HEIGHT).call(i);var u=(0,p.ohM)().on("drag",function(g){const m=parseFloat((0,p.Ys)("#moveBarUp").attr("y")),h=g.y;if(h>=m+t.VERTICAL_MOVE_BAR_HEIGHT&&h>=-15&&h<=t.heatmapHeight+5){let r;r=g.y<=-t.VERTICAL_MOVE_BAR_HEIGHT?-t.VERTICAL_MOVE_BAR_HEIGHT:g.y>=t.heatmapHeight?t.heatmapHeight:h,(0,p.Ys)(this).attr("y",r);const o=r-m-t.VERTICAL_MOVE_BAR_HEIGHT,d=m+t.VERTICAL_MOVE_BAR_HEIGHT,f=t.heatmapHeight-r;t.zoomFromScaleBar$.next({sourceOrientation:"vertical",scaleBarSetting:{smallEndRectLong:d,middleRectLong:o,bigEndRectLong:f,indicatorLong:o+d+f}})}});s.append("rect").attr("id","moveBarDown").attr("height",t.VERTICAL_MOVE_BAR_HEIGHT).attr("width",t.verticalScaleIndicatorWidth).attr("y",t.heatmapHeight).attr("fill","black").style("cursor","row-resize").call(u)}_addHorizontalScaleIndicators(){var t=this;let s=(0,p.Ys)(this.horizontalScaleIndicators.nativeElement).attr("transform","translate("+t.svgLeft2HeatmapWidth+" "+t.marginTop+")");s.append("rect").attr("id","topIndicatorLeft").attr("height",t.horizontalScaleIndicatorHeight).attr("width",0).attr("fill","grey").attr("fill-opacity",.5);var n=(0,p.ohM)().on("start",function(g,m){const r=(0,p.Ys)(this).attr("x")-g.x;m.deltaX=r}).on("drag",function(g,m){let h=(0,p.Ys)(this);const r=g.x+m.deltaX,o=parseFloat(h.attr("width"));let d;d=r<=0?0:r>=t.heatmapWidth-o?t.heatmapWidth-o:r;const b=t.heatmapWidth-d-o;t.zoomFromScaleBar$.next({sourceOrientation:"horizontal",scaleBarSetting:{smallEndRectLong:d,middleRectLong:o,bigEndRectLong:b,indicatorLong:d+o+b}})});s.append("g").selectAll("rect").data([{deltaX:0,deltaY:0}]).enter().append("rect").attr("id","topIndicatorMiddle").attr("height",t.horizontalScaleIndicatorHeight).attr("width",t.heatmapWidth).attr("fill","grey").attr("fill-opacity",.1).style("cursor","col-resize").call(n),s.append("rect").attr("id","topIndicatorRight").attr("height",t.horizontalScaleIndicatorHeight).attr("width",0).attr("fill","grey").attr("fill-opacity",.5);var i=(0,p.ohM)().on("start",function(g,m){const r=(0,p.Ys)(this).attr("x")-g.x;m.deltaX=r}).on("drag",function(g){const m=parseFloat((0,p.Ys)("#moveBarRight").attr("x")),h=g.x;if(h<m&&h>=-15&&h<=t.heatmapWidth){let r;r=h<=-t.HORIZONAL_MOVE_BAR_WIDTH?-t.HORIZONAL_MOVE_BAR_WIDTH:h>=t.heatmapWidth?t.heatmapWidth:h,(0,p.Ys)(this).attr("x",r);const o=m-r-t.HORIZONAL_MOVE_BAR_WIDTH,d=r+t.HORIZONAL_MOVE_BAR_WIDTH,f=t.heatmapWidth-m;t.zoomFromScaleBar$.next({sourceOrientation:"horizontal",scaleBarSetting:{smallEndRectLong:d,middleRectLong:o,bigEndRectLong:f,indicatorLong:d+o+f}})}});s.append("g").selectAll("rect").data([{deltaX:0}]).enter().append("rect").attr("id","moveBarLeft").attr("height",t.horizontalScaleIndicatorHeight).attr("width",t.HORIZONAL_MOVE_BAR_WIDTH).attr("fill","black").style("cursor","col-resize").attr("x",-t.HORIZONAL_MOVE_BAR_WIDTH).call(i);var u=(0,p.ohM)().on("drag",function(g){const m=parseFloat((0,p.Ys)("#moveBarLeft").attr("x")),h=g.x;if(h>m+t.HORIZONAL_MOVE_BAR_WIDTH&&h<=t.heatmapWidth+t.HORIZONAL_MOVE_BAR_WIDTH){let r;r=h<=-t.HORIZONAL_MOVE_BAR_WIDTH?-t.HORIZONAL_MOVE_BAR_WIDTH:h>=t.heatmapWidth?t.heatmapWidth:h,(0,p.Ys)(this).attr("x",r);const o=r-m-t.HORIZONAL_MOVE_BAR_WIDTH,d=m+t.HORIZONAL_MOVE_BAR_WIDTH,f=t.heatmapWidth-r;t.zoomFromScaleBar$.next({sourceOrientation:"horizontal",scaleBarSetting:{smallEndRectLong:d,middleRectLong:o,bigEndRectLong:f,indicatorLong:d+o+f}})}});s.append("rect").attr("id","moveBarRight").attr("height",t.horizontalScaleIndicatorHeight).attr("width",t.HORIZONAL_MOVE_BAR_WIDTH).attr("x",t.heatmapWidth).attr("fill","black").style("cursor","col-resize").call(u)}_highlightClickedCluster(t){const s=this,n=this.transformOneDirectionInfo.realTranslateY,i=this.transformOneDirectionInfo.realScaleY,u=n+s.clustersYpos[t]*i,g=u>=0?u:0;(0,p.Ys)(s.upCoverForHighlight.nativeElement).select("rect").attr("visibility","visible").attr("height",g);const h=s.heatmapHeight-(n+s.clustersYpos[t+1]*i),r=h>=0?h:0;(0,p.Ys)(s.downCoverForHighlight.nativeElement).select("rect").attr("visibility","visible").attr("height",r).attr("y",-r)}_disHighlightClickedCluster(){(0,p.Ys)(this.upCoverForHighlight.nativeElement).select("rect").attr("visibility","hidden"),(0,p.Ys)(this.downCoverForHighlight.nativeElement).select("rect").attr("visibility","hidden")}_drawCoversForHighlight(){const t=this;(0,p.Ys)(t.upCoverForHighlight.nativeElement).attr("transform","translate("+(t.svgLeft2HeatmapWidth-2)+" "+t.svgTop2HeatmapHeight+")").append("rect").attr("width",t.svgWidth).attr("height",50).attr("fill","white").attr("visibility","hidden").style("opacity",.9),(0,p.Ys)(t.downCoverForHighlight.nativeElement).attr("transform","translate("+(t.svgLeft2HeatmapWidth-2)+" "+(t.svgTop2HeatmapHeight+t.heatmapHeight)+")").append("rect").attr("width",t.svgWidth).attr("height",50).attr("y",-50).attr("fill","white").attr("visibility","hidden").style("opacity",.9)}_addCoverBoxes(){this._addHeatmapCoverRects(),this._addXlabelsCoverRects(),this._addYlabelsCoverRects()}_addHeatmapCoverRects(){const t=this,s=(0,p.Ys)(t.heatmapCoverRects.nativeElement).attr("transform","translate(0, 0)");s.append("rect").attr("height",t.svgTop2HeatmapHeight+1).attr("width",t.svgWidth).attr("fill","white"),s.append("rect").attr("x",0).attr("y",t.svgTop2HeatmapHeight+t.heatmapHeight-1).attr("width",t.svgWidth).attr("height",t.svgHeight-t.svgTop2HeatmapHeight-t.heatmapHeight+1).attr("fill","white"),s.append("rect").attr("y",t.svgTop2HeatmapHeight).attr("width",t.svgLeft2HeatmapWidth).attr("height",t.heatmapHeight).attr("fill","white"),s.append("rect").attr("x",t.svgLeft2HeatmapWidth+t.heatmapWidth).attr("y",t.svgTop2HeatmapHeight).attr("width",t.marginRight).attr("height",t.heatmapHeight).attr("fill","white")}_addXlabelsCoverRects(){var t=this;let s=(0,p.Ys)(t.xLabelsCoverRects.nativeElement);const n=-this.xLabelRotationDegree*Math.PI/180;s.append("rect").attr("x",0).attr("y",t.svgTop2HeatmapHeight+t.heatmapHeight).attr("width",t.svgLeft2HeatmapWidth-t.marginBottom*Math.cos(n)).attr("height",t.marginBottom).attr("fill","white")}_addYlabelsCoverRects(){var t=this;let s=(0,p.Ys)(t.yLabelsCoverRects.nativeElement);const n=t.svgLeft2HeatmapWidth+t.heatmapWidth;s.append("rect").attr("id","yLableTopCover").attr("transform","translate("+n+" 0)").attr("width",t.marginRight).attr("height",t.svgTop2HeatmapHeight).attr("fill","white");const i=t.svgLeft2HeatmapWidth+t.heatmapWidth,u=t.svgTop2HeatmapHeight+t.heatmapHeight;s.append("rect").attr("id","yLableDownCover").attr("transform","translate("+i+" "+u+")").attr("width",t.marginRight).attr("height",t.marginBottom).attr("fill","white")}_obtainAllValuesAsArray(){let t=[];return this.kmeansClusterResult.subClusters.forEach(s=>{s.dataMatrix.forEach(n=>{t=t.concat(n)})}),t}_convertScrollBarParameters2zoomParameters(t,s,n){const{smallEndRectLong:i,middleRectLong:u,indicatorLong:m}=Object.assign({},s),h=m/u,r=-i*h;return"vertical"===t?Object.assign(Object.assign({},n),{realScaleY:h,realTranslateY:r}):"horizontal"===t?Object.assign(Object.assign({},n),{realScaleX:h,realTranslateX:r}):void 0}_updateTransformInfo(t){this.transformOneDirectionInfo=Object.assign({},t)}_transformMapUsingRealZoomValues(t,s,n,i){const u=this,g=(0,p.Ys)(u.heatmap.nativeElement),m=(0,p.Ys)(u.xLabels.nativeElement),h=(0,p.Ys)(u.yLabels.nativeElement),v=((0,p.Ys)(u.upCoverForHighlight.nativeElement),(0,p.Ys)(u.downCoverForHighlight.nativeElement),u.svgLeft2HeatmapWidth+t),b=u.svgTop2HeatmapHeight+u.heatmapHeight,x=u.svgLeft2HeatmapWidth+u.heatmapWidth,y=u.svgTop2HeatmapHeight+s;if(g.attr("transform","translate("+(u.marginLeft+u.verticalScaleIndicatorWidth+u.verticalIndicatorHeatmapGap+t)+" "+(u.svgTop2HeatmapHeight+s)+") scale("+n+" "+i+")"),m.attr("transform","translate("+v+" "+b+")"),h.attr("transform","translate("+x+" "+y+") scale(1 1)"),m.selectAll("text").attr("transform",function(A,w){return"translate("+n*(u.initialxLableXTranslate[1]-u.initialxLableXTranslate[0])*(w+.5)+" 0)rotate("+u.xLabelRotationDegree+")"}),"visible"===(0,p.Ys)(this.yLabels.nativeElement).attr("visibility")){const A=h.selectAll(".subYlabelText");A.attr("transform",function(w,H){return"translate(0 "+i*u.clustersYpos[H]+")"}),A.each(function(w,H){(0,p.Ys)(this).selectAll("text").attr("transform",function($,B){return"translate(0 "+u.rowHeight*(B+.5)*i+")"})})}}_modifyVerticalScaleIndicators(t,s,n,i,u){(0,p.Ys)("#indicatorUp").attr("height",t),(0,p.Ys)("#indicatorMiddle").attr("height",s).attr("y",t),(0,p.Ys)("#indicatorDown").attr("height",n).attr("y",t+s),(0,p.Ys)("#moveBarUp").attr("y",t-u),(0,p.Ys)("#moveBarDown").attr("y",t+s)}_modifyHorizontalScaleIndicators(t,s,n,i,u){(0,p.Ys)("#topIndicatorLeft").attr("width",t),(0,p.Ys)("#topIndicatorMiddle").attr("width",s).attr("x",t),(0,p.Ys)("#topIndicatorRight").attr("width",n).attr("x",t+s),(0,p.Ys)("#moveBarLeft").attr("x",t-u),(0,p.Ys)("#moveBarRight").attr("x",t+s)}_computeRowsNum(){let t=0;return this.kmeansClusterResult.subClusters.forEach(s=>{t+=s.dataMatrix.length}),t}_computeRectsNum(){return this.kmeansClusterResult.topUniqueTerms.length}_computeSubclustersYpos(){let t=0,s=[];return this.kmeansClusterResult.subClusters.forEach((n,i)=>{s.push(t),t=t+this.rowHeight*n.dataMatrix.length+this.clusterGap}),s}_obtainMarginRight(){let t=0;const s=(0,J.H)(this.yLabelFontSize);return this._obtainLeftDisplayTerms().forEach(i=>{const u=i.length*s;u>t&&(t=u)}),t}_obtainMarginBottom(){let t=0;const s=(0,J.H)(this.xLabelFontSize),n=-this.xLabelRotationDegree*Math.PI/180;return this.kmeansClusterResult.topDisplayTerms.forEach(i=>{const u=i.length*s*Math.sin(n)+1.32*s*Math.cos(n);u>t&&(t=u)}),t}_obtainMarginLeft(){const t=-this.xLabelRotationDegree*Math.PI/180;return this.marginBottom*Math.cos(t)-this.verticalScaleIndicatorWidth}_obtainLeftDisplayTerms(){let t=[];return this.kmeansClusterResult.subClusters.forEach(s=>{t=t.concat(s.leftDisplayTerms)}),t}_computeRowHeight(){return(this.heatmapHeight-(this.clusterNum-1)*this.clusterGap)/this.rowsNum}_computeRectWidth(){return this.heatmapWidth/this.xLabelsNum}}return a.\u0275fac=function(t){return new(t||a)},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-kmeans-vis"]],viewQuery:function(t,s){if(1&t&&(e.Gf(ot,5),e.Gf(ct,5),e.Gf(ut,5),e.Gf(pt,5),e.Gf(dt,5),e.Gf(ht,5),e.Gf(mt,5),e.Gf(gt,5),e.Gf(ft,5),e.Gf(_t,5),e.Gf(It,5),e.Gf(vt,5)),2&t){let n;e.iGM(n=e.CRH())&&(s.svgContainer=n.first),e.iGM(n=e.CRH())&&(s.svgElement=n.first),e.iGM(n=e.CRH())&&(s.heatmap=n.first),e.iGM(n=e.CRH())&&(s.heatmapCoverRects=n.first),e.iGM(n=e.CRH())&&(s.xLabels=n.first),e.iGM(n=e.CRH())&&(s.xLabelsCoverRects=n.first),e.iGM(n=e.CRH())&&(s.yLabels=n.first),e.iGM(n=e.CRH())&&(s.yLabelsCoverRects=n.first),e.iGM(n=e.CRH())&&(s.verticalScaleIndicators=n.first),e.iGM(n=e.CRH())&&(s.horizontalScaleIndicators=n.first),e.iGM(n=e.CRH())&&(s.upCoverForHighlight=n.first),e.iGM(n=e.CRH())&&(s.downCoverForHighlight=n.first)}},inputs:{kmeansClusterResult:"kmeansClusterResult",auditTime:"auditTime"},outputs:{selectedClusterIndex$:"selectedClusterIndex$",mapSettings$:"mapSettings$"},features:[e.TTD],decls:24,vars:0,consts:[["svgContainer",""],[2,"height","80vh"],["svgElement",""],["heatmap",""],["heatmapCoverRects",""],["data-testid","xLabels"],["xLabels",""],["xLabelsCoverRects",""],["data-testid","yLabels"],["yLabels",""],["yLabelsCoverRects",""],["verticalScaleIndicators",""],["horizontalScaleIndicators",""],["data-testid","upCoverForHighlight"],["upCoverForHighlight",""],["data-testid","downCoverForHighlight"],["downCoverForHighlight",""]],template:function(t,s){1&t&&(e.TgZ(0,"div",null,0),e.O4$(),e.TgZ(2,"svg",1,2),e._UZ(4,"g",null,3),e._UZ(6,"g",null,4),e._UZ(8,"g",5,6),e._UZ(10,"g",null,7),e._UZ(12,"g",8,9),e._UZ(14,"g",null,10),e._UZ(16,"g",null,11),e._UZ(18,"g",null,12),e._UZ(20,"g",13,14),e._UZ(22,"g",15,16),e.qZA(),e.qZA())},styles:[""],changeDetection:0}),a})(),St=(()=>{class a{constructor(){this.genesSelected$=new e.vpe}ngOnInit(){this._obtainKmeansVisInfo()}ngOnChanges(t){t.kmeansClusterResult&&!t.kmeansClusterResult.isFirstChange()&&this._obtainKmeansVisInfo()}_obtainKmeansVisInfo(){this.clusterResultAndTransform&&(this.kmeansClusterResult=function(a){const l=a.result,t=l.dataArray,s=l.leftUniqueTerms,n=l.leftDisplayTerms,i={};l.clusterIndex.forEach((m,h)=>{i.hasOwnProperty(m)?i[m].push(h):i[m]=[h]});let u=[];const g=l.clusterIndex.reduce((m,h)=>Math.max(m,h),0);for(let m=0;m<=g;m++){let h=[],r=[],o=[];i[m].forEach(d=>{h.push(t[d]),r.push(s[d]),o.push(n[d])}),u.push({dataMatrix:h,leftUniqueTerms:r,leftDisplayTerms:o})}return{subClusters:u,topUniqueTerms:l.topUniqueTerms,topDisplayTerms:l.topDisplayTerms}}(this.clusterResultAndTransform))}processSelectedClusterIndex(t){if(t>=0){const s=this.kmeansClusterResult.subClusters[t].leftUniqueTerms,n={clickedNode:t.toString(),genes:s};this.genesSelected$.next(n)}else this.genesSelected$.next({clickedNode:"",genes:[]})}}return a.\u0275fac=function(t){return new(t||a)},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-vis-kmeans-cluster-result"]],inputs:{clusterResultAndTransform:"clusterResultAndTransform"},outputs:{genesSelected$:"genesSelected$"},features:[e.TTD],decls:1,vars:1,consts:[[3,"kmeansClusterResult","selectedClusterIndex$"]],template:function(t,s){1&t&&(e.TgZ(0,"app-kmeans-vis",0),e.NdJ("selectedClusterIndex$",function(i){return s.processSelectedClusterIndex(i)}),e.qZA()),2&t&&e.Q6J("kmeansClusterResult",s.kmeansClusterResult)},directives:[Ct],styles:[""],changeDetection:0}),a})();function Tt(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"app-vis-hierarchical-cluster-result",2),e.NdJ("genesSelected$",function(n){return e.CHM(t),e.oxw().processGenesSelected(n)}),e.qZA()}if(2&a){const t=e.oxw();e.Q6J("clusterResultTransform",t.clusterResultAndTransform)}}function bt(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"app-vis-kmeans-cluster-result",3),e.NdJ("genesSelected$",function(n){return e.CHM(t),e.oxw().processGenesSelected(n)}),e.qZA()}if(2&a){const t=e.oxw();e.Q6J("clusterResultAndTransform",t.clusterResultAndTransform)}}let Rt=(()=>{class a{constructor(){this.genesSelected$=new e.vpe}ngOnInit(){this._obtainClusterMethid()}ngOnChanges(t){t.clusterResultAndTransform&&!t.clusterResultAndTransform.isFirstChange()&&this._obtainClusterMethid()}_obtainClusterMethid(){this.clusterResultAndTransform&&(this.clusterMethod=this.clusterResultAndTransform.clusterMethod,this.genesSelected$.next({clickedNode:"",genes:[]}))}processGenesSelected(t){this.genesSelected$.next(t)}}return a.\u0275fac=function(t){return new(t||a)},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-vis-cluster-result-with-map"]],inputs:{clusterResultAndTransform:"clusterResultAndTransform"},outputs:{genesSelected$:"genesSelected$"},features:[e.TTD],decls:2,vars:2,consts:[[3,"clusterResultTransform","genesSelected$",4,"ngIf"],[3,"clusterResultAndTransform","genesSelected$",4,"ngIf"],[3,"clusterResultTransform","genesSelected$"],[3,"clusterResultAndTransform","genesSelected$"]],template:function(t,s){1&t&&(e.YNc(0,Tt,1,1,"app-vis-hierarchical-cluster-result",0),e.YNc(1,bt,1,1,"app-vis-kmeans-cluster-result",1)),2&t&&(e.Q6J("ngIf","Hierarchical"===s.clusterMethod),e.xp6(1),e.Q6J("ngIf","Kmeans"===s.clusterMethod))},directives:[D.O5,it,St],styles:[""],changeDetection:0}),a})();var xt=c(4547),yt=c(5826),Dt=c(6458);function Lt(a,l){if(1&a&&(e.TgZ(0,"p",5),e._uU(1),e.qZA()),2&a){const t=e.oxw();e.xp6(1),e.hij(" The genes selected from the clustering heatmap with name '",t.addSelectedGenesInfo.currentGeneListID,"' has been added to gene lists. You can use it in other apps\n")}}let Gt=(()=>{class a{constructor(){this.genesForEnrichment$=new e.vpe,this.visPPIsRequest$=new e.vpe,this.selectedGene$=new e.vpe,this.addSelectedGenesToStore$=new e.vpe,this.ifGenesSelected=!1}ngOnInit(){var t;this.ifGenesSelected=(null===(t=this.genesInfoForTable)||void 0===t?void 0:t.genesInfo.length)>=1}ngOnChanges(t){var s;t.genesInfoForTable&&!t.genesInfoForTable.isFirstChange()&&(this.ifGenesSelected=(null===(s=this.genesInfoForTable)||void 0===s?void 0:s.genesInfo.length)>=1)}requestEnrichedAnalysis(t){const s=this.genesInfoForTable.features[0],n=this.genesInfoForTable.genesInfo.map(i=>i[s]);this.genesForEnrichment$.next(n)}visPPInetwork(t){this.visPPIsRequest$.next(!0)}processedSelectedGene(t){this.selectedGene$.next(t)}addSelectedGenesToGeneList(t){this.addSelectedGenesToStore$.next(!0)}}return a.\u0275fac=function(t){return new(t||a)},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-selected-genes-management"]],inputs:{genesInfoForTable:"genesInfoForTable",addSelectedGenesInfo:"addSelectedGenesInfo"},outputs:{genesForEnrichment$:"genesForEnrichment$",visPPIsRequest$:"visPPIsRequest$",selectedGene$:"selectedGene$",addSelectedGenesToStore$:"addSelectedGenesToStore$"},features:[e.TTD],decls:8,vars:5,consts:[[3,"genesInfoForTable","selectedGene$"],["data-testid","enrichSubmit",1,"btn","btn-sm","btn-expressvis","mr-2","mt-1",3,"disabled","click"],["data-testid","triggerVisPPI",1,"btn","btn-sm","btn-expressvis","mr-2","mt-1",3,"disabled","click"],["data-testid","addToGeneList",1,"btn","btn-sm","btn-expressvis","mr-2","mt-1",3,"disabled","click"],["class","text-success","data-testid","clusterSelectedGenesHasBeenAddedNote",4,"ngIf"],["data-testid","clusterSelectedGenesHasBeenAddedNote",1,"text-success"]],template:function(t,s){1&t&&(e.TgZ(0,"app-display-genes-info-table-pagination",0),e.NdJ("selectedGene$",function(i){return s.processedSelectedGene(i)}),e.qZA(),e.TgZ(1,"button",1),e.NdJ("click",function(i){return s.requestEnrichedAnalysis(i)}),e._uU(2," Enrichment Analysis\n"),e.qZA(),e.TgZ(3,"button",2),e.NdJ("click",function(i){return s.visPPInetwork(i)}),e._uU(4," Visualize PPIs in PPIExp\n"),e.qZA(),e.TgZ(5,"button",3),e.NdJ("click",function(i){return s.addSelectedGenesToGeneList(i)}),e._uU(6," Add Genes To Gene Lists\n"),e.qZA(),e.YNc(7,Lt,2,1,"p",4)),2&t&&(e.Q6J("genesInfoForTable",s.genesInfoForTable),e.xp6(1),e.Q6J("disabled",!s.ifGenesSelected),e.xp6(2),e.Q6J("disabled",!s.ifGenesSelected),e.xp6(2),e.Q6J("disabled",!s.ifGenesSelected||(null==s.addSelectedGenesInfo?null:s.addSelectedGenesInfo.ifAdded)),e.xp6(2),e.Q6J("ngIf",null==s.addSelectedGenesInfo?null:s.addSelectedGenesInfo.ifAdded))},directives:[Dt.T,D.O5],styles:[""],changeDetection:0}),a})();var At=c(6988),wt=c(6588),Et=c(8200);let Ht=(()=>{class a{transform(t,...s){if(t&&t.length>=1)return[...t].reverse()}}return a.\u0275fac=function(t){return new(t||a)},a.\u0275pipe=e.Yjl({name:"reverse",type:a,pure:!0}),a})();const $t=["inputGeneListComponent"],Mt=["enrichmentContent"];function Nt(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"div",22),e.TgZ(1,"div",23),e.TgZ(2,"app-try-sample",24),e.NdJ("sampleForTryName$",function(n){return e.CHM(t),e.oxw().processTrySampleFileName(n)})("sampleForImportName$",function(n){return e.CHM(t),e.oxw().processDownloadSampleData(n)})("closeMe$",function(n){return e.CHM(t),e.oxw().closeTrySampleComponent(n)}),e.ALo(3,"async"),e.qZA(),e.qZA(),e.qZA()}if(2&a){const t=e.oxw();e.xp6(2),e.Q6J("fileInfos",t.trySamplesInfos)("trySamplePercentage",e.lcZ(3,2,t.trySamplePercentage$))}}function Ft(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"app-selected-genes-management",25),e.NdJ("genesForEnrichment$",function(n){return e.CHM(t),e.oxw().processEnrichmentRequest(n)})("selectedGene$",function(n){return e.CHM(t),e.oxw().processSelectedGene(n)})("visPPIsRequest$",function(n){return e.CHM(t),e.oxw().processVisPPIsRequest(n)})("addSelectedGenesToStore$",function(n){return e.CHM(t),e.oxw().processAddSelectedGenesToStoreSignal(n)}),e.ALo(1,"async"),e.ALo(2,"async"),e.qZA()}if(2&a){const t=e.oxw();e.Q6J("genesInfoForTable",e.lcZ(1,2,t.genesInfoForTable$))("addSelectedGenesInfo",e.lcZ(2,4,t.addSelectedGenesInfo$))}}function Zt(a,l){1&a&&(e.TgZ(0,"p",26),e._uU(1," Click one line in the left dendgrogram to select genes in its children nodes (for hierarchical clustering analysis); Or click on the heatmap to select genes in the clicked cluster (For Kmeans clustering analysis); "),e.qZA())}function Ot(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"app-display-one-gene-expression",27),e.NdJ("closeSignal$",function(n){return e.CHM(t),e.oxw().closeModalForExpression(n)}),e.ALo(1,"async"),e.qZA()}if(2&a){const t=e.oxw();e.Q6J("geneExpForBoxPlot",e.lcZ(1,1,t.geneExpForBoxPlot$))}}function Yt(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"div",28),e.TgZ(1,"h3"),e._uU(2,"Generate a New Gene List"),e.qZA(),e.TgZ(3,"button",29),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return null==n.inputGenelistModalRef?null:n.inputGenelistModalRef.hide()}),e.TgZ(4,"span",30),e._uU(5,"\xd7"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(6,"div",31),e.TgZ(7,"app-generate-new-gene-list",32),e.NdJ("outputGeneList$",function(n){return e.CHM(t),e.oxw().processInputGeneList(n)})("annotationTermsRequest$",function(n){return e.CHM(t),e.oxw().processAnnotationTermsRequest(n)})("annotationGenesRequest$",function(n){return e.CHM(t),e.oxw().processAnnotationGenesRequest(n)})("geneListFromDatasetRequest$",function(n){return e.CHM(t),e.oxw().processGeneListFromDatasetRequest(n)}),e.ALo(8,"async"),e.ALo(9,"async"),e.ALo(10,"async"),e.ALo(11,"async"),e.ALo(12,"async"),e.ALo(13,"async"),e.qZA(),e.qZA(),e.TgZ(14,"div",33),e.TgZ(15,"button",34),e.NdJ("click",function(){return e.CHM(t),e.oxw().inputGenelistModalRef.hide()}),e._uU(16,"close"),e.qZA(),e.qZA()}if(2&a){const t=e.oxw();e.xp6(7),e.Q6J("defaultWay","Obtain Top Variable Genes from Dataset")("availableSpecies",e.lcZ(8,7,t.availableSpecies$))("availableGeneIDtypes",e.lcZ(9,9,t.availableGeneIDtypes$))("annotationTerms",e.lcZ(10,11,t.annotationTerms$))("allDatasetInfoForDisplay",e.lcZ(11,13,t.allDatasetInfoForDisplay$))("geneNumberAfterFilter",e.lcZ(12,15,t.geneNumberAfterFilter$))("latestAddedGeneListID",e.lcZ(13,17,t.latestAddedGenelistName$))}}function qt(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"div",28),e.TgZ(1,"h4",35),e._uU(2,"Genes Enrichment Analysis"),e.qZA(),e.TgZ(3,"button",29),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return null==n.enrichedModalRef?null:n.enrichedModalRef.hide()}),e.TgZ(4,"span",30),e._uU(5,"\xd7"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(6,"div",31),e.TgZ(7,"app-display-enriched-annotations",36),e.NdJ("selectedAnnotationTermGenes$",function(n){return e.CHM(t),e.oxw().processSelectedAnnotationTermGenes(n)})("selectedKEGGpathway$",function(n){return e.CHM(t),e.oxw().processSelectedKEGGpathway(n)})("selectedGene$",function(n){return e.CHM(t),e.oxw().processSelectedGene(n)}),e.ALo(8,"async"),e.ALo(9,"async"),e.qZA(),e.qZA(),e.TgZ(10,"div",33),e.TgZ(11,"button",37),e.NdJ("click",function(){return e.CHM(t),e.oxw().enrichedModalRef.hide()}),e._uU(12," close "),e.qZA(),e.qZA()}if(2&a){const t=e.oxw();e.xp6(7),e.Q6J("geneListErichedResultStatus",e.lcZ(8,2,t.geneListEnrichedResultStatus$))("annotationTermGenesInfoForTable",e.lcZ(9,4,t.annotationTermGenesInfoForTable$))}}const Bt=[{path:"",component:(()=>{class a{constructor(t,s,n){this.facade=t,this.modalService=s,this.cdr=n,this.availableGeneListNames$=this.facade.allGeneListIDs$.pipe((0,ee.d)(2)),this.allDatasetInfoForDisplay$=this.facade.allDatasetInfoForDisplay$,this.availableClusterResultIDs$=this.facade.availableClusterResultIDs$,this.clusterResultAndTransform$=this.facade.datasetGeneListClusterResultAndTransform$,this.genesInfoForTable$=this.facade.selectedGenesInfo$.pipe((0,ee.d)(1)),this.geneExpForBoxPlot$=this.facade.selectedGeneExpForBoxPlot$,this.latestAddedGenelistName$=this.facade.latestAddedGenelistName$,this.annotationTerms$=this.facade.annotationTerms$,this.geneNumberAfterFilter$=this.facade.geneNumberAfterFilter$,this.geneListEnrichedResultStatus$=this.facade.selectedGenesEnrichedResultStatus$,this.selectedGenesInfoSubject=new S.X(null),this.trySamplePercentage$=this.facade.trySamplePercentage$,this.trySamplesInfos=[{fileForImport:"RNA-seq-sample-data1.zip",fileForTry:"RNAseqClusterExp.json.gz",description:"RNA-seq Data"}],this.ifShowTrySampleComponent=!0,this.allAvailableSpecies=Q.it,this.availableGeneIDtypes=Q.k1,this.selectedDatasetIDsubject=new S.X(null),this.annotationTermGenesSubject=new S.X(null),this.genesForEncirhmentSubject=new S.X(null),this.ifShowOneGeneExpression=!1,this.faTimes=z.NBC,this.faTable=z.B3e}ngOnInit(){this.availableGeneIDtypes$=this.selectedDatasetIDsubject.pipe((0,G.M)(this.allDatasetInfoForDisplay$),(0,T.U)(([t,s])=>{if(t){let n;return s.forEach(u=>{u.datasetID===t&&(n={name:u.IDtype,description:u.IDtype})}),[Object.assign({},n)]}return this.availableGeneIDtypes})),this.availableSpecies$=this.selectedDatasetIDsubject.pipe((0,G.M)(this.allDatasetInfoForDisplay$),(0,T.U)(([t,s])=>{if(t&&s){let n;for(let u of s)if(u.datasetID===t){n=u.speciesID;break}let i=[];for(const u of this.allAvailableSpecies)u.taxID===n&&i.push(u);return i}return this.allAvailableSpecies})),this.genesForEncirhmentSubject.pipe((0,I.h)(t=>null!=t),(0,G.M)(this.clusterResultAndTransform$.pipe((0,I.h)(t=>null!=t))),(0,T.U)(([t,s])=>({genes:t,backgroundGenes:s.result.leftUniqueTerms}))).subscribe(t=>{this.facade.requestEnrichedAnnotations(t)}),this.annotationTermGenesInfoForTable$=this.annotationTermGenesSubject.pipe((0,I.h)(t=>null!=t),(0,G.M)(this.genesInfoForTable$.pipe((0,I.h)(t=>null!=t))),(0,T.U)(([t,s])=>{const n=t.genes,i=s.features[0],u=s.genesInfo.filter(g=>n.includes(g[i]));return{features:s.features,genesInfo:u}})),this.addSelectedGenesInfo$=(0,K.aj)([this.selectedGenesInfoSubject.pipe((0,I.h)(t=>null!=t)),this.availableGeneListNames$.pipe((0,I.h)(t=>null!=t)),this.clusterResultAndTransform$.pipe((0,I.h)(t=>null!=t),(0,T.U)(t=>t.clusterResultID))]).pipe((0,T.U)(([t,s,n])=>{const i=Z(n,t.clickedNode);return{ifAdded:s.includes(i),currentGeneListID:i}}))}processSelectedDatasetID(t){this.selectedDatasetIDsubject.next(t)}processClusterRequestInfo(t){this.facade.processClusteringRequest(t)}processSelectedClusterResultID(t){this.facade.requestClusterResultAndTransform(t)}processInputGeneListSignal(t){this.inputGenelistModalRef=this.modalService.show(this.inputGeneListComponent),this.cdr.detectChanges()}processInputGeneList(t){this.facade.addGeneListToTheStore(t)}processAnnotationTermsRequest(t){this.facade.requestAnnotationTerms(t)}processAnnotationGenesRequest(t){this.facade.requestAnnotationGenes(t)}processGeneListFromDatasetRequest(t){this.facade.processNewGeneListFromDatasetRequest(t)}processGenesSelected(t){this.facade.requestSelectedGenesInfo(t),this.selectedGenesInfoSubject.next(t)}processEnrichmentRequest(t){this.genesForEncirhmentSubject.next(t),this.enrichedModalRef=this.modalService.show(this.enrichmentContent,Object.assign({},{class:"modal-xl"}))}processSelectedAnnotationTermGenes(t){this.annotationTermGenesSubject.next(t)}processSelectedKEGGpathway(t){var s;this.facade.visKeggPathway(t),null===(s=this.enrichedModalRef)||void 0===s||s.hide()}processVisPPIsRequest(t){this.facade.visSelectedGenesPPIs()}processAddSelectedGenesToStoreSignal(t){this.facade.addSelectedToGeneLists()}processSelectedGene(t){this.ifShowOneGeneExpression=!0,this.facade.requestOneGeneExpressionForBoxplot(t)}closeModalForExpression(t){this.ifShowOneGeneExpression=!1}downloadGenes(t){}processDownloadProjectSignal(t){this.facade.downloadProjectSignal()}processTrySampleFileName(t){this.facade.prepareTrySampleData(t)}closeTrySampleComponent(t){this.ifShowTrySampleComponent=!1}processDownloadSampleData(t){this.facade.downloadSampleData(t)}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(re),e.Y36(X.tT),e.Y36(e.sBO))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-cluster-exp"]],viewQuery:function(t,s){if(1&t&&(e.Gf($t,5,e.Rgc),e.Gf(Mt,5,e.Rgc)),2&t){let n;e.iGM(n=e.CRH())&&(s.inputGeneListComponent=n.first),e.iGM(n=e.CRH())&&(s.enrichmentContent=n.first)}},decls:33,vars:22,consts:[[1,"row","flex-xl-nowrap"],[1,"col-12","col-md-3","col-xl-2","border","bd-sidebar"],[3,"allDatasetInfoForDisplay","availableGeneListNames","selectedDatasetID$","clusterRequestInfo$","inputNewGeneListSignal$"],[1,"col-12","col-md-9","col-xl-10","mt-2"],["class","row border",4,"ngIf"],[1,"row","mt-2"],["data-testid","selectClusterResultID",1,"col-12",3,"geneListclusterIDs","selectedClusterID$"],[1,"row","row-cols-3","mt-1"],[1,"col-12","col-md-7","order-1","order-md-1","border"],[1,"text-center",2,"margin-bottom","0"],[1,"col-12","col-md-5","order-3","order-md-3","border"],[1,"text-center"],[1,"col-12","col-md-7","order-2","order-md-4","border","mainVisSection",3,"clusterResultAndTransform","genesSelected$"],[1,"col-12","col-md-5","order-4","order-md-6","border","mainVisSection",2,"background-color","white"],[3,"genesInfoForTable","addSelectedGenesInfo","genesForEnrichment$","selectedGene$","visPPIsRequest$","addSelectedGenesToStore$",4,"ngIf"],["data-testid","selectedGenesFromHeatmapNote","class","text-info",4,"ngIf"],[1,"row","mt-4"],[1,"col-12"],[3,"downloadProjectSignal$"],["cdkDrag","","class","moveFreeDiv border",3,"geneExpForBoxPlot","closeSignal$",4,"ngIf"],["inputGeneListComponent",""],["enrichmentContent",""],[1,"row","border"],[1,"col-12","p-1"],[3,"fileInfos","trySamplePercentage","sampleForTryName$","sampleForImportName$","closeMe$"],[3,"genesInfoForTable","addSelectedGenesInfo","genesForEnrichment$","selectedGene$","visPPIsRequest$","addSelectedGenesToStore$"],["data-testid","selectedGenesFromHeatmapNote",1,"text-info"],["cdkDrag","",1,"moveFreeDiv","border",3,"geneExpForBoxPlot","closeSignal$"],[1,"modal-header"],["type","button","aria-label","Close",1,"btn-close","close","pull-right",3,"click"],["aria-hidden","true",1,"visually-hidden"],[1,"modal-body"],[3,"defaultWay","availableSpecies","availableGeneIDtypes","annotationTerms","allDatasetInfoForDisplay","geneNumberAfterFilter","latestAddedGeneListID","outputGeneList$","annotationTermsRequest$","annotationGenesRequest$","geneListFromDatasetRequest$"],[1,"modal-footer"],["data-testid","closeGeneListInput","type","button",1,"btn","btn-default","btn-sm",3,"click"],[1,"modal-title"],[3,"geneListErichedResultStatus","annotationTermGenesInfoForTable","selectedAnnotationTermGenes$","selectedKEGGpathway$","selectedGene$"],["data-testid","closeGeneListInput","type","button",1,"btn","btn-default",3,"click"]],template:function(t,s){if(1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"app-generate-new-cluster-analysis",2),e.NdJ("selectedDatasetID$",function(i){return s.processSelectedDatasetID(i)})("clusterRequestInfo$",function(i){return s.processClusterRequestInfo(i)})("inputNewGeneListSignal$",function(i){return s.processInputGeneListSignal(i)}),e.ALo(3,"async"),e.ALo(4,"async"),e.qZA(),e.qZA(),e.TgZ(5,"div",3),e.YNc(6,Nt,4,4,"div",4),e.TgZ(7,"div",5),e.TgZ(8,"app-select-a-cluster-result",6),e.NdJ("selectedClusterID$",function(i){return s.processSelectedClusterResultID(i)}),e.ALo(9,"reverse"),e.ALo(10,"async"),e.qZA(),e.qZA(),e.TgZ(11,"div",7),e.TgZ(12,"div",8),e.TgZ(13,"h5",9),e._uU(14," Heatmap "),e.qZA(),e.qZA(),e.TgZ(15,"div",10),e.TgZ(16,"h5",11),e._uU(17," Genes Selected "),e.qZA(),e.qZA(),e.TgZ(18,"app-vis-cluster-result-with-map",12),e.NdJ("genesSelected$",function(i){return s.processGenesSelected(i)}),e.ALo(19,"async"),e.qZA(),e.TgZ(20,"div",13),e.YNc(21,Ft,3,6,"app-selected-genes-management",14),e.ALo(22,"async"),e.YNc(23,Zt,2,0,"p",15),e.ALo(24,"async"),e.qZA(),e.qZA(),e.TgZ(25,"div",16),e.TgZ(26,"div",17),e.TgZ(27,"app-download-project",18),e.NdJ("downloadProjectSignal$",function(i){return s.processDownloadProjectSignal(i)}),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.YNc(28,Ot,2,3,"app-display-one-gene-expression",19),e.qZA(),e.YNc(29,Yt,17,19,"ng-template",null,20,e.W1O),e.YNc(31,qt,13,6,"ng-template",null,21,e.W1O)),2&t){let n,i;e.xp6(2),e.Q6J("allDatasetInfoForDisplay",e.lcZ(3,8,s.allDatasetInfoForDisplay$))("availableGeneListNames",e.lcZ(4,10,s.availableGeneListNames$)),e.xp6(4),e.Q6J("ngIf",s.ifShowTrySampleComponent),e.xp6(2),e.Q6J("geneListclusterIDs",e.lcZ(9,12,e.lcZ(10,14,s.availableClusterResultIDs$))),e.xp6(10),e.Q6J("clusterResultAndTransform",e.lcZ(19,16,s.clusterResultAndTransform$)),e.xp6(3),e.Q6J("ngIf",(null==(n=e.lcZ(22,18,s.genesInfoForTable$))?null:n.genesInfo.length)>0),e.xp6(2),e.Q6J("ngIf",!((null==(i=e.lcZ(24,20,s.genesInfoForTable$))?null:i.genesInfo.length)>0)),e.xp6(5),e.Q6J("ngIf",s.ifShowOneGeneExpression)}},directives:[tt,D.O5,at,Rt,xt.E,yt.P,Gt,At.R,k.Zt,wt.D,Et.r],pipes:[D.Ov,Ht],styles:[""]}),a})(),data:{key:"ClusterExp"}}];let Pt=(()=>{class a{}return a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[[F.Bz.forChild(Bt)],F.Bz]}),a})(),Vt=(()=>{class a{}return a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({providers:[re],imports:[[D.ez,F.Bz,ue.JF,_.u5,_.UX,pe.Q8,de.Cl,k._t,he.uH,X.zk.forRoot(),me.D,fe.f,ge.m,Pt]]}),a})()}}]);